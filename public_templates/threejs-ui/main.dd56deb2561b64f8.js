"use strict";(self.webpackChunkthreegamification_ui=self.webpackChunkthreegamification_ui||[]).push([[792],{398:(Sr,nr,cp)=>{let uo;function ec(){return uo}function as(n){const e=uo;return uo=n,e}cp(935);const hv=Symbol("NotFound");function tc(n){return n===hv||"\u0275NotFound"===n?.name}Error;let vi=null,ir=!1,Hr=1;const oi=Symbol("SIGNAL");function _t(n){const e=vi;return vi=n,e}const Un={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function ic(n){if(ir)throw new Error("");if(null===vi)return;vi.consumerOnSignalRead(n);const e=vi.producersTail;if(void 0!==e&&e.producer===n)return;let t;const i=vi.recomputing;if(i&&(t=void 0!==e?e.nextProducer:vi.producers,void 0!==t&&t.producer===n))return vi.producersTail=t,void(t.lastReadVersion=n.version);const r=n.consumersTail;if(void 0!==r&&r.consumer===vi&&(!i||function fv(n,e){const t=e.producersTail;if(void 0!==t){let i=e.producers;do{if(i===n)return!0;if(i===t)break;i=i.nextProducer}while(void 0!==i)}return!1}(r,vi)))return;const s=Ri(vi),o={producer:n,consumer:vi,nextProducer:t,prevConsumer:r,lastReadVersion:n.version,nextConsumer:void 0};vi.producersTail=o,void 0!==e?e.nextProducer=o:vi.producers=o,s&&Ud(n,o)}function rc(n){if((!Ri(n)||n.dirty)&&(n.dirty||n.lastCleanEpoch!==Hr)){if(!n.producerMustRecompute(n)&&!Cl(n))return void sa(n);n.producerRecomputeValue(n),sa(n)}}function Fd(n){if(void 0===n.consumers)return;const e=ir;ir=!0;try{for(let t=n.consumers;void 0!==t;t=t.nextConsumer){const i=t.consumer;i.dirty||Tl(i)}}finally{ir=e}}function kd(){return!1!==vi?.consumerAllowSignalWrites}function Tl(n){n.dirty=!0,Fd(n),n.consumerMarkedDirty?.(n)}function sa(n){n.dirty=!1,n.lastCleanEpoch=Hr}function fo(n){return n&&(n.producersTail=void 0,n.recomputing=!0),_t(n)}function zs(n,e){if(_t(e),!n)return;n.recomputing=!1;const t=n.producersTail;let i=void 0!==t?t.nextProducer:n.producers;if(void 0!==i){if(Ri(n))do{i=Dl(i)}while(void 0!==i);void 0!==t?t.nextProducer=void 0:n.producers=void 0}}function Cl(n){for(let e=n.producers;void 0!==e;e=e.nextProducer){const t=e.producer,i=e.lastReadVersion;if(i!==t.version||(rc(t),i!==t.version))return!0}return!1}function oa(n){if(Ri(n)){let e=n.producers;for(;void 0!==e;)e=Dl(e)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function Ud(n,e){const t=n.consumersTail,i=Ri(n);if(void 0!==t?(e.nextConsumer=t.nextConsumer,t.nextConsumer=e):(e.nextConsumer=void 0,n.consumers=e),e.prevConsumer=t,n.consumersTail=e,!i)for(let r=n.producers;void 0!==r;r=r.nextProducer)Ud(r.producer,r)}function Dl(n){const e=n.producer,t=n.nextProducer,i=n.nextConsumer,r=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,void 0!==i?i.prevConsumer=r:e.consumersTail=r,void 0!==r)r.nextConsumer=i;else if(e.consumers=i,!Ri(e)){let s=e.producers;for(;void 0!==s;)s=Dl(s)}return t}function Ri(n){return n.consumerIsAlwaysLive||void 0!==n.consumers}let fp=function hp(){throw new Error};function rr(n){fp(n)}function mp(n,e){const t=Object.create(aa);t.value=n,void 0!==e&&(t.equal=e);const i=()=>function mv(n){return ic(n),n.value}(t);return i[oi]=t,[i,o=>oc(t,o),o=>function gp(n,e){kd()||rr(n),oc(n,e(n.value))}(t,o)]}function oc(n,e){kd()||rr(n),n.equal(n.value,e)||(n.value=e,function ca(n){n.version++,function Ld(){Hr++}(),Fd(n)}(n))}const aa={...Un,equal:function nc(n,e){return Object.is(n,e)},value:void 0,kind:"signal"};function Nn(n){return"function"==typeof n}function Bd(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Vd=Bd(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function ac(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Ti{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(Nn(i))try{i()}catch(s){e=s instanceof Vd?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{yp(s)}catch(o){e=e??[],o instanceof Vd?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Vd(e)}}add(e){var t;if(e&&e!==this)if(this.closed)yp(e);else{if(e instanceof Ti){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&ac(t,e)}remove(e){const{_finalizers:t}=this;t&&ac(t,e),e instanceof Ti&&e._removeParent(this)}}Ti.EMPTY=(()=>{const n=new Ti;return n.closed=!0,n})();const Al=Ti.EMPTY;function _p(n){return n instanceof Ti||n&&"closed"in n&&Nn(n.remove)&&Nn(n.add)&&Nn(n.unsubscribe)}function yp(n){Nn(n)?n():n.unsubscribe()}const mo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Il={setTimeout(n,e,...t){const{delegate:i}=Il;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Il;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function vp(n){Il.setTimeout(()=>{const{onUnhandledError:e}=mo;if(!e)throw n;e(n)})}function zd(){}const gv=H("C",void 0,void 0);function H(n,e,t){return{kind:n,value:e,error:t}}let ne=null;function U(n){if(mo.useDeprecatedSynchronousErrorHandling){const e=!ne;if(e&&(ne={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=ne;if(ne=null,t)throw i}}else n()}class Se extends Ti{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,_p(e)&&e.add(this)):this.destination=_n}static create(e,t,i){return new yt(e,t,i)}next(e){this.isStopped?Ut(function z(n){return H("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Ut(function Ep(n){return H("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Ut(gv,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Qe=Function.prototype.bind;function We(n,e){return Qe.call(n,e)}class rt{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){He(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){He(i)}else He(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){He(t)}}}class yt extends Se{constructor(e,t,i){let r;if(super(),Nn(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&mo.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&We(e.next,s),error:e.error&&We(e.error,s),complete:e.complete&&We(e.complete,s)}):r=e}this.destination=new rt(r)}}function He(n){mo.useDeprecatedSynchronousErrorHandling?function ee(n){mo.useDeprecatedSynchronousErrorHandling&&ne&&(ne.errorThrown=!0,ne.error=n)}(n):vp(n)}function Ut(n,e){const{onStoppedNotification:t}=mo;t&&Il.setTimeout(()=>t(n,e))}const _n={closed:!0,next:zd,error:function xt(n){throw n},complete:zd},xn="function"==typeof Symbol&&Symbol.observable||"@@observable";function Jn(n){return n}function Qn(n){return 0===n.length?Jn:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}let Te=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function yn(n){return n&&n instanceof Se||function pn(n){return n&&Nn(n.next)&&Nn(n.error)&&Nn(n.complete)}(n)&&_p(n)}(t)?t:new yt(t,i,r);return U(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=Ne(i))((r,s)=>{const o=new yt({next:a=>{try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[xn](){return this}pipe(...t){return Qn(t)(this)}toPromise(t){return new(t=Ne(t))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function Ne(n){var e;return null!==(e=n??mo.Promise)&&void 0!==e?e:Promise}const ti=Bd(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let lt=(()=>{class n extends Te{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new et(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new ti}next(t){U(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){U(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){U(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Al:(this.currentObservers=null,s.push(t),new Ti(()=>{this.currentObservers=null,ac(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new Te;return t.source=this,t}}return n.create=(e,t)=>new et(e,t),n})();class et extends lt{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:Al}}class Ht extends lt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}class O extends Error{code;constructor(e,t){super(function On(n,e){return`${function Lt(n){return`NG0${Math.abs(n)}`}(n)}${e?": "+e:""}`}(e,t)),this.code=e}}const Rt=globalThis;function N(n){for(let e in n)if(n[e]===N)return e;throw Error("")}function ke(n){if("string"==typeof n)return n;if(Array.isArray(n))return`[${n.map(ke).join(", ")}]`;if(null==n)return""+n;const e=n.overriddenName||n.name;if(e)return`${e}`;const t=n.toString();if(null==t)return""+t;const i=t.indexOf("\n");return i>=0?t.slice(0,i):t}function vt(n,e){return n?e?`${n} ${e}`:n:e||""}const rn=N({__forward_ref__:N});function cs(n){return n.__forward_ref__=cs,n.toString=function(){return ke(this())},n}function ut(n){return Mr(n)?n():n}function Mr(n){return"function"==typeof n&&n.hasOwnProperty(rn)&&n.__forward_ref__===cs}function Oe(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Ws(n){return{providers:n.providers||[],imports:n.imports||[]}}function go(n){return function xp(n,e){return n.hasOwnProperty(e)&&n[e]||null}(n,sr)}function ji(n){return n&&n.hasOwnProperty(_v)?n[_v]:null}const sr=N({\u0275prov:N}),_v=N({\u0275inj:N});class ge{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Oe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function vv(n){return n&&!!n.\u0275providers}const Ev=N({\u0275cmp:N}),gB=N({\u0275dir:N}),_B=N({\u0275pipe:N}),dT=N({\u0275mod:N}),hc=N({\u0275fac:N}),jd=N({__NG_ELEMENT_ID__:N}),hT=N({__NG_ENV_ID__:N});function Pt(n){return"string"==typeof n?n:null==n?"":String(n)}const bv=N({ngErrorCode:N}),fT=N({ngErrorMessage:N}),$d=N({ngTokenPath:N});function Sv(n,e){return mT("",-200,e)}function Mv(n,e){throw new O(-201,!1)}function mT(n,e,t){const i=new O(e,n);return i[bv]=e,i[fT]=n,t&&(i[$d]=t),i}let wv;function gT(){return wv}function wr(n){const e=wv;return wv=n,e}function _T(n,e,t){const i=go(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:8&t?null:void 0!==e?e:void Mv()}const fc={};class MB{injector;constructor(e){this.injector=e}retrieve(e,t){const i=Wd(t)||0;try{return this.injector.get(e,8&i?null:fc,i)}catch(r){if(tc(r))return r;throw r}}}function wB(n,e=0){const t=ec();if(void 0===t)throw new O(-203,!1);if(null===t)return _T(n,void 0,e);{const i=function xB(n){return{optional:!!(8&n),host:!!(1&n),self:!!(2&n),skipSelf:!!(4&n)}}(e),r=t.retrieve(n,i);if(tc(r)){if(i.optional)return null;throw r}return r}}function ct(n,e=0){return(gT()||wB)(ut(n),e)}function oe(n,e){return ct(n,Wd(e))}function Wd(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Tv(n){const e=[];for(let t=0;t<n.length;t++){const i=ut(n[t]);if(Array.isArray(i)){if(0===i.length)throw new O(900,!1);let r,s=0;for(let o=0;o<i.length;o++){const a=i[o],c=TB(a);"number"==typeof c?-1===c?r=a.token:s|=c:r=a}e.push(ct(r,s))}else e.push(ct(i))}return e}function TB(n){return n.__NG_DI_FLAG__}function pc(n,e){return n.hasOwnProperty(hc)?n[hc]:null}function Rl(n,e){n.forEach(t=>Array.isArray(t)?Rl(t,e):e(t))}function vT(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Cp(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Ap(n,e,t){let i=Xd(n,e);return i>=0?n[1|i]=t:(i=~i,function bT(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(1===r)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;)n[r]=n[r-2],r--;n[e]=t,n[e+1]=i}}(n,i,e,t)),i}function Cv(n,e){const t=Xd(n,e);if(t>=0)return n[1|t]}function Xd(n,e){return function DB(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){const s=i+(r-i>>1),o=n[s<<t];if(e===o)return s<<t;o>e?r=s:i=s+1}return~(r<<t)}(n,e,1)}const qs={},Bn=[],la=new ge(""),ST=new ge("",-1),Dv=new ge("");class Ip{get(e,t=fc){if(t===fc){const r=mT("",-201);throw r.name="\u0275NotFound",r}return t}}function Xs(n){return n[dT]||null}function vn(n){return n[Ev]||null}function or(n){return n[gB]||null}function Ms(n){return n[_B]||null}function Rp(n){return{\u0275providers:n}}function MT(...n){return{\u0275providers:Iv(0,n),\u0275fromNgModule:!0}}function Iv(n,...e){const t=[],i=new Set;let r;const s=o=>{t.push(o)};return Rl(e,o=>{const a=o;Pp(a,s,[],i)&&(r||=[],r.push(a))}),void 0!==r&&wT(r,s),t}function wT(n,e){for(let t=0;t<n.length;t++){const{ngModule:i,providers:r}=n[t];Rv(r,s=>{e(s,i)})}}function Pp(n,e,t,i){if(!(n=ut(n)))return!1;let r=null,s=ji(n);const o=!s&&vn(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const c=n.ngModule;if(s=ji(c),!s)return!1;r=c}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const c="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const l of c)Pp(l,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let l;i.add(r);try{Rl(s.imports,u=>{Pp(u,e,t,i)&&(l||=[],l.push(u))})}finally{}void 0!==l&&wT(l,e)}if(!a){const l=pc(r)||(()=>new r);e({provide:r,useFactory:l,deps:Bn},r),e({provide:Dv,useValue:r,multi:!0},r),e({provide:la,useValue:()=>ct(r),multi:!0},r)}const c=s.providers;if(null!=c&&!a){const l=n;Rv(c,u=>{e(u,l)})}}}return r!==n&&void 0!==n.providers}function Rv(n,e){for(let t of n)vv(t)&&(t=t.\u0275providers),Array.isArray(t)?Rv(t,e):e(t)}const IB=N({provide:String,useValue:N});function Pv(n){return null!==n&&"object"==typeof n&&IB in n}function _o(n){return"function"==typeof n}const Nv=new ge(""),Np={},DT={};let Ov;function Lv(){return void 0===Ov&&(Ov=new Ip),Ov}class $i{}class mc extends $i{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,kv(e,o=>this.processProvider(o)),this.records.set(ST,Nl(void 0,this)),r.has("environment")&&this.records.set($i,Nl(void 0,this));const s=this.records.get(Nv);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(Dv,Bn,{self:!0}))}retrieve(e,t){const i=Wd(t)||0;try{return this.get(e,fc,i)}catch(r){if(tc(r))return r;throw r}}destroy(){Yd(this),this._destroyed=!0;const e=_t(null);try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),_t(e)}}onDestroy(e){return Yd(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){Yd(this);const t=as(this),i=wr(void 0);try{return e()}finally{as(t),wr(i)}}get(e,t=fc,i){if(Yd(this),e.hasOwnProperty(hT))return e[hT](this);const r=Wd(i),o=as(this),a=wr(void 0);try{if(!(4&r)){let l=this.records.get(e);if(void 0===l){const u=function LB(n){return"function"==typeof n||"object"==typeof n&&"InjectionToken"===n.ngMetadataName}(e)&&go(e);l=u&&this.injectableDefInScope(u)?Nl(Fv(e),Np):null,this.records.set(e,l)}if(null!=l)return this.hydrate(e,l,r)}return(2&r?Lv():this.parent).get(e,t=8&r&&t===fc?null:t)}catch(c){const l=function bB(n){return n[bv]}(c);throw-200===l||-201===l?new O(l,null):c}finally{wr(a),as(o)}}resolveInjectorInitializers(){const e=_t(null),t=as(this),i=wr(void 0);try{const s=this.get(la,Bn,{self:!0});for(const o of s)o()}finally{as(t),wr(i),_t(e)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(ke(i));return`R3Injector[${e.join(", ")}]`}processProvider(e){let t=_o(e=ut(e))?e:ut(e&&e.provide);const i=function PB(n){return Pv(n)?Nl(void 0,n.useValue):Nl(function AT(n,e,t){let i;if(_o(n)){const r=ut(n);return pc(r)||Fv(r)}if(Pv(n))i=()=>ut(n.useValue);else if(function TT(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Tv(n.deps||[]));else if(function xT(n){return!(!n||!n.useExisting)}(n))i=(r,s)=>ct(ut(n.useExisting),void 0!==s&&8&s?8:void 0);else{const r=ut(n&&(n.useClass||n.provide));if(!function NB(n){return!!n.deps}(n))return pc(r)||Fv(r);i=()=>new r(...Tv(n.deps))}return i}(n),Np)}(e);if(!_o(e)&&!0===e.multi){let r=this.records.get(t);r||(r=Nl(void 0,Np,!0),r.factory=()=>Tv(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t,i){const r=_t(null);try{if(t.value===DT)throw Sv(ke(e));return t.value===Np&&(t.value=DT,t.value=t.factory(void 0,i)),"object"==typeof t.value&&t.value&&function OB(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{_t(r)}}injectableDefInScope(e){if(!e.providedIn)return!1;const t=ut(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function Fv(n){const e=go(n),t=null!==e?e.factory:pc(n);if(null!==t)return t;if(n instanceof ge)throw new O(204,!1);if(n instanceof Function)return function RB(n){if(n.length>0)throw new O(204,!1);const t=function uc(n){return(n?.[sr]??null)||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new O(204,!1)}function Yd(n){if(n.destroyed)throw new O(205,!1)}function Nl(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function kv(n,e){for(const t of n)Array.isArray(t)?kv(t,e):t&&vv(t)?kv(t.\u0275providers,e):e(t)}function Gr(n,e){let t;n instanceof mc?(Yd(n),t=n):t=new MB(n);const r=as(t),s=wr(void 0);try{return e()}finally{as(r),wr(s)}}function Uv(){return void 0!==gT()||null!=ec()}function ri(n){return Array.isArray(n)&&"object"==typeof n[1]}function ar(n){return Array.isArray(n)&&!0===n[1]}function RT(n){return!!(4&n.flags)}function Eo(n){return n.componentOffset>-1}function Ul(n){return!(1&~n.flags)}function $r(n){return!!n.template}function fa(n){return!!(512&n[2])}function bo(n){return!(256&~n[2])}function Oi(n){for(;Array.isArray(n);)n=n[0];return n}function Bl(n,e){return Oi(e[n])}function bi(n,e){return Oi(e[n.index])}function Vl(n,e){return n.data[e]}function cr(n,e){const t=e[n];return ri(t)?t:t[0]}function Hv(n){return!(128&~n[2])}function qi(n,e){return null==e?null:n[e]}function kT(n){n[17]=0}function UT(n){1024&n[2]||(n[2]|=1024,Hv(n)&&zl(n))}function kp(n){return!!(9216&n[2]||n[24]?.dirty)}function Gv(n){n[10].changeDetectionScheduler?.notify(8),64&n[2]&&(n[2]|=1024),kp(n)&&zl(n)}function zl(n){n[10].changeDetectionScheduler?.notify(0);let e=So(n);for(;null!==e&&!(8192&e[2])&&(e[2]|=8192,Hv(e));)e=So(e)}function Up(n,e){if(bo(n))throw new O(911,!1);null===n[21]&&(n[21]=[]),n[21].push(e)}function So(n){const e=n[3];return ar(e)?e[3]:e}function VT(n){return n[7]??=[]}function zT(n){return n.cleanup??=[]}const Tt={lFrame:iC(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let Wv=!1;function qv(){return Tt.bindingsEnabled}function te(){return Tt.lFrame.lView}function Nt(){return Tt.lFrame.tView}function Bi(n){return Tt.lFrame.contextLView=n,n[8]}function Vi(n){return Tt.lFrame.contextLView=null,n}function At(){let n=qT();for(;null!==n&&64===n.type;)n=n.parent;return n}function qT(){return Tt.lFrame.currentTNode}function Mo(n,e){const t=Tt.lFrame;t.currentTNode=n,t.isParent=e}function XT(){return Tt.lFrame.isParent}function JT(){return Wv}function Bp(n){const e=Wv;return Wv=n,e}function xr(){return Tt.lFrame.bindingIndex++}function xo(n){const e=Tt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function qB(n,e){const t=Tt.lFrame;t.bindingIndex=t.bindingRootIndex=n,Xv(e)}function Xv(n){Tt.lFrame.currentDirectiveIndex=n}function Zv(){return Tt.lFrame.currentQueryIndex}function Vp(n){Tt.lFrame.currentQueryIndex=n}function YB(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[5]:null}function tC(n,e,t){if(4&t){let r=e,s=n;for(;!(r=r.parent,null!==r||1&t||(r=YB(s),null===r||(s=s[14],10&r.type))););if(null===r)return!1;e=r,n=s}const i=Tt.lFrame=nC();return i.currentTNode=e,i.lView=n,!0}function Kv(n){const e=nC(),t=n[1];Tt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function nC(){const n=Tt.lFrame,e=null===n?null:n.child;return null===e?iC(n):e}function iC(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function rC(){const n=Tt.lFrame;return Tt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const sC=rC;function Jv(){const n=rC();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function zi(){return Tt.lFrame.selectedIndex}function Ec(n){Tt.lFrame.selectedIndex=n}let oC=!0;function zp(){return oC}function Qd(n){oC=n}let Qv={elements:void 0};function aC(n,e=null,t=null,i){const r=cC(n,e,t,i);return r.resolveInjectorInitializers(),r}function cC(n,e=null,t=null,i,r=new Set){const s=[t||Bn,MT(n)];return i=i||("object"==typeof n?void 0:ke(n)),new mc(s,e||Lv(),i||null,r)}class ds{static THROW_IF_NOT_FOUND=fc;static NULL=new Ip;static create(e,t){if(Array.isArray(e))return aC({name:""},t,e,"");{const i=e.name??"";return aC({name:i},e.parent,e.providers,i)}}static \u0275prov=Oe({token:ds,providedIn:"any",factory:()=>ct(ST)});static __NG_ELEMENT_ID__=-1}const Wr=new ge("");let Ys=(()=>class n{static __NG_ELEMENT_ID__=i3;static __NG_ENV_ID__=t=>t})();class lC extends Ys{_lView;constructor(e){super(),this._lView=e}get destroyed(){return bo(this._lView)}onDestroy(e){const t=this._lView;return Up(t,e),()=>function jv(n,e){if(null===n[21])return;const t=n[21].indexOf(e);-1!==t&&n[21].splice(t,1)}(t,e)}}function i3(){return new lC(te())}class Gl{_console=console;handleError(e){this._console.error("ERROR",e)}}const xs=new ge("",{providedIn:"root",factory:()=>{const n=oe($i);let e;return t=>{n.destroyed&&!e?setTimeout(()=>{throw t}):(e??=n.get(Gl),e.handleError(t))}}}),uC={provide:la,useValue:()=>{oe(Gl)},multi:!0};function Hp(n,e){const[t,i,r]=mp(n,e?.equal),s=t;return s.set=i,s.update=r,s.asReadonly=t0.bind(s),s}function t0(){const n=this[oi];if(void 0===n.readonlyFn){const e=()=>this();e[oi]=n,n.readonlyFn=e}return n.readonlyFn}class bc{}const fC=new ge("",{providedIn:"root",factory:()=>!1}),pC=new ge(""),mC=new ge("");let pa=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Ht(!1);get hasPendingTasks(){return!this.destroyed&&this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Te(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Oe({token:n,providedIn:"root",factory:()=>new n})}return n})(),Gp=(()=>{class n{internalPendingTasks=oe(pa);scheduler=oe(bc);errorHandler=oe(xs);add(){const t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){const i=this.add();t().catch(this.errorHandler).finally(i)}static \u0275prov=Oe({token:n,providedIn:"root",factory:()=>new n})}return n})();function eh(...n){}let gC=(()=>{class n{static \u0275prov=Oe({token:n,providedIn:"root",factory:()=>new o3})}return n})();class o3{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){const i=this.queues.get(e.zone);i.has(e)&&(i.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){const t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);const i=this.queues.get(t);i.has(e)||i.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(const[t,i]of this.queues)e||=null===t?this.flushQueue(i):t.run(()=>this.flushQueue(i));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(const i of e)i.dirty&&(this.dirtyEffectCount--,t=!0,i.run());return t}}let _C=null;function jl(){return _C}class c3{}let yC=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>oe(l3),providedIn:"platform"})}return n})(),l3=(()=>{class n extends yC{_location;_history;_doc=oe(Wr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return jl().getBaseHref(this._doc)}onPopState(t){const i=jl().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=jl().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){this._history.pushState(t,i,r)}replaceState(t,i,r){this._history.replaceState(t,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function vC(n,e){return n?e?n.endsWith("/")?e.startsWith("/")?n+e.slice(1):n+e:e.startsWith("/")?n+e:`${n}/${e}`:n:e}function EC(n){const e=n.search(/#|\?|$/);return"/"===n[e-1]?n.slice(0,e-1)+n.slice(e):n}function Sc(n){return n&&"?"!==n[0]?`?${n}`:n}let jp=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>oe(d3),providedIn:"root"})}return n})();const u3=new ge("");let d3=(()=>{class n extends jp{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,i){super(),this._platformLocation=t,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??oe(Wr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return vC(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+Sc(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){const o=this.prepareExternalUrl(r+Sc(s));this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){const o=this.prepareExternalUrl(r+Sc(s));this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(i){return new(i||n)(ct(yC),ct(u3,8))};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),th=(()=>{class n{_subject=new lt;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._basePath=function p3(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(EC(bC(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Sc(i))}normalize(t){return n.stripTrailingSlash(function f3(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,bC(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Sc(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Sc(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=Sc;static joinWithSlash=vC;static stripTrailingSlash=EC;static \u0275fac=function(i){return new(i||n)(ct(jp))};static \u0275prov=Oe({token:n,factory:()=>function h3(){return new th(ct(jp))}(),providedIn:"root"})}return n})();function bC(n){return n.replace(/\/index.html$/,"")}function SC(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}class MC{}function wC(n,e,t,i,r,s,o){try{var a=n[s](o),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(i,r)}function $n(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function o(c){wC(s,i,r,o,a,"next",c)}function a(c){wC(s,i,r,o,a,"throw",c)}o(void 0)})}}function xC(n){return Nn(n?.lift)}function Si(n){return e=>{if(xC(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function pi(n,e,t,i,r){return new m3(n,e,t,i,r)}class m3 extends Se{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=r?function(a){try{r(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function hn(n,e){return Si((t,i)=>{let r=0;t.subscribe(pi(i,s=>{i.next(n.call(e,s,r++))}))})}function To(n){return{toString:n}.toString()}class D3{previousValue;currentValue;firstChange;constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function DC(n,e,t,i){null!==e?e.applyValueToInputSignal(e,i):n[t]=i}const Yl=(()=>{const n=()=>AC;return n.ngInherit=!0,n})();function AC(n){return n.type.prototype.ngOnChanges&&(n.setInput=I3),A3}function A3(){const n=RC(this),e=n?.current;if(e){const t=n.previous;if(t===qs)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function I3(n,e,t,i,r){const s=this.declaredInputs[i],o=RC(n)||function R3(n,e){return n[IC]=e}(n,{previous:qs,current:null}),a=o.current||(o.current={}),c=o.previous,l=c[s];a[s]=new D3(l&&l.currentValue,t,c===qs),DC(n,e,r,t)}const IC="__ngSimpleChanges__";function RC(n){return n[IC]||null}const Mc=[],En=function(n,e=null,t){for(let i=0;i<Mc.length;i++)(0,Mc[i])(n,e,t)};function PC(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),c&&(n.viewHooks??=[]).push(-t,c),l&&((n.viewHooks??=[]).push(t,l),(n.viewCheckHooks??=[]).push(t,l)),null!=u&&(n.destroyHooks??=[]).push(t,u)}}function Wp(n,e,t){NC(n,e,3,t)}function qp(n,e,t,i){(3&n[2])===t&&NC(n,e,t,i)}function o0(n,e){let t=n[2];(3&t)===e&&(t&=16383,t+=1,n[2]=t)}function NC(n,e,t,i){const s=i??-1,o=e.length-1;let a=0;for(let c=void 0!==i?65535&n[17]:0;c<o;c++)if("number"==typeof e[c+1]){if(a=e[c],null!=i&&a>=i)break}else e[c]<0&&(n[17]+=65536),(a<s||-1==s)&&(F3(n,t,e,c),n[17]=(4294901760&n[17])+c+2),c++}function OC(n,e){En(4,n,e);const t=_t(null);try{e.call(n)}finally{_t(t),En(5,n,e)}}function F3(n,e,t,i){const r=t[i]<0,s=t[i+1],a=n[r?-t[i]:t[i]];r?n[2]>>14<n[17]>>16&&(3&n[2])===e&&(n[2]+=16384,OC(a,s)):OC(a,s)}class ih{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,i,r){this.factory=e,this.name=r,this.canSeeViewProviders=t,this.injectImpl=i}}function FC(n){return 3===n||4===n||6===n}function kC(n){return 64===n.charCodeAt(0)}function Kl(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||UC(n,t,r,0,-1===t||2===t?e[++i]:null)}}return n}function UC(n,e,t,i,r){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t)return void(null!==r&&(n[s+1]=r));s++,null!==r&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==r&&n.splice(s++,0,r)}function c0(n){return-1!==n}function rh(n){return 32767&n}function sh(n,e){let t=function V3(n){return n>>16}(n),i=e;for(;t>0;)i=i[14],t--;return i}let l0=!0;function Xp(n){const e=l0;return l0=n,e}let z3=0;const Zs={};function Yp(n,e){const t=zC(n,e);if(-1!==t)return t;const i=e[1];i.firstCreatePass&&(n.injectorIndex=e.length,u0(i.data,n),u0(e,null),u0(i.blueprint,null));const r=Zp(n,e),s=n.injectorIndex;if(c0(r)){const o=rh(r),a=sh(r,e),c=a[1].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=r,s}function u0(n,e){n.push(0,0,0,0,0,0,0,0,e)}function zC(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Zp(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=XC(r),null===i)return-1;if(t++,r=r[14],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return-1}function d0(n,e,t){!function H3(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(jd)&&(i=t[jd]),null==i&&(i=t[jd]=z3++);const r=255&i;e.data[n+(r>>5)]|=1<<r}(n,e,t)}function HC(n,e,t){if(8&t||void 0!==n)return n;Mv()}function GC(n,e,t,i){if(8&t&&void 0===i&&(i=null),!(3&t)){const r=n[9],s=wr(void 0);try{return r?r.get(e,i,8&t):_T(e,i,8&t)}finally{wr(s)}}return HC(i,0,t)}function jC(n,e,t,i=0,r){if(null!==n){if(2048&e[2]&&!(2&i)){const o=function q3(n,e,t,i,r){let s=n,o=e;for(;null!==s&&null!==o&&2048&o[2]&&!fa(o);){const a=$C(s,o,t,2|i,Zs);if(a!==Zs)return a;let c=s.parent;if(!c){const l=o[20];if(l){const u=l.get(t,Zs,i);if(u!==Zs)return u}c=XC(o),o=o[14]}s=c}return r}(n,e,t,i,Zs);if(o!==Zs)return o}const s=$C(n,e,t,i,Zs);if(s!==Zs)return s}return GC(e,t,i,r)}function $C(n,e,t,i,r){const s=function $3(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(jd)?n[jd]:void 0;return"number"==typeof e?e>=0?255&e:W3:e}(t);if("function"==typeof s){if(!tC(e,n,i))return 1&i?HC(r,0,i):GC(e,t,i,r);try{let o;if(o=s(i),null!=o||8&i)return o;Mv()}finally{sC()}}else if("number"==typeof s){let o=null,a=zC(n,e),c=-1,l=1&i?e[15][5]:null;for((-1===a||4&i)&&(c=-1===a?Zp(n,e):e[a+8],-1!==c&&qC(i,!1)?(o=e[1],a=rh(c),e=sh(c,e)):a=-1);-1!==a;){const u=e[1];if(WC(s,a,u.data)){const d=j3(a,e,t,o,i,l);if(d!==Zs)return d}c=e[a+8],-1!==c&&qC(i,e[1].data[a+8]===l)&&WC(s,a,e)?(o=u,a=rh(c),e=sh(c,e)):a=-1}}return r}function j3(n,e,t,i,r,s){const o=e[1],a=o.data[n+8],u=Kp(a,o,t,null==i?Eo(a)&&l0:i!=o&&!!(3&a.type),1&r&&s===a);return null!==u?oh(e,o,u,a,r):Zs}function Kp(n,e,t,i,r){const s=n.providerIndexes,o=e.data,a=1048575&s,c=n.directiveStart,u=s>>20,h=r?a+u:n.directiveEnd;for(let f=i?a:a+u;f<h;f++){const p=o[f];if(f<c&&t===p||f>=c&&p.type===t)return f}if(r){const f=o[c];if(f&&$r(f)&&f.type===t)return c}return null}function oh(n,e,t,i,r){let s=n[t];const o=e.data;if(s instanceof ih){const a=s;if(a.resolving)throw function on(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Pt(n)}(o[t]),Sv();const c=Xp(a.canSeeViewProviders);a.resolving=!0;const d=a.injectImpl?wr(a.injectImpl):null;tC(n,i,0);try{s=n[t]=a.factory(void 0,r,o,n,i),e.firstCreatePass&&t>=i.directiveStart&&function L3(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const o=AC(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}r&&(t.preOrderHooks??=[]).push(0-n,r),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}(t,o[t],e)}finally{null!==d&&wr(d),Xp(c),a.resolving=!1,sC()}}return s}function WC(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function qC(n,e){return!(2&n||1&n&&e)}class ci{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return jC(this._tNode,this._lView,e,Wd(i),t)}}function W3(){return new ci(At(),te())}function h0(n){return To(()=>{const e=n.prototype.constructor,t=e[hc]||f0(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[hc]||f0(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function f0(n){return Mr(n)?()=>{const e=f0(ut(n));return e&&e()}:pc(n)}function XC(n){const e=n[1],t=e.type;return 2===t?e.declTNode:1===t?n[5]:null}function tV(){return Jl(At(),te())}function Jl(n,e){return new ga(bi(n,e))}let ga=(()=>class n{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=tV})();function QC(n){return n instanceof ga?n.nativeElement:n}function nV(){return this._results[Symbol.iterator]()}class iV{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new lt}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;const i=function ls(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function CB(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(this._results,i,t))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=nV}function ch(n){return!(128&~n.flags)}var Qp=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(Qp||{});const em=new Map;let oV=0;function g0(n){em.delete(n[19])}const y0="__ngContext__";function Cr(n,e){ri(e)?(n[y0]=e[19],function cV(n){em.set(n[19],n)}(e)):n[y0]=e}function uD(n){return hD(n[12])}function dD(n){return hD(n[4])}function hD(n){for(;null!==n&&!ar(n);)n=n[4];return n}let v0;const uh=new ge("",{providedIn:"root",factory:()=>IV}),IV="ng",vD=new ge(""),nm=new ge("",{providedIn:"platform",factory:()=>"unknown"}),ED=new ge(""),bD=new ge("",{providedIn:"root",factory:()=>function _a(){if(void 0!==v0)return v0;if(typeof document<"u")return document;throw new O(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),UV=new ge("",{providedIn:"root",factory:()=>!1});function om(n){return!(32&~n.flags)}function WD(n,e){const t=n.contentQueries;if(null!==t){const i=_t(null);try{for(let r=0;r<t.length;r+=2){const o=t[r+1];if(-1!==o){const a=n.data[o];Vp(t[r]),a.contentQueries(2,e[o],o)}}}finally{_t(i)}}}function F0(n,e,t){Vp(0);const i=_t(null);try{e(n,t)}finally{_t(i)}}function k0(n,e,t){if(RT(e)){const i=_t(null);try{const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const a=n.data[o];a.contentQueries&&a.contentQueries(1,t[o],o)}}finally{_t(i)}}}var Co=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Co||{});class KD{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss)`}}function va(n){return n instanceof KD?n.changingThisBreaksApplicationSecurity:n}function Ks(n){return n instanceof Function?n():n}function Jz(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}const _A="ng-template";function Qz(n,e,t,i){let r=0;if(i){for(;r<e.length&&"string"==typeof e[r];r+=2)if("class"===e[r]&&-1!==Jz(e[r+1].toLowerCase(),t,0))return!0}else if($0(n))return!1;if(r=e.indexOf(1,r),r>-1){let s;for(;++r<e.length&&"string"==typeof(s=e[r]);)if(s.toLowerCase()===t)return!0}return!1}function $0(n){return 4===n.type&&n.value!==_A}function eH(n,e,t){return e===(4!==n.type||t?n.value:_A)}function tH(n,e,t){let i=4;const r=n.attrs,s=null!==r?function rH(n){for(let e=0;e<n.length;e++)if(FC(n[e]))return e;return n.length}(r):0;let o=!1;for(let a=0;a<e.length;a++){const c=e[a];if("number"!=typeof c){if(!o)if(4&i){if(i=2|1&i,""!==c&&!eH(n,c,t)||""===c&&1===e.length){if(Ts(i))return!1;o=!0}}else if(8&i){if(null===r||!Qz(n,r,c,t)){if(Ts(i))return!1;o=!0}}else{const l=e[++a],u=nH(c,r,$0(n),t);if(-1===u){if(Ts(i))return!1;o=!0;continue}if(""!==l){let d;if(d=u>s?"":r[u+1].toLowerCase(),2&i&&l!==d){if(Ts(i))return!1;o=!0}}}}else{if(!o&&!Ts(i)&&!Ts(c))return!1;if(o&&Ts(c))continue;o=!1,i=c|1&i}}return Ts(i)||o}function Ts(n){return!(1&n)}function nH(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const o=e[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++r];for(;"string"==typeof a;)a=e[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function sH(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function yA(n,e,t=!1){for(let i=0;i<e.length;i++)if(tH(n,e[i],t))return!0;return!1}function vA(n,e){return n?":not("+e.trim()+")":e}function aH(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&i){const a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!Ts(o)&&(e+=vA(s,r),r=""),i=o,s=s||!Ts(i);t++}return""!==r&&(e+=vA(s,r)),e}const Mn={};function gm(n,e,t){return n.createElement(e,t)}function xc(n,e,t,i,r){n.insertBefore(e,t,i,r)}function bA(n,e,t){n.appendChild(e,t)}function SA(n,e,t,i,r){null!==i?xc(n,e,t,i,r):bA(n,e,t)}function wA(n,e,t){const{mergedAttrs:i,classes:r,styles:s}=t;null!==i&&function B3(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{const s=r,o=t[++i];kC(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}}(n,e,i),null!==r&&function dH(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}(n,e,r),null!==s&&function uH(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}function X0(n,e,t,i,r,s,o,a,c,l,u){const d=26+i,h=d+r,f=function hH(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:Mn);return t}(d,h),p="function"==typeof l?l():l;return f[1]={type:n,blueprint:f,template:t,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:p,incompleteFirstPass:!1,ssrId:u}}function _m(n,e,t,i,r,s,o,a,c,l,u){const d=e.blueprint.slice();return d[0]=r,d[2]=1228|i,(null!==l||n&&2048&n[2])&&(d[2]|=2048),kT(d),d[3]=d[14]=n,d[8]=t,d[10]=o||n&&n[10],d[11]=a||n&&n[11],d[9]=c||n&&n[9]||null,d[5]=s,d[19]=function aV(){return oV++}(),d[6]=u,d[20]=l,d[15]=2==e.type?n[15]:d,d}function Y0(n){let e=16;return n.signals?e=4096:n.onPush&&(e=64),e}function _h(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function Z0(n,e){return n[12]?n[13][4]=e:n[12]=e,n[13]=e,e}function Kt(n=1){TA(Nt(),te(),zi()+n,!1)}function TA(n,e,t,i){if(!i)if(3&~e[2]){const s=n.preOrderHooks;null!==s&&qp(e,s,0,t)}else{const s=n.preOrderCheckHooks;null!==s&&Wp(e,s,t)}Ec(t)}var ym=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(ym||{});function yh(n,e,t,i){const r=_t(null);try{const[s,o,a]=n.inputs[t];let c=null;0!==(o&ym.SignalBased)&&(c=e[s][oi]),null!==c&&void 0!==c.transformFn?i=c.transformFn(i):null!==a&&(i=a.call(e,i)),null!==n.setInput?n.setInput(e,c,i,t,s):DC(e,c,s,i)}finally{_t(r)}}var Ea=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Ea||{});function J0(n,e){return undefined(n,e)}function ou(n,e,t,i,r){if(null!=i){let s,o=!1;ar(i)?s=i:ri(i)&&(o=!0,i=i[0]);const a=Oi(i);0===n&&null!==t?null==r?bA(e,t,a):xc(e,t,a,r||null,!0):1===n&&null!==t?xc(e,t,a,r||null,!0):2===n?function gh(n,e,t){n.removeChild(null,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function EH(n,e,t,i,r){const s=t[7];s!==Oi(t)&&ou(e,n,i,s,r);for(let a=10;a<t.length;a++){const c=t[a];Em(c[1],c,n,e,i,s)}}(e,n,s,t,r)}}function DA(n,e){e[10].changeDetectionScheduler?.notify(9),Em(n,e,e[11],2,null,null)}function Q0(n,e){const t=n[9],i=t.indexOf(e);t.splice(i,1)}function vh(n,e){if(bo(e))return;const t=e[11];t.destroyNode&&Em(n,e,t,3,null,null),function gH(n){let e=n[12];if(!e)return eE(n[1],n);for(;e;){let t=null;if(ri(e))t=e[12];else{const i=e[10];i&&(t=i)}if(!t){for(;e&&!e[4]&&e!==n;)ri(e)&&eE(e[1],e),e=e[3];null===e&&(e=n),ri(e)&&eE(e[1],e),t=e&&e[4]}e=t}}(e)}function eE(n,e){if(bo(e))return;const t=_t(null);try{e[2]&=-129,e[2]|=256,e[24]&&oa(e[24]),function yH(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof ih)){const s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],c=s[o+1];En(4,a,c);try{c.call(a)}finally{En(5,a,c)}}else{En(4,r,s);try{s.call(r)}finally{En(5,r,s)}}}}}(n,e),function _H(n,e){const t=n.cleanup,i=e[7];if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const a=t[o+3];a>=0?i[a]():i[-a].unsubscribe(),o+=2}else t[o].call(i[t[o+1]]);null!==i&&(e[7]=null);const r=e[21];if(null!==r){e[21]=null;for(let o=0;o<r.length;o++)(0,r[o])()}const s=e[23];if(null!==s){e[23]=null;for(const o of s)o.destroy()}}(n,e),1===e[1].type&&e[11].destroy();const i=e[16];if(null!==i&&ar(e[3])){i!==e[3]&&Q0(i,e);const r=e[18];null!==r&&r.detachView(n)}g0(e)}finally{_t(t)}}function tE(n,e,t){return function AA(n,e,t){let i=e;for(;null!==i&&168&i.type;)i=(e=i).parent;if(null===i)return t[0];if(Eo(i)){const{encapsulation:r}=n.data[i.directiveStart+i.componentOffset];if(r===Co.None||r===Co.Emulated)return null}return bi(i,t)}(n,e.parent,t)}let PA=function RA(n,e,t){return 40&n.type?bi(n,t):null};function iE(n,e,t,i){const r=tE(n,i,e),s=e[11],a=function IA(n,e,t){return PA(n,e,t)}(i.parent||e[5],i,e);if(null!=r)if(Array.isArray(t))for(let c=0;c<t.length;c++)SA(s,r,t[c],a,!1);else SA(s,r,t,a,!1)}function Tc(n,e){if(null!==e){const t=e.type;if(3&t)return bi(e,n);if(4&t)return vm(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return Tc(n,i);{const r=n[e.index];return ar(r)?vm(-1,r):Oi(r)}}if(128&t)return Tc(n,e.next);if(32&t)return J0(e,n)()||Oi(n[e.index]);{const i=OA(n,e);return null!==i?Array.isArray(i)?i[0]:Tc(So(n[15]),i):Tc(n,e.next)}}return null}function OA(n,e){return null!==e?n[15][5].projection[e.projection]:null}function vm(n,e){const t=10+n+1;if(t<e.length){const i=e[t],r=i[1].firstChild;if(null!==r)return Tc(i,r)}return e[7]}function rE(n,e,t,i,r,s,o){for(;null!=t;){if(128===t.type){t=t.next;continue}const a=i[t.index],c=t.type;if(o&&0===e&&(a&&Cr(Oi(a),i),t.flags|=2),!om(t))if(8&c)rE(n,e,t.child,i,r,s,!1),ou(e,n,r,a,s);else if(32&c){const l=J0(t,i);let u;for(;u=l();)ou(e,n,r,u,s);ou(e,n,r,a,s)}else 16&c?LA(n,e,i,t,r,s):ou(e,n,r,a,s);t=o?t.projectionNext:t.next}}function Em(n,e,t,i,r,s){rE(t,i,n.firstChild,e,r,s,!1)}function LA(n,e,t,i,r,s){const o=t[15],c=o[5].projection[i.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++)ou(e,n,r,c[l],s);else{let l=c;const u=o[3];ch(i)&&(l.flags|=128),rE(n,e,l,u,r,s,!0)}}function FA(n,e,t,i,r){const s=zi(),o=2&i;try{Ec(-1),o&&e.length>26&&TA(n,e,26,!1),En(o?2:0,r,t),t(i,r)}finally{Ec(s),En(o?3:1,r,t)}}function bm(n,e,t){(function TH(n,e,t){const i=t.directiveStart,r=t.directiveEnd;Eo(t)&&function fH(n,e,t){const i=bi(e,n),r=function xA(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=X0(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}(t),s=n[10].rendererFactory,o=Z0(n,_m(n,r,null,Y0(t),i,e,null,s.createRenderer(i,t),null,null,null));n[e.index]=o}(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||Yp(t,e);const s=t.initialInputs;for(let o=i;o<r;o++){const a=n.data[o],c=oh(e,n,o,t);Cr(c,e),null!==s&&IH(0,o-i,c,a,0,s),$r(a)&&(cr(t.index,e)[8]=oh(e,n,o,t))}})(n,e,t),!(64&~t.flags)&&function CH(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,o=function XB(){return Tt.lFrame.currentDirectiveIndex}();try{Ec(s);for(let a=i;a<r;a++){const c=n.data[a],l=e[a];Xv(a),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&DH(c,l)}}finally{Ec(-1),Xv(o)}}(n,e,t)}function au(n,e,t=bi){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?t(e,n):n[o];n[r++]=a}}}let kA=()=>null;function sE(n,e,t,i,r,s){xm(n,e[1],e,t,i)?Eo(n)&&function UA(n,e){const t=cr(e,n);16&t[2]||(t[2]|=64)}(e,n.index):(3&n.type&&(t=function xH(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(t)),function oE(n,e,t,i,r,s){if(3&n.type){const o=bi(n,e);i=null!=s?s(i,n.value||"",t):i,r.setProperty(o,t,i)}}(n,e,t,i,r,s))}function DH(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function aE(n,e){const t=n.directiveRegistry;let i=null;if(t)for(let r=0;r<t.length;r++){const s=t[r];yA(e,s.selectors,!1)&&(i??=[],$r(s)?i.unshift(s):i.push(s))}return i}function IH(n,e,t,i,r,s){const o=s[e];if(null!==o)for(let a=0;a<o.length;a+=2)yh(i,t,o[a],o[a+1])}function wm(n){let e=n;return XT()?function YT(){Tt.lFrame.isParent=!1}():(e=e.parent,Mo(e,!1)),e}function xm(n,e,t,i,r){const s=n.inputs?.[i],o=n.hostDirectiveInputs?.[i];let a=!1;if(o)for(let c=0;c<o.length;c+=2){const l=o[c];yh(e.data[l],t[l],o[c+1],r),a=!0}if(s)for(const c of s)yh(e.data[c],t[c],i,r),a=!0;return a}function PH(n,e){const t=cr(e,n),i=t[1];!function NH(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}(i,t);const r=t[0];null!==r&&null===t[6]&&(t[6]=null),En(18),Tm(i,t,t[8]),En(19,t[8])}function Tm(n,e,t){Kv(e);try{const i=n.viewQuery;null!==i&&F0(1,i,t);const r=n.template;null!==r&&FA(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[18]?.finishViewCreation(n),n.staticContentQueries&&WD(n,e),n.staticViewQueries&&F0(2,n.viewQuery,t);const s=n.components;null!==s&&function OH(n,e){for(let t=0;t<e.length;t++)PH(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[2]&=-5,Jv()}}function Cc(n,e){return!e||null===e.firstChild||ch(n)}function Eh(n,e,t,i,r=!1){for(;null!==t;){if(128===t.type){t=r?t.projectionNext:t.next;continue}const s=e[t.index];null!==s&&i.push(Oi(s)),ar(s)&&FH(s,i);const o=t.type;if(8&o)Eh(n,e,t.child,i);else if(32&o){const a=J0(t,e);let c;for(;c=a();)i.push(c)}else if(16&o){const a=OA(e,t);if(Array.isArray(a))i.push(...a);else{const c=So(e[15]);Eh(c[1],c,a,i,!0)}}t=r?t.projectionNext:t.next}return i}function FH(n,e){for(let t=10;t<n.length;t++){const i=n[t],r=i[1].firstChild;null!==r&&Eh(i[1],i,r,e)}n[7]!==n[0]&&e.push(n[7])}function HA(n){if(null!==n[25]){for(const e of n[25])e.impl.addSequence(e);n[25].length=0}}let GA=[];const VH={...Un,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{zl(n.lView)},consumerOnSignalRead(){this.lView[24]=this}},HH={...Un,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let e=So(n.lView);for(;e&&!jA(e[1]);)e=So(e);e&&UT(e)},consumerOnSignalRead(){this.lView[24]=this}};function jA(n){return 2!==n.type}function $A(n){if(null===n[23])return;let e=!0;for(;e;){let t=!1;for(const i of n[23])i.dirty&&(t=!0,null===i.zone||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));e=t&&!!(8192&n[2])}}function Cm(n,e=0){const i=n[10].rendererFactory;i.begin?.();try{!function jH(n,e){const t=JT();try{Bp(!0),lE(n,e);let i=0;for(;kp(n);){if(100===i)throw new O(103,!1);i++,lE(n,1)}}finally{Bp(t)}}(n,e)}finally{i.end?.()}}function WA(n,e,t,i){if(bo(e))return;const r=e[2];Kv(e);let a=!0,c=null,l=null;jA(n)?(l=function kH(n){return n[24]??function UH(n){const e=GA.pop()??Object.create(VH);return e.lView=n,e}(n)}(e),c=fo(l)):null===function cn(){return vi}()?(a=!1,l=function zH(n){const e=n[24]??Object.create(HH);return e.lView=n,e}(e),c=fo(l)):e[24]&&(oa(e[24]),e[24]=null);try{kT(e),function QT(n){return Tt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&FA(n,e,t,2,i);const u=!(3&~r);if(u){const f=n.preOrderCheckHooks;null!==f&&Wp(e,f,null)}else{const f=n.preOrderHooks;null!==f&&qp(e,f,0,null),o0(e,0)}if(function WH(n){for(let e=uD(n);null!==e;e=dD(e)){if(!(2&e[2]))continue;const t=e[9];for(let i=0;i<t.length;i++)UT(t[i])}}(e),$A(e),qA(e,0),null!==n.contentQueries&&WD(n,e),u){const f=n.contentCheckHooks;null!==f&&Wp(e,f)}else{const f=n.contentHooks;null!==f&&qp(e,f,1),o0(e,1)}!function XH(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const r=t[i];if(r<0)Ec(~r);else{const s=r,o=t[++i],a=t[++i];qB(o,s);const c=e[s];En(24,c),a(2,c),En(25,c)}}}finally{Ec(-1)}}(n,e);const d=n.components;null!==d&&YA(e,d,0);const h=n.viewQuery;if(null!==h&&F0(2,h,i),u){const f=n.viewCheckHooks;null!==f&&Wp(e,f)}else{const f=n.viewHooks;null!==f&&qp(e,f,2),o0(e,2)}if(!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[22]){for(const f of e[22])f();e[22]=null}HA(e),e[2]&=-73}catch(u){throw zl(e),u}finally{null!==l&&(zs(l,c),a&&function BH(n){n.lView[24]!==n&&(n.lView=null,GA.push(n))}(l)),Jv()}}function qA(n,e){for(let t=uD(n);null!==t;t=dD(t))for(let i=10;i<t.length;i++)XA(t[i],e)}function qH(n,e,t){En(18);const i=cr(e,n);XA(i,t),En(19,i[8])}function XA(n,e){Hv(n)&&lE(n,e)}function lE(n,e){const i=n[1],r=n[2],s=n[24];let o=!!(0===e&&16&r);if(o||=!!(64&r&&0===e),o||=!!(1024&r),o||=!(!s?.dirty||!Cl(s)),o||=!1,s&&(s.dirty=!1),n[2]&=-9217,o)WA(i,n,i.template,n[8]);else if(8192&r){const a=_t(null);try{$A(n),qA(n,1);const c=i.components;null!==c&&YA(n,c,1),HA(n)}finally{_t(a)}}}function YA(n,e,t){for(let i=0;i<e.length;i++)qH(n,e[i],t)}function lu(n,e){const t=JT()?64:1088;for(n[10].changeDetectionScheduler?.notify(e);n;){n[2]|=t;const i=So(n);if(fa(n)&&!i)return n;n=i}return null}function ZA(n,e,t,i){return[n,!0,0,e,null,i,null,t,null,null]}function bh(n,e){if(n.length<=10)return;const t=10+e,i=n[t];if(i){const r=i[16];null!==r&&r!==n&&Q0(r,i),e>0&&(n[t-1][4]=i[4]);const s=Cp(n,10+e);!function CA(n,e){DA(n,e),e[0]=null,e[5]=null}(i[1],i);const o=s[18];null!==o&&o.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function JA(n,e){const t=n[9],i=e[3];(ri(i)||e[15]!==i[3][15])&&(n[2]|=2),null===t?n[9]=[e]:t.push(e)}class Sh{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){const e=this._lView,t=e[1];return Eh(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return bo(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ar(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(bh(e,i),Cp(t,i))}this._attachedToViewContainer=!1}vh(this._lView[1],this._lView)}onDestroy(e){Up(this._lView,e)}markForCheck(){lu(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[2]&=-129}reattach(){Gv(this._lView),this._lView[2]|=128}detectChanges(){this._lView[2]|=1024,Cm(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new O(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const e=fa(this._lView),t=this._lView[16];null!==t&&!e&&Q0(t,this._lView),DA(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new O(902,!1);this._appRef=e;const t=fa(this._lView),i=this._lView[16];null!==i&&!t&&JA(i,this._lView),Gv(this._lView)}}let Ao=(()=>class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=ZH;constructor(t,i,r){this._declarationLView=t,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,r){const s=function cu(n,e,t,i){const r=_t(null);try{const s=e.tView,c=_m(n,s,t,4096&n[2]?4096:16,null,e,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null);c[16]=n[e.index];const u=n[18];return null!==u&&(c[18]=u.createEmbeddedView(s)),Tm(s,c,t),c}finally{_t(r)}}(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:i,dehydratedView:r});return new Sh(s)}})();function ZH(){return Dm(At(),te())}function Dm(n,e){return 4&n.type?new Ao(e,n,Jl(n,e)):null}function Dc(n,e,t,i,r){let s=n.data[e];if(null===s)s=function pE(n,e,t,i,r){const s=qT(),o=XT(),c=n.data[e]=function s4(n,e,t,i,r,s){let o=e?e.injectorIndex:-1,a=0;return function jT(){return null!==Tt.skipHydrationRootTNode}()&&(a|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,i,r);return function r4(n,e,t,i){null===n.firstChild&&(n.firstChild=e),null!==t&&(i?null==t.child&&null!==e.parent&&(t.child=e):null===t.next&&(t.next=e,e.prev=t))}(n,c,s,o),c}(n,e,t,i,r),function WB(){return Tt.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const o=function Jd(){const n=Tt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return Mo(s,!0),s}let z4=class{},MI=class{};class H4{resolveComponentFactory(e){throw new O(917,!1)}}let Fm=class{static NULL=new H4};class km{}let j4=(()=>{class n{static \u0275prov=Oe({token:n,providedIn:"root",factory:()=>null})}return n})();const SE={};class hu{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){const r=this.injector.get(e,SE,i);return r!==SE||t===SE?r:this.parentInjector.get(e,t,i)}}function Vm(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?r=vt(r,a):2==s&&(i=vt(i,a+": "+e[++o]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function pt(n,e=0){const t=te();return null===t?ct(n,e):jC(At(),t,ut(n),e)}function xI(n,e,t,i,r){const s=null===i?null:{"":-1},o=r(n,t);if(null!==o){let a=o,c=null,l=null;for(const u of o)if(null!==u.resolveHostDirectives){[a,c,l]=u.resolveHostDirectives(o);break}!function K4(n,e,t,i,r,s,o){const a=i.length;let c=!1;for(let h=0;h<a;h++){const f=i[h];!c&&$r(f)&&(c=!0,Z4(n,t,h)),d0(Yp(t,e),n,f.type)}!function iG(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,a);for(let h=0;h<a;h++){const f=i[h];f.providersResolver&&f.providersResolver(f)}let l=!1,u=!1,d=_h(n,e,a,null);a>0&&(t.directiveToIndex=new Map);for(let h=0;h<a;h++){const f=i[h];if(t.mergedAttrs=Kl(t.mergedAttrs,f.hostAttrs),Q4(n,t,e,d,f),nG(d,f,r),null!==o&&o.has(f)){const[_,g]=o.get(f);t.directiveToIndex.set(f.type,[d,_+t.directiveStart,g+t.directiveStart])}else(null===s||!s.has(f))&&t.directiveToIndex.set(f.type,d);null!==f.contentQueries&&(t.flags|=4),(null!==f.hostBindings||null!==f.hostAttrs||0!==f.hostVars)&&(t.flags|=64);const p=f.type.prototype;!l&&(p.ngOnChanges||p.ngOnInit||p.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),l=!0),!u&&(p.ngOnChanges||p.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),u=!0),d++}!function J4(n,e,t){for(let i=e.directiveStart;i<e.directiveEnd;i++){const r=n.data[i];if(null!==t&&t.has(r)){const s=t.get(r);CI(0,e,s,i),CI(1,e,s,i),AI(e,i,!0)}else TI(0,e,r,i),TI(1,e,r,i),AI(e,i,!1)}}(n,t,s)}(n,e,t,a,s,c,l)}null!==s&&null!==i&&function Y4(n,e,t){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new O(-301,!1);i.push(e[r],s)}}(t,i,s)}function Z4(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function TI(n,e,t,i){const r=0===n?t.inputs:t.outputs;for(const s in r)if(r.hasOwnProperty(s)){let o;o=0===n?e.inputs??={}:e.outputs??={},o[s]??=[],o[s].push(i),DI(e,s)}}function CI(n,e,t,i){const r=0===n?t.inputs:t.outputs;for(const s in r)if(r.hasOwnProperty(s)){const o=r[s];let a;a=0===n?e.hostDirectiveInputs??={}:e.hostDirectiveOutputs??={},a[o]??=[],a[o].push(i,s),DI(e,o)}}function DI(n,e){"class"===e?n.flags|=8:"style"===e&&(n.flags|=16)}function AI(n,e,t){const{attrs:i,inputs:r,hostDirectiveInputs:s}=n;if(null===i||!t&&null===r||t&&null===s||$0(n))return n.initialInputs??=[],void n.initialInputs.push(null);let o=null,a=0;for(;a<i.length;){const c=i[a];if(0!==c)if(5!==c){if("number"==typeof c)break;if(!t&&r.hasOwnProperty(c)){const l=r[c];for(const u of l)if(u===e){o??=[],o.push(c,i[a+1]);break}}else if(t&&s.hasOwnProperty(c)){const l=s[c];for(let u=0;u<l.length;u+=2)if(l[u]===e){o??=[],o.push(l[u+1],i[a+1]);break}}a+=2}else a+=2;else a+=4}n.initialInputs??=[],n.initialInputs.push(o)}function Q4(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=pc(r.type)),o=new ih(s,$r(r),pt,null);n.blueprint[i]=o,t[i]=o,function eG(n,e,t,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function tG(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,i,s)}}(n,e,i,_h(n,t,r.hostVars,Mn),r)}function nG(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;$r(e)&&(t[""]=n)}}function ME(n,e,t,i,r,s,o,a){const c=e[1],l=c.consts,d=Dc(c,n,t,i,qi(l,o));return s&&xI(c,e,d,qi(l,a),r),d.mergedAttrs=Kl(d.mergedAttrs,d.attrs),null!==d.attrs&&Vm(d,d.attrs,!1),null!==d.mergedAttrs&&Vm(d,d.mergedAttrs,!0),null!==c.queries&&c.queries.elementStart(c,d),d}function wE(n,e){PC(n,e),RT(e)&&n.queries.elementEnd(e)}function zm(n){return!!function xE(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function Wn(n,e,t){return t!==Mn&&(!Object.is(n[e],t)&&(n[e]=t,!0))}function Nh(n,e,t){return function i(r){lu(Eo(n)?cr(n.index,e):e,5);const o=e[8];let a=RI(e,o,t,r),c=i.__ngNextListenerFn__;for(;c;)a=RI(e,o,c,r)&&a,c=c.__ngNextListenerFn__;return a}}function RI(n,e,t,i){const r=_t(null);try{return En(6,e,t),!1!==t(i)}catch(s){return function cE(n,e){const t=n[9];if(!t)return;let i;try{i=t.get(xs,null)}catch{i=null}i?.(e)}(n,s),!1}finally{En(7,e,t),_t(r)}}function NI(n,e,t,i,r,s,o){const a=e.firstCreatePass?zT(e):null,c=VT(t),l=c.length;c.push(r,s),a&&a.push(i,n,l,(l+1)*(o?-1:1))}function Gm(n,e,t,i,r,s){const a=e[1],d=e[t][a.data[t].outputs[i]].subscribe(s);NI(n.index,a,e,r,s,d,!0)}const Sa=Symbol("BINDING");class OI extends Fm{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=vn(e);return new TE(t,this.ngModule)}}class TE extends MI{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=function mG(n){return Object.keys(n).map(e=>{const[t,i,r]=n[e],s={propName:t,templateName:e,isSignal:0!==(i&ym.SignalBased)};return r&&(s.transform=r),s})}(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=function gG(n){return Object.keys(n).map(e=>({propName:n[e],templateName:e}))}(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function cH(n){return n.map(aH).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,i,r,s,o){En(22);const a=_t(null);try{const c=this.componentDef,l=function bG(n,e,t,i){const r=n?["ng-version","20.2.3"]:function lH(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!Ts(r))break;r=s}i++}return t.length&&e.push(1,...t),e}(e.selectors[0]);let s=null,o=null,a=0;if(t)for(const u of t)a+=u[Sa].requiredVars,u.create&&(u.targetIdx=0,(s??=[]).push(u)),u.update&&(u.targetIdx=0,(o??=[]).push(u));if(i)for(let u=0;u<i.length;u++){const d=i[u];if("function"!=typeof d)for(const h of d.bindings){a+=h[Sa].requiredVars;const f=u+1;h.create&&(h.targetIdx=f,(s??=[]).push(h)),h.update&&(h.targetIdx=f,(o??=[]).push(h))}}const c=[e];if(i)for(const u of i){const h=or("function"==typeof u?u:u.type);c.push(h)}return X0(0,null,function SG(n,e){return n||e?t=>{if(1&t&&n)for(const i of n)i.create();if(2&t&&e)for(const i of e)i.update()}:null}(s,o),1,a,c,null,null,null,[r],null)}(i,c,o,s),u=function _G(n,e,t){let i=e instanceof $i?e:e?.injector;return i&&null!==n.getStandaloneInjector&&(i=n.getStandaloneInjector(i)||i),i?new hu(t,i):t}(c,r||this.ngModule,e),d=function yG(n){const e=n.get(km,null);if(null===e)throw new O(407,!1);return{rendererFactory:e,sanitizer:n.get(j4,null),changeDetectionScheduler:n.get(bc,null),ngReflect:!1}}(u),h=d.rendererFactory.createRenderer(null,c),f=i?function SH(n,e,t,i){const s=i.get(UV,!1)||t===Co.ShadowDom,o=n.selectRootElement(e,s);return function MH(n){kA(n)}(o),o}(h,i,c.encapsulation,u):function vG(n,e){const t=function EG(n){return(n.selectors[0][0]||"div").toLowerCase()}(n);return gm(e,t,"svg"===t?"svg":"math"===t?"math":null)}(c,h),p=o?.some(LI)||s?.some(m=>"function"!=typeof m&&m.bindings.some(LI)),_=_m(null,l,null,512|Y0(c),null,null,d,h,u,null,null);_[26]=f,Kv(_);let g=null;try{const m=ME(26,_,2,"#host",()=>l.directiveRegistry,!0,0);f&&(wA(h,f,m),Cr(f,_)),bm(l,_,m),k0(l,m,_),wE(l,m),void 0!==t&&function wG(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const s=t[r];i.push(null!=s&&s.length?Array.from(s):null)}}(m,this.ngContentSelectors,t),g=cr(m.index,_),_[8]=g[8],Tm(l,_,null)}catch(m){throw null!==g&&g0(g),g0(_),m}finally{En(23),Jv()}return new MG(this.componentType,_,!!p)}finally{_t(a)}}}function LI(n){const e=n[Sa].kind;return"input"===e||"twoWay"===e}class MG extends z4{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,i){super(),this._rootLView=t,this._hasInputBindings=i,this._tNode=Vl(t[1],26),this.location=Jl(this._tNode,t),this.instance=cr(this._tNode.index,t)[8],this.hostView=this.changeDetectorRef=new Sh(t,void 0),this.componentType=e}setInput(e,t){const i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const r=this._rootLView;xm(i,r[1],r,e,t),this.previousInputValues.set(e,t),lu(cr(i.index,r),1)}get injector(){return new ci(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}let Cs=(()=>class n{static __NG_ELEMENT_ID__=xG})();function xG(){return UI(At(),te())}const TG=Cs,FI=class extends TG{_lContainer;_hostTNode;_hostLView;constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Jl(this._hostTNode,this._hostLView)}get injector(){return new ci(this._hostTNode,this._hostLView)}get parentInjector(){const e=Zp(this._hostTNode,this._hostLView);if(c0(e)){const t=sh(e,this._hostLView),i=rh(e);return new ci(t[1].data[i+8],t)}return new ci(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=kI(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const a=e.createEmbeddedViewImpl(t||{},s,null);return this.insertImpl(a,r,Cc(this._hostTNode,null)),a}createComponent(e,t,i,r,s,o,a){const c=e&&!function nh(n){return"function"==typeof n}(e);let l;if(c)l=t;else{const g=t||{};l=g.index,i=g.injector,r=g.projectableNodes,s=g.environmentInjector||g.ngModuleRef,o=g.directives,a=g.bindings}const u=c?e:new TE(vn(e)),d=i||this.parentInjector;if(!s&&null==u.ngModule){const m=(c?d:this.parentInjector).get($i,null);m&&(s=m)}vn(u.componentType??{});const _=u.create(d,r,null,s,o,a);return this.insertImpl(_.hostView,l,Cc(this._hostTNode,null)),_}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,i){const r=e._lView;if(function zB(n){return ar(n[3])}(r)){const a=this.indexOf(e);if(-1!==a)this.detach(a);else{const c=r[3],l=new FI(c,c[5],c[3]);l.detach(l.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;return function uu(n,e,t,i=!0){const r=e[1];if(function YH(n,e,t,i){const r=10+i,s=t.length;i>0&&(t[r-1][4]=e),i<s-10?(e[4]=t[r],vT(t,10+i,e)):(t.push(e),e[4]=null),e[3]=t;const o=e[16];null!==o&&t!==o&&JA(o,e);const a=e[18];null!==a&&a.insertView(n),Gv(e),e[2]|=128}(r,e,n,t),i){const o=vm(t,n),a=e[11],c=a.parentNode(n[7]);null!==c&&function mH(n,e,t,i,r,s){i[0]=r,i[5]=e,Em(n,i,t,1,r,s)}(r,n[5],a,e,c,o)}const s=e[6];null!==s&&null!==s.firstChild&&(s.firstChild=null)}(o,r,s,i),e.attachToViewContainerRef(),vT(CE(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=kI(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=bh(this._lContainer,t);i&&(Cp(CE(this._lContainer),t),vh(i[1],i))}detach(e){const t=this._adjustIndex(e,-1),i=bh(this._lContainer,t);return i&&null!=Cp(CE(this._lContainer),t)?new Sh(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function kI(n){return n[8]}function CE(n){return n[8]||(n[8]=[])}function UI(n,e){let t;const i=e[n.index];return ar(i)?t=i:(t=ZA(i,e,null,n),e[n.index]=t,Z0(e,t)),BI(t,e,n,i),new FI(t,n,e)}let BI=function zI(n,e,t,i){if(n[7])return;let r;r=8&t.type?Oi(i):function CG(n,e){const t=n[11],i=t.createComment(""),r=bi(e,n),s=t.parentNode(r);return xc(t,s,i,t.nextSibling(r),!1),i}(e,t),n[7]=r};class AE{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new AE(this.queryList)}setDirty(){this.queryList.setDirty()}}class IE{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const o=t.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new IE(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==LE(e,t).matches&&this.queries[t].setDirty()}}class HI{flags;read;predicate;constructor(e,t,i=null){this.flags=t,this.read=i,this.predicate="string"==typeof e?function OG(n){return n.split(",").map(e=>e.trim())}(e):e}}class RE{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new RE(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class PE{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new PE(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,IG(t,s)),this.matchTNodeWithReadOption(e,t,Kp(t,e,s,!1,!1))}else i===Ao?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Kp(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===ga||r===Cs||r===Ao&&4&t.type)this.addMatch(t.index,-2);else{const s=Kp(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function IG(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function PG(n,e,t,i){return-1===t?function RG(n,e){return 11&n.type?Jl(n,e):4&n.type?Dm(n,e):null}(e,n):-2===t?function NG(n,e,t){return t===ga?Jl(e,n):t===Ao?Dm(e,n):t===Cs?UI(e,n):void 0}(n,e,i):oh(n,n[1],t,e)}function GI(n,e,t,i){const r=e[18].queries[i];if(null===r.matches){const s=n.data,o=t.matches,a=[];for(let c=0;null!==o&&c<o.length;c+=2){const l=o[c];a.push(l<0?null:PG(e,s[l],o[c+1],t.metadata.read))}r.matches=a}return r.matches}function NE(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const o=GI(n,e,r,t);for(let a=0;a<s.length;a+=2){const c=s[a];if(c>0)i.push(o[a/2]);else{const l=s[a+1],u=e[-c];for(let d=10;d<u.length;d++){const h=u[d];h[16]===h[3]&&NE(h[1],h,l,i)}if(null!==u[9]){const d=u[9];for(let h=0;h<d.length;h++){const f=d[h];NE(f[1],f,l,i)}}}}}return i}function jI(n,e,t){const i=new iV(!(4&~t));return function HT(n,e,t,i){const r=VT(e);r.push(t),n.firstCreatePass&&zT(n).push(i,r.length-1)}(n,e,i,i.destroy),(e[18]??=new IE).queries.push(new AE(i))-1}function $I(n,e,t){const i=Nt();return i.firstCreatePass&&(function qI(n,e,t){null===n.queries&&(n.queries=new RE),n.queries.track(new PE(e,t))}(i,new HI(n,e,t),-1),!(2&~e)&&(i.staticViewQueries=!0)),jI(i,te(),e)}function LE(n,e){return n.queries.getByIndex(e)}function XI(n,e){const t=n[1],i=LE(t,e);return i.crossesNgTemplate?NE(t,n,e,[]):GI(t,n,i,e)}const QI=new Set;let Pc=class{},eR=class{};class UE extends Pc{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new OI(this);constructor(e,t,i,r=!0){super(),this.ngModuleType=e,this._parent=t;const s=Xs(e);this._bootstrapComponents=Ks(s.bootstrap),this._r3Injector=cC(e,t,[{provide:Pc,useValue:this},{provide:Fm,useValue:this.componentFactoryResolver},...i],ke(e),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class tR extends eR{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new UE(this.moduleType,e,[])}}class nR extends Pc{injector;componentFactoryResolver=new OI(this);instance=null;constructor(e){super();const t=new mc([...e.providers,{provide:Pc,useValue:this},{provide:Fm,useValue:this.componentFactoryResolver}],e.parent||Lv(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function BE(n,e,t=null){return new nR({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}let qG=(()=>{class n{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const i=Iv(0,t.type),r=i.length>0?BE([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Oe({token:n,providedIn:"environment",factory:()=>new n(ct($i))})}return n})();function Lh(n){return To(()=>{const e=rR(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Qp.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:e.standalone?r=>r.get(qG).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Co.Emulated,styles:n.styles||Bn,_:null,schemas:n.schemas||null,tView:null,id:""};e.standalone&&function Xi(n){QI.has(n)||(QI.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}("NgStandalone"),sR(t);const i=n.dependencies;return t.directiveDefs=jm(i,iR),t.pipeDefs=jm(i,Ms),t.id=function KG(n){let e=0;const i=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,"function"==typeof n.consts?"":n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(const s of i.join("|"))e=Math.imul(31,e)+s.charCodeAt(0)|0;return e+=2147483648,"c"+e}(t),t})}function iR(n){return vn(n)||or(n)}function pu(n){return To(()=>({type:n.type,bootstrap:n.bootstrap||Bn,declarations:n.declarations||Bn,imports:n.imports||Bn,exports:n.exports||Bn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function XG(n,e){if(null==n)return qs;const t={};for(const i in n)if(n.hasOwnProperty(i)){const r=n[i];let s,o,a,c;Array.isArray(r)?(a=r[0],s=r[1],o=r[2]??s,c=r[3]||null):(s=r,o=r,a=ym.None,c=null),t[s]=[i,a,c],e[s]=o}return t}function YG(n){if(null==n)return qs;const e={};for(const t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function ur(n){return To(()=>{const e=rR(n);return sR(e),e})}function rR(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputConfig:n.inputs||qs,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:!0===n.signals,selectors:n.selectors||Bn,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:XG(n.inputs,e),outputs:YG(n.outputs),debugInfo:null}}function sR(n){n.features?.forEach(e=>e(n))}function jm(n,e){return n?()=>{const t="function"==typeof n?n():n,i=[];for(const r of t){const s=e(r);null!==s&&i.push(s)}return i}:null}function Qs(n,e,t,i,r,s,o,a){const c=te(),l=Nt();return function lj(n,e,t,i,r,s,o,a,c,l,u){const d=t+26;let h;e.firstCreatePass?(h=Dc(e,d,4,o||null,a||null),qv()&&xI(e,n,h,qi(e.consts,l),aE),PC(e,h)):h=e.data[d],function hR(n,e,t,i,r,s,o,a){if(t.firstCreatePass){n.mergedAttrs=Kl(n.mergedAttrs,n.attrs);const u=n.tView=X0(2,n,r,s,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);null!==t.queries&&(t.queries.template(t,n),u.queries=t.queries.embeddedTView(n))}a&&(n.flags|=a),Mo(n,!1);const c=pR(t,e,n,i);zp()&&iE(t,e,c,n),Cr(c,e);const l=ZA(c,e,c,n);e[i+26]=l,Z0(e,l)}(h,n,e,t,i,r,s,c),Ul(h)&&bm(e,n,h),null!=l&&au(n,h,u)}(c,l,n,e,t,i,r,qi(l.consts,s),void 0,o,a),Qs}let pR=function mR(n,e,t,i){return Qd(!0),e[11].createComment("")};var HE=function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n}(HE||{});const Uh=new ge(""),ER=!1,qr=class mj extends lt{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,Uv()&&(this.destroyRef=oe(Ys,{optional:!0})??void 0,this.pendingTasks=oe(pa,{optional:!0})??void 0)}emit(e){const t=_t(null);try{super.next(e)}finally{_t(t)}}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&"object"==typeof e){const c=e;r=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=this.wrapInTimeout(s),r&&(r=this.wrapInTimeout(r)),o&&(o=this.wrapInTimeout(o)));const a=super.subscribe({next:r,error:s,complete:o});return e instanceof Ti&&e.add(a),a}wrapInTimeout(e){return t=>{const i=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{void 0!==i&&this.pendingTasks?.remove(i)}})}}};function bR(n){let e,t;function i(){n=eh;try{void 0!==t&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(t),void 0!==e&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),i()}),"function"==typeof requestAnimationFrame&&(t=requestAnimationFrame(()=>{n(),i()})),()=>i()}function SR(n){return queueMicrotask(()=>n()),()=>{n=eh}}const GE="isAngularZone",Xm=GE+"_ID";let gj=0;class fn{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new qr(!1);onMicrotaskEmpty=new qr(!1);onStable=new qr(!1);onError=new qr(!1);constructor(e){const{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:s=ER}=e;if(typeof Zone>"u")throw new O(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&i,o.shouldCoalesceRunChangeDetection=r,o.callbackScheduled=!1,o.scheduleInRootZone=s,function vj(n){const e=()=>{!function yj(n){function e(){bR(()=>{n.callbackScheduled=!1,$E(n),n.isCheckStableRunning=!0,jE(n),n.isCheckStableRunning=!1})}n.isCheckStableRunning||n.callbackScheduled||(n.callbackScheduled=!0,n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),$E(n))}(n)},t=gj++;n._inner=n._inner.fork({name:"angular",properties:{[GE]:!0,[Xm]:t,[Xm+t]:!0},onInvokeTask:(i,r,s,o,a,c)=>{if(function Ej(n){return xR(n,"__ignore_ng_zone__")}(c))return i.invokeTask(s,o,a,c);try{return MR(n),i.invokeTask(s,o,a,c)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&e(),wR(n)}},onInvoke:(i,r,s,o,a,c,l)=>{try{return MR(n),i.invoke(s,o,a,c,l)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!function bj(n){return xR(n,"__scheduler_tick__")}(c)&&e(),wR(n)}},onHasTask:(i,r,s,o)=>{i.hasTask(s,o),r===s&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,$E(n),jE(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(i,r,s,o)=>(i.handleError(s,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(GE)}static assertInAngularZone(){if(!fn.isInAngularZone())throw new O(909,!1)}static assertNotInAngularZone(){if(fn.isInAngularZone())throw new O(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,_j,eh,eh);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const _j={};function jE(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function $E(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&!0===n.callbackScheduled)}function MR(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function wR(n){n._nesting--,jE(n)}class WE{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new qr;onMicrotaskEmpty=new qr;onStable=new qr;onError=new qr;run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}function xR(n,e){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0]?.data?.[e]}let TR=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=Oe({token:n,providedIn:"root",factory:()=>new n})}return n})(),UR=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();const QR=new ge(""),Qm=new ge("");let tb,QE=(()=>{class n{_ngZone;registry;_isZoneStable=!0;_callbacks=[];_taskTrackingZone=null;_destroyRef;constructor(t,i,r){this._ngZone=t,this.registry=i,Uv()&&(this._destroyRef=oe(Ys,{optional:!0})??void 0),tb||(function A$(n){tb=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this._taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){const t=this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),i=this._ngZone.runOutsideAngular(()=>this._ngZone.onStable.subscribe({next:()=>{fn.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}}));this._destroyRef?.onDestroy(()=>{t.unsubscribe(),i.unsubscribe()})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1))}}getPendingTasks(){return this._taskTrackingZone?this._taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t()},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this._taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}static \u0275fac=function(i){return new(i||n)(ct(fn),ct(eb),ct(Qm))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})(),eb=(()=>{class n{_applications=new Map;registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return tb?.findTestabilityInTree(this,t,i)??null}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();function eg(n){return!!n&&"function"==typeof n.then}function e1(n){return!!n&&"function"==typeof n.subscribe}const t1=new ge("");let n1=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i});appInits=oe(t1,{optional:!0})??[];injector=oe(ds);constructor(){}runInitializers(){if(this.initialized)return;const t=[];for(const r of this.appInits){const s=Gr(this.injector,r);if(eg(s))t.push(s);else if(e1(s)){const o=new Promise((a,c)=>{s.subscribe({complete:a,error:c})});t.push(o)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const i1=new ge("");let wa=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=oe(xs);afterRenderManager=oe(TR);zonelessEnabled=oe(fC);rootEffectScheduler=oe(gC);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new lt;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=oe(pa);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(hn(t=>!t))}constructor(){oe(Uh,{optional:!0})}whenStable(){let t;return new Promise(i=>{t=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{t.unsubscribe()})}_injector=oe($i);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,i){return this.bootstrapImpl(t,i)}bootstrapImpl(t,i,r=ds.NULL){return this._injector.get(fn).run(()=>{En(10);const o=t instanceof MI;if(!this._injector.get(n1).done)throw new O(405,"");let c;c=o?t:this._injector.get(Fm).resolveComponentFactory(t),this.componentTypes.push(c.componentType);const l=function R$(n){return n.isBoundToModule}(c)?void 0:this._injector.get(Pc),d=c.create(r,[],i||c.selector,l),h=d.location.nativeElement,f=d.injector.get(QR,null);return f?.registerApplication(h),d.onDestroy(()=>{this.detachView(d.hostView),tg(this.components,d),f?.unregisterApplication(h)}),this._loadComponent(d),En(11,d),d})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){En(12),null!==this.tracingSnapshot?this.tracingSnapshot.run(HE.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new O(101,!1);const t=_t(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,_t(t),this.afterTick.next(),En(13)}};synchronize(){null===this._rendererFactory&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(km,null,{optional:!0}));let t=0;for(;0!==this.dirtyFlags&&t++<10;)En(14),this.synchronizeOnce(),En(15)}synchronizeOnce(){16&this.dirtyFlags&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(7&this.dirtyFlags){const i=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews)(i||kp(r))&&(Cm(r,i&&!this.zonelessEnabled?0:1),t=!0);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),23&this.dirtyFlags)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:t})=>kp(t))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;tg(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(t),this._injector.get(i1,[]).forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>tg(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new O(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function tg(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const p1=new ge("",{providedIn:"root",factory:()=>!1}),p5=new ge("",{providedIn:"root",factory:()=>m5}),m5=4e3;function Yi(n,e,t){const i=te();return Wn(i,xr(),e)&&(Nt(),sE(function ws(){const n=Tt.lFrame;return Vl(n.tView,n.selectedIndex)}(),i,n,e,i[11],t)),Yi}function gb(n,e,t,i,r){xm(e,n,t,r?"class":"style",i)}function ht(n,e,t,i){const r=te(),s=r[1],o=n+26,a=s.firstCreatePass?ME(o,r,2,e,aE,qv(),t,i):s.data[o];if(function Mm(n,e,t,i,r){const s=26+t,o=e[1],a=r(o,e,n,i,t);e[s]=a,Mo(n,!0);const c=2===n.type;return c?(wA(e[11],a,n),(0===function HB(){return Tt.lFrame.elementDepthCount}()||Ul(n))&&Cr(a,e),function GB(){Tt.lFrame.elementDepthCount++}()):Cr(a,e),zp()&&(!c||!om(n))&&iE(o,e,a,n),n}(a,r,n,e,vb),Ul(a)){const c=r[1];bm(c,r,a),k0(c,a,r)}return null!=i&&au(r,a),ht}function mt(){const n=Nt(),t=wm(At());return n.firstCreatePass&&wE(n,t),function $T(n){return Tt.skipHydrationRootTNode===n}(t)&&function WT(){Tt.skipHydrationRootTNode=null}(),function GT(){Tt.lFrame.elementDepthCount--}(),null!=t.classesWithoutHost&&function k3(n){return!!(8&n.flags)}(t)&&gb(n,t,te(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function U3(n){return!!(16&n.flags)}(t)&&gb(n,t,te(),t.stylesWithoutHost,!1),mt}function Io(n,e,t,i){return ht(n,e,t,i),mt(),Io}typeof document<"u"&&document;let vb=(n,e,t,i,r)=>(Qd(!0),gm(e[11],i,function t3(){return Tt.lFrame.currentNamespace}()));function wu(){return te()}const lg="en-US";let N1=lg;function gi(n,e,t){const i=te(),r=Nt(),s=At();return function xb(n,e,t,i,r,s,o){let a=!0,c=null;if((3&i.type||o)&&(c??=Nh(i,e,s),function PI(n,e,t,i,r,s,o,a){const c=Ul(n);let l=!1,u=null;if(!i&&c&&(u=function aG(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===t&&r[s+1]===i){const a=e[7],c=r[s+2];return a&&a.length>c?a[c]:null}"string"==typeof o&&(s+=2)}return null}(e,t,s,n.index)),null!==u)(u.__ngLastListenerFn__||u).__ngNextListenerFn__=o,u.__ngLastListenerFn__=o,l=!0;else{const d=bi(n,t),h=i?i(d):d,f=r.listen(h,s,a);NI(i?_=>i(Oi(_[n.index])):n.index,e,t,s,a,f,!1)}return l}(i,n,e,o,t,r,s,c)&&(a=!1)),a){const l=i.outputs?.[r],u=i.hostDirectiveOutputs?.[r];if(u&&u.length)for(let d=0;d<u.length;d+=2){const h=u[d],f=u[d+1];c??=Nh(i,e,s),Gm(i,e,h,f,r,c)}if(l&&l.length)for(const d of l)c??=Nh(i,e,s),Gm(i,e,d,r,r,c)}}(r,i,i[11],s,n,e,t),gi}function hr(n=1){return function ZB(n){return(Tt.lFrame.contextLView=function BT(n,e){for(;n>0;)e=e[14],n--;return e}(n,Tt.lFrame.contextLView))[8]}(n)}function Tb(n,e,t){$I(n,e,t)}function fg(n){const e=te(),t=Nt(),i=Zv();Vp(i+1);const r=LE(t,i);if(n.dirty&&function VB(n){return!(4&~n[2])}(e)===!(2&~r.metadata.flags)){if(null===r.matches)n.reset([]);else{const s=XI(e,i);n.reset(s,QC),n.notifyOnChanges()}return!0}return!1}function pg(){return function OE(n,e){return n[18].queries[e].queryList}(te(),Zv())}function mg(n,e){return n<<17|e<<2}function Vc(n){return n>>17&32767}function Cb(n){return 2|n}function Tu(n){return(131068&n)>>2}function Db(n,e){return-131069&n|e<<2}function Ab(n){return 1|n}function eP(n,e,t,i){const r=n[t+1],s=null===e;let o=i?Vc(r):Tu(r),a=!1;for(;0!==o&&(!1===a||s);){const l=n[o+1];qW(n[o],e)&&(a=!0,n[o+1]=i?Ab(l):Cb(l)),o=i?Vc(l):Tu(l)}a&&(n[t+1]=i?Cb(r):Ab(r))}function qW(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&Xd(n,e)>=0}const Ci={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function tP(n){return n.substring(Ci.key,Ci.keyEnd)}function nP(n,e){const t=Ci.textEnd;return t===e?-1:(e=Ci.keyEnd=function KW(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}(n,Ci.key=e,t),Cu(n,e,t))}function Cu(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function zc(n,e){return function cP(n,e,t,i){const r=te(),s=Nt(),o=xo(2);s.firstUpdatePass&&dP(s,n,o,i),e!==Mn&&Wn(r,o,e)&&fP(s,s.data[zi()],r,r[11],n,r[o+1]=function u8(n,e){return null==n||""===n||("string"==typeof e?n+=e:"object"==typeof n&&(n=ke(va(n)))),n}(e,t),i,o)}(n,e,null,!0),zc}function gg(n){!function lP(n,e,t,i){const r=Nt(),s=xo(2);r.firstUpdatePass&&dP(r,null,s,i);const o=te();if(t!==Mn&&Wn(o,s,t)){const a=r.data[zi()];if(mP(a,i)&&!uP(r,s)){let c=i?a.classesWithoutHost:a.stylesWithoutHost;null!==c&&(t=vt(c,t||"")),gb(r,a,o,t,i)}else!function l8(n,e,t,i,r,s,o,a){r===Mn&&(r=Bn);let c=0,l=0,u=0<r.length?r[0]:null,d=0<s.length?s[0]:null;for(;null!==u||null!==d;){const h=c<r.length?r[c+1]:void 0,f=l<s.length?s[l+1]:void 0;let _,p=null;u===d?(c+=2,l+=2,h!==f&&(p=d,_=f)):null===d||null!==u&&u<d?(c+=2,p=u):(l+=2,p=d,_=f),null!==p&&fP(n,e,t,i,p,_,o,a),u=c<r.length?r[c]:null,d=l<s.length?s[l]:null}}(r,a,o,o[11],o[s+1],o[s+1]=function a8(n,e,t){if(null==t||""===t)return Bn;const i=[],r=va(t);if(Array.isArray(r))for(let s=0;s<r.length;s++)n(i,r[s],!0);else if("object"==typeof r)for(const s in r)r.hasOwnProperty(s)&&n(i,s,r[s]);else"string"==typeof r&&e(i,r);return i}(n,e,t),i,s)}}(c8,n8,n,!0)}function n8(n,e){for(let t=function YW(n){return function rP(n){Ci.key=0,Ci.keyEnd=0,Ci.value=0,Ci.valueEnd=0,Ci.textEnd=n.length}(n),nP(n,Cu(n,0,Ci.textEnd))}(e);t>=0;t=nP(e,t))Ap(n,tP(e),!0)}function uP(n,e){return e>=n.expandoStartIndex}function dP(n,e,t,i){const r=n.data;if(null===r[t+1]){const s=r[zi()],o=uP(n,t);mP(s,i)&&null===e&&!o&&(e=!1),e=function i8(n,e,t,i){const r=function Yv(n){const e=Tt.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=i?e.residualClasses:e.residualStyles;if(null===r)0===(i?e.classBindings:e.styleBindings)&&(t=qh(t=Ib(null,n,e,t,i),e.attrs,i),s=null);else{const o=e.directiveStylingLast;if(-1===o||n[o]!==r)if(t=Ib(r,n,e,t,i),null===s){let c=function r8(n,e,t){const i=t?e.classBindings:e.styleBindings;if(0!==Tu(i))return n[Vc(i)]}(n,e,i);void 0!==c&&Array.isArray(c)&&(c=Ib(null,n,e,c[1],i),c=qh(c,e.attrs,i),function s8(n,e,t,i){n[Vc(t?e.classBindings:e.styleBindings)]=i}(n,e,i,c))}else s=function o8(n,e,t){let i;const r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++)i=qh(i,n[s].hostAttrs,t);return qh(i,e.attrs,t)}(n,e,i)}return void 0!==s&&(i?e.residualClasses=s:e.residualStyles=s),t}(r,s,e,i),function $W(n,e,t,i,r,s){let o=s?e.classBindings:e.styleBindings,a=Vc(o),c=Tu(o);n[i]=t;let u,l=!1;if(Array.isArray(t)?(u=t[1],(null===u||Xd(t,u)>0)&&(l=!0)):u=t,r)if(0!==c){const h=Vc(n[a+1]);n[i+1]=mg(h,a),0!==h&&(n[h+1]=Db(n[h+1],i)),n[a+1]=function GW(n,e){return 131071&n|e<<17}(n[a+1],i)}else n[i+1]=mg(a,0),0!==a&&(n[a+1]=Db(n[a+1],i)),a=i;else n[i+1]=mg(c,0),0===a?a=i:n[c+1]=Db(n[c+1],i),c=i;l&&(n[i+1]=Cb(n[i+1])),eP(n,u,i,!0),eP(n,u,i,!1),function WW(n,e,t,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&Xd(s,e)>=0&&(t[i+1]=Ab(t[i+1]))}(e,u,n,i,s),o=mg(a,c),s?e.classBindings=o:e.styleBindings=o}(r,s,e,t,o,i)}}function Ib(n,e,t,i,r){let s=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(s=e[a],i=qh(i,s.hostAttrs,r),s!==n);)a++;return null!==n&&(t.directiveStylingLast=a),i}function qh(n,e,t){const i=t?1:2;let r=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?r=o:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Ap(n,o,!!t||e[++s]))}return void 0===n?null:n}function c8(n,e,t){const i=String(e);""!==i&&!i.includes(" ")&&Ap(n,i,t)}function fP(n,e,t,i,r,s,o,a){if(!(3&e.type))return;const c=n.data,l=c[a+1],u=function jW(n){return!(1&~n)}(l)?pP(c,e,t,r,Tu(l),o):void 0;_g(u)||(_g(s)||function HW(n){return!(2&~n)}(l)&&(s=pP(c,null,t,r,a,o)),function bH(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let s=-1===i.indexOf("-")?void 0:Ea.DashCase;null==r?n.removeStyle(t,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Ea.Important),n.setStyle(t,i,r,s))}}(i,o,Bl(zi(),t),r,s))}function pP(n,e,t,i,r,s){const o=null===e;let a;for(;r>0;){const c=n[r],l=Array.isArray(c),u=l?c[1]:c,d=null===u;let h=t[r+1];h===Mn&&(h=d?Bn:void 0);let f=d?Cv(h,i):u===i?h:void 0;if(l&&!_g(f)&&(f=Cv(c,i)),_g(f)&&(a=f,o))return a;const p=n[r+1];r=o?Vc(p):Tu(p)}if(null!==e){let c=s?e.residualClasses:e.residualStyles;null!=c&&(a=Cv(c,i))}return a}function _g(n){return void 0!==n}function mP(n,e){return!!(n.flags&(e?8:16))}function Wt(n,e=""){const t=te(),i=Nt(),r=n+26,s=i.firstCreatePass?Dc(i,r,1,e,null):i.data[r],o=gP(i,t,s,e,n);t[r]=o,zp()&&iE(i,t,o,s),Mo(s,!1)}let gP=(n,e,t,i,r)=>(Qd(!0),function W0(n,e){return n.createText(e)}(e[11],i));function vP(n,e,t,i,r,s=""){const a=function Rc(n,e,t,i){const r=Wn(n,e,t);return Wn(n,e+1,i)||r}(n,function wo(){return Tt.lFrame.bindingIndex}(),t,r);return xo(2),a?e+Pt(t)+i+Pt(r)+s:Mn}function Ro(n){return Xr("",n),Ro}function Xr(n,e,t){const i=te(),r=function yP(n,e,t,i=""){return Wn(n,xr(),t)?e+Pt(t)+i:Mn}(i,n,e,t);return r!==Mn&&Po(i,zi(),r),Xr}function yg(n,e,t,i,r){const s=te(),o=vP(s,n,e,t,i,r);return o!==Mn&&Po(s,zi(),o),yg}function Po(n,e,t){const i=Bl(e,n);!function EA(n,e,t){n.setValue(e,t)}(n[11],i,t)}class T6{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let C6=(()=>{class n{compileModuleSync(t){return new tR(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),s=Ks(Xs(t).declarations).reduce((o,a)=>{const c=vn(a);return c&&o.push(new TE(c)),o},[]);return new T6(i,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),A6=(()=>{class n{zone=oe(fn);changeDetectionScheduler=oe(bc);applicationRef=oe(wa);applicationErrorHandler=oe(xs);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Bb({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new fn({...Vb(),scheduleInRootZone:t}),[{provide:fn,useFactory:n},{provide:la,multi:!0,useFactory:()=>{const i=oe(A6,{optional:!0});return()=>i.initialize()}},{provide:la,multi:!0,useFactory:()=>{const i=oe(R6);return()=>{i.initialize()}}},!0===e?{provide:pC,useValue:!0}:[],{provide:mC,useValue:t??ER},{provide:xs,useFactory:()=>{const i=oe(fn),r=oe($i);let s;return o=>{i.runOutsideAngular(()=>{r.destroyed&&!s?setTimeout(()=>{throw o}):(s??=r.get(Gl),s.handleError(o))})}}}]}function Vb(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}let R6=(()=>{class n{subscription=new Ti;initialized=!1;zone=oe(fn);pendingTasks=oe(pa);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{fn.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{fn.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Hb=(()=>{class n{applicationErrorHandler=oe(xs);appRef=oe(wa);taskService=oe(pa);ngZone=oe(fn);zonelessEnabled=oe(fC);tracing=oe(Uh,{optional:!0});disableScheduling=oe(pC,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Ti;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Xm):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(oe(mC,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof WE||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;let i=!1;switch(t){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 6:case 13:this.appRef.dirtyFlags|=2,i=!0;break;case 12:this.appRef.dirtyFlags|=16,i=!0;break;case 11:i=!0;break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;const r=this.useMicrotaskScheduler?SR:bR;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>r(()=>this.tick())):this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Xm+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(0===this.appRef.dirtyFlags)return void this.cleanup();!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){this.taskService.remove(t),this.applicationErrorHandler(i)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,SR(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Da=new ge("",{providedIn:"root",factory:()=>oe(Da,{optional:!0,skipSelf:!0})||function P6(){return typeof $localize<"u"&&$localize.locale||lg}()}),wg=Symbol("InputSignalNode#UNSET"),hN={...aa,transformFn:void 0,applyValueToInputSignal(n,e){oc(n,e)}};function fN(n,e){const t=Object.create(hN);function i(){if(ic(t),t.value===wg)throw new O(-950,null);return t.value}return t.value=n,t.transformFn=e?.transform,i[oi]=t,i}function pN(n,e){return fN(n,e)}new ge("").__NG_ELEMENT_ID__=n=>{const e=At();if(null===e)throw new O(204,!1);if(2&e.type)return e.value;if(8&n)return null;throw new O(204,!1)};const G6=(pN.required=function H6(n){return fN(wg,n)},pN),xg=new ge(""),X6=new ge("");function Kh(n){return!n.moduleRef}let EN,Aa=null;let Xb=(()=>class n{static __NG_ELEMENT_ID__=eq})();function eq(n){return function tq(n,e,t){if(Eo(n)&&!t){const i=cr(n.index,e);return new Sh(i,i)}return 175&n.type?new Sh(e[15],e):null}(At(),te(),!(16&~n))}class CN{constructor(){}supports(e){return zm(e)}create(e){return new iq(e)}}const nq=(n,e)=>e;class iq{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||nq}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){const o=!i||t&&t.currentIndex<AN(i,r,s)?t:i,a=AN(o,r,s),c=o.currentIndex;if(o===i)r--,i=i._nextRemoved;else if(t=t._next,null==o.previousIndex)r++;else{s||(s=[]);const l=a-r,u=c-r;if(l!=u){for(let h=0;h<l;h++){const f=h<s.length?s[h]:s[h]=0,p=f+h;u<=p&&p<l&&(s[h]=f+1)}s[o.previousIndex]=u-l}}a!==c&&e(o,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!zm(e))throw new O(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,s,o,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,o,a),i=!0),t=t._next}else r=0,function sG(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Symbol.iterator]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,a=>{o=this._trackByFn(r,a),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,a,o,r)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new rq(t,i),s,r),e}_verifyReinsertion(e,t,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,s=e._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new DN),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new DN),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class rq{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}}class sq{_head=null;_tail=null;add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class DN{map=new Map;put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new sq,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function AN(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function RN(){return new Yb([new CN])}let Yb=(()=>{class n{factories;static \u0275prov=Oe({token:n,providedIn:"root",factory:RN});constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:()=>{const i=oe(n,{optional:!0,skipSelf:!0});return n.create(t,i||RN())}}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new O(901,!1)}}return n})(),uq=(()=>{class n{constructor(t){}static \u0275fac=function(i){return new(i||n)(ct(wa))};static \u0275mod=pu({type:n});static \u0275inj=Ws({})}return n})();function dq(n){En(8);try{const{rootComponent:e,appProviders:t,platformProviders:i}=n,r=function Q6(n=[]){if(Aa)return Aa;const e=function wN(n=[],e){return ds.create({name:e,providers:[{provide:Nv,useValue:"platform"},{provide:xg,useValue:new Set([()=>Aa=null])},...n]})}(n);return Aa=e,function I$(){!function pp(n){fp=n}(()=>{throw new O(600,"")})}(),function xN(n){const e=n.get(vD,null);Gr(n,()=>{e?.forEach(t=>t())})}(e),e}(i),s=[Bb({}),{provide:bc,useExisting:Hb},uC,...t||[]];return function vN(n){const e=Kh(n)?n.r3Injector:n.moduleRef.injector,t=e.get(fn);return t.run(()=>{Kh(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();const i=e.get(xs);let r;if(t.runOutsideAngular(()=>{r=t.onError.subscribe({next:i})}),Kh(n)){const s=()=>e.destroy(),o=n.platformInjector.get(xg);o.add(s),e.onDestroy(()=>{r.unsubscribe(),o.delete(s)})}else{const s=()=>n.moduleRef.destroy(),o=n.platformInjector.get(xg);o.add(s),n.moduleRef.onDestroy(()=>{tg(n.allPlatformModules,n.moduleRef),r.unsubscribe(),o.delete(s)})}return function Z6(n,e,t){try{const i=t();return eg(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n(i)),i}}(i,t,()=>{const s=e.get(pa),o=s.add(),a=e.get(n1);return a.runInitializers(),a.donePromise.then(()=>{if(function K5(n){"string"==typeof n&&(N1=n.toLowerCase().replace(/_/g,"-"))}(e.get(Da,lg)||lg),!e.get(X6,!0))return Kh(n)?e.get(wa):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(Kh(n)){const u=e.get(wa);return void 0!==n.rootComponent&&u.bootstrap(n.rootComponent),u}return EN?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>{s.remove(o)})})})}({r3Injector:new nR({providers:s,parent:r,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:r,rootComponent:e})}catch(e){return Promise.reject(e)}finally{En(9)}}const qN="browser";function XN(n){return n===qN}function Li(n){return function g9(n){const e=_t(null);try{return n()}finally{_t(e)}}(n)}Error,Error;class yX{$implicit;ngForOf;index;count;constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let fS=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((r,s,o)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new yX(r.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)i.remove(null===s?void 0:s);else if(null!==s){const a=i.get(s);i.move(a,o),MO(a,r)}});for(let r=0,s=i.length;r<s;r++){const a=i.get(r).context;a.index=r,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{MO(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(t,i){return!0}static \u0275fac=function(i){return new(i||n)(pt(Cs),pt(Ao),pt(Yb))};static \u0275dir=ur({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function MO(n,e){n.context.$implicit=e.item}let $g=(()=>{class n{_viewContainer;_context=new vX;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,i){this._viewContainer=t,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){wO(t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){wO(t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,i){return!0}static \u0275fac=function(i){return new(i||n)(pt(Cs),pt(Ao))};static \u0275dir=ur({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})();class vX{$implicit=null;ngIf=null}function wO(n,e){if(n&&!n.createEmbeddedView)throw new O(2020,!1)}let Wg=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=pu({type:n});static \u0275inj=Ws({})}return n})();const yS=new ge("");let CO=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,i){this._zone=i,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r,s){return this._findPluginFor(i).addEventListener(t,i,r,s)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(s=>s.supports(t)),!i)throw new O(5101,!1);return this._eventNameToPlugin.set(t,i),i}static \u0275fac=function(i){return new(i||n)(ct(yS),ct(fn))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();class DO{_doc;constructor(e){this._doc=e}manager}const vS="ng-app-id";function AO(n){for(const e of n)e.remove()}function IO(n,e){const t=e.createElement("style");return t.textContent=n,t}function ES(n,e){const t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}let RO=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,i,r,s={}){this.doc=t,this.appId=i,this.nonce=r,function jX(n,e,t,i){const r=n.head?.querySelectorAll(`style[${vS}="${e}"],link[${vS}="${e}"]`);if(r)for(const s of r)s.removeAttribute(vS),s instanceof HTMLLinkElement?i.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&t.set(s.textContent,{usage:0,elements:[s]})}(t,i,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,i){for(const r of t)this.addUsage(r,this.inline,IO);i?.forEach(r=>this.addUsage(r,this.external,ES))}removeStyles(t,i){for(const r of t)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(t,i,r){const s=i.get(t);s?s.usage++:i.set(t,{usage:1,elements:[...this.hosts].map(o=>this.addElement(o,r(t,this.doc)))})}removeUsage(t,i){const r=i.get(t);r&&(r.usage--,r.usage<=0&&(AO(r.elements),i.delete(t)))}ngOnDestroy(){for(const[,{elements:t}]of[...this.inline,...this.external])AO(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(const[i,{elements:r}]of this.inline)r.push(this.addElement(t,IO(i,this.doc)));for(const[i,{elements:r}]of this.external)r.push(this.addElement(t,ES(i,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,i){return this.nonce&&i.setAttribute("nonce",this.nonce),t.appendChild(i)}static \u0275fac=function(i){return new(i||n)(ct(Wr),ct(uh),ct(bD,8),ct(nm))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();const bS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},SS=/%COMP%/g,ZX=new ge("",{providedIn:"root",factory:()=>!0});function NO(n,e){return e.map(t=>t.replace(SS,n))}let MS=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;animationDisabled;maxAnimationTimeout;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;registry;constructor(t,i,r,s,o,a,c,l=null,u,d,h=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=c,this.nonce=l,this.animationDisabled=u,this.maxAnimationTimeout=d,this.tracingService=h,this.platformIsServer=!1,this.defaultRenderer=new wS(t,o,c,this.platformIsServer,this.tracingService,this.registry=function e0(){return Qv}(),this.maxAnimationTimeout)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;const r=this.getOrCreateRenderer(t,i);return r instanceof LO?r.applyToHost(t):r instanceof xS&&r.applyStyles(),r}getOrCreateRenderer(t,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const o=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,h=this.tracingService;switch(i.encapsulation){case Co.Emulated:s=new LO(c,l,i,this.appId,u,o,a,d,h,this.registry,this.animationDisabled,this.maxAnimationTimeout);break;case Co.ShadowDom:return new e7(c,l,t,i,o,a,this.nonce,d,h,this.registry,this.maxAnimationTimeout);default:s=new xS(c,l,i,u,o,a,d,h,this.registry,this.animationDisabled,this.maxAnimationTimeout)}r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(i){return new(i||n)(ct(CO),ct(RO),ct(uh),ct(ZX),ct(Wr),ct(nm),ct(fn),ct(bD),ct(p1),ct(p5),ct(Uh,8))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();class wS{eventManager;doc;ngZone;platformIsServer;tracingService;registry;maxAnimationTimeout;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,i,r,s,o,a){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.tracingService=s,this.registry=o,this.maxAnimationTimeout=a}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(bS[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(OO(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(OO(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){const{elements:i}=this.registry;i?i.animate(t,()=>t.remove(),this.maxAnimationTimeout):t.remove()}selectRootElement(e,t){let i="string"==typeof e?this.doc.querySelector(e):e;if(!i)throw new O(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=bS[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=bS[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(Ea.DashCase|Ea.Important)?e.style.setProperty(t,i,r&Ea.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&Ea.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){null!=e&&(e[t]=i)}setValue(e,t){e.nodeValue=t}listen(e,t,i,r){if("string"==typeof e&&!(e=jl().getGlobalEventTarget(this.doc,e)))throw new O(5102,!1);let s=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(e,t,s)),this.eventManager.addEventListener(e,t,s,r)}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&t.preventDefault()}}}function OO(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class e7 extends wS{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,i,r,s,o,a,c,l,u,d){super(e,s,o,c,l,u,d),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let h=r.styles;h=NO(r.id,h);for(const p of h){const _=document.createElement("style");a&&_.setAttribute("nonce",a),_.textContent=p,this.shadowRoot.appendChild(_)}const f=r.getExternalStyles?.();if(f)for(const p of f){const _=ES(p,s);a&&_.setAttribute("nonce",a),this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class xS extends wS{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;_animationDisabled;constructor(e,t,i,r,s,o,a,c,l,u,d,h){super(e,s,o,a,c,l,d),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r,this._animationDisabled=u;let f=i.styles;this.styles=h?NO(h,f):f,this.styleUrls=i.getExternalStyles?.(h)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){if(this.removeStylesOnCompDestroy){if(!this._animationDisabled&&this.registry.elements)return void this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)},this.maxAnimationTimeout)});this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}}}class LO extends xS{contentAttr;hostAttr;constructor(e,t,i,r,s,o,a,c,l,u,d,h){const f=r+"-"+i.id;super(e,t,i,s,o,a,c,l,u,d,h,f),this.contentAttr=function KX(n){return"_ngcontent-%COMP%".replace(SS,n)}(f),this.hostAttr=function JX(n){return"_nghost-%COMP%".replace(SS,n)}(f)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}class TS extends c3{supportsDOMEvents=!0;static makeCurrent(){!function a3(n){_C??=n}(new TS)}onAndCancel(e,t,i,r){return e.addEventListener(t,i,r),()=>{e.removeEventListener(t,i,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function t7(){return rf=rf||document.head.querySelector("base"),rf?rf.getAttribute("href"):null}();return null==t?null:function n7(n){return new URL(n,document.baseURI).pathname}(t)}resetBaseElement(){rf=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return SC(document.cookie,e)}}let rf=null,r7=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})(),s7=(()=>{class n extends DO{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r,s){return t.addEventListener(i,r,s),()=>this.removeEventListener(t,i,r,s)}removeEventListener(t,i,r,s){return t.removeEventListener(i,r,s)}static \u0275fac=function(i){return new(i||n)(ct(Wr))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();const FO=["alt","control","meta","shift"],o7={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},a7={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let c7=(()=>{class n extends DO{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r,s){const o=n.parseEventName(i),a=n.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>jl().onAndCancel(t,o.domEventName,a,s))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),FO.forEach(l=>{const u=i.indexOf(l);u>-1&&(i.splice(u,1),o+=l+".")}),o+=s,0!=i.length||0===s.length)return null;const c={};return c.domEventName=r,c.fullKey=o,c}static matchEventFullKeyCode(t,i){let r=o7[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),FO.forEach(o=>{o!==r&&(0,a7[o])(t)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}static \u0275fac=function(i){return new(i||n)(ct(Wr))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();function kO(n){return{appProviders:[...BO,...n?.providers??[]],platformProviders:f7}}const f7=[{provide:nm,useValue:qN},{provide:vD,useValue:function u7(){TS.makeCurrent()},multi:!0},{provide:Wr,useFactory:function h7(){return function AV(n){v0=n}(document),document}}],UO=[{provide:Qm,useClass:class i7{addToWindow(e){Rt.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new O(5103,!1);return s},Rt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Rt.getAllAngularRootElements=()=>e.getAllRootElements(),Rt.frameworkStabilizers||(Rt.frameworkStabilizers=[]),Rt.frameworkStabilizers.push(i=>{const r=Rt.getAllAngularTestabilities();let s=r.length;const o=function(){s--,0==s&&i()};r.forEach(a=>{a.whenStable(o)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?jl().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}}},{provide:QR,useClass:QE,deps:[fn,eb,Qm]},{provide:QE,useClass:QE,deps:[fn,eb,Qm]}],BO=[{provide:Nv,useValue:"root"},{provide:Gl,useFactory:function d7(){return new Gl}},{provide:yS,useClass:s7,multi:!0,deps:[Wr]},{provide:yS,useClass:c7,multi:!0,deps:[Wr]},MS,RO,CO,{provide:km,useExisting:MS},{provide:MC,useClass:r7},[]];let VO=(()=>{class n{constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275mod=pu({type:n});static \u0275inj=Ws({providers:[...BO,...UO],imports:[Wg,uq]})}return n})();function Ia(n){return this instanceof Ia?(this.v=n,this):new Ia(n)}function jO(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function IS(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){!function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}(a,c,(o=n[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const $O=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function WO(n){return Nn(n?.then)}function qO(n){return Nn(n[xn])}function XO(n){return Symbol.asyncIterator&&Nn(n?.[Symbol.asyncIterator])}function YO(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const ZO=function V7(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function KO(n){return Nn(n?.[ZO])}function JO(n){return function GO(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function o(f){return function(p){return Promise.resolve(p).then(f,d)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(f,p){i[f]&&(r[f]=function(_){return new Promise(function(g,m){s.push([f,_,g,m])>1||c(f,_)})},p&&(r[f]=p(r[f])))}function c(f,p){try{!function l(f){f.value instanceof Ia?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}(i[f](p))}catch(_){h(s[0][3],_)}}function u(f){c("next",f)}function d(f){c("throw",f)}function h(f,p){f(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield Ia(t.read());if(r)return yield Ia(void 0);yield yield Ia(i)}}finally{t.releaseLock()}})}function QO(n){return Nn(n?.getReader)}function gs(n){if(n instanceof Te)return n;if(null!=n){if(qO(n))return function z7(n){return new Te(e=>{const t=n[xn]();if(Nn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if($O(n))return function H7(n){return new Te(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(WO(n))return function G7(n){return new Te(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,vp)})}(n);if(XO(n))return eL(n);if(KO(n))return function j7(n){return new Te(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(QO(n))return function $7(n){return eL(JO(n))}(n)}throw YO(n)}function eL(n){return new Te(e=>{(function W7(n,e){var t,i,r,s;return function zO(n,e,t,i){return new(t||(t=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):function r(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,c)}l((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=jO(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function _s(n){return Si((e,t)=>{gs(n).subscribe(pi(t,()=>t.complete(),zd)),!t.closed&&e.subscribe(t)})}function Zr(n,e){return Si((t,i)=>{let r=0;t.subscribe(pi(i,s=>n.call(e,s,r++)&&i.next(s)))})}var _i=function(n){return n.SYS="sys",n.APP="app",n.UI="ui",n}(_i||{}),Fi=function(n){return n.BOT_STATUS="bot_status",n.BOT_COMMAND="bot_command",n.HEALTH_CHECK="health_check",n.USER_ACTION="user_action",n.SYSTEM_EVENT="system_event",n}(Fi||{});const PS={now:()=>(PS.delegate||Date).now(),delegate:void 0};class q7 extends lt{constructor(e=1/0,t=1/0,i=PS){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:i,_infiniteTimeWindow:r,_timestampProvider:s,_windowTime:o}=this;t||(i.push(e),!r&&i.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:i,_buffer:r}=this,s=r.slice();for(let o=0;o<s.length&&!e.closed;o+=i?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:i,_infiniteTimeWindow:r}=this,s=(r?1:2)*e;if(e<1/0&&s<i.length&&i.splice(0,i.length-s),!r){const o=t.now();let a=0;for(let c=1;c<i.length&&i[c]<=o;c+=2)a=c;a&&i.splice(0,a+1)}}}function NS(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new yt({next:()=>{i.unsubscribe(),n()}});return gs(e(...t)).subscribe(i)}function qg(n,e,t){let i,r=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:e=1/0,refCount:r=!1,scheduler:t}=n):i=n??1/0,function X7(n={}){const{connector:e=()=>new lt,resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let o,a,c,l=0,u=!1,d=!1;const h=()=>{a?.unsubscribe(),a=void 0},f=()=>{h(),o=c=void 0,u=d=!1},p=()=>{const _=o;f(),_?.unsubscribe()};return Si((_,g)=>{l++,!d&&!u&&h();const m=c=c??e();g.add(()=>{l--,0===l&&!d&&!u&&(a=NS(p,r))}),m.subscribe(g),!o&&l>0&&(o=new yt({next:y=>m.next(y),error:y=>{d=!0,h(),a=NS(f,t,y),m.error(y)},complete:()=>{u=!0,h(),a=NS(f,i),m.complete()}}),gs(_).subscribe(o))})(s)}}({connector:()=>new q7(i,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}class Y7 extends Ti{constructor(e,t){super()}schedule(e,t=0){return this}}const Xg={setInterval(n,e,...t){const{delegate:i}=Xg;return i?.setInterval?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=Xg;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};class sf{constructor(e,t=sf.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}}sf.now=PS.now;const Yg=new class K7 extends sf{constructor(e,t=sf.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}}(class Z7 extends Y7{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var i;if(this.closed)return this;this.state=e;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return Xg.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&Xg.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r,i=!1;try{this.work(e)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,ac(i,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}),J7=Yg;function tL(n){return n&&Nn(n.schedule)}function nL(n=0,e,t=J7){let i=-1;return null!=e&&(tL(e)?t=e:i=e),new Te(r=>{let s=function eY(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;s<0&&(s=0);let o=0;return t.schedule(function(){r.closed||(r.next(o++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function iL(n,e=Yg){return Si((t,i)=>{let r=null,s=null,o=null;const a=()=>{if(r){r.unsubscribe(),r=null;const l=s;s=null,i.next(l)}};function c(){const l=o+n,u=e.now();if(u<l)return r=this.schedule(void 0,l-u),void i.add(r);a()}t.subscribe(pi(i,l=>{s=l,o=e.now(),r||(r=e.schedule(c,n),i.add(r))},()=>{a(),i.complete()},void 0,()=>{s=r=null}))})}let rL=(()=>{var n;class e{constructor(){this.alephClient=null,this.destroy$=new lt,this.connectionStatus$=new Ht("disconnected"),this.messageStream$=new lt,this.errorStream$=new lt,this.bridgeEvents$=new lt,this.sysChannel$=new lt,this.appChannel$=new lt,this.uiChannel$=new lt,this.activeRooms=new Set,this.reconnectionAttempts=0,this.maxReconnectionAttempts=5,this.isReconnecting$=new Ht(!1),this.reconnectionTimer=null,this.connectionStatus=this.connectionStatus$.asObservable(),this.messages=this.messageStream$.asObservable().pipe(qg(1)),this.errors=this.errorStream$.asObservable(),this.events=this.bridgeEvents$.asObservable(),this.isReconnecting=this.isReconnecting$.asObservable(),this.sysMessages=this.sysChannel$.asObservable().pipe(qg(1)),this.appMessages=this.appChannel$.asObservable().pipe(qg(1)),this.uiMessages=this.uiChannel$.asObservable().pipe(qg(1)),console.log("\u{1f517} RxjsSocketBridge initialized with AlephScript"),this.setupMessagePipeline(),this.setupReconnectionHandler(),this.loadAlephScriptClient()}loadAlephScriptClient(){var i=this;return $n(function*(){try{if(window.createAlephScriptClient)return void console.log("\u2705 AlephScript client already available");const r=document.createElement("script");r.src="/assets/alephscript-client.js",r.async=!0,yield new Promise((s,o)=>{r.onload=s,r.onerror=o,document.head.appendChild(r)}),console.log("\u2705 AlephScript client loaded successfully")}catch(r){console.error("\u274c Failed to load AlephScript client:",r),i.errorStream$.next(r)}})()}connect(i){const s=i||{url:"ws://localhost:9090",options:{autoConnect:!0,timeout:2e4,reconnection:!0,reconnectionAttempts:this.maxReconnectionAttempts,reconnectionDelay:1e3,maxReconnectionDelay:5e3,reconnectionDelayMax:5e3,randomizationFactor:.5}};console.log("\u{1f680} Connecting to AlephScript server:",s.url);try{this.waitForAlephScript().then(()=>{this.alephClient=window.createAlephScriptClient("threejs","threejs-visual",s.url),this.setupAlephScriptEventHandlers(),this.alephClient.connect(),this.bridgeEvents$.next({type:"connection",data:{config:s},timestamp:Date.now()})}).catch(o=>{console.error("\u274c Failed to initialize AlephScript client:",o),this.errorStream$.next(o)})}catch(o){console.error("\u274c Failed to create AlephScript connection:",o),this.errorStream$.next(o)}}waitForAlephScript(){return $n(function*(){let i=0;for(;!window.createAlephScriptClient&&i<50;)yield new Promise(s=>setTimeout(s,100)),i++;if(!window.createAlephScriptClient)throw new Error("AlephScript client not available after waiting")})()}setupAlephScriptEventHandlers(){this.alephClient&&(this.alephClient.on("connected",()=>{console.log("\u2705 AlephScript connected"),this.connectionStatus$.next("connected"),this.reconnectionAttempts=0,this.isReconnecting$.next(!1),this.stopReconnection()}),this.alephClient.on("disconnected",()=>{console.log("\u274c AlephScript disconnected"),this.connectionStatus$.next("disconnected"),this.startReconnection()}),this.alephClient.on("error",i=>{console.error("\u274c AlephScript error:",i),this.connectionStatus$.next("error"),this.errorStream$.next(i),this.startReconnection()}),this.alephClient.on("gameStateUpdate",i=>{const r=this.convertToSocketMessage(i,_i.APP,Fi.SYSTEM_EVENT);this.handleIncomingMessage(r)}),this.alephClient.on("agentSelected",i=>{const r=this.convertToSocketMessage(i,_i.APP,Fi.BOT_COMMAND);this.handleIncomingMessage(r)}),this.alephClient.on("postulationsUpdate",i=>{const r=this.convertToSocketMessage(i,_i.UI,Fi.SYSTEM_EVENT);this.handleIncomingMessage(r)}),this.alephClient.on("xValueUpdate",i=>{const r=this.convertToSocketMessage(i,_i.SYS,Fi.SYSTEM_EVENT);this.handleIncomingMessage(r)}),this.alephClient.on("consoleOutput",i=>{const r=this.convertToSocketMessage(i,_i.SYS,Fi.SYSTEM_EVENT);this.handleIncomingMessage(r)}),this.alephClient.on("heartbeat",i=>{const r=this.convertToSocketMessage(i,_i.SYS,Fi.HEALTH_CHECK);this.handleIncomingMessage(r)}))}convertToSocketMessage(i,r,s){return{id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),channel:r,type:s,action:i.action||"update",data:i,source:"alephscript"}}disconnect(){console.log("\u{1f50c} Disconnecting from AlephScript server"),this.alephClient&&(this.alephClient.disconnect(),this.alephClient=null),this.connectionStatus$.next("disconnected"),this.activeRooms.clear(),this.stopReconnection(),this.bridgeEvents$.next({type:"disconnection",timestamp:Date.now()})}handleIncomingMessage(i){try{switch(console.log("\u{1f4e8} Received message:",i),this.messageStream$.next(i),i.channel){case _i.SYS:this.sysChannel$.next(i);break;case _i.APP:this.appChannel$.next(i);break;case _i.UI:this.uiChannel$.next(i)}this.bridgeEvents$.next({type:"message",data:i,timestamp:Date.now()})}catch(r){console.error("\u274c Error handling incoming message:",r),this.errorStream$.next(r)}}setupMessagePipeline(){const i=this.messageStream$.pipe(function tY(n,e=Yg,t){const i=nL(n,e);return function Q7(n,e){return Si((t,i)=>{const{leading:r=!0,trailing:s=!1}=e??{};let o=!1,a=null,c=null,l=!1;const u=()=>{c?.unsubscribe(),c=null,s&&(f(),l&&i.complete())},d=()=>{c=null,l&&i.complete()},h=p=>c=gs(n(p)).subscribe(pi(i,u,d)),f=()=>{if(o){o=!1;const p=a;a=null,i.next(p),!l&&h(p)}};t.subscribe(pi(i,p=>{o=!0,a=p,(!c||c.closed)&&(r?f():h(p))},()=>{l=!0,(!(s&&o&&c)||c.closed)&&i.complete()}))})}(()=>i,t)}(50),_s(this.destroy$)),r=this.messageStream$.pipe(Zr(s=>s.type===Fi.HEALTH_CHECK),iL(1e3),_s(this.destroy$));i.subscribe(s=>{}),r.subscribe(s=>{console.log("\u{1f493} Processed health check:",s)})}setupReconnectionHandler(){this.connectionStatus$.pipe(Zr(i=>"disconnected"===i||"error"===i),iL(1e3),_s(this.destroy$)).subscribe(()=>{!this.isReconnecting$.value&&this.reconnectionAttempts<this.maxReconnectionAttempts&&this.startReconnection()})}subscribe(i,r){this.getChannelStream(i).pipe(_s(this.destroy$)).subscribe(r)}unsubscribe(i,r){console.log(`\u{1f515} Unsubscribe request for channel: ${i}`)}emit(i,r){if(this.alephClient&&this.alephClient.isConnected())try{switch(r.type){case Fi.USER_ACTION:this.alephClient.sendUserInput(r.action||"action");break;case Fi.BOT_COMMAND:this.alephClient.selectAgent(r.botId||"agent");break;default:this.alephClient.sendMessage(r)}console.log("\u{1f4e4} Emitted message via AlephScript:",i,r)}catch(s){console.error("\u274c Error emitting message:",s),this.errorStream$.next(s)}else console.warn("\u26a0\ufe0f Cannot emit message: AlephScript not connected")}getActiveChannels(){return Object.values(_i)}join(i){var r=this;return $n(function*(){try{return r.alephClient&&r.alephClient.isConnected()?(r.activeRooms.add(i),console.log("\u{1f3e0} Joined room:",i),!0):(console.warn("\u26a0\ufe0f Cannot join room: AlephScript not connected"),!1)}catch(s){return console.error("\u274c Error joining room:",s),!1}})()}leave(i){var r=this;return $n(function*(){try{return r.activeRooms.delete(i),console.log("\u{1f6aa} Left room:",i),!0}catch(s){return console.error("\u274c Error leaving room:",s),!1}})()}getRooms(){return Array.from(this.activeRooms).map(i=>({id:i,name:i,subscribers:1}))}isInRoom(i){return this.activeRooms.has(i)}start(){this.startReconnection()}stop(){this.stopReconnection()}getAttempts(){return this.reconnectionAttempts}getChannelStream(i){switch(i){case _i.SYS:return this.sysMessages;case _i.APP:return this.appMessages;case _i.UI:return this.uiMessages;default:return this.messages.pipe(Zr(r=>r.channel===i))}}startReconnection(){if(this.isReconnecting$.value||this.reconnectionAttempts>=this.maxReconnectionAttempts)return;this.isReconnecting$.next(!0),this.connectionStatus$.next("connecting");const i=Math.min(1e3*Math.pow(2,this.reconnectionAttempts),3e4);console.log(`\u{1f504} Attempting reconnection in ${i}ms (attempt ${this.reconnectionAttempts+1})`),this.reconnectionTimer=setTimeout(()=>{this.reconnectionAttempts++,this.alephClient&&this.alephClient.connect(),setTimeout(()=>{"connected"!==this.connectionStatus$.value&&this.isReconnecting$.next(!1)},5e3)},i)}stopReconnection(){this.reconnectionTimer&&(clearTimeout(this.reconnectionTimer),this.reconnectionTimer=null),this.isReconnecting$.next(!1)}dispose(){console.log("\u{1f9f9} Disposing RxjsSocketBridge"),this.destroy$.next(),this.destroy$.complete(),this.disconnect(),this.connectionStatus$.complete(),this.messageStream$.complete(),this.errorStream$.complete(),this.bridgeEvents$.complete(),this.sysChannel$.complete(),this.appChannel$.complete(),this.uiChannel$.complete(),this.isReconnecting$.complete()}static#e=n=()=>(this.\u0275fac=function(r){return new(r||e)},this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})(),sL=(()=>{var n;class e{constructor(i){this.bridge=i,console.log("SocketService initialized")}connect(i){this.bridge.connect(i)}disconnect(){this.bridge.disconnect()}get connectionStatus$(){return this.bridge.connectionStatus}get messages$(){return this.bridge.messages}get sysMessages$(){return this.bridge.sysMessages}get appMessages$(){return this.bridge.appMessages}get uiMessages$(){return this.bridge.uiMessages}get errors$(){return this.bridge.errors}get isReconnecting$(){return this.bridge.isReconnecting}sendBotCommand(i,r,s){const o={id:`cmd_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),channel:_i.APP,type:Fi.BOT_COMMAND,botId:i,command:r,params:s};this.bridge.emit(_i.APP,o)}sendUserAction(i,r){const s={id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),channel:_i.UI,type:Fi.USER_ACTION,action:i,data:r};this.bridge.emit(_i.UI,s)}joinRoom(i){var r=this;return $n(function*(){return r.bridge.join(i)})()}leaveRoom(i){var r=this;return $n(function*(){return r.bridge.leave(i)})()}isConnected(){return void 0!==this.bridge.connectionStatus}getConnectionAttempts(){return this.bridge.getAttempts()}static#e=n=()=>(this.\u0275fac=function(r){return new(r||e)(ct(rL))},this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})();function nY(n,e){if(1&n){const t=wu();ht(0,"div",9)(1,"button",5),gi("click",function(){return Bi(t),Vi(hr().startAllSelected())}),Wt(2),mt(),ht(3,"button",10),gi("click",function(){return Bi(t),Vi(hr().stopAllSelected())}),Wt(4," Stop Selected "),mt()()}if(2&n){const t=hr();Kt(2),Xr(" Start Selected (",t.getSelectedCount(),") ")}}function iY(n,e){if(1&n&&(ht(0,"span",24),Wt(1),mt()),2&n){const t=hr().$implicit;Kt(),Xr(" ",t.messageCount," msgs ")}}function rY(n,e){if(1&n){const t=wu();ht(0,"div",11),gi("click",function(){const r=Bi(t).$implicit;return Vi(hr().onBotClick(r))}),ht(1,"div",12),Io(2,"div",13),ht(3,"div",14)(4,"div",15),Wt(5),mt(),ht(6,"div",16),Wt(7),mt(),ht(8,"div",17)(9,"span",18),Wt(10),mt(),Qs(11,iY,2,1,"span",19),mt()()(),ht(12,"div",20)(13,"button",21),gi("click",function(r){const s=Bi(t).$implicit;return Vi(hr().startBot(s,r))}),Wt(14," \u25b6 "),mt(),ht(15,"button",22),gi("click",function(r){const s=Bi(t).$implicit;return Vi(hr().stopBot(s,r))}),Wt(16," \u23f9 "),mt(),ht(17,"button",23),gi("click",function(r){const s=Bi(t).$implicit;return Vi(hr().resetBot(s,r))}),Wt(18," \u21bb "),mt()()()}if(2&n){const t=e.$implicit;zc("selected",hr().isSelected(t)),Kt(2),gg(t.status),Kt(3),Ro(t.name),Kt(2),Ro(t.id),Kt(3),Ro(t.status.toUpperCase()),Kt(),Yi("ngIf",t.messageCount>0),Kt(2),Yi("disabled","online"===t.status),Kt(2),Yi("disabled","offline"===t.status)}}function sY(n,e){1&n&&(ht(0,"div",25)(1,"p"),Wt(2,"No bots available"),mt(),ht(3,"small"),Wt(4,"Check your Socket.io connection"),mt()())}let oY=(()=>{var n;class e{constructor(i){this.socketService=i,this.destroy$=new lt,this.bots=[],this.selectedBotIds=new Set}ngOnInit(){console.log("BotListComponent initializing..."),this.initializeBots(),this.socketService.sysMessages$.pipe(_s(this.destroy$),Zr(i=>i.type===Fi.BOT_STATUS)).subscribe(i=>{this.updateBotStatus(i)}),this.socketService.appMessages$.pipe(_s(this.destroy$)).subscribe(i=>{console.log("Bot app message:",i)})}initializeBots(){const i=[{name:"North",angle:0,positions:2},{name:"East",angle:Math.PI/2,positions:2},{name:"South",angle:Math.PI,positions:2},{name:"West",angle:3*Math.PI/2,positions:2}];this.bots=[],i.forEach((r,s)=>{for(let o=0;o<r.positions;o++){const a=`bot_${r.name.toLowerCase()}_${o+1}`,c=5+2*o,l=r.angle+.3*o,u={id:a,name:`${r.name} Bot ${o+1}`,status:"offline",position:{x:Math.cos(l)*c,y:0,z:Math.sin(l)*c},lastActive:null,messageCount:0};this.bots.push(u)}}),console.log("Initialized bots:",this.bots)}updateBotStatus(i){const r=this.bots.find(s=>s.id===i.botId);r&&(r.status=i.status,r.lastActive=new Date,i.position&&(r.position=i.position),console.log("Updated bot status:",r))}onBotClick(i){this.selectedBotIds.has(i.id)?this.selectedBotIds.delete(i.id):this.selectedBotIds.add(i.id),this.socketService.sendUserAction("bot_selected",{botId:i.id,selected:this.selectedBotIds.has(i.id)}),console.log("Bot clicked:",i.id,"Selected:",this.selectedBotIds.has(i.id))}startBot(i,r){r.stopPropagation(),console.log("Starting bot:",i.id),this.socketService.sendBotCommand(i.id,"start")}stopBot(i,r){r.stopPropagation(),console.log("Stopping bot:",i.id),this.socketService.sendBotCommand(i.id,"stop")}resetBot(i,r){r.stopPropagation(),console.log("Resetting bot:",i.id),this.socketService.sendBotCommand(i.id,"reset")}startAllSelected(){this.selectedBotIds.forEach(i=>{this.socketService.sendBotCommand(i,"start")}),console.log("Started all selected bots")}stopAllSelected(){this.selectedBotIds.forEach(i=>{this.socketService.sendBotCommand(i,"stop")}),console.log("Stopped all selected bots")}selectAll(){this.selectedBotIds.clear(),this.bots.forEach(i=>this.selectedBotIds.add(i.id))}deselectAll(){this.selectedBotIds.clear()}isSelected(i){return this.selectedBotIds.has(i.id)}getSelectedCount(){return this.selectedBotIds.size}trackBot(i,r){return r.id}ngOnDestroy(){console.log("BotListComponent destroying..."),this.destroy$.next(),this.destroy$.complete()}static#e=n=()=>(this.\u0275fac=function(r){return new(r||e)(pt(sL))},this.\u0275cmp=Lh({type:e,selectors:[["app-bot-list"]],decls:15,vars:6,consts:[[1,"bot-list-panel","ui-panel"],[1,"panel-header"],[1,"selection-info"],["class","bulk-actions",4,"ngIf"],[1,"selection-controls"],[1,"btn","btn-small",3,"click"],[1,"bot-list"],["class","bot-list-item",3,"selected","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],[1,"bulk-actions"],[1,"btn","btn-small","btn-danger",3,"click"],[1,"bot-list-item",3,"click"],[1,"bot-info"],[1,"bot-status"],[1,"bot-details"],[1,"bot-name"],[1,"bot-id"],[1,"bot-meta"],[1,"status-text"],["class","message-count",4,"ngIf"],[1,"bot-actions"],["title","Start Bot",1,"btn","btn-small",3,"click","disabled"],["title","Stop Bot",1,"btn","btn-small","btn-danger",3,"click","disabled"],["title","Reset Bot",1,"btn","btn-small",3,"click"],[1,"message-count"],[1,"empty-state"]],template:function(r,s){1&r&&(ht(0,"div",0)(1,"div",1)(2,"h3"),Wt(3,"Bot Management"),mt(),ht(4,"div",2),Wt(5),mt()(),Qs(6,nY,5,1,"div",3),ht(7,"div",4)(8,"button",5),gi("click",function(){return s.selectAll()}),Wt(9,"Select All"),mt(),ht(10,"button",5),gi("click",function(){return s.deselectAll()}),Wt(11,"Clear"),mt()(),ht(12,"div",6),Qs(13,rY,19,10,"div",7),mt(),Qs(14,sY,5,0,"div",8),mt()),2&r&&(Kt(5),yg(" ",s.getSelectedCount()," / ",s.bots.length," selected "),Kt(),Yi("ngIf",s.getSelectedCount()>0),Kt(7),Yi("ngForOf",s.bots)("ngForTrackBy",s.trackBot),Kt(),Yi("ngIf",0===s.bots.length))},dependencies:[Wg,fS,$g],styles:[".bot-list-panel[_ngcontent-%COMP%]{width:100%;max-height:100%;display:flex;flex-direction:column}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.1)}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1em;font-weight:600}.selection-info[_ngcontent-%COMP%]{font-size:.8em;color:#bbb}.bulk-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:12px;padding:8px;background:#3498db1a;border-radius:4px;border:1px solid rgba(52,152,219,.3)}.selection-controls[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px}.btn-small[_ngcontent-%COMP%]{padding:4px 8px;font-size:.8em;min-width:auto}.bot-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;max-height:400px}.bot-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px;margin:4px 0;background:#ffffff0d;border-radius:6px;border-left:4px solid transparent;cursor:pointer;transition:all .3s ease;-webkit-user-select:none;user-select:none}.bot-list-item[_ngcontent-%COMP%]:hover{background:#ffffff1a;transform:translate(2px)}.bot-list-item.selected[_ngcontent-%COMP%]{border-left-color:#3498db;background:#3498db33}.bot-info[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.bot-status[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;margin-right:12px;flex-shrink:0}.bot-status.online[_ngcontent-%COMP%]{background:#2ecc71;box-shadow:0 0 10px #2ecc7180}.bot-status.offline[_ngcontent-%COMP%]{background:#e74c3c}.bot-status.processing[_ngcontent-%COMP%]{background:#f39c12;animation:pulse 1.5s ease-in-out infinite alternate}.bot-details[_ngcontent-%COMP%]{flex:1}.bot-name[_ngcontent-%COMP%]{font-weight:500;font-size:.9em;margin-bottom:2px}.bot-id[_ngcontent-%COMP%]{font-size:.7em;color:#bbb;font-family:Courier New,monospace;margin-bottom:4px}.bot-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:.7em}.status-text[_ngcontent-%COMP%]{padding:2px 6px;border-radius:3px;font-weight:500}.bot-list-item[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{background:#ffffff1a}.bot-list-item.selected[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{background:#3498db4d}.message-count[_ngcontent-%COMP%]{color:#3498db}.bot-actions[_ngcontent-%COMP%]{display:flex;gap:4px;flex-shrink:0}.bot-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:28px;height:28px;padding:0;display:flex;align-items:center;justify-content:center;font-size:.8em}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.empty-state[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-top:8px;font-size:.8em}@media (max-width: 768px){.bot-list-item[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:8px}.bot-actions[_ngcontent-%COMP%]{justify-content:center}.bulk-actions[_ngcontent-%COMP%]{flex-direction:column}}.bot-list-item[_ngcontent-%COMP%]{will-change:transform,background-color}"]}))}return n(),e})();function oL(n,e){return Si(function aY(n,e,t,i,r){return(s,o)=>{let a=t,c=e,l=0;s.subscribe(pi(o,u=>{const d=l++;c=a?n(c,u,d):(a=!0,u),i&&o.next(c)},r&&(()=>{a&&o.next(c),o.complete()})))}}(n,e,arguments.length>=2,!0))}const cY=["messageContainer"];function lY(n,e){if(1&n&&(ht(0,"span",26),Wt(1),mt()),2&n){const t=hr(2).$implicit;Kt(),Xr("From: ",t.source)}}function uY(n,e){if(1&n&&(ht(0,"span",27),Wt(1),mt()),2&n){const t=hr(2).$implicit;Kt(),Xr("To: ",t.target)}}function dY(n,e){if(1&n&&(ht(0,"div",23),Qs(1,lY,2,1,"span",24)(2,uY,2,1,"span",25),mt()),2&n){const t=hr().$implicit;Kt(),Yi("ngIf",t.source),Kt(),Yi("ngIf",t.target)}}function hY(n,e){if(1&n){const t=wu();ht(0,"div",16),gi("click",function(){const r=Bi(t).$implicit;return Vi(hr().onMessageClick(r))}),ht(1,"div",17)(2,"span",18),Wt(3),mt(),ht(4,"span",19),Wt(5),mt(),ht(6,"span",20),Wt(7),mt()(),ht(8,"div",21),Wt(9),mt(),Qs(10,dY,3,2,"div",22),mt()}if(2&n){const t=e.$implicit,i=hr();gg(i.getChannelClass(t.channel)),Kt(3),Ro(i.getTimeString(t.timestamp)),Kt(2),Ro(t.channel.toUpperCase()),Kt(2),Ro(t.type),Kt(2),Ro(t.content),Kt(),Yi("ngIf",t.source||t.target)}}function fY(n,e){1&n&&(ht(0,"div",28)(1,"p"),Wt(2,"No messages yet"),mt(),ht(3,"small"),Wt(4,"Waiting for Socket.io messages..."),mt()())}function pY(n,e){1&n&&(ht(0,"div",28)(1,"p"),Wt(2,"No messages match current filters"),mt(),ht(3,"small"),Wt(4,"Try adjusting your channel filters above"),mt()())}let mY=(()=>{var n;class e{constructor(i){this.socketService=i,this.destroy$=new lt,this.messages=[],this.filteredMessages=[],this.activeFilters={sys:!0,app:!0,ui:!0},this.maxMessages=100,this.autoScroll=!0,this.messageStats={total:0,sys:0,app:0,ui:0}}ngOnInit(){console.log("MessagePanelComponent initializing..."),this.socketService.messages$.pipe(_s(this.destroy$),oL((i,r)=>{const o=[...i,this.convertSocketMessageToMessage(r)];return o.length>this.maxMessages&&o.splice(0,o.length-this.maxMessages),o},[])).subscribe(i=>{this.messages=i,this.updateStats(),this.applyFilters(),this.scrollToBottomIfNeeded()})}ngAfterViewInit(){setTimeout(()=>this.scrollToBottom(),100)}convertSocketMessageToMessage(i){return{id:i.id,timestamp:new Date(i.timestamp),channel:i.channel,type:i.type,content:this.formatMessageContent(i),source:i.source,target:i.target,data:i}}formatMessageContent(i){switch(i.type){case Fi.BOT_STATUS:return`Bot ${i.botId} is now ${i.status}`;case Fi.BOT_COMMAND:return`Command "${i.command}" sent to bot ${i.botId}`;case Fi.HEALTH_CHECK:const o=i;return`System Health - CPU: ${o.systemHealth?.cpu}%, Memory: ${o.systemHealth?.memory}%, Connections: ${o.systemHealth?.connections}`;case Fi.USER_ACTION:return`User action: ${i.action}`;case Fi.SYSTEM_EVENT:const c=i;return`${c.severity.toUpperCase()}: ${c.event}`;default:return"Unknown message type"}}updateStats(){this.messageStats={total:this.messages.length,sys:this.messages.filter(i=>i.channel===_i.SYS).length,app:this.messages.filter(i=>i.channel===_i.APP).length,ui:this.messages.filter(i=>i.channel===_i.UI).length}}applyFilters(){this.filteredMessages=this.messages.filter(i=>this.activeFilters[i.channel])}scrollToBottomIfNeeded(){this.autoScroll&&this.messageContainer&&setTimeout(()=>this.scrollToBottom(),0)}scrollToBottom(){if(this.messageContainer){const i=this.messageContainer.nativeElement;i.scrollTop=i.scrollHeight}}toggleFilter(i){this.activeFilters[i]=!this.activeFilters[i],this.applyFilters(),console.log("Filter toggled:",i,this.activeFilters[i])}clearAllFilters(){this.activeFilters={sys:!1,app:!1,ui:!1},this.applyFilters()}showAllFilters(){this.activeFilters={sys:!0,app:!0,ui:!0},this.applyFilters()}clearMessages(){this.messages=[],this.filteredMessages=[],this.updateStats(),console.log("Messages cleared")}toggleAutoScroll(){this.autoScroll=!this.autoScroll,console.log("Auto-scroll:",this.autoScroll)}onMessageClick(i){console.log("Message clicked:",i),this.socketService.sendUserAction("message_clicked",{messageId:i.id,channel:i.channel,type:i.type})}getChannelClass(i){return`message-${i}`}getTimeString(i){return i.toLocaleTimeString()}trackMessage(i,r){return r.id}isFilterActive(i){return this.activeFilters[i]}getFilteredCount(){return this.filteredMessages.length}ngOnDestroy(){console.log("MessagePanelComponent destroying..."),this.destroy$.next(),this.destroy$.complete()}static#e=n=()=>(this.\u0275fac=function(r){return new(r||e)(pt(sL))},this.\u0275cmp=Lh({type:e,selectors:[["app-message-panel"]],viewQuery:function(r,s){if(1&r&&Tb(cY,5),2&r){let o;fg(o=pg())&&(s.messageContainer=o.first)}},decls:30,vars:18,consts:[["messageContainer",""],[1,"message-panel","ui-panel"],[1,"panel-header"],[1,"message-count"],[1,"filter-controls"],[1,"filter-buttons"],[1,"filter-btn",3,"click"],[1,"control-buttons"],[1,"btn","btn-small",3,"click"],[1,"btn","btn-small","btn-danger",3,"click"],[1,"scroll-controls"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"message-list"],["class","message-item",3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],[1,"message-item",3,"click"],[1,"message-header"],[1,"message-time"],[1,"message-channel"],[1,"message-type"],[1,"message-content"],["class","message-meta",4,"ngIf"],[1,"message-meta"],["class","message-source",4,"ngIf"],["class","message-target",4,"ngIf"],[1,"message-source"],[1,"message-target"],[1,"empty-state"]],template:function(r,s){if(1&r){const o=wu();ht(0,"div",1)(1,"div",2)(2,"h3"),Wt(3,"Message Stream"),mt(),ht(4,"div",3),Wt(5),mt()(),ht(6,"div",4)(7,"div",5)(8,"button",6),gi("click",function(){return Bi(o),Vi(s.toggleFilter("sys"))}),Wt(9),mt(),ht(10,"button",6),gi("click",function(){return Bi(o),Vi(s.toggleFilter("app"))}),Wt(11),mt(),ht(12,"button",6),gi("click",function(){return Bi(o),Vi(s.toggleFilter("ui"))}),Wt(13),mt()(),ht(14,"div",7)(15,"button",8),gi("click",function(){return Bi(o),Vi(s.showAllFilters())}),Wt(16,"All"),mt(),ht(17,"button",8),gi("click",function(){return Bi(o),Vi(s.clearAllFilters())}),Wt(18,"None"),mt(),ht(19,"button",9),gi("click",function(){return Bi(o),Vi(s.clearMessages())}),Wt(20,"Clear"),mt()()(),ht(21,"div",10)(22,"label",11)(23,"input",12),gi("change",function(){return Bi(o),Vi(s.toggleAutoScroll())}),mt(),Wt(24," Auto-scroll to bottom "),mt()(),ht(25,"div",13,0),Qs(27,hY,11,7,"div",14)(28,fY,5,0,"div",15)(29,pY,5,0,"div",15),mt()()}2&r&&(Kt(5),yg(" ",s.getFilteredCount()," / ",s.messageStats.total," "),Kt(3),zc("active",s.isFilterActive("sys")),Kt(),Xr(" SYS (",s.messageStats.sys,") "),Kt(),zc("active",s.isFilterActive("app")),Kt(),Xr(" APP (",s.messageStats.app,") "),Kt(),zc("active",s.isFilterActive("ui")),Kt(),Xr(" UI (",s.messageStats.ui,") "),Kt(10),Yi("checked",s.autoScroll),Kt(2),zc("auto-scroll",s.autoScroll),Kt(2),Yi("ngForOf",s.filteredMessages)("ngForTrackBy",s.trackMessage),Kt(),Yi("ngIf",0===s.filteredMessages.length&&0===s.messageStats.total),Kt(),Yi("ngIf",0===s.filteredMessages.length&&s.messageStats.total>0))},dependencies:[Wg,fS,$g],styles:[".message-panel[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;max-height:100%}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.1)}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1em;font-weight:600}.message-count[_ngcontent-%COMP%]{font-size:.8em;color:#bbb;font-family:Courier New,monospace}.filter-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:8px;background:#ffffff0d;border-radius:4px;flex-wrap:wrap;gap:8px}.filter-buttons[_ngcontent-%COMP%]{display:flex;gap:4px}.filter-btn[_ngcontent-%COMP%]{padding:4px 8px;font-size:.8em;border:1px solid rgba(255,255,255,.2);background:#ffffff0d;color:#ccc;border-radius:3px;cursor:pointer;transition:all .3s ease}.filter-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-color:#ffffff4d}.filter-btn.active[_ngcontent-%COMP%]{background:#3498db4d;border-color:#3498db;color:#fff}.control-buttons[_ngcontent-%COMP%]{display:flex;gap:4px}.scroll-controls[_ngcontent-%COMP%]{margin-bottom:12px;padding:4px 0}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:.8em;cursor:pointer;-webkit-user-select:none;user-select:none}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin:0}.message-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;max-height:350px;border:1px solid rgba(255,255,255,.1);border-radius:4px;background:#0003}.message-list.auto-scroll[_ngcontent-%COMP%]{scroll-behavior:smooth}.message-item[_ngcontent-%COMP%]{padding:8px 12px;margin:2px 0;border-radius:4px;font-size:.85em;border-left:3px solid;cursor:pointer;transition:all .2s ease;animation:_ngcontent-%COMP%_slideIn .3s ease-out}.message-item[_ngcontent-%COMP%]:hover{background:#ffffff1a;transform:translate(2px)}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(-10px);opacity:0}to{transform:translate(0);opacity:1}}.message-sys[_ngcontent-%COMP%]{border-left-color:#e74c3c;background:#e74c3c1a}.message-app[_ngcontent-%COMP%]{border-left-color:#3498db;background:#3498db1a}.message-ui[_ngcontent-%COMP%]{border-left-color:#2ecc71;background:#2ecc711a}.message-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px;font-size:.7em;color:#bbb}.message-time[_ngcontent-%COMP%]{font-family:Courier New,monospace;color:#888}.message-channel[_ngcontent-%COMP%]{background:#ffffff1a;padding:1px 4px;border-radius:2px;font-weight:500}.message-type[_ngcontent-%COMP%]{color:#999;font-style:italic}.message-content[_ngcontent-%COMP%]{line-height:1.4;margin-bottom:4px;word-wrap:break-word}.message-meta[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:.7em;color:#777;margin-top:4px}.message-source[_ngcontent-%COMP%], .message-target[_ngcontent-%COMP%]{font-family:Courier New,monospace}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.empty-state[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-top:8px;font-size:.8em}@media (max-width: 768px){.filter-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-buttons[_ngcontent-%COMP%], .control-buttons[_ngcontent-%COMP%]{justify-content:center}.message-header[_ngcontent-%COMP%]{flex-wrap:wrap}.message-list[_ngcontent-%COMP%]{max-height:250px}}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff0d}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#fff3;border-radius:3px}.message-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#ffffff4d}"]}))}return n(),e})();const Ra=0,Pr=1,Lo=2,Gc=100,EY=101,bY=102,wY=200,xY=201,TY=202,CY=203,LS=204,FS=205,DY=206,AY=207,IY=208,RY=209,PY=210,NY=211,OY=212,LY=213,FY=214,kS=0,US=1,BS=2,Lu=3,VS=4,zS=5,HS=6,GS=7,Qg=1e3,Is=1001,e_=1002,Zi=1003,mL=1004,cf=1005,ki=1006,t_=1007,Fo=1008,ko=1009,lf=1012,La=1014,Kr=1015,uf=1016,Fu=1020,Nr=1023,ku=1026,Uu=1027,i_=33776,r_=33777,s_=33778,o_=33779,a_=36492,Jr="srgb",zu="srgb-linear",u_="linear",An="srgb",Hu=7680,JY=512,QY=513,eZ=514,CL=515,tZ=516,nZ=517,iZ=518,rZ=519,Uo=2e3;class Bo{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Ki=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Wc=Math.PI/180,Gu=180/Math.PI;function Qr(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Ki[255&n]+Ki[n>>8&255]+Ki[n>>16&255]+Ki[n>>24&255]+"-"+Ki[255&e]+Ki[e>>8&255]+"-"+Ki[e>>16&15|64]+Ki[e>>24&255]+"-"+Ki[63&t|128]+Ki[t>>8&255]+"-"+Ki[t>>16&255]+Ki[t>>24&255]+Ki[255&i]+Ki[i>>8&255]+Ki[i>>16&255]+Ki[i>>24&255]).toLowerCase()}function ui(n,e,t){return Math.max(e,Math.min(t,n))}function df(n,e,t){return(1-t)*n+t*e}function pr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Vt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}const bZ_DEG2RAD=Wc;class ie{constructor(e=0,t=0){ie.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ui(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class zt{constructor(e,t,i,r,s,o,a,c,l){zt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,c,l)}set(e,t,i,r,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=i,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],c=i[6],l=i[1],u=i[4],d=i[7],h=i[2],f=i[5],p=i[8],_=r[0],g=r[3],m=r[6],y=r[1],E=r[4],v=r[7],C=r[2],x=r[5],T=r[8];return s[0]=o*_+a*y+c*C,s[3]=o*g+a*E+c*x,s[6]=o*m+a*v+c*T,s[1]=l*_+u*y+d*C,s[4]=l*g+u*E+d*x,s[7]=l*m+u*v+d*T,s[2]=h*_+f*y+p*C,s[5]=h*g+f*E+p*x,s[8]=h*m+f*v+p*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-i*s*u+i*a*c+r*s*l-r*o*c}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,h=a*c-u*s,f=l*s-o*c,p=t*d+i*h+r*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const _=1/p;return e[0]=d*_,e[1]=(r*l-u*i)*_,e[2]=(a*i-r*o)*_,e[3]=h*_,e[4]=(u*t-r*c)*_,e[5]=(r*s-a*t)*_,e[6]=f*_,e[7]=(i*c-l*t)*_,e[8]=(o*t-i*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(i*c,i*l,-i*(c*o+l*a)+o+e,-r*l,r*c,-r*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(CM.makeScale(e,t)),this}rotate(e){return this.premultiply(CM.makeRotation(-e)),this}translate(e,t){return this.premultiply(CM.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const CM=new zt;function IL(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function hf(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function MZ(){const n=hf("canvas");return n.style.display="block",n}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const RL={};function ff(n){n in RL||(RL[n]=!0,console.warn(n))}const ln={enabled:!0,workingColorSpace:zu,spaces:{},convert:function(n,e,t){return!1===this.enabled||e===t||!e||!t||(this.spaces[e].transfer===An&&(n.r=Vo(n.r),n.g=Vo(n.g),n.b=Vo(n.b)),this.spaces[e].primaries!==this.spaces[t].primaries&&(n.applyMatrix3(this.spaces[e].toXYZ),n.applyMatrix3(this.spaces[t].fromXYZ)),this.spaces[t].transfer===An&&(n.r=$u(n.r),n.g=$u(n.g),n.b=$u(n.b))),n},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return""===n?u_:this.spaces[n].transfer},getLuminanceCoefficients:function(n,e=this.workingColorSpace){return n.fromArray(this.spaces[e].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,e,t){return n.copy(this.spaces[e].toXYZ).multiply(this.spaces[t].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}};function Vo(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function $u(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const PL=[.64,.33,.3,.6,.15,.06],NL=[.2126,.7152,.0722],OL=[.3127,.329],LL=(new zt).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),FL=(new zt).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);let Wu;ln.define({[zu]:{primaries:PL,whitePoint:OL,transfer:u_,toXYZ:LL,fromXYZ:FL,luminanceCoefficients:NL,workingColorSpaceConfig:{unpackColorSpace:Jr},outputColorSpaceConfig:{drawingBufferColorSpace:Jr}},[Jr]:{primaries:PL,whitePoint:OL,transfer:An,toXYZ:LL,fromXYZ:FL,luminanceCoefficients:NL,outputColorSpaceConfig:{drawingBufferColorSpace:Jr}}});class CZ{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Wu&&(Wu=hf("canvas")),Wu.width=e.width,Wu.height=e.height;const i=Wu.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Wu}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=hf("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=255*Vo(s[o]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Vo(t[i]/255)):Vo(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let DZ=0;class qu{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:DZ++}),this.uuid=Qr(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)s.push(DM(r[o].isDataTexture?r[o].image:r[o]))}else s=DM(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function DM(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?CZ.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let AZ=0,Or=(()=>{class n extends Bo{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=Is,s=Is,o=ki,a=Fo,c=Nr,l=ko,u=n.DEFAULT_ANISOTROPY,d=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:AZ++}),this.uuid=Qr(),this.name="",this.source=new qu(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=c,this.internalFormat=null,this.type=l,this.offset=new ie(0,0),this.repeat=new ie(1,1),this.center=new ie(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case Is:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case Is:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class gn{constructor(e=0,t=0,i=0,r=1){gn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const c=e.elements,l=c[0],u=c[4],d=c[8],h=c[1],f=c[5],p=c[9],_=c[2],g=c[6],m=c[10];if(Math.abs(u-h)<.01&&Math.abs(d-_)<.01&&Math.abs(p-g)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+_)<.1&&Math.abs(p+g)<.1&&Math.abs(l+f+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const E=(l+1)/2,v=(f+1)/2,C=(m+1)/2,x=(u+h)/4,T=(d+_)/4,I=(p+g)/4;return E>v&&E>C?E<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(E),r=x/i,s=T/i):v>C?v<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(v),i=x/r,s=I/r):C<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(C),i=T/s,r=I/s),this.set(i,r,s,t),this}let y=Math.sqrt((g-p)*(g-p)+(d-_)*(d-_)+(h-u)*(h-u));return Math.abs(y)<.001&&(y=1),this.x=(g-p)/y,this.y=(d-_)/y,this.z=(h-u)/y,this.w=Math.acos((l+f+m-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class IZ extends Bo{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new gn(0,0,e,t),this.scissorTest=!1,this.viewport=new gn(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ki,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Or(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new qu(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class eo extends IZ{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class AM extends Or{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zi,this.minFilter=Zi,this.wrapR=Is,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class kL extends Or{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zi,this.minFilter=Zi,this.wrapR=Is,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class mr{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let c=i[r+0],l=i[r+1],u=i[r+2],d=i[r+3];const h=s[o+0],f=s[o+1],p=s[o+2],_=s[o+3];if(0===a)return e[t+0]=c,e[t+1]=l,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=p,void(e[t+3]=_);if(d!==_||c!==h||l!==f||u!==p){let g=1-a;const m=c*h+l*f+u*p+d*_,y=m>=0?1:-1,E=1-m*m;if(E>Number.EPSILON){const C=Math.sqrt(E),x=Math.atan2(C,m*y);g=Math.sin(g*x)/C,a=Math.sin(a*x)/C}const v=a*y;if(c=c*g+h*v,l=l*g+f*v,u=u*g+p*v,d=d*g+_*v,g===1-a){const C=1/Math.sqrt(c*c+l*l+u*u+d*d);c*=C,l*=C,u*=C,d*=C}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],c=i[r+1],l=i[r+2],u=i[r+3],d=s[o],h=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*d+c*f-l*h,e[t+1]=c*p+u*h+l*d-a*f,e[t+2]=l*p+u*f+a*h-c*d,e[t+3]=u*p-a*d-c*h-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(i/2),u=a(r/2),d=a(s/2),h=c(i/2),f=c(r/2),p=c(s/2);switch(o){case"XYZ":this._x=h*u*d+l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d+h*f*p;break;case"YZX":this._x=h*u*d+l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d-h*f*p;break;case"XZY":this._x=h*u*d-l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],d=t[10],h=i+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-c)*f,this._y=(s-l)*f,this._z=(o-r)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(u-c)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+l)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(s-l)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(c+u)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-r)/f,this._x=(s+l)/f,this._y=(c+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ui(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=i*u+o*a+r*l-s*c,this._y=r*u+o*c+s*a-i*l,this._z=s*u+o*l+i*c-r*a,this._w=o*u-i*a-r*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),d=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=o*d+this._w*h,this._x=i*d+this._x*h,this._y=r*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class A{constructor(e=0,t=0,i=0){A.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(UL.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(UL.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*r-a*i),u=2*(a*t-s*r),d=2*(s*i-o*t);return this.x=t+c*l+o*d-a*u,this.y=i+c*u+a*l-s*d,this.z=r+c*d+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=r*c-s*a,this.y=s*o-i*c,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return IM.copy(this).projectOnVector(e),this.sub(IM)}reflect(e){return this.sub(IM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ui(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const IM=new A,UL=new mr;class Lr{constructor(e=new A(1/0,1/0,1/0),t=new A(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Rs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Rs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Rs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i){const s=i.getAttribute("position");if(!0===t&&void 0!==s&&!0!==e.isInstancedMesh)for(let o=0,a=s.count;o<a;o++)!0===e.isMesh?e.getVertexPosition(o,Rs):Rs.fromBufferAttribute(s,o),Rs.applyMatrix4(e.matrixWorld),this.expandByPoint(Rs);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),f_.copy(e.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),f_.copy(i.boundingBox)),f_.applyMatrix4(e.matrixWorld),this.union(f_)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Rs),Rs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(pf),p_.subVectors(this.max,pf),Xu.subVectors(e.a,pf),Yu.subVectors(e.b,pf),Zu.subVectors(e.c,pf),ka.subVectors(Yu,Xu),Ua.subVectors(Zu,Yu),qc.subVectors(Xu,Zu);let t=[0,-ka.z,ka.y,0,-Ua.z,Ua.y,0,-qc.z,qc.y,ka.z,0,-ka.x,Ua.z,0,-Ua.x,qc.z,0,-qc.x,-ka.y,ka.x,0,-Ua.y,Ua.x,0,-qc.y,qc.x,0];return!(!RM(t,Xu,Yu,Zu,p_)||(t=[1,0,0,0,1,0,0,0,1],!RM(t,Xu,Yu,Zu,p_)))&&(m_.crossVectors(ka,Ua),t=[m_.x,m_.y,m_.z],RM(t,Xu,Yu,Zu,p_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Rs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Rs).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(zo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),zo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),zo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),zo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),zo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),zo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),zo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),zo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(zo)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const zo=[new A,new A,new A,new A,new A,new A,new A,new A],Rs=new A,f_=new Lr,Xu=new A,Yu=new A,Zu=new A,ka=new A,Ua=new A,qc=new A,pf=new A,p_=new A,m_=new A,Xc=new A;function RM(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){Xc.fromArray(n,s);const a=r.x*Math.abs(Xc.x)+r.y*Math.abs(Xc.y)+r.z*Math.abs(Xc.z),c=e.dot(Xc),l=t.dot(Xc),u=i.dot(Xc);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const RZ=new Lr,mf=new A,PM=new A;class gr{constructor(e=new A,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):RZ.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;mf.subVectors(e,this.center);const t=mf.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(mf,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(PM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(mf.copy(e.center).add(PM)),this.expandByPoint(mf.copy(e.center).sub(PM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ho=new A,NM=new A,g_=new A,Ba=new A,OM=new A,__=new A,LM=new A;class Ku{constructor(e=new A,t=new A(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ho)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ho.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ho.copy(this.origin).addScaledVector(this.direction,t),Ho.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){NM.copy(e).add(t).multiplyScalar(.5),g_.copy(t).sub(e).normalize(),Ba.copy(this.origin).sub(NM);const s=.5*e.distanceTo(t),o=-this.direction.dot(g_),a=Ba.dot(this.direction),c=-Ba.dot(g_),l=Ba.lengthSq(),u=Math.abs(1-o*o);let d,h,f,p;if(u>0)if(d=o*c-a,h=o*a-c,p=s*u,d>=0)if(h>=-p)if(h<=p){const _=1/u;d*=_,h*=_,f=d*(d+o*h+2*a)+h*(o*d+h+2*c)+l}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h<=-p?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l):h<=p?(d=0,h=Math.min(Math.max(-s,-c),s),f=h*(h+2*c)+l):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(NM).addScaledVector(g_,h),f}intersectSphere(e,t){Ho.subVectors(e.center,this.origin);const i=Ho.dot(this.direction),r=Ho.dot(Ho)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,c=i+o;return c<0?null:this.at(a<0?c:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-h.z)*d,c=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,c=(e.min.z-h.z)*d),i>c||a>r)||((a>i||i!=i)&&(i=a),(c<r||r!=r)&&(r=c),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,Ho)}intersectTriangle(e,t,i,r,s){OM.subVectors(t,e),__.subVectors(i,e),LM.crossVectors(OM,__);let a,o=this.direction.dot(LM);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Ba.subVectors(this.origin,e);const c=a*this.direction.dot(__.crossVectors(Ba,__));if(c<0)return null;const l=a*this.direction.dot(OM.cross(Ba));if(l<0||c+l>o)return null;const u=-a*Ba.dot(LM);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ct{constructor(e,t,i,r,s,o,a,c,l,u,d,h,f,p,_,g){Ct.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,c,l,u,d,h,f,p,_,g)}set(e,t,i,r,s,o,a,c,l,u,d,h,f,p,_,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=s,m[5]=o,m[9]=a,m[13]=c,m[2]=l,m[6]=u,m[10]=d,m[14]=h,m[3]=f,m[7]=p,m[11]=_,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ct).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Ju.setFromMatrixColumn(e,0).length(),s=1/Ju.setFromMatrixColumn(e,1).length(),o=1/Ju.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),c=Math.cos(r),l=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const h=o*u,f=o*d,p=a*u,_=a*d;t[0]=c*u,t[4]=-c*d,t[8]=l,t[1]=f+p*l,t[5]=h-_*l,t[9]=-a*c,t[2]=_-h*l,t[6]=p+f*l,t[10]=o*c}else if("YXZ"===e.order){const h=c*u,f=c*d,p=l*u,_=l*d;t[0]=h+_*a,t[4]=p*a-f,t[8]=o*l,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=_+h*a,t[10]=o*c}else if("ZXY"===e.order){const h=c*u,f=c*d,p=l*u,_=l*d;t[0]=h-_*a,t[4]=-o*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=_-h*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if("ZYX"===e.order){const h=o*u,f=o*d,p=a*u,_=a*d;t[0]=c*u,t[4]=p*l-f,t[8]=h*l+_,t[1]=c*d,t[5]=_*l+h,t[9]=f*l-p,t[2]=-l,t[6]=a*c,t[10]=o*c}else if("YZX"===e.order){const h=o*c,f=o*l,p=a*c,_=a*l;t[0]=c*u,t[4]=_-h*d,t[8]=p*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=f*d+p,t[10]=h-_*d}else if("XZY"===e.order){const h=o*c,f=o*l,p=a*c,_=a*l;t[0]=c*u,t[4]=-d,t[8]=l*u,t[1]=h*d+_,t[5]=o*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=_*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(PZ,e,NZ)}lookAt(e,t,i){const r=this.elements;return es.subVectors(e,t),0===es.lengthSq()&&(es.z=1),es.normalize(),Va.crossVectors(i,es),0===Va.lengthSq()&&(1===Math.abs(i.z)?es.x+=1e-4:es.z+=1e-4,es.normalize(),Va.crossVectors(i,es)),Va.normalize(),y_.crossVectors(es,Va),r[0]=Va.x,r[4]=y_.x,r[8]=es.x,r[1]=Va.y,r[5]=y_.y,r[9]=es.y,r[2]=Va.z,r[6]=y_.z,r[10]=es.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],c=i[8],l=i[12],u=i[1],d=i[5],h=i[9],f=i[13],p=i[2],_=i[6],g=i[10],m=i[14],y=i[3],E=i[7],v=i[11],C=i[15],x=r[0],T=r[4],I=r[8],M=r[12],b=r[1],P=r[5],W=r[9],$=r[13],J=r[2],ce=r[6],L=r[10],Y=r[14],B=r[3],ae=r[7],ve=r[11],De=r[15];return s[0]=o*x+a*b+c*J+l*B,s[4]=o*T+a*P+c*ce+l*ae,s[8]=o*I+a*W+c*L+l*ve,s[12]=o*M+a*$+c*Y+l*De,s[1]=u*x+d*b+h*J+f*B,s[5]=u*T+d*P+h*ce+f*ae,s[9]=u*I+d*W+h*L+f*ve,s[13]=u*M+d*$+h*Y+f*De,s[2]=p*x+_*b+g*J+m*B,s[6]=p*T+_*P+g*ce+m*ae,s[10]=p*I+_*W+g*L+m*ve,s[14]=p*M+_*$+g*Y+m*De,s[3]=y*x+E*b+v*J+C*B,s[7]=y*T+E*P+v*ce+C*ae,s[11]=y*I+E*W+v*L+C*ve,s[15]=y*M+E*$+v*Y+C*De,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],d=e[6],h=e[10],f=e[14];return e[3]*(+s*c*d-r*l*d-s*a*h+i*l*h+r*a*f-i*c*f)+e[7]*(+t*c*f-t*l*h+s*o*h-r*o*f+r*l*u-s*c*u)+e[11]*(+t*l*d-t*a*f-s*o*d+i*o*f+s*a*u-i*l*u)+e[15]*(-r*a*u-t*c*d+t*a*h+r*o*d-i*o*h+i*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],_=e[13],g=e[14],m=e[15],y=d*g*l-_*h*l+_*c*f-a*g*f-d*c*m+a*h*m,E=p*h*l-u*g*l-p*c*f+o*g*f+u*c*m-o*h*m,v=u*_*l-p*d*l+p*a*f-o*_*f-u*a*m+o*d*m,C=p*d*c-u*_*c-p*a*h+o*_*h+u*a*g-o*d*g,x=t*y+i*E+r*v+s*C;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/x;return e[0]=y*T,e[1]=(_*h*s-d*g*s-_*r*f+i*g*f+d*r*m-i*h*m)*T,e[2]=(a*g*s-_*c*s+_*r*l-i*g*l-a*r*m+i*c*m)*T,e[3]=(d*c*s-a*h*s-d*r*l+i*h*l+a*r*f-i*c*f)*T,e[4]=E*T,e[5]=(u*g*s-p*h*s+p*r*f-t*g*f-u*r*m+t*h*m)*T,e[6]=(p*c*s-o*g*s-p*r*l+t*g*l+o*r*m-t*c*m)*T,e[7]=(o*h*s-u*c*s+u*r*l-t*h*l-o*r*f+t*c*f)*T,e[8]=v*T,e[9]=(p*d*s-u*_*s-p*i*f+t*_*f+u*i*m-t*d*m)*T,e[10]=(o*_*s-p*a*s+p*i*l-t*_*l-o*i*m+t*a*m)*T,e[11]=(u*a*s-o*d*s-u*i*l+t*d*l+o*i*f-t*a*f)*T,e[12]=C*T,e[13]=(u*_*r-p*d*r+p*i*h-t*_*h-u*i*g+t*d*g)*T,e[14]=(p*a*r-o*_*r-p*i*c+t*_*c+o*i*g-t*a*g)*T,e[15]=(o*d*r-u*a*r+u*i*c-t*d*c-o*i*h+t*a*h)*T,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+i,l*a-r*c,l*c+r*a,0,l*a+r*c,u*a+i,u*c-r*o,0,l*c-r*a,u*c+r*o,s*c*c+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,d=a+a,h=s*l,f=s*u,p=s*d,_=o*u,g=o*d,m=a*d,y=c*l,E=c*u,v=c*d,C=i.x,x=i.y,T=i.z;return r[0]=(1-(_+m))*C,r[1]=(f+v)*C,r[2]=(p-E)*C,r[3]=0,r[4]=(f-v)*x,r[5]=(1-(h+m))*x,r[6]=(g+y)*x,r[7]=0,r[8]=(p+E)*T,r[9]=(g-y)*T,r[10]=(1-(h+_))*T,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Ju.set(r[0],r[1],r[2]).length();const o=Ju.set(r[4],r[5],r[6]).length(),a=Ju.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Ps.copy(this);const l=1/s,u=1/o,d=1/a;return Ps.elements[0]*=l,Ps.elements[1]*=l,Ps.elements[2]*=l,Ps.elements[4]*=u,Ps.elements[5]*=u,Ps.elements[6]*=u,Ps.elements[8]*=d,Ps.elements[9]*=d,Ps.elements[10]*=d,t.setFromRotationMatrix(Ps),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=Uo){const c=this.elements,l=2*s/(t-e),u=2*s/(i-r),d=(t+e)/(t-e),h=(i+r)/(i-r);let f,p;if(a===Uo)f=-(o+s)/(o-s),p=-2*o*s/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);f=-o/(o-s),p=-o*s/(o-s)}return c[0]=l,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=Uo){const c=this.elements,l=1/(t-e),u=1/(i-r),d=1/(o-s),h=(t+e)*l,f=(i+r)*u;let p,_;if(a===Uo)p=(o+s)*d,_=-2*d;else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=s*d,_=-1*d}return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=_,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Ju=new A,Ps=new Ct,PZ=new A(0,0,0),NZ=new A(1,1,1),Va=new A,y_=new A,es=new A,BL=new Ct,VL=new mr;let Go=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,o=s[0],a=s[4],c=s[8],l=s[1],u=s[5],d=s[9],h=s[2],f=s[6],p=s[10];switch(i){case"XYZ":this._y=Math.asin(ui(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ui(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(c,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(ui(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-ui(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(ui(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(c,p));break;case"XZY":this._z=Math.asin(-ui(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-d,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return BL.makeRotationFromQuaternion(t),this.setFromRotationMatrix(BL,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return VL.setFromEuler(this),this.setFromQuaternion(VL,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class FM{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let OZ=0;const zL=new A,Qu=new mr,jo=new Ct,v_=new A,gf=new A,LZ=new A,FZ=new mr,HL=new A(1,0,0),GL=new A(0,1,0),jL=new A(0,0,1),$L={type:"added"},kZ={type:"removed"},ed={type:"childadded",child:null},kM={type:"childremoved",child:null};let Xn=(()=>{class n extends Bo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:OZ++}),this.uuid=Qr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new A,i=new Go,r=new mr,s=new A(1,1,1);i._onChange(function o(){r.setFromEuler(i,!1)}),r._onChange(function a(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ct},normalMatrix:{value:new zt}}),this.matrix=new Ct,this.matrixWorld=new Ct,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new FM,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Qu.setFromAxisAngle(t,i),this.quaternion.multiply(Qu),this}rotateOnWorldAxis(t,i){return Qu.setFromAxisAngle(t,i),this.quaternion.premultiply(Qu),this}rotateX(t){return this.rotateOnAxis(HL,t)}rotateY(t){return this.rotateOnAxis(GL,t)}rotateZ(t){return this.rotateOnAxis(jL,t)}translateOnAxis(t,i){return zL.copy(t).applyQuaternion(this.quaternion),this.position.add(zL.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(HL,t)}translateY(t){return this.translateOnAxis(GL,t)}translateZ(t){return this.translateOnAxis(jL,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(jo.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?v_.copy(t):v_.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),gf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?jo.lookAt(gf,v_,this.up):jo.lookAt(v_,gf,this.up),this.quaternion.setFromRotationMatrix(jo),s&&(jo.extractRotation(s.matrixWorld),Qu.setFromRotationMatrix(jo),this.quaternion.premultiply(Qu.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent($L),ed.child=t,this.dispatchEvent(ed),ed.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(kZ),kM.child=t,this.dispatchEvent(kM),kM.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),jo.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),jo.multiply(t.parent.matrixWorld)),t.applyMatrix4(jo),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent($L),ed.child=t,this.dispatchEvent(ed),ed.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(t,i);if(void 0!==a)return a}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gf,t,LZ),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gf,FZ,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateMatrixWorld(t)}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===i){const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function o(c,l){return void 0===c[l.uuid]&&(c[l.uuid]=l.toJSON(t)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(c=>({boxInitialized:c.boxInitialized,boxMin:c.box.min.toArray(),boxMax:c.box.max.toArray(),sphereInitialized:c.sphereInitialized,sphereRadius:c.sphere.radius,sphereCenter:c.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(s.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),null!==this.boundingBox&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){const l=c.shapes;if(Array.isArray(l))for(let u=0,d=l.length;u<d;u++)o(t.shapes,l[u]);else o(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const c=[];for(let l=0,u=this.material.length;l<u;l++)c.push(o(t.materials,this.material[l]));s.material=c}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++)s.animations.push(o(t.animations,this.animations[c]))}if(i){const c=a(t.geometries),l=a(t.materials),u=a(t.textures),d=a(t.images),h=a(t.shapes),f=a(t.skeletons),p=a(t.animations),_=a(t.nodes);c.length>0&&(r.geometries=c),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),d.length>0&&(r.images=d),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),p.length>0&&(r.animations=p),_.length>0&&(r.nodes=_)}return r.object=s,r;function a(c){const l=[];for(const u in c){const d=c[u];delete d.metadata,l.push(d)}return l}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new A(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const Ns=new A,$o=new A,UM=new A,Wo=new A,td=new A,nd=new A,WL=new A,BM=new A,VM=new A,zM=new A,HM=new gn,GM=new gn,jM=new gn;class ts{constructor(e=new A,t=new A,i=new A){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Ns.subVectors(e,t),r.cross(Ns);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Ns.subVectors(r,t),$o.subVectors(i,t),UM.subVectors(e,t);const o=Ns.dot(Ns),a=Ns.dot($o),c=Ns.dot(UM),l=$o.dot($o),u=$o.dot(UM),d=o*l-a*a;if(0===d)return s.set(0,0,0),null;const h=1/d,f=(l*c-a*u)*h,p=(o*u-a*c)*h;return s.set(1-f-p,p,f)}static containsPoint(e,t,i,r){return null!==this.getBarycoord(e,t,i,r,Wo)&&Wo.x>=0&&Wo.y>=0&&Wo.x+Wo.y<=1}static getInterpolation(e,t,i,r,s,o,a,c){return null===this.getBarycoord(e,t,i,r,Wo)?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Wo.x),c.addScaledVector(o,Wo.y),c.addScaledVector(a,Wo.z),c)}static getInterpolatedAttribute(e,t,i,r,s,o){return HM.setScalar(0),GM.setScalar(0),jM.setScalar(0),HM.fromBufferAttribute(e,t),GM.fromBufferAttribute(e,i),jM.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(HM,s.x),o.addScaledVector(GM,s.y),o.addScaledVector(jM,s.z),o}static isFrontFacing(e,t,i,r){return Ns.subVectors(i,t),$o.subVectors(e,t),Ns.cross($o).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ns.subVectors(this.c,this.b),$o.subVectors(this.a,this.b),.5*Ns.cross($o).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ts.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ts.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return ts.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return ts.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ts.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;td.subVectors(r,i),nd.subVectors(s,i),BM.subVectors(e,i);const c=td.dot(BM),l=nd.dot(BM);if(c<=0&&l<=0)return t.copy(i);VM.subVectors(e,r);const u=td.dot(VM),d=nd.dot(VM);if(u>=0&&d<=u)return t.copy(r);const h=c*d-u*l;if(h<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(i).addScaledVector(td,o);zM.subVectors(e,s);const f=td.dot(zM),p=nd.dot(zM);if(p>=0&&f<=p)return t.copy(s);const _=f*l-c*p;if(_<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(nd,a);const g=u*p-f*d;if(g<=0&&d-u>=0&&f-p>=0)return WL.subVectors(s,r),a=(d-u)/(d-u+(f-p)),t.copy(r).addScaledVector(WL,a);const m=1/(g+_+h);return o=_*m,a=h*m,t.copy(i).addScaledVector(td,o).addScaledVector(nd,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const qL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},za={h:0,s:0,l:0},E_={h:0,s:0,l:0};function $M(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class Le{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(void 0===t&&void 0===i){const r=e;r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Jr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ln.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=ln.workingColorSpace){return this.r=e,this.g=t,this.b=i,ln.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=ln.workingColorSpace){if(e=function TM(n,e){return(n%e+e)%e}(e,1),t=ui(t,0,1),i=ui(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=$M(o,s,e+1/3),this.g=$M(o,s,e),this.b=$M(o,s,e-1/3)}return ln.toWorkingColorSpace(this,r),this}setStyle(e,t=Jr){function i(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[2];switch(r[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Jr){const i=qL[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Vo(e.r),this.g=Vo(e.g),this.b=Vo(e.b),this}copyLinearToSRGB(e){return this.r=$u(e.r),this.g=$u(e.g),this.b=$u(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Jr){return ln.fromWorkingColorSpace(Ji.copy(this),e),65536*Math.round(ui(255*Ji.r,0,255))+256*Math.round(ui(255*Ji.g,0,255))+Math.round(ui(255*Ji.b,0,255))}getHexString(e=Jr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ln.workingColorSpace){ln.fromWorkingColorSpace(Ji.copy(this),t);const i=Ji.r,r=Ji.g,s=Ji.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=u<=.5?d/(o+a):d/(2-o-a),o){case i:c=(r-s)/d+(r<s?6:0);break;case r:c=(s-i)/d+2;break;case s:c=(i-r)/d+4}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=ln.workingColorSpace){return ln.fromWorkingColorSpace(Ji.copy(this),t),e.r=Ji.r,e.g=Ji.g,e.b=Ji.b,e}getStyle(e=Jr){ln.fromWorkingColorSpace(Ji.copy(this),e);const t=Ji.r,i=Ji.g,r=Ji.b;return e!==Jr?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(e,t,i){return this.getHSL(za),this.setHSL(za.h+e,za.s+t,za.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(za),e.getHSL(E_);const i=df(za.h,E_.h,t),r=df(za.s,E_.s,t),s=df(za.l,E_.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ji=new Le;Le.NAMES=qL;let UZ=0;class _r extends Bo{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:UZ++}),this.uuid=Qr(),this.name="",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Le(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Hu,this.stencilZFail=Hu,this.stencilZPass=Hu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(i.dispersion=this.dispersion),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapRotation&&(i.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),204!==this.blendSrc&&(i.blendSrc=this.blendSrc),205!==this.blendDst&&(i.blendDst=this.blendDst),100!==this.blendEquation&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Hu&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Hu&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Hu&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class qo extends _r{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new Le(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Go,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const xi=new A,b_=new ie;class kn{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRanges=[],this.gpuType=Kr,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)b_.fromBufferAttribute(this,t),b_.applyMatrix3(e),this.setXY(t,b_.x,b_.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)xi.fromBufferAttribute(this,t),xi.applyMatrix3(e),this.setXYZ(t,xi.x,xi.y,xi.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)xi.fromBufferAttribute(this,t),xi.applyMatrix4(e),this.setXYZ(t,xi.x,xi.y,xi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)xi.fromBufferAttribute(this,t),xi.applyNormalMatrix(e),this.setXYZ(t,xi.x,xi.y,xi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)xi.fromBufferAttribute(this,t),xi.transformDirection(e),this.setXYZ(t,xi.x,xi.y,xi.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=pr(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Vt(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=pr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=pr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=pr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=pr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),r=Vt(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),r=Vt(r,this.array),s=Vt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class XL extends kn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class YL extends kn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Xe extends kn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let VZ=0;const ys=new Ct,WM=new Xn,id=new A,ns=new Lr,yf=new Lr,Ui=new A;class Jt extends Bo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:VZ++}),this.uuid=Qr(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(IL(e)?YL:XL)(e,1):e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new zt).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ys.makeRotationFromQuaternion(e),this.applyMatrix4(ys),this}rotateX(e){return ys.makeRotationX(e),this.applyMatrix4(ys),this}rotateY(e){return ys.makeRotationY(e),this.applyMatrix4(ys),this}rotateZ(e){return ys.makeRotationZ(e),this.applyMatrix4(ys),this}translate(e,t,i){return ys.makeTranslation(e,t,i),this.applyMatrix4(ys),this}scale(e,t,i){return ys.makeScale(e,t,i),this.applyMatrix4(ys),this}lookAt(e){return WM.lookAt(e),WM.updateMatrix(),this.applyMatrix4(WM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(id).negate(),this.translate(id.x,id.y,id.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Xe(i,3))}else{for(let i=0,r=t.count;i<r;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Lr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new A(-1/0,-1/0,-1/0),new A(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)ns.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(Ui.addVectors(this.boundingBox.min,ns.min),this.boundingBox.expandByPoint(Ui),Ui.addVectors(this.boundingBox.max,ns.max),this.boundingBox.expandByPoint(Ui)):(this.boundingBox.expandByPoint(ns.min),this.boundingBox.expandByPoint(ns.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new gr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new A,1/0);if(e){const i=this.boundingSphere.center;if(ns.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)yf.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(Ui.addVectors(ns.min,yf.min),ns.expandByPoint(Ui),Ui.addVectors(ns.max,yf.max),ns.expandByPoint(Ui)):(ns.expandByPoint(yf.min),ns.expandByPoint(yf.max));ns.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Ui.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Ui));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ui.fromBufferAttribute(a,l),c&&(id.fromBufferAttribute(e,l),Ui.add(id)),r=Math.max(r,i.distanceToSquared(Ui))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.position,r=t.normal,s=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new kn(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let I=0;I<i.count;I++)a[I]=new A,c[I]=new A;const l=new A,u=new A,d=new A,h=new ie,f=new ie,p=new ie,_=new A,g=new A;function m(I,M,b){l.fromBufferAttribute(i,I),u.fromBufferAttribute(i,M),d.fromBufferAttribute(i,b),h.fromBufferAttribute(s,I),f.fromBufferAttribute(s,M),p.fromBufferAttribute(s,b),u.sub(l),d.sub(l),f.sub(h),p.sub(h);const P=1/(f.x*p.y-p.x*f.y);isFinite(P)&&(_.copy(u).multiplyScalar(p.y).addScaledVector(d,-f.y).multiplyScalar(P),g.copy(d).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar(P),a[I].add(_),a[M].add(_),a[b].add(_),c[I].add(g),c[M].add(g),c[b].add(g))}let y=this.groups;0===y.length&&(y=[{start:0,count:e.count}]);for(let I=0,M=y.length;I<M;++I){const b=y[I],P=b.start;for(let $=P,J=P+b.count;$<J;$+=3)m(e.getX($+0),e.getX($+1),e.getX($+2))}const E=new A,v=new A,C=new A,x=new A;function T(I){C.fromBufferAttribute(r,I),x.copy(C);const M=a[I];E.copy(M),E.sub(C.multiplyScalar(C.dot(M))).normalize(),v.crossVectors(x,M);const P=v.dot(c[I])<0?-1:1;o.setXYZW(I,E.x,E.y,E.z,P)}for(let I=0,M=y.length;I<M;++I){const b=y[I],P=b.start;for(let $=P,J=P+b.count;$<J;$+=3)T(e.getX($+0)),T(e.getX($+1)),T(e.getX($+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new kn(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let h=0,f=i.count;h<f;h++)i.setXYZ(h,0,0,0);const r=new A,s=new A,o=new A,a=new A,c=new A,l=new A,u=new A,d=new A;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),_=e.getX(h+1),g=e.getX(h+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,g),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,p),c.fromBufferAttribute(i,_),l.fromBufferAttribute(i,g),a.add(u),c.add(u),l.add(u),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(_,c.x,c.y,c.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let h=0,f=t.count;h<f;h+=3)r.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Ui.fromBufferAttribute(e,t),Ui.normalize(),e.setXYZ(t,Ui.x,Ui.y,Ui.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,d=a.normalized,h=new l.constructor(c.length*u);let f=0,p=0;for(let _=0,g=c.length;_<g;_++){f=a.isInterleavedBufferAttribute?c[_]*a.data.stride+a.offset:c[_]*u;for(let m=0;m<u;m++)h[p++]=l[f++]}return new kn(h,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Jt,i=this.index.array,r=this.attributes;for(const a in r){const l=e(r[a],i);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,d=l.length;u<d;u++){const f=e(l[u],i);c.push(f)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const c=this.parameters;for(const l in c)void 0!==c[l]&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const c in i)e.data.attributes[c]=i[c].toJSON(e.data);const r={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let d=0,h=l.length;d<h;d++)u.push(l[d].toJSON(e.data));u.length>0&&(r[c]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const l in r)this.setAttribute(l,r[l].clone(t));const s=e.morphAttributes;for(const l in s){const u=[],d=s[l];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const d=o[l];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const c=e.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ZL=new Ct,Yc=new Ku,S_=new gr,KL=new A,M_=new A,w_=new A,x_=new A,qM=new A,T_=new A,JL=new A,C_=new A;class ei extends Xn{constructor(e=new Jt,t=new qo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){T_.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c];0!==u&&(qM.fromBufferAttribute(s[c],e),T_.addScaledVector(o?qM:qM.sub(t),u))}t.add(T_)}return t}raycast(e,t){const i=this.geometry,s=this.matrixWorld;void 0!==this.material&&(null===i.boundingSphere&&i.computeBoundingSphere(),S_.copy(i.boundingSphere),S_.applyMatrix4(s),Yc.copy(e.ray).recast(e.near),(!1!==S_.containsPoint(Yc.origin)||!(null===Yc.intersectSphere(S_,KL)||Yc.origin.distanceToSquared(KL)>(e.far-e.near)**2))&&(ZL.copy(s).invert(),Yc.copy(e.ray).applyMatrix4(ZL),(null===i.boundingBox||!1!==Yc.intersectsBox(i.boundingBox))&&this._computeIntersections(e,t,Yc)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,f=s.drawRange;if(null!==a)if(Array.isArray(o))for(let p=0,_=h.length;p<_;p++){const g=h[p],m=o[g.materialIndex];for(let v=Math.max(g.start,f.start),C=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));v<C;v+=3)r=D_(this,m,e,i,l,u,d,a.getX(v),a.getX(v+1),a.getX(v+2)),r&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,t.push(r))}else for(let g=Math.max(0,f.start),m=Math.min(a.count,f.start+f.count);g<m;g+=3)r=D_(this,o,e,i,l,u,d,a.getX(g),a.getX(g+1),a.getX(g+2)),r&&(r.faceIndex=Math.floor(g/3),t.push(r));else if(void 0!==c)if(Array.isArray(o))for(let p=0,_=h.length;p<_;p++){const g=h[p],m=o[g.materialIndex];for(let v=Math.max(g.start,f.start),C=Math.min(c.count,Math.min(g.start+g.count,f.start+f.count));v<C;v+=3)r=D_(this,m,e,i,l,u,d,v,v+1,v+2),r&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,t.push(r))}else for(let g=Math.max(0,f.start),m=Math.min(c.count,f.start+f.count);g<m;g+=3)r=D_(this,o,e,i,l,u,d,g,g+1,g+2),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}function D_(n,e,t,i,r,s,o,a,c,l){n.getVertexPosition(a,M_),n.getVertexPosition(c,w_),n.getVertexPosition(l,x_);const u=function zZ(n,e,t,i,r,s,o,a){let c;if(c=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,0===e.side,a),null===c)return null;C_.copy(a),C_.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(C_);return l<t.near||l>t.far?null:{distance:l,point:C_.clone(),object:n}}(n,e,t,i,M_,w_,x_,JL);if(u){const d=new A;ts.getBarycoord(JL,M_,w_,x_,d),r&&(u.uv=ts.getInterpolatedAttribute(r,a,c,l,d,new ie)),s&&(u.uv1=ts.getInterpolatedAttribute(s,a,c,l,d,new ie)),o&&(u.normal=ts.getInterpolatedAttribute(o,a,c,l,d,new A),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:c,c:l,normal:new A,materialIndex:0};ts.getNormal(M_,w_,x_,h.normal),u.face=h,u.barycoord=d}return u}class rd extends Jt{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],d=[];let h=0,f=0;function p(_,g,m,y,E,v,C,x,T,I,M){const b=v/T,P=C/I,W=v/2,$=C/2,J=x/2,ce=T+1,L=I+1;let Y=0,B=0;const ae=new A;for(let ve=0;ve<L;ve++){const De=ve*P-$;for(let ot=0;ot<ce;ot++)ae[_]=(ot*b-W)*y,ae[g]=De*E,ae[m]=J,l.push(ae.x,ae.y,ae.z),ae[_]=0,ae[g]=0,ae[m]=x>0?1:-1,u.push(ae.x,ae.y,ae.z),d.push(ot/T),d.push(1-ve/I),Y+=1}for(let ve=0;ve<I;ve++)for(let De=0;De<T;De++){const tn=h+De+ce*(ve+1),K=h+(De+1)+ce*(ve+1),Ee=h+(De+1)+ce*ve;c.push(h+De+ce*ve,tn,Ee),c.push(tn,K,Ee),B+=6}a.addGroup(f,B,M),f+=B,h+=Y}p("z","y","x",-1,-1,i,t,e,o,s,0),p("z","y","x",1,-1,i,t,-e,o,s,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,s,4),p("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(c),this.setAttribute("position",new Xe(l,3)),this.setAttribute("normal",new Xe(u,3)),this.setAttribute("uv",new Xe(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rd(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function sd(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():e[t][i]=Array.isArray(r)?r.slice():r}}return e}function yr(n){const e={};for(let t=0;t<n.length;t++){const i=sd(n[t]);for(const r in i)e[r]=i[r]}return e}function QL(n){const e=n.getRenderTarget();return null===e?n.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:ln.workingColorSpace}const GZ={clone:sd,merge:yr};class to extends _r{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=sd(e.uniforms),this.uniformsGroups=function HZ(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;t.uniforms[r]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class XM extends Xn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ct,this.projectionMatrix=new Ct,this.projectionMatrixInverse=new Ct,this.coordinateSystem=Uo}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Ha=new A,eF=new ie,tF=new ie;class Gi extends XM{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Gu*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Wc*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Gu*Math.atan(Math.tan(.5*Wc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Ha.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ha.x,Ha.y).multiplyScalar(-e/Ha.z),Ha.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Ha.x,Ha.y).multiplyScalar(-e/Ha.z)}getViewSize(e,t){return this.getViewBounds(e,eF,tF),t.subVectors(tF,eF)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Wc*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*r/c,t-=o.offsetY*i/l,r*=o.width/c,i*=o.height/l}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class WZ extends Xn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Gi(-90,1,e,t);r.layers=this.layers,this.add(r);const s=new Gi(-90,1,e,t);s.layers=this.layers,this.add(s);const o=new Gi(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new Gi(-90,1,e,t);a.layers=this.layers,this.add(a);const c=new Gi(-90,1,e,t);c.layers=this.layers,this.add(c);const l=new Gi(-90,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,c]=t;for(const l of t)this.remove(l);if(e===Uo)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,c),e.setRenderTarget(i,4,r),e.render(t,l),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,r),e.render(t,u),e.setRenderTarget(d,h,f),e.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class A_ extends Or{constructor(e,t,i,r,s,o,a,c,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:301,i,r,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class qZ extends eo{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1};this.texture=new A_([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ki}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new rd(5,5,5),s=new to({name:"CubemapFromEquirect",uniforms:sd(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new ei(r,s),a=t.minFilter;return t.minFilter===Fo&&(t.minFilter=ki),new WZ(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const YM=new A,XZ=new A,YZ=new zt;class Ga{constructor(e=new A(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=YM.subVectors(i,t).cross(XZ.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(YM),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||YZ.getNormalMatrix(e),r=this.coplanarPoint(YM).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Zc=new gr,I_=new A;class R_{constructor(e=new Ga,t=new Ga,i=new Ga,r=new Ga,s=new Ga,o=new Ga){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Uo){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],c=r[3],l=r[4],u=r[5],d=r[6],h=r[7],f=r[8],p=r[9],_=r[10],g=r[11],m=r[12],y=r[13],E=r[14],v=r[15];if(i[0].setComponents(c-s,h-l,g-f,v-m).normalize(),i[1].setComponents(c+s,h+l,g+f,v+m).normalize(),i[2].setComponents(c+o,h+u,g+p,v+y).normalize(),i[3].setComponents(c-o,h-u,g-p,v-y).normalize(),i[4].setComponents(c-a,h-d,g-_,v-E).normalize(),t===Uo)i[5].setComponents(c+a,h+d,g+_,v+E).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(a,d,_,E).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Zc.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Zc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Zc)}intersectsSprite(e){return Zc.center.set(0,0,0),Zc.radius=.7071067811865476,Zc.applyMatrix4(e.matrixWorld),this.intersectsSphere(Zc)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(I_.x=r.normal.x>0?e.max.x:e.min.x,I_.y=r.normal.y>0?e.max.y:e.min.y,I_.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(I_)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function nF(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function ZZ(n){const e=new WeakMap;return{get:function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)},remove:function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(n.deleteBuffer(c.buffer),e.delete(a))},update:function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);return void((!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version}))}const l=e.get(a);if(void 0===l)e.set(a,function t(a,c){const l=a.array,u=a.usage,d=l.byteLength,h=n.createBuffer();let f;if(n.bindBuffer(c,h),n.bufferData(c,l,u),a.onUploadCallback(),l instanceof Float32Array)f=n.FLOAT;else if(l instanceof Uint16Array)f=a.isFloat16BufferAttribute?n.HALF_FLOAT:n.UNSIGNED_SHORT;else if(l instanceof Int16Array)f=n.SHORT;else if(l instanceof Uint32Array)f=n.UNSIGNED_INT;else if(l instanceof Int32Array)f=n.INT;else if(l instanceof Int8Array)f=n.BYTE;else if(l instanceof Uint8Array)f=n.UNSIGNED_BYTE;else{if(!(l instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);f=n.UNSIGNED_BYTE}return{buffer:h,type:f,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:d}}(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function i(a,c,l){const u=c.array,d=c.updateRanges;if(n.bindBuffer(l,a),0===d.length)n.bufferSubData(l,0,u);else{d.sort((f,p)=>f.start-p.start);let h=0;for(let f=1;f<d.length;f++){const p=d[h],_=d[f];_.start<=p.start+p.count+1?p.count=Math.max(p.count,_.start+_.count-p.start):(++h,d[h]=_)}d.length=h+1;for(let f=0,p=d.length;f<p;f++){const _=d[f];n.bufferSubData(l,_.start*u.BYTES_PER_ELEMENT,u,_.start,_.count)}c.clearUpdateRanges()}c.onUploadCallback()})(l.buffer,a,c),l.version=a.version}}}}class vf extends Jt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),c=Math.floor(r),l=a+1,u=c+1,d=e/a,h=t/c,f=[],p=[],_=[],g=[];for(let m=0;m<u;m++){const y=m*h-o;for(let E=0;E<l;E++)p.push(E*d-s,-y,0),_.push(0,0,1),g.push(E/a),g.push(1-m/c)}for(let m=0;m<c;m++)for(let y=0;y<a;y++){const v=y+l*(m+1),C=y+1+l*(m+1),x=y+1+l*m;f.push(y+l*m,v,x),f.push(v,C,x)}this.setIndex(f),this.setAttribute("position",new Xe(p,3)),this.setAttribute("normal",new Xe(_,3)),this.setAttribute("uv",new Xe(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vf(e.width,e.height,e.widthSegments,e.heightSegments)}}const Qt={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Ce={common:{diffuse:{value:new Le(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new zt},alphaMap:{value:null},alphaMapTransform:{value:new zt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new zt}},envmap:{envMap:{value:null},envMapRotation:{value:new zt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new zt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new zt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new zt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new zt},normalScale:{value:new ie(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new zt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new zt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new zt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new zt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Le(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Le(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new zt},alphaTest:{value:0},uvTransform:{value:new zt}},sprite:{diffuse:{value:new Le(16777215)},opacity:{value:1},center:{value:new ie(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new zt},alphaMap:{value:null},alphaMapTransform:{value:new zt},alphaTest:{value:0}}},no={basic:{uniforms:yr([Ce.common,Ce.specularmap,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.fog]),vertexShader:Qt.meshbasic_vert,fragmentShader:Qt.meshbasic_frag},lambert:{uniforms:yr([Ce.common,Ce.specularmap,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.fog,Ce.lights,{emissive:{value:new Le(0)}}]),vertexShader:Qt.meshlambert_vert,fragmentShader:Qt.meshlambert_frag},phong:{uniforms:yr([Ce.common,Ce.specularmap,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.fog,Ce.lights,{emissive:{value:new Le(0)},specular:{value:new Le(1118481)},shininess:{value:30}}]),vertexShader:Qt.meshphong_vert,fragmentShader:Qt.meshphong_frag},standard:{uniforms:yr([Ce.common,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.roughnessmap,Ce.metalnessmap,Ce.fog,Ce.lights,{emissive:{value:new Le(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag},toon:{uniforms:yr([Ce.common,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.gradientmap,Ce.fog,Ce.lights,{emissive:{value:new Le(0)}}]),vertexShader:Qt.meshtoon_vert,fragmentShader:Qt.meshtoon_frag},matcap:{uniforms:yr([Ce.common,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.fog,{matcap:{value:null}}]),vertexShader:Qt.meshmatcap_vert,fragmentShader:Qt.meshmatcap_frag},points:{uniforms:yr([Ce.points,Ce.fog]),vertexShader:Qt.points_vert,fragmentShader:Qt.points_frag},dashed:{uniforms:yr([Ce.common,Ce.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qt.linedashed_vert,fragmentShader:Qt.linedashed_frag},depth:{uniforms:yr([Ce.common,Ce.displacementmap]),vertexShader:Qt.depth_vert,fragmentShader:Qt.depth_frag},normal:{uniforms:yr([Ce.common,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,{opacity:{value:1}}]),vertexShader:Qt.meshnormal_vert,fragmentShader:Qt.meshnormal_frag},sprite:{uniforms:yr([Ce.sprite,Ce.fog]),vertexShader:Qt.sprite_vert,fragmentShader:Qt.sprite_frag},background:{uniforms:{uvTransform:{value:new zt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Qt.background_vert,fragmentShader:Qt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new zt}},vertexShader:Qt.backgroundCube_vert,fragmentShader:Qt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Qt.cube_vert,fragmentShader:Qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qt.equirect_vert,fragmentShader:Qt.equirect_frag},distanceRGBA:{uniforms:yr([Ce.common,Ce.displacementmap,{referencePosition:{value:new A},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qt.distanceRGBA_vert,fragmentShader:Qt.distanceRGBA_frag},shadow:{uniforms:yr([Ce.lights,Ce.fog,{color:{value:new Le(0)},opacity:{value:1}}]),vertexShader:Qt.shadow_vert,fragmentShader:Qt.shadow_frag}};no.physical={uniforms:yr([no.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new zt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new zt},clearcoatNormalScale:{value:new ie(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new zt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new zt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new zt},sheen:{value:0},sheenColor:{value:new Le(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new zt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new zt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new zt},transmissionSamplerSize:{value:new ie},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new zt},attenuationDistance:{value:0},attenuationColor:{value:new Le(0)},specularColor:{value:new Le(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new zt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new zt},anisotropyVector:{value:new ie},anisotropyMap:{value:null},anisotropyMapTransform:{value:new zt}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag};const P_={r:0,b:0,g:0},Kc=new Go,ZJ=new Ct;function KJ(n,e,t,i,r,s,o){const a=new Le(0);let l,u,c=!0===s?0:1,d=null,h=0,f=null;function p(y){let E=!0===y.isScene?y.background:null;return E&&E.isTexture&&(E=(y.backgroundBlurriness>0?t:e).get(E)),E}function m(y,E){y.getRGB(P_,QL(n)),i.buffers.color.setClear(P_.r,P_.g,P_.b,E,o)}return{getClearColor:function(){return a},setClearColor:function(y,E=1){a.set(y),c=E,m(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(y){c=y,m(a,c)},render:function _(y){let E=!1;const v=p(y);null===v?m(a,c):v&&v.isColor&&(m(v,1),E=!0);const C=n.xr.getEnvironmentBlendMode();"additive"===C?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===C&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||E)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))},addToRenderList:function g(y,E){const v=p(E);v&&(v.isCubeTexture||306===v.mapping)?(void 0===u&&(u=new ei(new rd(1,1,1),new to({name:"BackgroundCubeMaterial",uniforms:sd(no.backgroundCube.uniforms),vertexShader:no.backgroundCube.vertexShader,fragmentShader:no.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,x,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),Kc.copy(E.backgroundRotation),Kc.x*=-1,Kc.y*=-1,Kc.z*=-1,v.isCubeTexture&&!1===v.isRenderTargetTexture&&(Kc.y*=-1,Kc.z*=-1),u.material.uniforms.envMap.value=v,u.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(ZJ.makeRotationFromEuler(Kc)),u.material.toneMapped=ln.getTransfer(v.colorSpace)!==An,(d!==v||h!==v.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=v,h=v.version,f=n.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new ei(new vf(2,2),new to({name:"BackgroundMaterial",uniforms:sd(no.background.uniforms),vertexShader:no.background.vertexShader,fragmentShader:no.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,l.material.toneMapped=ln.getTransfer(v.colorSpace)!==An,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),(d!==v||h!==v.version||f!==n.toneMapping)&&(l.material.needsUpdate=!0,d=v,h=v.version,f=n.toneMapping),l.layers.enableAll(),y.unshift(l,l.geometry,l.material,0,0,null))}}}function JJ(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=h(null);let s=r,o=!1;function l(b){return n.bindVertexArray(b)}function u(b){return n.deleteVertexArray(b)}function h(b){const P=[],W=[],$=[];for(let J=0;J<t;J++)P[J]=0,W[J]=0,$[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:W,attributeDivisors:$,object:b,attributes:{},index:null}}function _(){const b=s.newAttributes;for(let P=0,W=b.length;P<W;P++)b[P]=0}function g(b){m(b,0)}function m(b,P){const $=s.enabledAttributes,J=s.attributeDivisors;s.newAttributes[b]=1,0===$[b]&&(n.enableVertexAttribArray(b),$[b]=1),J[b]!==P&&(n.vertexAttribDivisor(b,P),J[b]=P)}function y(){const b=s.newAttributes,P=s.enabledAttributes;for(let W=0,$=P.length;W<$;W++)P[W]!==b[W]&&(n.disableVertexAttribArray(W),P[W]=0)}function E(b,P,W,$,J,ce,L){!0===L?n.vertexAttribIPointer(b,P,W,J,ce):n.vertexAttribPointer(b,P,W,$,J,ce)}function I(){M(),o=!0,s!==r&&(s=r,l(s.object))}function M(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function a(b,P,W,$,J){let ce=!1;const L=function d(b,P,W){const $=!0===W.wireframe;let J=i[b.id];void 0===J&&(J={},i[b.id]=J);let ce=J[P.id];void 0===ce&&(ce={},J[P.id]=ce);let L=ce[$];return void 0===L&&(L=h(function c(){return n.createVertexArray()}()),ce[$]=L),L}($,W,P);s!==L&&(s=L,l(s.object)),ce=function f(b,P,W,$){const J=s.attributes,ce=P.attributes;let L=0;const Y=W.getAttributes();for(const B in Y)if(Y[B].location>=0){const ve=J[B];let De=ce[B];if(void 0===De&&("instanceMatrix"===B&&b.instanceMatrix&&(De=b.instanceMatrix),"instanceColor"===B&&b.instanceColor&&(De=b.instanceColor)),void 0===ve||ve.attribute!==De||De&&ve.data!==De.data)return!0;L++}return s.attributesNum!==L||s.index!==$}(b,$,W,J),ce&&function p(b,P,W,$){const J={},ce=P.attributes;let L=0;const Y=W.getAttributes();for(const B in Y)if(Y[B].location>=0){let ve=ce[B];void 0===ve&&("instanceMatrix"===B&&b.instanceMatrix&&(ve=b.instanceMatrix),"instanceColor"===B&&b.instanceColor&&(ve=b.instanceColor));const De={};De.attribute=ve,ve&&ve.data&&(De.data=ve.data),J[B]=De,L++}s.attributes=J,s.attributesNum=L,s.index=$}(b,$,W,J),null!==J&&e.update(J,n.ELEMENT_ARRAY_BUFFER),(ce||o)&&(o=!1,function v(b,P,W,$){_();const J=$.attributes,ce=W.getAttributes(),L=P.defaultAttributeValues;for(const Y in ce){const B=ce[Y];if(B.location>=0){let ae=J[Y];if(void 0===ae&&("instanceMatrix"===Y&&b.instanceMatrix&&(ae=b.instanceMatrix),"instanceColor"===Y&&b.instanceColor&&(ae=b.instanceColor)),void 0!==ae){const ve=ae.normalized,De=ae.itemSize,ot=e.get(ae);if(void 0===ot)continue;const tn=ot.buffer,K=ot.type,Ee=ot.bytesPerElement,Ge=K===n.INT||K===n.UNSIGNED_INT||1013===ae.gpuType;if(ae.isInterleavedBufferAttribute){const fe=ae.data,qe=fe.stride,Ke=ae.offset;if(fe.isInstancedInterleavedBuffer){for(let gt=0;gt<B.locationSize;gt++)m(B.location+gt,fe.meshPerAttribute);!0!==b.isInstancedMesh&&void 0===$._maxInstanceCount&&($._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let gt=0;gt<B.locationSize;gt++)g(B.location+gt);n.bindBuffer(n.ARRAY_BUFFER,tn);for(let gt=0;gt<B.locationSize;gt++)E(B.location+gt,De/B.locationSize,K,ve,qe*Ee,(Ke+De/B.locationSize*gt)*Ee,Ge)}else{if(ae.isInstancedBufferAttribute){for(let fe=0;fe<B.locationSize;fe++)m(B.location+fe,ae.meshPerAttribute);!0!==b.isInstancedMesh&&void 0===$._maxInstanceCount&&($._maxInstanceCount=ae.meshPerAttribute*ae.count)}else for(let fe=0;fe<B.locationSize;fe++)g(B.location+fe);n.bindBuffer(n.ARRAY_BUFFER,tn);for(let fe=0;fe<B.locationSize;fe++)E(B.location+fe,De/B.locationSize,K,ve,De*Ee,De/B.locationSize*fe*Ee,Ge)}}else if(void 0!==L){const ve=L[Y];if(void 0!==ve)switch(ve.length){case 2:n.vertexAttrib2fv(B.location,ve);break;case 3:n.vertexAttrib3fv(B.location,ve);break;case 4:n.vertexAttrib4fv(B.location,ve);break;default:n.vertexAttrib1fv(B.location,ve)}}}}y()}(b,P,W,$),null!==J&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(J).buffer))},reset:I,resetDefaultState:M,dispose:function C(){I();for(const b in i){const P=i[b];for(const W in P){const $=P[W];for(const J in $)u($[J].object),delete $[J];delete P[W]}delete i[b]}},releaseStatesOfGeometry:function x(b){if(void 0===i[b.id])return;const P=i[b.id];for(const W in P){const $=P[W];for(const J in $)u($[J].object),delete $[J];delete P[W]}delete i[b.id]},releaseStatesOfProgram:function T(b){for(const P in i){const W=i[P];if(void 0===W[b.id])continue;const $=W[b.id];for(const J in $)u($[J].object),delete $[J];delete W[b.id]}},initAttributes:_,enableAttribute:g,disableUnusedAttributes:y}}function QJ(n,e,t){let i;function o(l,u,d){0!==d&&(n.drawArraysInstanced(i,l,u,d),t.update(u,i,d))}this.setMode=function r(l){i=l},this.render=function s(l,u){n.drawArrays(i,l,u),t.update(u,i,1)},this.renderInstances=o,this.renderMultiDraw=function a(l,u,d){if(0===d)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,l,0,u,0,d);let f=0;for(let p=0;p<d;p++)f+=u[p];t.update(f,i,1)},this.renderMultiDrawInstances=function c(l,u,d,h){if(0===d)return;const f=e.get("WEBGL_multi_draw");if(null===f)for(let p=0;p<l.length;p++)o(l[p],u[p],h[p]);else{f.multiDrawArraysInstancedWEBGL(i,l,0,u,0,h,0,d);let p=0;for(let _=0;_<d;_++)p+=u[_]*h[_];t.update(p,i,1)}}}function eQ(n,e,t,i){let r;function c(T){if("highp"===T){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return"mediump"===T&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=void 0!==t.precision?t.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const d=!0===t.logarithmicDepthBuffer,h=!0===t.reverseDepthBuffer&&e.has("EXT_clip_control"),f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function s(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const T=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:c,textureFormatReadable:function o(T){return!(T!==Nr&&i.convert(T)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))},textureTypeReadable:function a(T){const I=T===uf&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(T!==ko&&i.convert(T)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&T!==Kr&&!I)},precision:l,logarithmicDepthBuffer:d,reverseDepthBuffer:h,maxTextures:f,maxVertexTextures:p,maxTextureSize:n.getParameter(n.MAX_TEXTURE_SIZE),maxCubemapSize:n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:n.getParameter(n.MAX_VERTEX_ATTRIBS),maxVertexUniforms:n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:n.getParameter(n.MAX_VARYING_VECTORS),maxFragmentUniforms:n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:p>0,maxSamples:n.getParameter(n.MAX_SAMPLES)}}function tQ(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Ga,a=new zt,c={value:null,needsUpdate:!1};function u(d,h,f,p){const _=null!==d?d.length:0;let g=null;if(0!==_){if(g=c.value,!0!==p||null===g){const m=f+4*_,y=h.matrixWorldInverse;a.getNormalMatrix(y),(null===g||g.length<m)&&(g=new Float32Array(m));for(let E=0,v=f;E!==_;++E,v+=4)o.copy(d[E]).applyMatrix4(y,a),o.normal.toArray(g,v),g[v+3]=o.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,g}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=0!==d.length||h||0!==i||r;return r=h,i=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const p=d.clippingPlanes,_=d.clipIntersection,g=d.clipShadows,m=n.get(d);if(!r||null===p||0===p.length||s&&!g)s?u(null):function l(){c.value!==t&&(c.value=t,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const y=s?0:i,E=4*y;let v=m.clippingState||null;c.value=v,v=u(p,h,E,f);for(let C=0;C!==E;++C)v[C]=t[C];m.clippingState=v,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=y}}}function nQ(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=301:304===a&&(o.mapping=302),o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const c=e.get(a);void 0!==c&&(e.delete(a),c.dispose())}return{get:function i(o){if(o&&o.isTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const c=o.image;if(c&&c.height>0){const l=new qZ(c.height);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",r),t(l.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class ZM extends XM{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,c=r-t;if(null!==this.view&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const iF=[.125,.215,.35,.446,.526,.582],KM=new ZM,rF=new Le;let JM=null,QM=0,ew=0,tw=!1;const Qc=(1+Math.sqrt(5))/2,ld=1/Qc,sF=[new A(-Qc,ld,0),new A(Qc,ld,0),new A(-ld,0,Qc),new A(ld,0,Qc),new A(0,Qc,-ld),new A(0,Qc,ld),new A(-1,1,-1),new A(1,1,-1),new A(-1,1,1),new A(1,1,1)];class oF{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){JM=this._renderer.getRenderTarget(),QM=this._renderer.getActiveCubeFace(),ew=this._renderer.getActiveMipmapLevel(),tw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=lF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=cF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(JM,QM,ew),this._renderer.xr.enabled=tw,e.scissorTest=!1,N_(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),JM=this._renderer.getRenderTarget(),QM=this._renderer.getActiveCubeFace(),ew=this._renderer.getActiveMipmapLevel(),tw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:ki,minFilter:ki,generateMipmaps:!1,type:uf,format:Nr,colorSpace:zu,depthBuffer:!1},r=aF(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=aF(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function iQ(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+iF.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let c=1/a;o>n-4?c=iF[o-n+4-1]:0===o&&(c=0),i.push(c);const l=1/(a-2),u=-l,d=1+l,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,_=3,g=2,m=1,y=new Float32Array(_*p*f),E=new Float32Array(g*p*f),v=new Float32Array(m*p*f);for(let x=0;x<f;x++){const T=x%3*2/3-1,I=x>2?0:-1;y.set([T,I,0,T+2/3,I,0,T+2/3,I+1,0,T,I,0,T+2/3,I+1,0,T,I+1,0],_*p*x),E.set(h,g*p*x),v.set([x,x,x,x,x,x],m*p*x)}const C=new Jt;C.setAttribute("position",new kn(y,_)),C.setAttribute("uv",new kn(E,g)),C.setAttribute("faceIndex",new kn(v,m)),e.push(C),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function rQ(n,e,t){const i=new Float32Array(20),r=new A(0,1,0);return new to({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new ei(this._lodPlanes[0],e);this._renderer.compile(t,KM)}_sceneToCubeUV(e,t,i,r){const a=new Gi(90,1,t,i),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(rF),u.toneMapping=0,u.autoClear=!1;const f=new qo({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new ei(new rd,f);let _=!1;const g=e.background;g?g.isColor&&(f.color.copy(g),e.background=null,_=!0):(f.color.copy(rF),_=!0);for(let m=0;m<6;m++){const y=m%3;0===y?(a.up.set(0,c[m],0),a.lookAt(l[m],0,0)):1===y?(a.up.set(0,0,c[m]),a.lookAt(0,l[m],0)):(a.up.set(0,c[m],0),a.lookAt(0,0,l[m]));const E=this._cubeSize;N_(r,y*E,m>2?E:0,E,E),u.setRenderTarget(r),_&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,r=301===e.mapping||302===e.mapping;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=lF()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=cF());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new ei(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const c=this._cubeSize;N_(t,0,0,3*c,2*c),i.setRenderTarget(t),i.render(o,KM)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]);this._blur(e,s-1,s,o,sF[(r-s-1)%sF.length])}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const c=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new ei(this._lodPlanes[r],l),h=l.uniforms,f=this._sizeLods[i]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,_=s/p,g=isFinite(s)?1+Math.floor(3*_):20;g>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const m=[];let y=0;for(let T=0;T<20;++T){const I=T/_,M=Math.exp(-I*I/2);m.push(M),0===T?y+=M:T<g&&(y+=2*M)}for(let T=0;T<m.length;T++)m[T]=m[T]/y;h.envMap.value=e.texture,h.samples.value=g,h.weights.value=m,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:E}=this;h.dTheta.value=p,h.mipInt.value=E-i;const v=this._sizeLods[r];N_(t,3*v*(r>E-4?r-E+4:0),4*(this._cubeSize-v),3*v,2*v),c.setRenderTarget(t),c.render(d,KM)}}function aF(n,e,t){const i=new eo(n,e,t);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function N_(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function cF(){return new to({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function lF(){return new to({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function sQ(n){let e=new WeakMap,t=null;function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);void 0!==l&&(e.delete(c),l.dispose())}return{get:function i(a){if(a&&a.isTexture){const c=a.mapping,l=303===c||304===c,u=301===c||302===c;if(l||u){let d=e.get(a);if(a.isRenderTargetTexture&&a.pmremVersion!==(void 0!==d?d.texture.pmremVersion:0))return null===t&&(t=new oF(n)),d=l?t.fromEquirectangular(a,d):t.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(void 0!==d)return d.texture;{const f=a.image;return l&&f&&f.height>0||u&&f&&function r(a){let c=0;for(let u=0;u<6;u++)void 0!==a[u]&&c++;return 6===c}(f)?(null===t&&(t=new oF(n)),d=l?t.fromEquirectangular(a):t.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",s),d.texture):null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function oQ(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return null===r&&ff("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function aQ(n,e,t,i){const r={},s=new WeakMap;function o(d){const h=d.target;null!==h.index&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);for(const p in h.morphAttributes){const _=h.morphAttributes[p];for(let g=0,m=_.length;g<m;g++)e.remove(_[g])}h.removeEventListener("dispose",o),delete r[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),i.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,t.memory.geometries--}function l(d){const h=[],f=d.index,p=d.attributes.position;let _=0;if(null!==f){const y=f.array;_=f.version;for(let E=0,v=y.length;E<v;E+=3){const C=y[E+0],x=y[E+1],T=y[E+2];h.push(C,x,x,T,T,C)}}else{if(void 0===p)return;_=p.version;for(let E=0,v=p.array.length/3-1;E<v;E+=3){const C=E+0,x=E+1,T=E+2;h.push(C,x,x,T,T,C)}}const g=new(IL(h)?YL:XL)(h,1);g.version=_;const m=s.get(d);m&&e.remove(m),s.set(d,g)}return{get:function a(d,h){return!0===r[h.id]||(h.addEventListener("dispose",o),r[h.id]=!0,t.memory.geometries++),h},update:function c(d){const h=d.attributes;for(const p in h)e.update(h[p],n.ARRAY_BUFFER);const f=d.morphAttributes;for(const p in f){const _=f[p];for(let g=0,m=_.length;g<m;g++)e.update(_[g],n.ARRAY_BUFFER)}},getWireframeAttribute:function u(d){const h=s.get(d);if(h){const f=d.index;null!==f&&h.version<f.version&&l(d)}else l(d);return s.get(d)}}}function cQ(n,e,t){let i,s,o;function l(h,f,p){0!==p&&(n.drawElementsInstanced(i,f,s,h*o,p),t.update(f,i,p))}this.setMode=function r(h){i=h},this.setIndex=function a(h){s=h.type,o=h.bytesPerElement},this.render=function c(h,f){n.drawElements(i,f,s,h*o),t.update(f,i,1)},this.renderInstances=l,this.renderMultiDraw=function u(h,f,p){if(0===p)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,s,h,0,p);let g=0;for(let m=0;m<p;m++)g+=f[m];t.update(g,i,1)},this.renderMultiDrawInstances=function d(h,f,p,_){if(0===p)return;const g=e.get("WEBGL_multi_draw");if(null===g)for(let m=0;m<h.length;m++)l(h[m]/o,f[m],_[m]);else{g.multiDrawElementsInstancedWEBGL(i,f,0,s,h,0,_,0,p);let m=0;for(let y=0;y<p;y++)m+=f[y]*_[y];t.update(m,i,1)}}}function lQ(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function uQ(n,e,t){const i=new WeakMap,r=new gn;return{update:function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=void 0!==u?u.length:0;let h=i.get(a);if(void 0===h||h.count!==d){let M=function(){T.dispose(),i.delete(a),a.removeEventListener("dispose",M)};void 0!==h&&h.texture.dispose();const f=void 0!==a.morphAttributes.position,p=void 0!==a.morphAttributes.normal,_=void 0!==a.morphAttributes.color,g=a.morphAttributes.position||[],m=a.morphAttributes.normal||[],y=a.morphAttributes.color||[];let E=0;!0===f&&(E=1),!0===p&&(E=2),!0===_&&(E=3);let v=a.attributes.position.count*E,C=1;v>e.maxTextureSize&&(C=Math.ceil(v/e.maxTextureSize),v=e.maxTextureSize);const x=new Float32Array(v*C*4*d),T=new AM(x,v,C,d);T.type=Kr,T.needsUpdate=!0;const I=4*E;for(let b=0;b<d;b++){const P=g[b],W=m[b],$=y[b],J=v*C*4*b;for(let ce=0;ce<P.count;ce++){const L=ce*I;!0===f&&(r.fromBufferAttribute(P,ce),x[J+L+0]=r.x,x[J+L+1]=r.y,x[J+L+2]=r.z,x[J+L+3]=0),!0===p&&(r.fromBufferAttribute(W,ce),x[J+L+4]=r.x,x[J+L+5]=r.y,x[J+L+6]=r.z,x[J+L+7]=0),!0===_&&(r.fromBufferAttribute($,ce),x[J+L+8]=r.x,x[J+L+9]=r.y,x[J+L+10]=r.z,x[J+L+11]=4===$.itemSize?r.w:1)}}h={count:d,texture:T,size:new ie(v,C)},i.set(a,h),a.addEventListener("dispose",M)}if(!0===o.isInstancedMesh&&null!==o.morphTexture)c.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let f=0;for(let _=0;_<l.length;_++)f+=l[_];const p=a.morphTargetsRelative?1:1-f;c.getUniforms().setValue(n,"morphTargetBaseInfluence",p),c.getUniforms().setValue(n,"morphTargetInfluences",l)}c.getUniforms().setValue(n,"morphTargetsTexture",h.texture,t),c.getUniforms().setValue(n,"morphTargetsTextureSize",h.size)}}}function dQ(n,e,t,i){let r=new WeakMap;function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),null!==l.instanceColor&&t.remove(l.instanceColor)}return{update:function s(c){const l=i.render.frame,d=e.get(c,c.geometry);if(r.get(d)!==l&&(e.update(d),r.set(d,l)),c.isInstancedMesh&&(!1===c.hasEventListener("dispose",a)&&c.addEventListener("dispose",a),r.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),null!==c.instanceColor&&t.update(c.instanceColor,n.ARRAY_BUFFER),r.set(c,l))),c.isSkinnedMesh){const h=c.skeleton;r.get(h)!==l&&(h.update(),r.set(h,l))}return d},dispose:function o(){r=new WeakMap}}}class uF extends Or{constructor(e,t,i,r,s,o,a,c,l,u=ku){if(u!==ku&&u!==Uu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&u===ku&&(i=La),void 0===i&&u===Uu&&(i=Fu),super(null,r,s,o,a,c,u,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Zi,this.minFilter=void 0!==c?c:Zi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const dF=new Or,hF=new uF(1,1),fF=new AM,pF=new kL,mF=new A_,gF=[],_F=[],yF=new Float32Array(16),vF=new Float32Array(9),EF=new Float32Array(4);function ud(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=gF[r];if(void 0===s&&(s=new Float32Array(r),gF[r]=s),0!==e){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function Di(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ai(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function O_(n,e){let t=_F[e];void 0===t&&(t=new Int32Array(e),_F[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function hQ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function fQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Di(t,e))return;n.uniform2fv(this.addr,e),Ai(t,e)}}function pQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Di(t,e))return;n.uniform3fv(this.addr,e),Ai(t,e)}}function mQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Di(t,e))return;n.uniform4fv(this.addr,e),Ai(t,e)}}function gQ(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Di(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ai(t,e)}else{if(Di(t,i))return;EF.set(i),n.uniformMatrix2fv(this.addr,!1,EF),Ai(t,i)}}function _Q(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Di(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ai(t,e)}else{if(Di(t,i))return;vF.set(i),n.uniformMatrix3fv(this.addr,!1,vF),Ai(t,i)}}function yQ(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Di(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ai(t,e)}else{if(Di(t,i))return;yF.set(i),n.uniformMatrix4fv(this.addr,!1,yF),Ai(t,i)}}function vQ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function EQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Di(t,e))return;n.uniform2iv(this.addr,e),Ai(t,e)}}function bQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Di(t,e))return;n.uniform3iv(this.addr,e),Ai(t,e)}}function SQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Di(t,e))return;n.uniform4iv(this.addr,e),Ai(t,e)}}function MQ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function wQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Di(t,e))return;n.uniform2uiv(this.addr,e),Ai(t,e)}}function xQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Di(t,e))return;n.uniform3uiv(this.addr,e),Ai(t,e)}}function TQ(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Di(t,e))return;n.uniform4uiv(this.addr,e),Ai(t,e)}}function CQ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();let s;i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),this.type===n.SAMPLER_2D_SHADOW?(hF.compareFunction=515,s=hF):s=dF,t.setTexture2D(e||s,r)}function DQ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||pF,r)}function AQ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||mF,r)}function IQ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||fF,r)}function PQ(n,e){n.uniform1fv(this.addr,e)}function NQ(n,e){const t=ud(e,this.size,2);n.uniform2fv(this.addr,t)}function OQ(n,e){const t=ud(e,this.size,3);n.uniform3fv(this.addr,t)}function LQ(n,e){const t=ud(e,this.size,4);n.uniform4fv(this.addr,t)}function FQ(n,e){const t=ud(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function kQ(n,e){const t=ud(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function UQ(n,e){const t=ud(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function BQ(n,e){n.uniform1iv(this.addr,e)}function VQ(n,e){n.uniform2iv(this.addr,e)}function zQ(n,e){n.uniform3iv(this.addr,e)}function HQ(n,e){n.uniform4iv(this.addr,e)}function GQ(n,e){n.uniform1uiv(this.addr,e)}function jQ(n,e){n.uniform2uiv(this.addr,e)}function $Q(n,e){n.uniform3uiv(this.addr,e)}function WQ(n,e){n.uniform4uiv(this.addr,e)}function qQ(n,e,t){const i=this.cache,r=e.length,s=O_(t,r);Di(i,s)||(n.uniform1iv(this.addr,s),Ai(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||dF,s[o])}function XQ(n,e,t){const i=this.cache,r=e.length,s=O_(t,r);Di(i,s)||(n.uniform1iv(this.addr,s),Ai(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||pF,s[o])}function YQ(n,e,t){const i=this.cache,r=e.length,s=O_(t,r);Di(i,s)||(n.uniform1iv(this.addr,s),Ai(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||mF,s[o])}function ZQ(n,e,t){const i=this.cache,r=e.length,s=O_(t,r);Di(i,s)||(n.uniform1iv(this.addr,s),Ai(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||fF,s[o])}class JQ{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=function RQ(n){switch(n){case 5126:return hQ;case 35664:return fQ;case 35665:return pQ;case 35666:return mQ;case 35674:return gQ;case 35675:return _Q;case 35676:return yQ;case 5124:case 35670:return vQ;case 35667:case 35671:return EQ;case 35668:case 35672:return bQ;case 35669:case 35673:return SQ;case 5125:return MQ;case 36294:return wQ;case 36295:return xQ;case 36296:return TQ;case 35678:case 36198:case 36298:case 36306:case 35682:return CQ;case 35679:case 36299:case 36307:return DQ;case 35680:case 36300:case 36308:case 36293:return AQ;case 36289:case 36303:case 36311:case 36292:return IQ}}(t.type)}}class QQ{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function KQ(n){switch(n){case 5126:return PQ;case 35664:return NQ;case 35665:return OQ;case 35666:return LQ;case 35674:return FQ;case 35675:return kQ;case 35676:return UQ;case 5124:case 35670:return BQ;case 35667:case 35671:return VQ;case 35668:case 35672:return zQ;case 35669:case 35673:return HQ;case 5125:return GQ;case 36294:return jQ;case 36295:return $Q;case 36296:return WQ;case 35678:case 36198:case 36298:case 36306:case 35682:return qQ;case 35679:case 36299:case 36307:return XQ;case 35680:case 36300:case 36308:case 36293:return YQ;case 36289:case 36303:case 36311:case 36292:return ZQ}}(t.type)}}class eee{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const iw=/(\w+)(\])?(\[|\.)?/g;function bF(n,e){n.seq.push(e),n.map[e.id]=e}function tee(n,e,t){const i=n.name,r=i.length;for(iw.lastIndex=0;;){const s=iw.exec(i);let a=s[1];const l=s[3];if("]"===s[2]&&(a|=0),void 0===l||"["===l&&iw.lastIndex+2===r){bF(t,void 0===l?new JQ(a,n,e):new QQ(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new eee(a),bF(t,d)),t=d}}}class L_{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);tee(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=i[a.id];!1!==c.needsUpdate&&a.setValue(e,c.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function SF(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let iee=0;const MF=new zt;function wF(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function ree(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join("\n")}(n.getShaderSource(e),o)}return r}function oee(n,e){const t=function see(n){ln._getMatrix(MF,ln.workingColorSpace,n);const e=`mat3( ${MF.elements.map(t=>t.toFixed(4))} )`;switch(ln.getTransfer(n)){case u_:return[e,"LinearTransferOETF"];case An:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}(e);return[`vec4 ${n}( vec4 value ) {`,`\treturn ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join("\n")}function aee(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="Cineon";break;case 4:t="ACESFilmic";break;case 6:t="AgX";break;case 7:t="Neutral";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const F_=new A;function Ef(n){return""!==n}function xF(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function TF(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const hee=/^[ \t]*#include +<([\w\d./]+)>/gm;function rw(n){return n.replace(hee,pee)}const fee=new Map;function pee(n,e){let t=Qt[e];if(void 0===t){const i=fee.get(e);if(void 0===i)throw new Error("Can not resolve #include <"+e+">");t=Qt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i)}return rw(t)}const mee=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function CF(n){return n.replace(mee,gee)}function gee(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function DF(n){let e=`precision ${n.precision} float;\n\tprecision ${n.precision} int;\n\tprecision ${n.precision} sampler2D;\n\tprecision ${n.precision} samplerCube;\n\tprecision ${n.precision} sampler3D;\n\tprecision ${n.precision} sampler2DArray;\n\tprecision ${n.precision} sampler2DShadow;\n\tprecision ${n.precision} samplerCubeShadow;\n\tprecision ${n.precision} sampler2DArrayShadow;\n\tprecision ${n.precision} isampler2D;\n\tprecision ${n.precision} isampler3D;\n\tprecision ${n.precision} isamplerCube;\n\tprecision ${n.precision} isampler2DArray;\n\tprecision ${n.precision} usampler2D;\n\tprecision ${n.precision} usampler3D;\n\tprecision ${n.precision} usamplerCube;\n\tprecision ${n.precision} usampler2DArray;\n\t`;return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function See(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=function _ee(n){let e="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),l=function yee(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function vee(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function Eee(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),h=function bee(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),f=function lee(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ef).join("\n")}(t),p=function uee(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),_=r.createProgram();let g,m,y=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(Ef).join("\n"),g.length>0&&(g+="\n"),m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(Ef).join("\n"),m.length>0&&(m+="\n")):(g=[DF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ef).join("\n"),m=[DF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?Qt.tonemapping_pars_fragment:"",0!==t.toneMapping?aee("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Qt.colorspace_pars_fragment,oee("linearToOutputTexel",t.outputColorSpace),(ln.getLuminanceCoefficients(F_),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${F_.x.toFixed(4)}, ${F_.y.toFixed(4)}, ${F_.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(Ef).join("\n")),o=rw(o),o=xF(o,t),o=TF(o,t),a=rw(a),a=xF(a,t),a=TF(a,t),o=CF(o),a=CF(a),!0!==t.isRawShaderMaterial&&(y="#version 300 es\n",g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,m=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+m);const v=y+m+a,C=SF(r,r.VERTEX_SHADER,y+g+o),x=SF(r,r.FRAGMENT_SHADER,v);function T(P){if(n.debug.checkShaderErrors){const W=r.getProgramInfoLog(_).trim(),$=r.getShaderInfoLog(C).trim(),J=r.getShaderInfoLog(x).trim();let ce=!0,L=!0;if(!1===r.getProgramParameter(_,r.LINK_STATUS))if(ce=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(r,_,C,x);else{const Y=wF(r,C,"vertex"),B=wF(r,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+P.name+"\nMaterial Type: "+P.type+"\n\nProgram Info Log: "+W+"\n"+Y+"\n"+B)}else""!==W?console.warn("THREE.WebGLProgram: Program Info Log:",W):(""===$||""===J)&&(L=!1);L&&(P.diagnostics={runnable:ce,programLog:W,vertexShader:{log:$,prefix:g},fragmentShader:{log:J,prefix:m}})}r.deleteShader(C),r.deleteShader(x),I=new L_(r,_),M=function dee(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(r,_)}let I,M;r.attachShader(_,C),r.attachShader(_,x),void 0!==t.index0AttributeName?r.bindAttribLocation(_,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_),this.getUniforms=function(){return void 0===I&&T(this),I},this.getAttributes=function(){return void 0===M&&T(this),M};let b=!1===t.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===b&&(b=r.getProgramParameter(_,37297)),b},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=iee++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=C,this.fragmentShader=x,this}let Mee=0;class wee{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new xee(e),t.set(e,i)),i}}class xee{constructor(e){this.id=Mee++,this.code=e,this.usedTimes=0}}function Tee(n,e,t,i,r,s,o){const a=new FM,c=new wee,l=new Set,u=[],d=r.logarithmicDepthBuffer,h=r.vertexTextures;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(M){return l.add(M),0===M?"uv":`uv${M}`}return{getParameters:function g(M,b,P,W,$){const J=W.fog,ce=$.geometry,Y=(M.isMeshStandardMaterial?t:e).get(M.envMap||(M.isMeshStandardMaterial?W.environment:null)),B=Y&&306===Y.mapping?Y.image.height:null,ae=p[M.type];null!==M.precision&&(f=r.getMaxPrecision(M.precision),f!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",f,"instead."));const ve=ce.morphAttributes.position||ce.morphAttributes.normal||ce.morphAttributes.color,De=void 0!==ve?ve.length:0;let tn,K,Ee,Ge,ot=0;if(void 0!==ce.morphAttributes.position&&(ot=1),void 0!==ce.morphAttributes.normal&&(ot=2),void 0!==ce.morphAttributes.color&&(ot=3),ae){const wn=no[ae];tn=wn.vertexShader,K=wn.fragmentShader}else tn=M.vertexShader,K=M.fragmentShader,c.update(M),Ee=c.getVertexShaderID(M),Ge=c.getFragmentShaderID(M);const fe=n.getRenderTarget(),qe=n.state.buffers.depth.getReversed(),Ke=!0===$.isInstancedMesh,gt=!0===$.isBatchedMesh,nn=!!M.map,be=!!Y,R=!!M.aoMap,tt=!!M.lightMap,me=!!M.bumpMap,ze=!!M.normalMap,xe=!!M.displacementMap,Mt=!!M.emissiveMap,Be=!!M.metalnessMap,D=!!M.roughnessMap,S=M.anisotropy>0,j=M.clearcoat>0,he=M.iridescence>0,se=M.sheen>0,Je=M.transmission>0,Ae=S&&!!M.anisotropyMap,Ve=j&&!!M.clearcoatMap,sn=j&&!!M.clearcoatNormalMap,_e=j&&!!M.clearcoatRoughnessMap,je=he&&!!M.iridescenceMap,wt=he&&!!M.iridescenceThicknessMap,Ot=se&&!!M.sheenColorMap,$e=se&&!!M.sheenRoughnessMap,un=!!M.specularMap,en=!!M.specularColorMap,Hn=!!M.specularIntensityMap,F=Je&&!!M.transmissionMap,Ie=Je&&!!M.thicknessMap,le=!!M.alphaMap,Xt=!!M.extensions;let hi=0;M.toneMapped&&(null===fe||!0===fe.isXRRenderTarget)&&(hi=n.toneMapping);const tr={shaderID:ae,shaderType:M.type,shaderName:M.name,vertexShader:tn,fragmentShader:K,defines:M.defines,customVertexShaderID:Ee,customFragmentShaderID:Ge,isRawShaderMaterial:!0===M.isRawShaderMaterial,glslVersion:M.glslVersion,precision:f,batching:gt,batchingColor:gt&&null!==$._colorsTexture,instancing:Ke,instancingColor:Ke&&null!==$.instanceColor,instancingMorph:Ke&&null!==$.morphTexture,supportsVertexTextures:h,outputColorSpace:null===fe?n.outputColorSpace:!0===fe.isXRRenderTarget?fe.texture.colorSpace:zu,alphaToCoverage:!!M.alphaToCoverage,map:nn,matcap:!!M.matcap,envMap:be,envMapMode:be&&Y.mapping,envMapCubeUVHeight:B,aoMap:R,lightMap:tt,bumpMap:me,normalMap:ze,displacementMap:h&&xe,emissiveMap:Mt,normalMapObjectSpace:ze&&1===M.normalMapType,normalMapTangentSpace:ze&&0===M.normalMapType,metalnessMap:Be,roughnessMap:D,anisotropy:S,anisotropyMap:Ae,clearcoat:j,clearcoatMap:Ve,clearcoatNormalMap:sn,clearcoatRoughnessMap:_e,dispersion:M.dispersion>0,iridescence:he,iridescenceMap:je,iridescenceThicknessMap:wt,sheen:se,sheenColorMap:Ot,sheenRoughnessMap:$e,specularMap:un,specularColorMap:en,specularIntensityMap:Hn,transmission:Je,transmissionMap:F,thicknessMap:Ie,gradientMap:!!M.gradientMap,opaque:!1===M.transparent&&1===M.blending&&!1===M.alphaToCoverage,alphaMap:le,alphaTest:M.alphaTest>0,alphaHash:!!M.alphaHash,combine:M.combine,mapUv:nn&&_(M.map.channel),aoMapUv:R&&_(M.aoMap.channel),lightMapUv:tt&&_(M.lightMap.channel),bumpMapUv:me&&_(M.bumpMap.channel),normalMapUv:ze&&_(M.normalMap.channel),displacementMapUv:xe&&_(M.displacementMap.channel),emissiveMapUv:Mt&&_(M.emissiveMap.channel),metalnessMapUv:Be&&_(M.metalnessMap.channel),roughnessMapUv:D&&_(M.roughnessMap.channel),anisotropyMapUv:Ae&&_(M.anisotropyMap.channel),clearcoatMapUv:Ve&&_(M.clearcoatMap.channel),clearcoatNormalMapUv:sn&&_(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:_e&&_(M.clearcoatRoughnessMap.channel),iridescenceMapUv:je&&_(M.iridescenceMap.channel),iridescenceThicknessMapUv:wt&&_(M.iridescenceThicknessMap.channel),sheenColorMapUv:Ot&&_(M.sheenColorMap.channel),sheenRoughnessMapUv:$e&&_(M.sheenRoughnessMap.channel),specularMapUv:un&&_(M.specularMap.channel),specularColorMapUv:en&&_(M.specularColorMap.channel),specularIntensityMapUv:Hn&&_(M.specularIntensityMap.channel),transmissionMapUv:F&&_(M.transmissionMap.channel),thicknessMapUv:Ie&&_(M.thicknessMap.channel),alphaMapUv:le&&_(M.alphaMap.channel),vertexTangents:!!ce.attributes.tangent&&(ze||S),vertexColors:M.vertexColors,vertexAlphas:!0===M.vertexColors&&!!ce.attributes.color&&4===ce.attributes.color.itemSize,pointsUvs:!0===$.isPoints&&!!ce.attributes.uv&&(nn||le),fog:!!J,useFog:!0===M.fog,fogExp2:!!J&&J.isFogExp2,flatShading:!0===M.flatShading,sizeAttenuation:!0===M.sizeAttenuation,logarithmicDepthBuffer:d,reverseDepthBuffer:qe,skinning:!0===$.isSkinnedMesh,morphTargets:void 0!==ce.morphAttributes.position,morphNormals:void 0!==ce.morphAttributes.normal,morphColors:void 0!==ce.morphAttributes.color,morphTargetsCount:De,morphTextureStride:ot,numDirLights:b.directional.length,numPointLights:b.point.length,numSpotLights:b.spot.length,numSpotLightMaps:b.spotLightMap.length,numRectAreaLights:b.rectArea.length,numHemiLights:b.hemi.length,numDirLightShadows:b.directionalShadowMap.length,numPointLightShadows:b.pointShadowMap.length,numSpotLightShadows:b.spotShadowMap.length,numSpotLightShadowsWithMaps:b.numSpotLightShadowsWithMaps,numLightProbes:b.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:n.shadowMap.enabled&&P.length>0,shadowMapType:n.shadowMap.type,toneMapping:hi,decodeVideoTexture:nn&&!0===M.map.isVideoTexture&&ln.getTransfer(M.map.colorSpace)===An,decodeVideoTextureEmissive:Mt&&!0===M.emissiveMap.isVideoTexture&&ln.getTransfer(M.emissiveMap.colorSpace)===An,premultipliedAlpha:M.premultipliedAlpha,doubleSided:2===M.side,flipSided:1===M.side,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:Xt&&!0===M.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Xt&&!0===M.extensions.multiDraw||gt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return tr.vertexUv1s=l.has(1),tr.vertexUv2s=l.has(2),tr.vertexUv3s=l.has(3),l.clear(),tr},getProgramCacheKey:function m(M){const b=[];if(M.shaderID?b.push(M.shaderID):(b.push(M.customVertexShaderID),b.push(M.customFragmentShaderID)),void 0!==M.defines)for(const P in M.defines)b.push(P),b.push(M.defines[P]);return!1===M.isRawShaderMaterial&&(function y(M,b){M.push(b.precision),M.push(b.outputColorSpace),M.push(b.envMapMode),M.push(b.envMapCubeUVHeight),M.push(b.mapUv),M.push(b.alphaMapUv),M.push(b.lightMapUv),M.push(b.aoMapUv),M.push(b.bumpMapUv),M.push(b.normalMapUv),M.push(b.displacementMapUv),M.push(b.emissiveMapUv),M.push(b.metalnessMapUv),M.push(b.roughnessMapUv),M.push(b.anisotropyMapUv),M.push(b.clearcoatMapUv),M.push(b.clearcoatNormalMapUv),M.push(b.clearcoatRoughnessMapUv),M.push(b.iridescenceMapUv),M.push(b.iridescenceThicknessMapUv),M.push(b.sheenColorMapUv),M.push(b.sheenRoughnessMapUv),M.push(b.specularMapUv),M.push(b.specularColorMapUv),M.push(b.specularIntensityMapUv),M.push(b.transmissionMapUv),M.push(b.thicknessMapUv),M.push(b.combine),M.push(b.fogExp2),M.push(b.sizeAttenuation),M.push(b.morphTargetsCount),M.push(b.morphAttributeCount),M.push(b.numDirLights),M.push(b.numPointLights),M.push(b.numSpotLights),M.push(b.numSpotLightMaps),M.push(b.numHemiLights),M.push(b.numRectAreaLights),M.push(b.numDirLightShadows),M.push(b.numPointLightShadows),M.push(b.numSpotLightShadows),M.push(b.numSpotLightShadowsWithMaps),M.push(b.numLightProbes),M.push(b.shadowMapType),M.push(b.toneMapping),M.push(b.numClippingPlanes),M.push(b.numClipIntersection),M.push(b.depthPacking)}(b,M),function E(M,b){a.disableAll(),b.supportsVertexTextures&&a.enable(0),b.instancing&&a.enable(1),b.instancingColor&&a.enable(2),b.instancingMorph&&a.enable(3),b.matcap&&a.enable(4),b.envMap&&a.enable(5),b.normalMapObjectSpace&&a.enable(6),b.normalMapTangentSpace&&a.enable(7),b.clearcoat&&a.enable(8),b.iridescence&&a.enable(9),b.alphaTest&&a.enable(10),b.vertexColors&&a.enable(11),b.vertexAlphas&&a.enable(12),b.vertexUv1s&&a.enable(13),b.vertexUv2s&&a.enable(14),b.vertexUv3s&&a.enable(15),b.vertexTangents&&a.enable(16),b.anisotropy&&a.enable(17),b.alphaHash&&a.enable(18),b.batching&&a.enable(19),b.dispersion&&a.enable(20),b.batchingColor&&a.enable(21),M.push(a.mask),a.disableAll(),b.fog&&a.enable(0),b.useFog&&a.enable(1),b.flatShading&&a.enable(2),b.logarithmicDepthBuffer&&a.enable(3),b.reverseDepthBuffer&&a.enable(4),b.skinning&&a.enable(5),b.morphTargets&&a.enable(6),b.morphNormals&&a.enable(7),b.morphColors&&a.enable(8),b.premultipliedAlpha&&a.enable(9),b.shadowMapEnabled&&a.enable(10),b.doubleSided&&a.enable(11),b.flipSided&&a.enable(12),b.useDepthPacking&&a.enable(13),b.dithering&&a.enable(14),b.transmission&&a.enable(15),b.sheen&&a.enable(16),b.opaque&&a.enable(17),b.pointsUvs&&a.enable(18),b.decodeVideoTexture&&a.enable(19),b.decodeVideoTextureEmissive&&a.enable(20),b.alphaToCoverage&&a.enable(21),M.push(a.mask)}(b,M),b.push(n.outputColorSpace)),b.push(M.customProgramCacheKey),b.join()},getUniforms:function v(M){const b=p[M.type];let P;return P=b?GZ.clone(no[b].uniforms):M.uniforms,P},acquireProgram:function C(M,b){let P;for(let W=0,$=u.length;W<$;W++){const J=u[W];if(J.cacheKey===b){P=J,++P.usedTimes;break}}return void 0===P&&(P=new See(n,b,M,s),u.push(P)),P},releaseProgram:function x(M){if(0===--M.usedTimes){const b=u.indexOf(M);u[b]=u[u.length-1],u.pop(),M.destroy()}},releaseShaderCache:function T(M){c.remove(M)},programs:u,dispose:function I(){c.dispose()}}}function Cee(){let n=new WeakMap;return{has:function e(o){return n.has(o)},get:function t(o){let a=n.get(o);return void 0===a&&(a={},n.set(o,a)),a},remove:function i(o){n.delete(o)},update:function r(o,a,c){n.get(o)[a]=c},dispose:function s(){n=new WeakMap}}}function Dee(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function AF(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function IF(){const n=[];let e=0;const t=[],i=[],r=[];function o(d,h,f,p,_,g){let m=n[e];return void 0===m?(m={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:_,group:g},n[e]=m):(m.id=d.id,m.object=d,m.geometry=h,m.material=f,m.groupOrder=p,m.renderOrder=d.renderOrder,m.z=_,m.group=g),e++,m}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function a(d,h,f,p,_,g){const m=o(d,h,f,p,_,g);f.transmission>0?i.push(m):!0===f.transparent?r.push(m):t.push(m)},unshift:function c(d,h,f,p,_,g){const m=o(d,h,f,p,_,g);f.transmission>0?i.unshift(m):!0===f.transparent?r.unshift(m):t.unshift(m)},finish:function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function l(d,h){t.length>1&&t.sort(d||Dee),i.length>1&&i.sort(h||AF),r.length>1&&r.sort(h||AF)}}}function Aee(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let o;return void 0===s?(o=new IF,n.set(i,[o])):r>=s.length?(o=new IF,s.push(o)):o=s[r],o},dispose:function t(){n=new WeakMap}}}function Iee(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new A,color:new Le};break;case"SpotLight":t={position:new A,direction:new A,color:new Le,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new A,color:new Le,distance:0,decay:0};break;case"HemisphereLight":t={direction:new A,skyColor:new Le,groundColor:new Le};break;case"RectAreaLight":t={color:new Le,position:new A,halfWidth:new A,halfHeight:new A}}return n[e.id]=t,t}}}let Pee=0;function Nee(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function Oee(n){const e=new Iee,t=function Ree(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)i.probe.push(new A);const r=new A,s=new Ct,o=new Ct;return{setup:function a(l){let u=0,d=0,h=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let f=0,p=0,_=0,g=0,m=0,y=0,E=0,v=0,C=0,x=0,T=0;l.sort(Nee);for(let M=0,b=l.length;M<b;M++){const P=l[M],W=P.color,$=P.intensity,J=P.distance,ce=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)u+=W.r*$,d+=W.g*$,h+=W.b*$;else if(P.isLightProbe){for(let L=0;L<9;L++)i.probe[L].addScaledVector(P.sh.coefficients[L],$);T++}else if(P.isDirectionalLight){const L=e.get(P);if(L.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const Y=P.shadow,B=t.get(P);B.shadowIntensity=Y.intensity,B.shadowBias=Y.bias,B.shadowNormalBias=Y.normalBias,B.shadowRadius=Y.radius,B.shadowMapSize=Y.mapSize,i.directionalShadow[f]=B,i.directionalShadowMap[f]=ce,i.directionalShadowMatrix[f]=P.shadow.matrix,y++}i.directional[f]=L,f++}else if(P.isSpotLight){const L=e.get(P);L.position.setFromMatrixPosition(P.matrixWorld),L.color.copy(W).multiplyScalar($),L.distance=J,L.coneCos=Math.cos(P.angle),L.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),L.decay=P.decay,i.spot[_]=L;const Y=P.shadow;if(P.map&&(i.spotLightMap[C]=P.map,C++,Y.updateMatrices(P),P.castShadow&&x++),i.spotLightMatrix[_]=Y.matrix,P.castShadow){const B=t.get(P);B.shadowIntensity=Y.intensity,B.shadowBias=Y.bias,B.shadowNormalBias=Y.normalBias,B.shadowRadius=Y.radius,B.shadowMapSize=Y.mapSize,i.spotShadow[_]=B,i.spotShadowMap[_]=ce,v++}_++}else if(P.isRectAreaLight){const L=e.get(P);L.color.copy(W).multiplyScalar($),L.halfWidth.set(.5*P.width,0,0),L.halfHeight.set(0,.5*P.height,0),i.rectArea[g]=L,g++}else if(P.isPointLight){const L=e.get(P);if(L.color.copy(P.color).multiplyScalar(P.intensity),L.distance=P.distance,L.decay=P.decay,P.castShadow){const Y=P.shadow,B=t.get(P);B.shadowIntensity=Y.intensity,B.shadowBias=Y.bias,B.shadowNormalBias=Y.normalBias,B.shadowRadius=Y.radius,B.shadowMapSize=Y.mapSize,B.shadowCameraNear=Y.camera.near,B.shadowCameraFar=Y.camera.far,i.pointShadow[p]=B,i.pointShadowMap[p]=ce,i.pointShadowMatrix[p]=P.shadow.matrix,E++}i.point[p]=L,p++}else if(P.isHemisphereLight){const L=e.get(P);L.skyColor.copy(P.color).multiplyScalar($),L.groundColor.copy(P.groundColor).multiplyScalar($),i.hemi[m]=L,m++}}g>0&&(!0===n.has("OES_texture_float_linear")?(i.rectAreaLTC1=Ce.LTC_FLOAT_1,i.rectAreaLTC2=Ce.LTC_FLOAT_2):(i.rectAreaLTC1=Ce.LTC_HALF_1,i.rectAreaLTC2=Ce.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=d,i.ambient[2]=h;const I=i.hash;(I.directionalLength!==f||I.pointLength!==p||I.spotLength!==_||I.rectAreaLength!==g||I.hemiLength!==m||I.numDirectionalShadows!==y||I.numPointShadows!==E||I.numSpotShadows!==v||I.numSpotMaps!==C||I.numLightProbes!==T)&&(i.directional.length=f,i.spot.length=_,i.rectArea.length=g,i.point.length=p,i.hemi.length=m,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=E,i.pointShadowMap.length=E,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=E,i.spotLightMatrix.length=v+C-x,i.spotLightMap.length=C,i.numSpotLightShadowsWithMaps=x,i.numLightProbes=T,I.directionalLength=f,I.pointLength=p,I.spotLength=_,I.rectAreaLength=g,I.hemiLength=m,I.numDirectionalShadows=y,I.numPointShadows=E,I.numSpotShadows=v,I.numSpotMaps=C,I.numLightProbes=T,i.version=Pee++)},setupView:function c(l,u){let d=0,h=0,f=0,p=0,_=0;const g=u.matrixWorldInverse;for(let m=0,y=l.length;m<y;m++){const E=l[m];if(E.isDirectionalLight){const v=i.directional[d];v.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),v.direction.sub(r),v.direction.transformDirection(g),d++}else if(E.isSpotLight){const v=i.spot[f];v.position.setFromMatrixPosition(E.matrixWorld),v.position.applyMatrix4(g),v.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),v.direction.sub(r),v.direction.transformDirection(g),f++}else if(E.isRectAreaLight){const v=i.rectArea[p];v.position.setFromMatrixPosition(E.matrixWorld),v.position.applyMatrix4(g),o.identity(),s.copy(E.matrixWorld),s.premultiply(g),o.extractRotation(s),v.halfWidth.set(.5*E.width,0,0),v.halfHeight.set(0,.5*E.height,0),v.halfWidth.applyMatrix4(o),v.halfHeight.applyMatrix4(o),p++}else if(E.isPointLight){const v=i.point[h];v.position.setFromMatrixPosition(E.matrixWorld),v.position.applyMatrix4(g),h++}else if(E.isHemisphereLight){const v=i.hemi[_];v.direction.setFromMatrixPosition(E.matrixWorld),v.direction.transformDirection(g),_++}}},state:i}}function RF(n){const e=new Oee(n),t=[],i=[],l={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function r(u){l.camera=u,t.length=0,i.length=0},state:l,setupLights:function a(){e.setup(t)},setupLightsView:function c(u){e.setupView(t,u)},pushLight:function s(u){t.push(u)},pushShadow:function o(u){i.push(u)}}}function Lee(n){let e=new WeakMap;return{get:function t(r,s=0){const o=e.get(r);let a;return void 0===o?(a=new RF(n),e.set(r,[a])):s>=o.length?(a=new RF(n),o.push(a)):a=o[s],a},dispose:function i(){e=new WeakMap}}}class PF extends _r{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class NF extends _r{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Uee(n,e,t){let i=new R_;const r=new ie,s=new ie,o=new gn,a=new PF({depthPacking:3201}),c=new NF,l={},u=t.maxTextureSize,d={[Ra]:1,[Pr]:0,[Lo]:2},h=new to({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ie},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new Jt;p.setAttribute("position",new kn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new ei(p,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let m=this.type;function y(x,T){const I=e.update(_);h.defines.VSM_SAMPLES!==x.blurSamples&&(h.defines.VSM_SAMPLES=x.blurSamples,f.defines.VSM_SAMPLES=x.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===x.mapPass&&(x.mapPass=new eo(r.x,r.y)),h.uniforms.shadow_pass.value=x.map.texture,h.uniforms.resolution.value=x.mapSize,h.uniforms.radius.value=x.radius,n.setRenderTarget(x.mapPass),n.clear(),n.renderBufferDirect(T,null,I,h,_,null),f.uniforms.shadow_pass.value=x.mapPass.texture,f.uniforms.resolution.value=x.mapSize,f.uniforms.radius.value=x.radius,n.setRenderTarget(x.map),n.clear(),n.renderBufferDirect(T,null,I,f,_,null)}function E(x,T,I,M){let b=null;const P=!0===I.isPointLight?x.customDistanceMaterial:x.customDepthMaterial;if(void 0!==P)b=P;else if(b=!0===I.isPointLight?c:a,n.localClippingEnabled&&!0===T.clipShadows&&Array.isArray(T.clippingPlanes)&&0!==T.clippingPlanes.length||T.displacementMap&&0!==T.displacementScale||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const W=b.uuid,$=T.uuid;let J=l[W];void 0===J&&(J={},l[W]=J);let ce=J[$];void 0===ce&&(ce=b.clone(),J[$]=ce,T.addEventListener("dispose",C)),b=ce}return b.visible=T.visible,b.wireframe=T.wireframe,b.side=3===M?null!==T.shadowSide?T.shadowSide:T.side:null!==T.shadowSide?T.shadowSide:d[T.side],b.alphaMap=T.alphaMap,b.alphaTest=T.alphaTest,b.map=T.map,b.clipShadows=T.clipShadows,b.clippingPlanes=T.clippingPlanes,b.clipIntersection=T.clipIntersection,b.displacementMap=T.displacementMap,b.displacementScale=T.displacementScale,b.displacementBias=T.displacementBias,b.wireframeLinewidth=T.wireframeLinewidth,b.linewidth=T.linewidth,!0===I.isPointLight&&!0===b.isMeshDistanceMaterial&&(n.properties.get(b).light=I),b}function v(x,T,I,M,b){if(!1===x.visible)return;if(x.layers.test(T.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&3===b)&&(!x.frustumCulled||i.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,x.matrixWorld);const $=e.update(x),J=x.material;if(Array.isArray(J)){const ce=$.groups;for(let L=0,Y=ce.length;L<Y;L++){const B=ce[L],ae=J[B.materialIndex];if(ae&&ae.visible){const ve=E(x,ae,M,b);x.onBeforeShadow(n,x,T,I,$,ve,B),n.renderBufferDirect(I,null,$,ve,x,B),x.onAfterShadow(n,x,T,I,$,ve,B)}}}else if(J.visible){const ce=E(x,J,M,b);x.onBeforeShadow(n,x,T,I,$,ce,null),n.renderBufferDirect(I,null,$,ce,x,null),x.onAfterShadow(n,x,T,I,$,ce,null)}}const W=x.children;for(let $=0,J=W.length;$<J;$++)v(W[$],T,I,M,b)}function C(x){x.target.removeEventListener("dispose",C);for(const I in l){const M=l[I],b=x.target.uuid;b in M&&(M[b].dispose(),delete M[b])}}this.render=function(x,T,I){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===x.length)return;const M=n.getRenderTarget(),b=n.getActiveCubeFace(),P=n.getActiveMipmapLevel(),W=n.state;W.setBlending(0),W.buffers.color.setClear(1,1,1,1),W.buffers.depth.setTest(!0),W.setScissorTest(!1);const $=3!==m&&3===this.type,J=3===m&&3!==this.type;for(let ce=0,L=x.length;ce<L;ce++){const Y=x[ce],B=Y.shadow;if(void 0===B){console.warn("THREE.WebGLShadowMap:",Y,"has no shadow.");continue}if(!1===B.autoUpdate&&!1===B.needsUpdate)continue;r.copy(B.mapSize);const ae=B.getFrameExtents();if(r.multiply(ae),s.copy(B.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/ae.x),r.x=s.x*ae.x,B.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/ae.y),r.y=s.y*ae.y,B.mapSize.y=s.y)),null===B.map||!0===$||!0===J){const De=3!==this.type?{minFilter:Zi,magFilter:Zi}:{};null!==B.map&&B.map.dispose(),B.map=new eo(r.x,r.y,De),B.map.texture.name=Y.name+".shadowMap",B.camera.updateProjectionMatrix()}n.setRenderTarget(B.map),n.clear();const ve=B.getViewportCount();for(let De=0;De<ve;De++){const ot=B.getViewport(De);o.set(s.x*ot.x,s.y*ot.y,s.x*ot.z,s.y*ot.w),W.viewport(o),B.updateMatrices(Y,De),i=B.getFrustum(),v(T,I,B.camera,Y,this.type)}!0!==B.isPointLightShadow&&3===this.type&&y(B,I),B.needsUpdate=!1}m=this.type,g.needsUpdate=!1,n.setRenderTarget(M,b,P)}}const Bee={[kS]:1,[BS]:6,[VS]:7,[Lu]:5,[US]:0,[HS]:2,[GS]:4,[zS]:3};function Vee(n,e){const s=new function t(){let F=!1;const Ie=new gn;let Q=null;const le=new gn(0,0,0,0);return{setMask:function(Fe){Q!==Fe&&!F&&(n.colorMask(Fe,Fe,Fe,Fe),Q=Fe)},setLocked:function(Fe){F=Fe},setClear:function(Fe,Pe,Xt,hi,tr){!0===tr&&(Fe*=hi,Pe*=hi,Xt*=hi),Ie.set(Fe,Pe,Xt,hi),!1===le.equals(Ie)&&(n.clearColor(Fe,Pe,Xt,hi),le.copy(Ie))},reset:function(){F=!1,Q=null,le.set(-1,0,0,0)}}},o=new function i(){let F=!1,Ie=!1,Q=null,le=null,Fe=null;return{setReversed:function(Pe){if(Ie!==Pe){const Xt=e.get("EXT_clip_control");Xt.clipControlEXT(Xt.LOWER_LEFT_EXT,Ie?Xt.ZERO_TO_ONE_EXT:Xt.NEGATIVE_ONE_TO_ONE_EXT);const hi=Fe;Fe=null,this.setClear(hi)}Ie=Pe},getReversed:function(){return Ie},setTest:function(Pe){Pe?fe(n.DEPTH_TEST):qe(n.DEPTH_TEST)},setMask:function(Pe){Q!==Pe&&!F&&(n.depthMask(Pe),Q=Pe)},setFunc:function(Pe){if(Ie&&(Pe=Bee[Pe]),le!==Pe){switch(Pe){case 0:n.depthFunc(n.NEVER);break;case 1:n.depthFunc(n.ALWAYS);break;case 2:n.depthFunc(n.LESS);break;case 3:default:n.depthFunc(n.LEQUAL);break;case 4:n.depthFunc(n.EQUAL);break;case 5:n.depthFunc(n.GEQUAL);break;case 6:n.depthFunc(n.GREATER);break;case 7:n.depthFunc(n.NOTEQUAL)}le=Pe}},setLocked:function(Pe){F=Pe},setClear:function(Pe){Fe!==Pe&&(Ie&&(Pe=1-Pe),n.clearDepth(Pe),Fe=Pe)},reset:function(){F=!1,Q=null,le=null,Fe=null,Ie=!1}}},a=new function r(){let F=!1,Ie=null,Q=null,le=null,Fe=null,Pe=null,Xt=null,hi=null,tr=null;return{setTest:function(wn){F||(wn?fe(n.STENCIL_TEST):qe(n.STENCIL_TEST))},setMask:function(wn){Ie!==wn&&!F&&(n.stencilMask(wn),Ie=wn)},setFunc:function(wn,Bs,ia){(Q!==wn||le!==Bs||Fe!==ia)&&(n.stencilFunc(wn,Bs,ia),Q=wn,le=Bs,Fe=ia)},setOp:function(wn,Bs,ia){(Pe!==wn||Xt!==Bs||hi!==ia)&&(n.stencilOp(wn,Bs,ia),Pe=wn,Xt=Bs,hi=ia)},setLocked:function(wn){F=wn},setClear:function(wn){tr!==wn&&(n.clearStencil(wn),tr=wn)},reset:function(){F=!1,Ie=null,Q=null,le=null,Fe=null,Pe=null,Xt=null,hi=null,tr=null}}},c=new WeakMap,l=new WeakMap;let u={},d={},h=new WeakMap,f=[],p=null,_=!1,g=null,m=null,y=null,E=null,v=null,C=null,x=null,T=new Le(0,0,0),I=0,M=!1,b=null,P=null,W=null,$=null,J=null;const ce=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let L=!1,Y=0;const B=n.getParameter(n.VERSION);-1!==B.indexOf("WebGL")?(Y=parseFloat(/^WebGL (\d)/.exec(B)[1]),L=Y>=1):-1!==B.indexOf("OpenGL ES")&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),L=Y>=2);let ae=null,ve={};const De=n.getParameter(n.SCISSOR_BOX),ot=n.getParameter(n.VIEWPORT),tn=(new gn).fromArray(De),K=(new gn).fromArray(ot);function Ee(F,Ie,Q,le){const Fe=new Uint8Array(4),Pe=n.createTexture();n.bindTexture(F,Pe),n.texParameteri(F,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(F,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Xt=0;Xt<Q;Xt++)F===n.TEXTURE_3D||F===n.TEXTURE_2D_ARRAY?n.texImage3D(Ie,0,n.RGBA,1,1,le,0,n.RGBA,n.UNSIGNED_BYTE,Fe):n.texImage2D(Ie+Xt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Fe);return Pe}const Ge={};function fe(F){!0!==u[F]&&(n.enable(F),u[F]=!0)}function qe(F){!1!==u[F]&&(n.disable(F),u[F]=!1)}Ge[n.TEXTURE_2D]=Ee(n.TEXTURE_2D,n.TEXTURE_2D,1),Ge[n.TEXTURE_CUBE_MAP]=Ee(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ge[n.TEXTURE_2D_ARRAY]=Ee(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Ge[n.TEXTURE_3D]=Ee(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),fe(n.DEPTH_TEST),o.setFunc(3),me(!1),ze(1),fe(n.CULL_FACE),R(0);const ue={[Gc]:n.FUNC_ADD,[EY]:n.FUNC_SUBTRACT,[bY]:n.FUNC_REVERSE_SUBTRACT};ue[103]=n.MIN,ue[104]=n.MAX;const be={[wY]:n.ZERO,[xY]:n.ONE,[TY]:n.SRC_COLOR,[LS]:n.SRC_ALPHA,[PY]:n.SRC_ALPHA_SATURATE,[IY]:n.DST_COLOR,[DY]:n.DST_ALPHA,[CY]:n.ONE_MINUS_SRC_COLOR,[FS]:n.ONE_MINUS_SRC_ALPHA,[RY]:n.ONE_MINUS_DST_COLOR,[AY]:n.ONE_MINUS_DST_ALPHA,[NY]:n.CONSTANT_COLOR,[OY]:n.ONE_MINUS_CONSTANT_COLOR,[LY]:n.CONSTANT_ALPHA,[FY]:n.ONE_MINUS_CONSTANT_ALPHA};function R(F,Ie,Q,le,Fe,Pe,Xt,hi,tr,wn){if(0!==F){if(!1===_&&(fe(n.BLEND),_=!0),5===F)Fe=Fe||Ie,Pe=Pe||Q,Xt=Xt||le,(Ie!==m||Fe!==v)&&(n.blendEquationSeparate(ue[Ie],ue[Fe]),m=Ie,v=Fe),(Q!==y||le!==E||Pe!==C||Xt!==x)&&(n.blendFuncSeparate(be[Q],be[le],be[Pe],be[Xt]),y=Q,E=le,C=Pe,x=Xt),(!1===hi.equals(T)||tr!==I)&&(n.blendColor(hi.r,hi.g,hi.b,tr),T.copy(hi),I=tr),g=F,M=!1;else if(F!==g||wn!==M){if((100!==m||100!==v)&&(n.blendEquation(n.FUNC_ADD),m=100,v=100),wn)switch(F){case 1:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.ONE,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",F)}else switch(F){case 1:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",F)}y=null,E=null,C=null,x=null,T.set(0,0,0),I=0,g=F,M=wn}}else!0===_&&(qe(n.BLEND),_=!1)}function me(F){b!==F&&(n.frontFace(F?n.CW:n.CCW),b=F)}function ze(F){0!==F?(fe(n.CULL_FACE),F!==P&&n.cullFace(1===F?n.BACK:2===F?n.FRONT:n.FRONT_AND_BACK)):qe(n.CULL_FACE),P=F}function Mt(F,Ie,Q){F?(fe(n.POLYGON_OFFSET_FILL),($!==Ie||J!==Q)&&(n.polygonOffset(Ie,Q),$=Ie,J=Q)):qe(n.POLYGON_OFFSET_FILL)}return{buffers:{color:s,depth:o,stencil:a},enable:fe,disable:qe,bindFramebuffer:function Ke(F,Ie){return d[F]!==Ie&&(n.bindFramebuffer(F,Ie),d[F]=Ie,F===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=Ie),F===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=Ie),!0)},drawBuffers:function gt(F,Ie){let Q=f,le=!1;if(F){Q=h.get(Ie),void 0===Q&&(Q=[],h.set(Ie,Q));const Fe=F.textures;if(Q.length!==Fe.length||Q[0]!==n.COLOR_ATTACHMENT0){for(let Pe=0,Xt=Fe.length;Pe<Xt;Pe++)Q[Pe]=n.COLOR_ATTACHMENT0+Pe;Q.length=Fe.length,le=!0}}else Q[0]!==n.BACK&&(Q[0]=n.BACK,le=!0);le&&n.drawBuffers(Q)},useProgram:function nn(F){return p!==F&&(n.useProgram(F),p=F,!0)},setBlending:R,setMaterial:function tt(F,Ie){2===F.side?qe(n.CULL_FACE):fe(n.CULL_FACE);let Q=1===F.side;Ie&&(Q=!Q),me(Q),1===F.blending&&!1===F.transparent?R(0):R(F.blending,F.blendEquation,F.blendSrc,F.blendDst,F.blendEquationAlpha,F.blendSrcAlpha,F.blendDstAlpha,F.blendColor,F.blendAlpha,F.premultipliedAlpha),o.setFunc(F.depthFunc),o.setTest(F.depthTest),o.setMask(F.depthWrite),s.setMask(F.colorWrite);const le=F.stencilWrite;a.setTest(le),le&&(a.setMask(F.stencilWriteMask),a.setFunc(F.stencilFunc,F.stencilRef,F.stencilFuncMask),a.setOp(F.stencilFail,F.stencilZFail,F.stencilZPass)),Mt(F.polygonOffset,F.polygonOffsetFactor,F.polygonOffsetUnits),!0===F.alphaToCoverage?fe(n.SAMPLE_ALPHA_TO_COVERAGE):qe(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:me,setCullFace:ze,setLineWidth:function xe(F){F!==W&&(L&&n.lineWidth(F),W=F)},setPolygonOffset:Mt,setScissorTest:function Be(F){F?fe(n.SCISSOR_TEST):qe(n.SCISSOR_TEST)},activeTexture:function D(F){void 0===F&&(F=n.TEXTURE0+ce-1),ae!==F&&(n.activeTexture(F),ae=F)},bindTexture:function S(F,Ie,Q){void 0===Q&&(Q=null===ae?n.TEXTURE0+ce-1:ae);let le=ve[Q];void 0===le&&(le={type:void 0,texture:void 0},ve[Q]=le),(le.type!==F||le.texture!==Ie)&&(ae!==Q&&(n.activeTexture(Q),ae=Q),n.bindTexture(F,Ie||Ge[F]),le.type=F,le.texture=Ie)},unbindTexture:function j(){const F=ve[ae];void 0!==F&&void 0!==F.type&&(n.bindTexture(F.type,null),F.type=void 0,F.texture=void 0)},compressedTexImage2D:function re(){try{n.compressedTexImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},compressedTexImage3D:function he(){try{n.compressedTexImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texImage2D:function je(){try{n.texImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texImage3D:function wt(){try{n.texImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},updateUBOMapping:function un(F,Ie){let Q=l.get(Ie);void 0===Q&&(Q=new WeakMap,l.set(Ie,Q));let le=Q.get(F);void 0===le&&(le=n.getUniformBlockIndex(Ie,F.name),Q.set(F,le))},uniformBlockBinding:function en(F,Ie){const le=l.get(Ie).get(F);c.get(Ie)!==le&&(n.uniformBlockBinding(Ie,le,F.__bindingPointIndex),c.set(Ie,le))},texStorage2D:function sn(){try{n.texStorage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texStorage3D:function _e(){try{n.texStorage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texSubImage2D:function se(){try{n.texSubImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texSubImage3D:function Je(){try{n.texSubImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},compressedTexSubImage2D:function Ae(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},compressedTexSubImage3D:function Ve(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},scissor:function Ot(F){!1===tn.equals(F)&&(n.scissor(F.x,F.y,F.z,F.w),tn.copy(F))},viewport:function $e(F){!1===K.equals(F)&&(n.viewport(F.x,F.y,F.z,F.w),K.copy(F))},reset:function Hn(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},ae=null,ve={},d={},h=new WeakMap,f=[],p=null,_=!1,g=null,m=null,y=null,E=null,v=null,C=null,x=null,T=new Le(0,0,0),I=0,M=!1,b=null,P=null,W=null,$=null,J=null,tn.set(0,0,n.canvas.width,n.canvas.height),K.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}}}function sw(n,e,t,i){const r=function jee(n){switch(n){case ko:case 1010:return{byteLength:1,components:1};case lf:case 1011:case uf:return{byteLength:2,components:1};case 1017:case 1018:return{byteLength:2,components:4};case La:case 1013:case Kr:return{byteLength:4,components:1};case 35902:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}(i);switch(t){case 1021:case 1024:return n*e;case 1025:return n*e*2;case 1028:case 1029:return n*e/r.components*r.byteLength;case 1030:case 1031:return n*e*2/r.components*r.byteLength;case 1022:return n*e*3/r.components*r.byteLength;case Nr:case 1033:return n*e*4/r.components*r.byteLength;case i_:case r_:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case s_:case o_:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case 35841:case 35843:return Math.max(n,16)*Math.max(e,8)/4;case 35840:case 35842:return Math.max(n,8)*Math.max(e,8)/2;case 36196:case 37492:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case 37496:case 37808:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case 37809:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case 37810:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case 37811:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case 37812:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case 37813:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case 37814:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case 37815:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case 37816:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case 37817:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case 37818:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case 37819:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case 37820:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case 37821:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case a_:case 36494:case 36495:return Math.ceil(n/4)*Math.ceil(e/4)*16;case 36283:case 36284:return Math.ceil(n/4)*Math.ceil(e/4)*8;case 36285:case 36286:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function $ee(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),l=new ie,u=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function p(D,S){return f?new OffscreenCanvas(D,S):hf("canvas")}function _(D,S,j){let re=1;const he=Be(D);if((he.width>j||he.height>j)&&(re=j/Math.max(he.width,he.height)),re<1){if(typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&D instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&D instanceof ImageBitmap||typeof VideoFrame<"u"&&D instanceof VideoFrame){const se=Math.floor(re*he.width),Je=Math.floor(re*he.height);void 0===d&&(d=p(se,Je));const Ae=S?p(se,Je):d;return Ae.width=se,Ae.height=Je,Ae.getContext("2d").drawImage(D,0,0,se,Je),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+he.width+"x"+he.height+") to ("+se+"x"+Je+")."),Ae}return"data"in D&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+he.width+"x"+he.height+")."),D}return D}function g(D){return D.generateMipmaps}function m(D){n.generateMipmap(D)}function y(D){return D.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:D.isWebGL3DRenderTarget?n.TEXTURE_3D:D.isWebGLArrayRenderTarget||D.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function E(D,S,j,re,he=!1){if(null!==D){if(void 0!==n[D])return n[D];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+D+"'")}let se=S;if(S===n.RED&&(j===n.FLOAT&&(se=n.R32F),j===n.HALF_FLOAT&&(se=n.R16F),j===n.UNSIGNED_BYTE&&(se=n.R8)),S===n.RED_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.R8UI),j===n.UNSIGNED_SHORT&&(se=n.R16UI),j===n.UNSIGNED_INT&&(se=n.R32UI),j===n.BYTE&&(se=n.R8I),j===n.SHORT&&(se=n.R16I),j===n.INT&&(se=n.R32I)),S===n.RG&&(j===n.FLOAT&&(se=n.RG32F),j===n.HALF_FLOAT&&(se=n.RG16F),j===n.UNSIGNED_BYTE&&(se=n.RG8)),S===n.RG_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.RG8UI),j===n.UNSIGNED_SHORT&&(se=n.RG16UI),j===n.UNSIGNED_INT&&(se=n.RG32UI),j===n.BYTE&&(se=n.RG8I),j===n.SHORT&&(se=n.RG16I),j===n.INT&&(se=n.RG32I)),S===n.RGB_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.RGB8UI),j===n.UNSIGNED_SHORT&&(se=n.RGB16UI),j===n.UNSIGNED_INT&&(se=n.RGB32UI),j===n.BYTE&&(se=n.RGB8I),j===n.SHORT&&(se=n.RGB16I),j===n.INT&&(se=n.RGB32I)),S===n.RGBA_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.RGBA8UI),j===n.UNSIGNED_SHORT&&(se=n.RGBA16UI),j===n.UNSIGNED_INT&&(se=n.RGBA32UI),j===n.BYTE&&(se=n.RGBA8I),j===n.SHORT&&(se=n.RGBA16I),j===n.INT&&(se=n.RGBA32I)),S===n.RGB&&j===n.UNSIGNED_INT_5_9_9_9_REV&&(se=n.RGB9_E5),S===n.RGBA){const Je=he?u_:ln.getTransfer(re);j===n.FLOAT&&(se=n.RGBA32F),j===n.HALF_FLOAT&&(se=n.RGBA16F),j===n.UNSIGNED_BYTE&&(se=Je===An?n.SRGB8_ALPHA8:n.RGBA8),j===n.UNSIGNED_SHORT_4_4_4_4&&(se=n.RGBA4),j===n.UNSIGNED_SHORT_5_5_5_1&&(se=n.RGB5_A1)}return(se===n.R16F||se===n.R32F||se===n.RG16F||se===n.RG32F||se===n.RGBA16F||se===n.RGBA32F)&&e.get("EXT_color_buffer_float"),se}function v(D,S){let j;return D?null===S||S===La||S===Fu?j=n.DEPTH24_STENCIL8:S===Kr?j=n.DEPTH32F_STENCIL8:S===lf&&(j=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===S||S===La||S===Fu?j=n.DEPTH_COMPONENT24:S===Kr?j=n.DEPTH_COMPONENT32F:S===lf&&(j=n.DEPTH_COMPONENT16),j}function C(D,S){return!0===g(D)||D.isFramebufferTexture&&D.minFilter!==Zi&&D.minFilter!==ki?Math.log2(Math.max(S.width,S.height))+1:void 0!==D.mipmaps&&D.mipmaps.length>0?D.mipmaps.length:D.isCompressedTexture&&Array.isArray(D.image)?S.mipmaps.length:1}function x(D){const S=D.target;S.removeEventListener("dispose",x),function I(D){const S=i.get(D);if(void 0===S.__webglInit)return;const j=D.source,re=h.get(j);if(re){const he=re[S.__cacheKey];he.usedTimes--,0===he.usedTimes&&M(D),0===Object.keys(re).length&&h.delete(j)}i.remove(D)}(S),S.isVideoTexture&&u.delete(S)}function T(D){const S=D.target;S.removeEventListener("dispose",T),function b(D){const S=i.get(D);if(D.depthTexture&&(D.depthTexture.dispose(),i.remove(D.depthTexture)),D.isWebGLCubeRenderTarget)for(let re=0;re<6;re++){if(Array.isArray(S.__webglFramebuffer[re]))for(let he=0;he<S.__webglFramebuffer[re].length;he++)n.deleteFramebuffer(S.__webglFramebuffer[re][he]);else n.deleteFramebuffer(S.__webglFramebuffer[re]);S.__webglDepthbuffer&&n.deleteRenderbuffer(S.__webglDepthbuffer[re])}else{if(Array.isArray(S.__webglFramebuffer))for(let re=0;re<S.__webglFramebuffer.length;re++)n.deleteFramebuffer(S.__webglFramebuffer[re]);else n.deleteFramebuffer(S.__webglFramebuffer);if(S.__webglDepthbuffer&&n.deleteRenderbuffer(S.__webglDepthbuffer),S.__webglMultisampledFramebuffer&&n.deleteFramebuffer(S.__webglMultisampledFramebuffer),S.__webglColorRenderbuffer)for(let re=0;re<S.__webglColorRenderbuffer.length;re++)S.__webglColorRenderbuffer[re]&&n.deleteRenderbuffer(S.__webglColorRenderbuffer[re]);S.__webglDepthRenderbuffer&&n.deleteRenderbuffer(S.__webglDepthRenderbuffer)}const j=D.textures;for(let re=0,he=j.length;re<he;re++){const se=i.get(j[re]);se.__webglTexture&&(n.deleteTexture(se.__webglTexture),o.memory.textures--),i.remove(j[re])}i.remove(D)}(S)}function M(D){const S=i.get(D);n.deleteTexture(S.__webglTexture),delete h.get(D.source)[S.__cacheKey],o.memory.textures--}let P=0;function ce(D,S){const j=i.get(D);if(D.isVideoTexture&&function xe(D){const S=o.render.frame;u.get(D)!==S&&(u.set(D,S),D.update())}(D),!1===D.isRenderTargetTexture&&D.version>0&&j.__version!==D.version){const re=D.image;if(null===re)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==re.complete)return void K(j,D,S);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(n.TEXTURE_2D,j.__webglTexture,n.TEXTURE0+S)}const ae={[Qg]:n.REPEAT,[Is]:n.CLAMP_TO_EDGE,[e_]:n.MIRRORED_REPEAT},ve={[Zi]:n.NEAREST,[mL]:n.NEAREST_MIPMAP_NEAREST,[cf]:n.NEAREST_MIPMAP_LINEAR,[ki]:n.LINEAR,[t_]:n.LINEAR_MIPMAP_NEAREST,[Fo]:n.LINEAR_MIPMAP_LINEAR},De={[JY]:n.NEVER,[rZ]:n.ALWAYS,[QY]:n.LESS,[CL]:n.LEQUAL,[eZ]:n.EQUAL,[iZ]:n.GEQUAL,[tZ]:n.GREATER,[nZ]:n.NOTEQUAL};function ot(D,S){if(S.type===Kr&&!1===e.has("OES_texture_float_linear")&&(S.magFilter===ki||1007===S.magFilter||1005===S.magFilter||S.magFilter===Fo||S.minFilter===ki||1007===S.minFilter||1005===S.minFilter||S.minFilter===Fo)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(D,n.TEXTURE_WRAP_S,ae[S.wrapS]),n.texParameteri(D,n.TEXTURE_WRAP_T,ae[S.wrapT]),(D===n.TEXTURE_3D||D===n.TEXTURE_2D_ARRAY)&&n.texParameteri(D,n.TEXTURE_WRAP_R,ae[S.wrapR]),n.texParameteri(D,n.TEXTURE_MAG_FILTER,ve[S.magFilter]),n.texParameteri(D,n.TEXTURE_MIN_FILTER,ve[S.minFilter]),S.compareFunction&&(n.texParameteri(D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(D,n.TEXTURE_COMPARE_FUNC,De[S.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(S.magFilter===Zi||1005!==S.minFilter&&S.minFilter!==Fo||S.type===Kr&&!1===e.has("OES_texture_float_linear"))return;if(S.anisotropy>1||i.get(S).__currentAnisotropy){const j=e.get("EXT_texture_filter_anisotropic");n.texParameterf(D,j.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(S.anisotropy,r.getMaxAnisotropy())),i.get(S).__currentAnisotropy=S.anisotropy}}}function tn(D,S){let j=!1;void 0===D.__webglInit&&(D.__webglInit=!0,S.addEventListener("dispose",x));const re=S.source;let he=h.get(re);void 0===he&&(he={},h.set(re,he));const se=function J(D){const S=[];return S.push(D.wrapS),S.push(D.wrapT),S.push(D.wrapR||0),S.push(D.magFilter),S.push(D.minFilter),S.push(D.anisotropy),S.push(D.internalFormat),S.push(D.format),S.push(D.type),S.push(D.generateMipmaps),S.push(D.premultiplyAlpha),S.push(D.flipY),S.push(D.unpackAlignment),S.push(D.colorSpace),S.join()}(S);if(se!==D.__cacheKey){void 0===he[se]&&(he[se]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,j=!0),he[se].usedTimes++;const Je=he[D.__cacheKey];void 0!==Je&&(he[D.__cacheKey].usedTimes--,0===Je.usedTimes&&M(S)),D.__cacheKey=se,D.__webglTexture=he[se].texture}return j}function K(D,S,j){let re=n.TEXTURE_2D;(S.isDataArrayTexture||S.isCompressedArrayTexture)&&(re=n.TEXTURE_2D_ARRAY),S.isData3DTexture&&(re=n.TEXTURE_3D);const he=tn(D,S),se=S.source;t.bindTexture(re,D.__webglTexture,n.TEXTURE0+j);const Je=i.get(se);if(se.version!==Je.__version||!0===he){t.activeTexture(n.TEXTURE0+j);const Ae=ln.getPrimaries(ln.workingColorSpace),Ve=""===S.colorSpace?null:ln.getPrimaries(S.colorSpace),sn=""===S.colorSpace||Ae===Ve?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,S.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,S.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,S.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,sn);let _e=_(S.image,!1,r.maxTextureSize);_e=Mt(S,_e);const je=s.convert(S.format,S.colorSpace),wt=s.convert(S.type);let $e,Ot=E(S.internalFormat,je,wt,S.colorSpace,S.isVideoTexture);ot(re,S);const un=S.mipmaps,en=!0!==S.isVideoTexture,Hn=void 0===Je.__version||!0===he,F=se.dataReady,Ie=C(S,_e);if(S.isDepthTexture)Ot=v(S.format===Uu,S.type),Hn&&(en?t.texStorage2D(n.TEXTURE_2D,1,Ot,_e.width,_e.height):t.texImage2D(n.TEXTURE_2D,0,Ot,_e.width,_e.height,0,je,wt,null));else if(S.isDataTexture)if(un.length>0){en&&Hn&&t.texStorage2D(n.TEXTURE_2D,Ie,Ot,un[0].width,un[0].height);for(let Q=0,le=un.length;Q<le;Q++)$e=un[Q],en?F&&t.texSubImage2D(n.TEXTURE_2D,Q,0,0,$e.width,$e.height,je,wt,$e.data):t.texImage2D(n.TEXTURE_2D,Q,Ot,$e.width,$e.height,0,je,wt,$e.data);S.generateMipmaps=!1}else en?(Hn&&t.texStorage2D(n.TEXTURE_2D,Ie,Ot,_e.width,_e.height),F&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,_e.width,_e.height,je,wt,_e.data)):t.texImage2D(n.TEXTURE_2D,0,Ot,_e.width,_e.height,0,je,wt,_e.data);else if(S.isCompressedTexture)if(S.isCompressedArrayTexture){en&&Hn&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ie,Ot,un[0].width,un[0].height,_e.depth);for(let Q=0,le=un.length;Q<le;Q++)if($e=un[Q],S.format!==Nr)if(null!==je)if(en){if(F)if(S.layerUpdates.size>0){const Fe=sw($e.width,$e.height,S.format,S.type);for(const Pe of S.layerUpdates){const Xt=$e.data.subarray(Pe*Fe/$e.data.BYTES_PER_ELEMENT,(Pe+1)*Fe/$e.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Q,0,0,Pe,$e.width,$e.height,1,je,Xt)}S.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Q,0,0,0,$e.width,$e.height,_e.depth,je,$e.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Q,Ot,$e.width,$e.height,_e.depth,0,$e.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else en?F&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Q,0,0,0,$e.width,$e.height,_e.depth,je,wt,$e.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Q,Ot,$e.width,$e.height,_e.depth,0,je,wt,$e.data)}else{en&&Hn&&t.texStorage2D(n.TEXTURE_2D,Ie,Ot,un[0].width,un[0].height);for(let Q=0,le=un.length;Q<le;Q++)$e=un[Q],S.format!==Nr?null!==je?en?F&&t.compressedTexSubImage2D(n.TEXTURE_2D,Q,0,0,$e.width,$e.height,je,$e.data):t.compressedTexImage2D(n.TEXTURE_2D,Q,Ot,$e.width,$e.height,0,$e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):en?F&&t.texSubImage2D(n.TEXTURE_2D,Q,0,0,$e.width,$e.height,je,wt,$e.data):t.texImage2D(n.TEXTURE_2D,Q,Ot,$e.width,$e.height,0,je,wt,$e.data)}else if(S.isDataArrayTexture)if(en){if(Hn&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ie,Ot,_e.width,_e.height,_e.depth),F)if(S.layerUpdates.size>0){const Q=sw(_e.width,_e.height,S.format,S.type);for(const le of S.layerUpdates){const Fe=_e.data.subarray(le*Q/_e.data.BYTES_PER_ELEMENT,(le+1)*Q/_e.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,le,_e.width,_e.height,1,je,wt,Fe)}S.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,_e.width,_e.height,_e.depth,je,wt,_e.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ot,_e.width,_e.height,_e.depth,0,je,wt,_e.data);else if(S.isData3DTexture)en?(Hn&&t.texStorage3D(n.TEXTURE_3D,Ie,Ot,_e.width,_e.height,_e.depth),F&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,_e.width,_e.height,_e.depth,je,wt,_e.data)):t.texImage3D(n.TEXTURE_3D,0,Ot,_e.width,_e.height,_e.depth,0,je,wt,_e.data);else if(S.isFramebufferTexture){if(Hn)if(en)t.texStorage2D(n.TEXTURE_2D,Ie,Ot,_e.width,_e.height);else{let Q=_e.width,le=_e.height;for(let Fe=0;Fe<Ie;Fe++)t.texImage2D(n.TEXTURE_2D,Fe,Ot,Q,le,0,je,wt,null),Q>>=1,le>>=1}}else if(un.length>0){if(en&&Hn){const Q=Be(un[0]);t.texStorage2D(n.TEXTURE_2D,Ie,Ot,Q.width,Q.height)}for(let Q=0,le=un.length;Q<le;Q++)$e=un[Q],en?F&&t.texSubImage2D(n.TEXTURE_2D,Q,0,0,je,wt,$e):t.texImage2D(n.TEXTURE_2D,Q,Ot,je,wt,$e);S.generateMipmaps=!1}else if(en){if(Hn){const Q=Be(_e);t.texStorage2D(n.TEXTURE_2D,Ie,Ot,Q.width,Q.height)}F&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,je,wt,_e)}else t.texImage2D(n.TEXTURE_2D,0,Ot,je,wt,_e);g(S)&&m(re),Je.__version=se.version,S.onUpdate&&S.onUpdate(S)}D.__version=S.version}function Ge(D,S,j,re,he,se){const Je=s.convert(j.format,j.colorSpace),Ae=s.convert(j.type),Ve=E(j.internalFormat,Je,Ae,j.colorSpace),sn=i.get(S),_e=i.get(j);if(_e.__renderTarget=S,!sn.__hasExternalTextures){const je=Math.max(1,S.width>>se),wt=Math.max(1,S.height>>se);he===n.TEXTURE_3D||he===n.TEXTURE_2D_ARRAY?t.texImage3D(he,se,Ve,je,wt,S.depth,0,Je,Ae,null):t.texImage2D(he,se,Ve,je,wt,0,Je,Ae,null)}t.bindFramebuffer(n.FRAMEBUFFER,D),ze(S)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,re,he,_e.__webglTexture,0,me(S)):(he===n.TEXTURE_2D||he>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&he<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,re,he,_e.__webglTexture,se),t.bindFramebuffer(n.FRAMEBUFFER,null)}function fe(D,S,j){if(n.bindRenderbuffer(n.RENDERBUFFER,D),S.depthBuffer){const re=S.depthTexture,se=v(S.stencilBuffer,re&&re.isDepthTexture?re.type:null),Je=S.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ae=me(S);ze(S)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ae,se,S.width,S.height):j?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ae,se,S.width,S.height):n.renderbufferStorage(n.RENDERBUFFER,se,S.width,S.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Je,n.RENDERBUFFER,D)}else{const re=S.textures;for(let he=0;he<re.length;he++){const se=re[he],Je=s.convert(se.format,se.colorSpace),Ae=s.convert(se.type),Ve=E(se.internalFormat,Je,Ae,se.colorSpace),sn=me(S);j&&!1===ze(S)?n.renderbufferStorageMultisample(n.RENDERBUFFER,sn,Ve,S.width,S.height):ze(S)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,sn,Ve,S.width,S.height):n.renderbufferStorage(n.RENDERBUFFER,Ve,S.width,S.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ke(D){const S=i.get(D),j=!0===D.isWebGLCubeRenderTarget;if(S.__boundDepthTexture!==D.depthTexture){const re=D.depthTexture;if(S.__depthDisposeCallback&&S.__depthDisposeCallback(),re){const he=()=>{delete S.__boundDepthTexture,delete S.__depthDisposeCallback,re.removeEventListener("dispose",he)};re.addEventListener("dispose",he),S.__depthDisposeCallback=he}S.__boundDepthTexture=re}if(D.depthTexture&&!S.__autoAllocateDepthBuffer){if(j)throw new Error("target.depthTexture not supported in Cube render targets");!function qe(D,S){if(S&&S.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,D),!S.depthTexture||!S.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const re=i.get(S.depthTexture);re.__renderTarget=S,(!re.__webglTexture||S.depthTexture.image.width!==S.width||S.depthTexture.image.height!==S.height)&&(S.depthTexture.image.width=S.width,S.depthTexture.image.height=S.height,S.depthTexture.needsUpdate=!0),ce(S.depthTexture,0);const he=re.__webglTexture,se=me(S);if(S.depthTexture.format===ku)ze(S)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,he,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,he,0);else{if(S.depthTexture.format!==Uu)throw new Error("Unknown depthTexture format");ze(S)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,he,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,he,0)}}(S.__webglFramebuffer,D)}else if(j){S.__webglDepthbuffer=[];for(let re=0;re<6;re++)if(t.bindFramebuffer(n.FRAMEBUFFER,S.__webglFramebuffer[re]),void 0===S.__webglDepthbuffer[re])S.__webglDepthbuffer[re]=n.createRenderbuffer(),fe(S.__webglDepthbuffer[re],D,!1);else{const he=D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,se=S.__webglDepthbuffer[re];n.bindRenderbuffer(n.RENDERBUFFER,se),n.framebufferRenderbuffer(n.FRAMEBUFFER,he,n.RENDERBUFFER,se)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,S.__webglFramebuffer),void 0===S.__webglDepthbuffer)S.__webglDepthbuffer=n.createRenderbuffer(),fe(S.__webglDepthbuffer,D,!1);else{const re=D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,he=S.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,he),n.framebufferRenderbuffer(n.FRAMEBUFFER,re,n.RENDERBUFFER,he)}t.bindFramebuffer(n.FRAMEBUFFER,null)}const be=[],R=[];function me(D){return Math.min(r.maxSamples,D.samples)}function ze(D){const S=i.get(D);return D.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==S.__useRenderToTexture}function Mt(D,S){const j=D.colorSpace,re=D.format,he=D.type;return!0===D.isCompressedTexture||!0===D.isVideoTexture||j!==zu&&""!==j&&(ln.getTransfer(j)===An?(re!==Nr||he!==ko)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",j)),S}function Be(D){return typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement?(l.width=D.naturalWidth||D.width,l.height=D.naturalHeight||D.height):typeof VideoFrame<"u"&&D instanceof VideoFrame?(l.width=D.displayWidth,l.height=D.displayHeight):(l.width=D.width,l.height=D.height),l}this.allocateTextureUnit=function $(){const D=P;return D>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+D+" texture units while this GPU supports only "+r.maxTextures),P+=1,D},this.resetTextureUnits=function W(){P=0},this.setTexture2D=ce,this.setTexture2DArray=function L(D,S){const j=i.get(D);D.version>0&&j.__version!==D.version?K(j,D,S):t.bindTexture(n.TEXTURE_2D_ARRAY,j.__webglTexture,n.TEXTURE0+S)},this.setTexture3D=function Y(D,S){const j=i.get(D);D.version>0&&j.__version!==D.version?K(j,D,S):t.bindTexture(n.TEXTURE_3D,j.__webglTexture,n.TEXTURE0+S)},this.setTextureCube=function B(D,S){const j=i.get(D);D.version>0&&j.__version!==D.version?function Ee(D,S,j){if(6!==S.image.length)return;const re=tn(D,S),he=S.source;t.bindTexture(n.TEXTURE_CUBE_MAP,D.__webglTexture,n.TEXTURE0+j);const se=i.get(he);if(he.version!==se.__version||!0===re){t.activeTexture(n.TEXTURE0+j);const Je=ln.getPrimaries(ln.workingColorSpace),Ae=""===S.colorSpace?null:ln.getPrimaries(S.colorSpace),Ve=""===S.colorSpace||Je===Ae?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,S.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,S.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,S.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ve);const sn=S.isCompressedTexture||S.image[0].isCompressedTexture,_e=S.image[0]&&S.image[0].isDataTexture,je=[];for(let le=0;le<6;le++)je[le]=sn||_e?_e?S.image[le].image:S.image[le]:_(S.image[le],!0,r.maxCubemapSize),je[le]=Mt(S,je[le]);const wt=je[0],Ot=s.convert(S.format,S.colorSpace),$e=s.convert(S.type),un=E(S.internalFormat,Ot,$e,S.colorSpace),en=!0!==S.isVideoTexture,Hn=void 0===se.__version||!0===re,F=he.dataReady;let Q,Ie=C(S,wt);if(ot(n.TEXTURE_CUBE_MAP,S),sn){en&&Hn&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ie,un,wt.width,wt.height);for(let le=0;le<6;le++){Q=je[le].mipmaps;for(let Fe=0;Fe<Q.length;Fe++){const Pe=Q[Fe];S.format!==Nr?null!==Ot?en?F&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe,0,0,Pe.width,Pe.height,Ot,Pe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe,un,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):en?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe,0,0,Pe.width,Pe.height,Ot,$e,Pe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe,un,Pe.width,Pe.height,0,Ot,$e,Pe.data)}}}else{if(Q=S.mipmaps,en&&Hn){Q.length>0&&Ie++;const le=Be(je[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Ie,un,le.width,le.height)}for(let le=0;le<6;le++)if(_e){en?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,0,0,je[le].width,je[le].height,Ot,$e,je[le].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,un,je[le].width,je[le].height,0,Ot,$e,je[le].data);for(let Fe=0;Fe<Q.length;Fe++){const Xt=Q[Fe].image[le].image;en?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe+1,0,0,Xt.width,Xt.height,Ot,$e,Xt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe+1,un,Xt.width,Xt.height,0,Ot,$e,Xt.data)}}else{en?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,0,0,Ot,$e,je[le]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,un,Ot,$e,je[le]);for(let Fe=0;Fe<Q.length;Fe++){const Pe=Q[Fe];en?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe+1,0,0,Ot,$e,Pe.image[le]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+le,Fe+1,un,Ot,$e,Pe.image[le])}}}g(S)&&m(n.TEXTURE_CUBE_MAP),se.__version=he.version,S.onUpdate&&S.onUpdate(S)}D.__version=S.version}(j,D,S):t.bindTexture(n.TEXTURE_CUBE_MAP,j.__webglTexture,n.TEXTURE0+S)},this.rebindTextures=function gt(D,S,j){const re=i.get(D);void 0!==S&&Ge(re.__webglFramebuffer,D,D.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),void 0!==j&&Ke(D)},this.setupRenderTarget=function nn(D){const S=D.texture,j=i.get(D),re=i.get(S);D.addEventListener("dispose",T);const he=D.textures,se=!0===D.isWebGLCubeRenderTarget,Je=he.length>1;if(Je||(void 0===re.__webglTexture&&(re.__webglTexture=n.createTexture()),re.__version=S.version,o.memory.textures++),se){j.__webglFramebuffer=[];for(let Ae=0;Ae<6;Ae++)if(S.mipmaps&&S.mipmaps.length>0){j.__webglFramebuffer[Ae]=[];for(let Ve=0;Ve<S.mipmaps.length;Ve++)j.__webglFramebuffer[Ae][Ve]=n.createFramebuffer()}else j.__webglFramebuffer[Ae]=n.createFramebuffer()}else{if(S.mipmaps&&S.mipmaps.length>0){j.__webglFramebuffer=[];for(let Ae=0;Ae<S.mipmaps.length;Ae++)j.__webglFramebuffer[Ae]=n.createFramebuffer()}else j.__webglFramebuffer=n.createFramebuffer();if(Je)for(let Ae=0,Ve=he.length;Ae<Ve;Ae++){const sn=i.get(he[Ae]);void 0===sn.__webglTexture&&(sn.__webglTexture=n.createTexture(),o.memory.textures++)}if(D.samples>0&&!1===ze(D)){j.__webglMultisampledFramebuffer=n.createFramebuffer(),j.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,j.__webglMultisampledFramebuffer);for(let Ae=0;Ae<he.length;Ae++){const Ve=he[Ae];j.__webglColorRenderbuffer[Ae]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,j.__webglColorRenderbuffer[Ae]);const sn=s.convert(Ve.format,Ve.colorSpace),_e=s.convert(Ve.type),je=E(Ve.internalFormat,sn,_e,Ve.colorSpace,!0===D.isXRRenderTarget),wt=me(D);n.renderbufferStorageMultisample(n.RENDERBUFFER,wt,je,D.width,D.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ae,n.RENDERBUFFER,j.__webglColorRenderbuffer[Ae])}n.bindRenderbuffer(n.RENDERBUFFER,null),D.depthBuffer&&(j.__webglDepthRenderbuffer=n.createRenderbuffer(),fe(j.__webglDepthRenderbuffer,D,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(se){t.bindTexture(n.TEXTURE_CUBE_MAP,re.__webglTexture),ot(n.TEXTURE_CUBE_MAP,S);for(let Ae=0;Ae<6;Ae++)if(S.mipmaps&&S.mipmaps.length>0)for(let Ve=0;Ve<S.mipmaps.length;Ve++)Ge(j.__webglFramebuffer[Ae][Ve],D,S,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,Ve);else Ge(j.__webglFramebuffer[Ae],D,S,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0);g(S)&&m(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Je){for(let Ae=0,Ve=he.length;Ae<Ve;Ae++){const sn=he[Ae],_e=i.get(sn);t.bindTexture(n.TEXTURE_2D,_e.__webglTexture),ot(n.TEXTURE_2D,sn),Ge(j.__webglFramebuffer,D,sn,n.COLOR_ATTACHMENT0+Ae,n.TEXTURE_2D,0),g(sn)&&m(n.TEXTURE_2D)}t.unbindTexture()}else{let Ae=n.TEXTURE_2D;if((D.isWebGL3DRenderTarget||D.isWebGLArrayRenderTarget)&&(Ae=D.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Ae,re.__webglTexture),ot(Ae,S),S.mipmaps&&S.mipmaps.length>0)for(let Ve=0;Ve<S.mipmaps.length;Ve++)Ge(j.__webglFramebuffer[Ve],D,S,n.COLOR_ATTACHMENT0,Ae,Ve);else Ge(j.__webglFramebuffer,D,S,n.COLOR_ATTACHMENT0,Ae,0);g(S)&&m(Ae),t.unbindTexture()}D.depthBuffer&&Ke(D)},this.updateRenderTargetMipmap=function ue(D){const S=D.textures;for(let j=0,re=S.length;j<re;j++){const he=S[j];if(g(he)){const se=y(D),Je=i.get(he).__webglTexture;t.bindTexture(se,Je),m(se),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function tt(D){if(D.samples>0)if(!1===ze(D)){const S=D.textures,j=D.width,re=D.height;let he=n.COLOR_BUFFER_BIT;const se=D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Je=i.get(D),Ae=S.length>1;if(Ae)for(let Ve=0;Ve<S.length;Ve++)t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ve,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ve,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Je.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Je.__webglFramebuffer);for(let Ve=0;Ve<S.length;Ve++){if(D.resolveDepthBuffer&&(D.depthBuffer&&(he|=n.DEPTH_BUFFER_BIT),D.stencilBuffer&&D.resolveStencilBuffer&&(he|=n.STENCIL_BUFFER_BIT)),Ae){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Je.__webglColorRenderbuffer[Ve]);const sn=i.get(S[Ve]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,sn,0)}n.blitFramebuffer(0,0,j,re,0,0,j,re,he,n.NEAREST),!0===c&&(be.length=0,R.length=0,be.push(n.COLOR_ATTACHMENT0+Ve),D.depthBuffer&&!1===D.resolveDepthBuffer&&(be.push(se),R.push(se),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,R)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,be))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ae)for(let Ve=0;Ve<S.length;Ve++){t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ve,n.RENDERBUFFER,Je.__webglColorRenderbuffer[Ve]);const sn=i.get(S[Ve]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ve,n.TEXTURE_2D,sn,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Je.__webglMultisampledFramebuffer)}else D.depthBuffer&&!1===D.resolveDepthBuffer&&c&&n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT])},this.setupDepthRenderbuffer=Ke,this.setupFrameBufferTexture=Ge,this.useMultisampledRTT=ze}function Wee(n,e){return{convert:function t(i,r=""){let s;const o=ln.getTransfer(r);if(i===ko)return n.UNSIGNED_BYTE;if(1017===i)return n.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return n.UNSIGNED_SHORT_5_5_5_1;if(35902===i)return n.UNSIGNED_INT_5_9_9_9_REV;if(1010===i)return n.BYTE;if(1011===i)return n.SHORT;if(i===lf)return n.UNSIGNED_SHORT;if(1013===i)return n.INT;if(i===La)return n.UNSIGNED_INT;if(i===Kr)return n.FLOAT;if(i===uf)return n.HALF_FLOAT;if(1021===i)return n.ALPHA;if(1022===i)return n.RGB;if(i===Nr)return n.RGBA;if(1024===i)return n.LUMINANCE;if(1025===i)return n.LUMINANCE_ALPHA;if(i===ku)return n.DEPTH_COMPONENT;if(i===Uu)return n.DEPTH_STENCIL;if(1028===i)return n.RED;if(1029===i)return n.RED_INTEGER;if(1030===i)return n.RG;if(1031===i)return n.RG_INTEGER;if(1033===i)return n.RGBA_INTEGER;if(i===i_||i===r_||i===s_||i===o_)if(o===An){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===i_)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===r_)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===s_)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===o_)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===i_)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===r_)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===s_)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===o_)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===i)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i||37492===i||37496===i){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(36196===i||37492===i)return o===An?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return o===An?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===a_||36494===i||36495===i){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===a_)return o===An?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===i)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===i)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===i||36284===i||36285===i||36286===i){if(s=e.get("EXT_texture_compression_rgtc"),null===s)return null;if(i===a_)return s.COMPRESSED_RED_RGTC1_EXT;if(36284===i)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===i)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===i)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Fu?n.UNSIGNED_INT_24_8:void 0!==n[i]?n[i]:null}}}class qee extends Gi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class bf extends Xn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Xee={type:"move"};class ow{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new bf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new bf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new A,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new A),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new bf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new A,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new A),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const _ of e.hand.values()){const g=t.getJointPose(_,i),m=this._getHandJoint(l,_);null!==g&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=null!==g}const h=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),f=.02,p=.005;l.inputState.pinching&&h>f+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=f-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==c&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Xee)))}return null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==s),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new bf;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class Kee{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(null===this.texture){const r=new Or;e.properties.get(r).__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,i=new to({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new ei(new vf(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Jee extends Bo{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,d=null,h=null,f=null,p=null;const _=new Kee,g=t.getContextAttributes();let m=null,y=null;const E=[],v=[],C=new ie;let x=null;const T=new Gi;T.viewport=new gn;const I=new Gi;I.viewport=new gn;const M=[T,I],b=new qee;let P=null,W=null;function $(K){const Ee=v.indexOf(K.inputSource);if(-1===Ee)return;const Ge=E[Ee];void 0!==Ge&&(Ge.update(K.inputSource,K.frame,l||o),Ge.dispatchEvent({type:K.type,data:K.inputSource}))}function J(){r.removeEventListener("select",$),r.removeEventListener("selectstart",$),r.removeEventListener("selectend",$),r.removeEventListener("squeeze",$),r.removeEventListener("squeezestart",$),r.removeEventListener("squeezeend",$),r.removeEventListener("end",J),r.removeEventListener("inputsourceschange",ce);for(let K=0;K<E.length;K++){const Ee=v[K];null!==Ee&&(v[K]=null,E[K].disconnect(Ee))}P=null,W=null,_.reset(),e.setRenderTarget(m),f=null,h=null,d=null,r=null,y=null,tn.stop(),i.isPresenting=!1,e.setPixelRatio(x),e.setSize(C.width,C.height,!1),i.dispatchEvent({type:"sessionend"})}function ce(K){for(let Ee=0;Ee<K.removed.length;Ee++){const Ge=K.removed[Ee],fe=v.indexOf(Ge);fe>=0&&(v[fe]=null,E[fe].disconnect(Ge))}for(let Ee=0;Ee<K.added.length;Ee++){const Ge=K.added[Ee];let fe=v.indexOf(Ge);if(-1===fe){for(let Ke=0;Ke<E.length;Ke++){if(Ke>=v.length){v.push(Ge),fe=Ke;break}if(null===v[Ke]){v[Ke]=Ge,fe=Ke;break}}if(-1===fe)break}const qe=E[fe];qe&&qe.connect(Ge)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let Ee=E[K];return void 0===Ee&&(Ee=new ow,E[K]=Ee),Ee.getTargetRaySpace()},this.getControllerGrip=function(K){let Ee=E[K];return void 0===Ee&&(Ee=new ow,E[K]=Ee),Ee.getGripSpace()},this.getHand=function(K){let Ee=E[K];return void 0===Ee&&(Ee=new ow,E[K]=Ee),Ee.getHandSpace()},this.setFramebufferScaleFactor=function(K){s=K,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){a=K,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(K){l=K},this.getBaseLayer=function(){return null!==h?h:f},this.getBinding=function(){return d},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=function(){var K=$n(function*(Ee){if(r=Ee,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",$),r.addEventListener("selectstart",$),r.addEventListener("selectend",$),r.addEventListener("squeeze",$),r.addEventListener("squeezestart",$),r.addEventListener("squeezeend",$),r.addEventListener("end",J),r.addEventListener("inputsourceschange",ce),!0!==g.xrCompatible&&(yield t.makeXRCompatible()),x=e.getPixelRatio(),e.getSize(C),void 0===r.renderState.layers)f=new XRWebGLLayer(r,t,{antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),y=new eo(f.framebufferWidth,f.framebufferHeight,{format:Nr,type:ko,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil});else{let Ge=null,fe=null,qe=null;g.depth&&(qe=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ge=g.stencil?Uu:ku,fe=g.stencil?Fu:La);const Ke={colorFormat:t.RGBA8,depthFormat:qe,scaleFactor:s};d=new XRWebGLBinding(r,t),h=d.createProjectionLayer(Ke),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),y=new eo(h.textureWidth,h.textureHeight,{format:Nr,type:ko,depthTexture:new uF(h.textureWidth,h.textureHeight,fe,void 0,void 0,void 0,void 0,void 0,void 0,Ge),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues})}y.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=yield r.requestReferenceSpace(a),tn.setContext(r),tn.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(Ee){return K.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};const L=new A,Y=new A;function ae(K,Ee){null===Ee?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(Ee.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(null===r)return;let Ee=K.near,Ge=K.far;null!==_.texture&&(_.depthNear>0&&(Ee=_.depthNear),_.depthFar>0&&(Ge=_.depthFar)),b.near=I.near=T.near=Ee,b.far=I.far=T.far=Ge,(P!==b.near||W!==b.far)&&(r.updateRenderState({depthNear:b.near,depthFar:b.far}),P=b.near,W=b.far),T.layers.mask=2|K.layers.mask,I.layers.mask=4|K.layers.mask,b.layers.mask=T.layers.mask|I.layers.mask;const fe=K.parent,qe=b.cameras;ae(b,fe);for(let Ke=0;Ke<qe.length;Ke++)ae(qe[Ke],fe);2===qe.length?function B(K,Ee,Ge){L.setFromMatrixPosition(Ee.matrixWorld),Y.setFromMatrixPosition(Ge.matrixWorld);const fe=L.distanceTo(Y),qe=Ee.projectionMatrix.elements,Ke=Ge.projectionMatrix.elements,gt=qe[14]/(qe[10]-1),nn=qe[14]/(qe[10]+1),ue=(qe[9]+1)/qe[5],be=(qe[9]-1)/qe[5],R=(qe[8]-1)/qe[0],tt=(Ke[8]+1)/Ke[0],me=gt*R,ze=gt*tt,xe=fe/(-R+tt),Mt=xe*-R;if(Ee.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(Mt),K.translateZ(xe),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert(),-1===qe[10])K.projectionMatrix.copy(Ee.projectionMatrix),K.projectionMatrixInverse.copy(Ee.projectionMatrixInverse);else{const Be=gt+xe,D=nn+xe;K.projectionMatrix.makePerspective(me-Mt,ze+(fe-Mt),ue*nn/D*Be,be*nn/D*Be,Be,D),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}}(b,T,I):b.projectionMatrix.copy(T.projectionMatrix),function ve(K,Ee,Ge){null===Ge?K.matrix.copy(Ee.matrixWorld):(K.matrix.copy(Ge.matrixWorld),K.matrix.invert(),K.matrix.multiply(Ee.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy(Ee.projectionMatrix),K.projectionMatrixInverse.copy(Ee.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=2*Gu*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}(K,b,fe)},this.getCamera=function(){return b},this.getFoveation=function(){if(null!==h||null!==f)return c},this.setFoveation=function(K){c=K,null!==h&&(h.fixedFoveation=K),null!==f&&void 0!==f.fixedFoveation&&(f.fixedFoveation=K)},this.hasDepthSensing=function(){return null!==_.texture},this.getDepthSensingMesh=function(){return _.getMesh(b)};let De=null;const tn=new nF;tn.setAnimationLoop(function ot(K,Ee){if(u=Ee.getViewerPose(l||o),p=Ee,null!==u){const Ge=u.views;null!==f&&(e.setRenderTargetFramebuffer(y,f.framebuffer),e.setRenderTarget(y));let fe=!1;Ge.length!==b.cameras.length&&(b.cameras.length=0,fe=!0);for(let Ke=0;Ke<Ge.length;Ke++){const gt=Ge[Ke];let nn=null;if(null!==f)nn=f.getViewport(gt);else{const be=d.getViewSubImage(h,gt);nn=be.viewport,0===Ke&&(e.setRenderTargetTextures(y,be.colorTexture,h.ignoreDepthValues?void 0:be.depthStencilTexture),e.setRenderTarget(y))}let ue=M[Ke];void 0===ue&&(ue=new Gi,ue.layers.enable(Ke),ue.viewport=new gn,M[Ke]=ue),ue.matrix.fromArray(gt.transform.matrix),ue.matrix.decompose(ue.position,ue.quaternion,ue.scale),ue.projectionMatrix.fromArray(gt.projectionMatrix),ue.projectionMatrixInverse.copy(ue.projectionMatrix).invert(),ue.viewport.set(nn.x,nn.y,nn.width,nn.height),0===Ke&&(b.matrix.copy(ue.matrix),b.matrix.decompose(b.position,b.quaternion,b.scale)),!0===fe&&b.cameras.push(ue)}const qe=r.enabledFeatures;if(qe&&qe.includes("depth-sensing")){const Ke=d.getDepthInformation(Ge[0]);Ke&&Ke.isValid&&Ke.texture&&_.init(e,Ke,r.renderState)}}for(let Ge=0;Ge<E.length;Ge++){const fe=v[Ge],qe=E[Ge];null!==fe&&void 0!==qe&&qe.update(fe,Ee,l||o)}De&&De(K,Ee),Ee.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Ee}),p=null}),this.setAnimationLoop=function(K){De=K},this.dispose=function(){}}}const el=new Go,Qee=new Ct;function ete(n,e){function t(g,m){!0===g.matrixAutoUpdate&&g.updateMatrix(),m.value.copy(g.matrix)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,t(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,1===m.side&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,t(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),1===m.side&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,t(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,t(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const y=e.get(m),E=y.envMap,v=y.envMapRotation;E&&(g.envMap.value=E,el.copy(v),el.x*=-1,el.y*=-1,el.z*=-1,E.isCubeTexture&&!1===E.isRenderTargetTexture&&(el.y*=-1,el.z*=-1),g.envMapRotation.value.setFromMatrix4(Qee.makeRotationFromEuler(el)),g.flipEnvMap.value=E.isCubeTexture&&!1===E.isRenderTargetTexture?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap&&(g.lightMap.value=m.lightMap,g.lightMapIntensity.value=m.lightMapIntensity,t(m.lightMap,g.lightMapTransform)),m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,g.aoMapTransform))}return{refreshFogUniforms:function i(g,m){m.color.getRGB(g.fogColor.value,QL(n)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)},refreshMaterialUniforms:function r(g,m,y,E,v){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),function d(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}(g,m)):m.isMeshPhongMaterial?(s(g,m),function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}(g,m)):m.isMeshStandardMaterial?(s(g,m),function h(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,g.roughnessMapTransform)),m.envMap&&(g.envMapIntensity.value=m.envMapIntensity)}(g,m),m.isMeshPhysicalMaterial&&function f(g,m,y){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),1===m.side&&g.clearcoatNormalScale.value.negate())),m.dispersion>0&&(g.dispersion.value=m.dispersion),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,g.specularIntensityMapTransform))}(g,m,v)):m.isMeshMatcapMaterial?(s(g,m),function p(g,m){m.matcap&&(g.matcap.value=m.matcap)}(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),function _(g,m){const y=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform))}(g,m),m.isLineDashedMaterial&&function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}(g,m)):m.isPointsMaterial?function c(g,m,y,E){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*y,g.scale.value=.5*E,m.map&&(g.map.value=m.map,t(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}(g,m,y,E):m.isSpriteMaterial?function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}}}function tte(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function f(y,E,v,C){const x=y.value,T=E+"_"+v;if(void 0===C[T])return C[T]="number"==typeof x||"boolean"==typeof x?x:x.clone(),!0;{const I=C[T];if("number"==typeof x||"boolean"==typeof x){if(I!==x)return C[T]=x,!0}else if(!1===I.equals(x))return I.copy(x),!0}return!1}function _(y){const E={boundary:0,storage:0};return"number"==typeof y||"boolean"==typeof y?(E.boundary=4,E.storage=4):y.isVector2?(E.boundary=8,E.storage=8):y.isVector3||y.isColor?(E.boundary=16,E.storage=12):y.isVector4?(E.boundary=16,E.storage=16):y.isMatrix3?(E.boundary=48,E.storage=48):y.isMatrix4?(E.boundary=64,E.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),E}function g(y){const E=y.target;E.removeEventListener("dispose",g);const v=o.indexOf(E.__bindingPointIndex);o.splice(v,1),n.deleteBuffer(r[E.id]),delete r[E.id],delete s[E.id]}return{bind:function c(y,E){i.uniformBlockBinding(y,E.program)},update:function l(y,E){let v=r[y.id];void 0===v&&(function p(y){const E=y.uniforms;let v=0;for(let T=0,I=E.length;T<I;T++){const M=Array.isArray(E[T])?E[T]:[E[T]];for(let b=0,P=M.length;b<P;b++){const W=M[b],$=Array.isArray(W.value)?W.value:[W.value];for(let J=0,ce=$.length;J<ce;J++){const Y=_($[J]),B=v%16,ae=B%Y.boundary,ve=B+ae;v+=ae,0!==ve&&16-ve<Y.storage&&(v+=16-ve),W.__data=new Float32Array(Y.storage/Float32Array.BYTES_PER_ELEMENT),W.__offset=v,v+=Y.storage}}}const x=v%16;x>0&&(v+=16-x),y.__size=v,y.__cache={}}(y),v=function u(y){const E=function d(){for(let y=0;y<a;y++)if(-1===o.indexOf(y))return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();y.__bindingPointIndex=E;const v=n.createBuffer(),C=y.__size,x=y.usage;return n.bindBuffer(n.UNIFORM_BUFFER,v),n.bufferData(n.UNIFORM_BUFFER,C,x),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,E,v),v}(y),r[y.id]=v,y.addEventListener("dispose",g)),i.updateUBOMapping(y,E.program);const x=e.render.frame;s[y.id]!==x&&(function h(y){const v=y.uniforms,C=y.__cache;n.bindBuffer(n.UNIFORM_BUFFER,r[y.id]);for(let x=0,T=v.length;x<T;x++){const I=Array.isArray(v[x])?v[x]:[v[x]];for(let M=0,b=I.length;M<b;M++){const P=I[M];if(!0===f(P,x,M,C)){const W=P.__offset,$=Array.isArray(P.value)?P.value:[P.value];let J=0;for(let ce=0;ce<$.length;ce++){const L=$[ce],Y=_(L);"number"==typeof L||"boolean"==typeof L?(P.__data[0]=L,n.bufferSubData(n.UNIFORM_BUFFER,W+J,P.__data)):L.isMatrix3?(P.__data[0]=L.elements[0],P.__data[1]=L.elements[1],P.__data[2]=L.elements[2],P.__data[3]=0,P.__data[4]=L.elements[3],P.__data[5]=L.elements[4],P.__data[6]=L.elements[5],P.__data[7]=0,P.__data[8]=L.elements[6],P.__data[9]=L.elements[7],P.__data[10]=L.elements[8],P.__data[11]=0):(L.toArray(P.__data,J),J+=Y.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,W,P.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(y),s[y.id]=x)},dispose:function m(){for(const y in r)n.deleteBuffer(r[y]);o=[],r={},s={}}}}class nte{constructor(e={}){const{canvas:t=MZ(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1,reverseDepthBuffer:h=!1}=e;let f;if(this.isWebGLRenderer=!0,null!==i){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=i.getContextAttributes().alpha}else f=o;const p=new Uint32Array(4),_=new Int32Array(4);let g=null,m=null;const y=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Jr,this.toneMapping=0,this.toneMappingExposure=1;const v=this;let C=!1,x=0,T=0,I=null,M=-1,b=null;const P=new gn,W=new gn;let $=null;const J=new Le(0);let ce=0,L=t.width,Y=t.height,B=1,ae=null,ve=null;const De=new gn(0,0,L,Y),ot=new gn(0,0,L,Y);let tn=!1;const K=new R_;let Ee=!1,Ge=!1;const fe=new Ct,qe=new Ct,Ke=new A,gt=new gn,nn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ue=!1;function be(){return null===I?B:1}let me,ze,xe,Mt,Be,D,S,j,re,he,se,Je,Ae,Ve,sn,_e,je,wt,Ot,$e,un,en,Hn,F,R=i;function tt(w,k){return t.getContext(w,k)}try{const w={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r170"),t.addEventListener("webglcontextlost",le,!1),t.addEventListener("webglcontextrestored",Fe,!1),t.addEventListener("webglcontextcreationerror",Pe,!1),null===R){const k="webgl2";if(R=tt(k,w),null===R)throw tt(k)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(w){throw console.error("THREE.WebGLRenderer: "+w.message),w}function Ie(){me=new oQ(R),me.init(),en=new Wee(R,me),ze=new eQ(R,me,e,en),xe=new Vee(R,me),ze.reverseDepthBuffer&&h&&xe.buffers.depth.setReversed(!0),Mt=new lQ(R),Be=new Cee,D=new $ee(R,me,xe,Be,ze,en,Mt),S=new nQ(v),j=new sQ(v),re=new ZZ(R),Hn=new JJ(R,re),he=new aQ(R,re,Mt,Hn),se=new dQ(R,he,re,Mt),Ot=new uQ(R,ze,D),_e=new tQ(Be),Je=new Tee(v,S,j,me,ze,Hn,_e),Ae=new ete(v,Be),Ve=new Aee,sn=new Lee(me),wt=new KJ(v,S,j,xe,se,f,c),je=new Uee(v,se,ze),F=new tte(R,Mt,ze,xe),$e=new QJ(R,me,Mt),un=new cQ(R,me,Mt),Mt.programs=Je.programs,v.capabilities=ze,v.extensions=me,v.properties=Be,v.renderLists=Ve,v.shadowMap=je,v.state=xe,v.info=Mt}Ie();const Q=new Jee(v,R);function le(w){w.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Fe(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const w=Mt.autoReset,k=je.enabled,q=je.autoUpdate,X=je.needsUpdate,V=je.type;Ie(),Mt.autoReset=w,je.enabled=k,je.autoUpdate=q,je.needsUpdate=X,je.type=V}function Pe(w){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",w.statusMessage)}function Xt(w){const k=w.target;k.removeEventListener("dispose",Xt),function hi(w){(function tr(w){const k=Be.get(w).programs;void 0!==k&&(k.forEach(function(q){Je.releaseProgram(q)}),w.isShaderMaterial&&Je.releaseShaderCache(w))})(w),Be.remove(w)}(k)}function wn(w,k,q){!0===w.transparent&&2===w.side&&!1===w.forceSinglePass?(w.side=1,w.needsUpdate=!0,dv(w,k,q),w.side=0,w.needsUpdate=!0,dv(w,k,q),w.side=2):dv(w,k,q)}this.xr=Q,this.getContext=function(){return R},this.getContextAttributes=function(){return R.getContextAttributes()},this.forceContextLoss=function(){const w=me.get("WEBGL_lose_context");w&&w.loseContext()},this.forceContextRestore=function(){const w=me.get("WEBGL_lose_context");w&&w.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(w){void 0!==w&&(B=w,this.setSize(L,Y,!1))},this.getSize=function(w){return w.set(L,Y)},this.setSize=function(w,k,q=!0){Q.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=w,Y=k,t.width=Math.floor(w*B),t.height=Math.floor(k*B),!0===q&&(t.style.width=w+"px",t.style.height=k+"px"),this.setViewport(0,0,w,k))},this.getDrawingBufferSize=function(w){return w.set(L*B,Y*B).floor()},this.setDrawingBufferSize=function(w,k,q){L=w,Y=k,B=q,t.width=Math.floor(w*q),t.height=Math.floor(k*q),this.setViewport(0,0,w,k)},this.getCurrentViewport=function(w){return w.copy(P)},this.getViewport=function(w){return w.copy(De)},this.setViewport=function(w,k,q,X){w.isVector4?De.set(w.x,w.y,w.z,w.w):De.set(w,k,q,X),xe.viewport(P.copy(De).multiplyScalar(B).round())},this.getScissor=function(w){return w.copy(ot)},this.setScissor=function(w,k,q,X){w.isVector4?ot.set(w.x,w.y,w.z,w.w):ot.set(w,k,q,X),xe.scissor(W.copy(ot).multiplyScalar(B).round())},this.getScissorTest=function(){return tn},this.setScissorTest=function(w){xe.setScissorTest(tn=w)},this.setOpaqueSort=function(w){ae=w},this.setTransparentSort=function(w){ve=w},this.getClearColor=function(w){return w.copy(wt.getClearColor())},this.setClearColor=function(){wt.setClearColor.apply(wt,arguments)},this.getClearAlpha=function(){return wt.getClearAlpha()},this.setClearAlpha=function(){wt.setClearAlpha.apply(wt,arguments)},this.clear=function(w=!0,k=!0,q=!0){let X=0;if(w){let V=!1;if(null!==I){const Me=I.texture.format;V=1033===Me||1031===Me||1029===Me}if(V){const Me=I.texture.type,Re=Me===ko||Me===La||Me===lf||Me===Fu||1017===Me||1018===Me,nt=wt.getClearColor(),Ye=wt.getClearAlpha(),kt=nt.r,Yt=nt.g,it=nt.b;Re?(p[0]=kt,p[1]=Yt,p[2]=it,p[3]=Ye,R.clearBufferuiv(R.COLOR,0,p)):(_[0]=kt,_[1]=Yt,_[2]=it,_[3]=Ye,R.clearBufferiv(R.COLOR,0,_))}else X|=R.COLOR_BUFFER_BIT}k&&(X|=R.DEPTH_BUFFER_BIT),q&&(X|=R.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),R.clear(X)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",le,!1),t.removeEventListener("webglcontextrestored",Fe,!1),t.removeEventListener("webglcontextcreationerror",Pe,!1),Ve.dispose(),sn.dispose(),Be.dispose(),S.dispose(),j.dispose(),se.dispose(),Hn.dispose(),F.dispose(),Je.dispose(),Q.dispose(),Q.removeEventListener("sessionstart",rB),Q.removeEventListener("sessionend",sB),wl.stop()},this.renderBufferDirect=function(w,k,q,X,V,Me){null===k&&(k=nn);const Re=V.isMesh&&V.matrixWorld.determinant()<0,nt=function Tce(w,k,q,X,V){!0!==k.isScene&&(k=nn),D.resetTextureUnits();const Me=k.fog,nt=null===I?v.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:zu,Ye=(X.isMeshStandardMaterial?j:S).get(X.envMap||(X.isMeshStandardMaterial?k.environment:null)),kt=!0===X.vertexColors&&!!q.attributes.color&&4===q.attributes.color.itemSize,Yt=!!q.attributes.tangent&&(!!X.normalMap||X.anisotropy>0),it=!!q.morphAttributes.position,dn=!!q.morphAttributes.normal,Zn=!!q.morphAttributes.color;let Pn=0;X.toneMapped&&(null===I||!0===I.isXRRenderTarget)&&(Pn=v.toneMapping);const zr=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,bn=void 0!==zr?zr.length:0,at=Be.get(X),ra=m.state.lights;!0!==Ee||!0!==Ge&&w===b||_e.setState(X,w,w===b&&X.id===M);let Sn=!1;X.version===at.__version?(at.needsLights&&at.lightsStateVersion!==ra.state.version||at.outputColorSpace!==nt||V.isBatchedMesh&&!1===at.batching||!V.isBatchedMesh&&!0===at.batching||V.isBatchedMesh&&!0===at.batchingColor&&null===V.colorTexture||V.isBatchedMesh&&!1===at.batchingColor&&null!==V.colorTexture||V.isInstancedMesh&&!1===at.instancing||!V.isInstancedMesh&&!0===at.instancing||V.isSkinnedMesh&&!1===at.skinning||!V.isSkinnedMesh&&!0===at.skinning||V.isInstancedMesh&&!0===at.instancingColor&&null===V.instanceColor||V.isInstancedMesh&&!1===at.instancingColor&&null!==V.instanceColor||V.isInstancedMesh&&!0===at.instancingMorph&&null===V.morphTexture||V.isInstancedMesh&&!1===at.instancingMorph&&null!==V.morphTexture||at.envMap!==Ye||!0===X.fog&&at.fog!==Me||void 0!==at.numClippingPlanes&&(at.numClippingPlanes!==_e.numPlanes||at.numIntersection!==_e.numIntersection)||at.vertexAlphas!==kt||at.vertexTangents!==Yt||at.morphTargets!==it||at.morphNormals!==dn||at.morphColors!==Zn||at.toneMapping!==Pn||at.morphTargetsCount!==bn)&&(Sn=!0):(Sn=!0,at.__version=X.version);let Vs=at.currentProgram;!0===Sn&&(Vs=dv(X,k,V));let Nd=!1,os=!1,op=!1;const Kn=Vs.getUniforms(),lo=at.uniforms;if(xe.useProgram(Vs.program)&&(Nd=!0,os=!0,op=!0),X.id!==M&&(M=X.id,os=!0),Nd||b!==w){xe.buffers.depth.getReversed()?(fe.copy(w.projectionMatrix),function xZ(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}(fe),function TZ(n){const e=n.elements;-1===e[11]?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=1-e[14])}(fe),Kn.setValue(R,"projectionMatrix",fe)):Kn.setValue(R,"projectionMatrix",w.projectionMatrix),Kn.setValue(R,"viewMatrix",w.matrixWorldInverse);const Ja=Kn.map.cameraPosition;void 0!==Ja&&Ja.setValue(R,Ke.setFromMatrixPosition(w.matrixWorld)),ze.logarithmicDepthBuffer&&Kn.setValue(R,"logDepthBufFC",2/(Math.log(w.far+1)/Math.LN2)),(X.isMeshPhongMaterial||X.isMeshToonMaterial||X.isMeshLambertMaterial||X.isMeshBasicMaterial||X.isMeshStandardMaterial||X.isShaderMaterial)&&Kn.setValue(R,"isOrthographic",!0===w.isOrthographicCamera),b!==w&&(b=w,os=!0,op=!0)}if(V.isSkinnedMesh){Kn.setOptional(R,V,"bindMatrix"),Kn.setOptional(R,V,"bindMatrixInverse");const bs=V.skeleton;bs&&(null===bs.boneTexture&&bs.computeBoneTexture(),Kn.setValue(R,"boneTexture",bs.boneTexture,D))}V.isBatchedMesh&&(Kn.setOptional(R,V,"batchingTexture"),Kn.setValue(R,"batchingTexture",V._matricesTexture,D),Kn.setOptional(R,V,"batchingIdTexture"),Kn.setValue(R,"batchingIdTexture",V._indirectTexture,D),Kn.setOptional(R,V,"batchingColorTexture"),null!==V._colorsTexture&&Kn.setValue(R,"batchingColorTexture",V._colorsTexture,D));const ap=q.morphAttributes;if((void 0!==ap.position||void 0!==ap.normal||void 0!==ap.color)&&Ot.update(V,q,Vs),(os||at.receiveShadow!==V.receiveShadow)&&(at.receiveShadow=V.receiveShadow,Kn.setValue(R,"receiveShadow",V.receiveShadow)),X.isMeshGouraudMaterial&&null!==X.envMap&&(lo.envMap.value=Ye,lo.flipEnvMap.value=Ye.isCubeTexture&&!1===Ye.isRenderTargetTexture?-1:1),X.isMeshStandardMaterial&&null===X.envMap&&null!==k.environment&&(lo.envMapIntensity.value=k.environmentIntensity),os&&(Kn.setValue(R,"toneMappingExposure",v.toneMappingExposure),at.needsLights&&function Cce(w,k){w.ambientLightColor.needsUpdate=k,w.lightProbe.needsUpdate=k,w.directionalLights.needsUpdate=k,w.directionalLightShadows.needsUpdate=k,w.pointLights.needsUpdate=k,w.pointLightShadows.needsUpdate=k,w.spotLights.needsUpdate=k,w.spotLightShadows.needsUpdate=k,w.rectAreaLights.needsUpdate=k,w.hemisphereLights.needsUpdate=k}(lo,op),Me&&!0===X.fog&&Ae.refreshFogUniforms(lo,Me),Ae.refreshMaterialUniforms(lo,X,B,Y,m.state.transmissionRenderTarget[w.id]),L_.upload(R,lB(at),lo,D)),X.isShaderMaterial&&!0===X.uniformsNeedUpdate&&(L_.upload(R,lB(at),lo,D),X.uniformsNeedUpdate=!1),X.isSpriteMaterial&&Kn.setValue(R,"center",V.center),Kn.setValue(R,"modelViewMatrix",V.modelViewMatrix),Kn.setValue(R,"normalMatrix",V.normalMatrix),Kn.setValue(R,"modelMatrix",V.matrixWorld),X.isShaderMaterial||X.isRawShaderMaterial){const bs=X.uniformsGroups;for(let Ja=0,Qa=bs.length;Ja<Qa;Ja++){const dB=bs[Ja];F.update(dB,Vs),F.bind(dB,Vs)}}return Vs}(w,k,q,X,V);xe.setMaterial(X,Re);let Ye=q.index,kt=1;if(!0===X.wireframe){if(Ye=he.getWireframeAttribute(q),void 0===Ye)return;kt=2}const Yt=q.drawRange,it=q.attributes.position;let dn=Yt.start*kt,Zn=(Yt.start+Yt.count)*kt;null!==Me&&(dn=Math.max(dn,Me.start*kt),Zn=Math.min(Zn,(Me.start+Me.count)*kt)),null!==Ye?(dn=Math.max(dn,0),Zn=Math.min(Zn,Ye.count)):null!=it&&(dn=Math.max(dn,0),Zn=Math.min(Zn,it.count));const Pn=Zn-dn;if(Pn<0||Pn===1/0)return;Hn.setup(V,X,nt,q,Ye);let zr,bn=$e;if(null!==Ye&&(zr=re.get(Ye),bn=un,bn.setIndex(zr)),V.isMesh)!0===X.wireframe?(xe.setLineWidth(X.wireframeLinewidth*be()),bn.setMode(R.LINES)):bn.setMode(R.TRIANGLES);else if(V.isLine){let at=X.linewidth;void 0===at&&(at=1),xe.setLineWidth(at*be()),bn.setMode(V.isLineSegments?R.LINES:V.isLineLoop?R.LINE_LOOP:R.LINE_STRIP)}else V.isPoints?bn.setMode(R.POINTS):V.isSprite&&bn.setMode(R.TRIANGLES);if(V.isBatchedMesh)if(null!==V._multiDrawInstances)bn.renderMultiDrawInstances(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount,V._multiDrawInstances);else if(me.get("WEBGL_multi_draw"))bn.renderMultiDraw(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount);else{const at=V._multiDrawStarts,ra=V._multiDrawCounts,Sn=V._multiDrawCount,Vs=Ye?re.get(Ye).bytesPerElement:1,Nd=Be.get(X).currentProgram.getUniforms();for(let os=0;os<Sn;os++)Nd.setValue(R,"_gl_DrawID",os),bn.render(at[os]/Vs,ra[os])}else if(V.isInstancedMesh)bn.renderInstances(dn,Pn,V.count);else if(q.isInstancedBufferGeometry){const ra=Math.min(q.instanceCount,void 0!==q._maxInstanceCount?q._maxInstanceCount:1/0);bn.renderInstances(dn,Pn,ra)}else bn.render(dn,Pn)},this.compile=function(w,k,q=null){null===q&&(q=w),m=sn.get(q),m.init(k),E.push(m),q.traverseVisible(function(V){V.isLight&&V.layers.test(k.layers)&&(m.pushLight(V),V.castShadow&&m.pushShadow(V))}),w!==q&&w.traverseVisible(function(V){V.isLight&&V.layers.test(k.layers)&&(m.pushLight(V),V.castShadow&&m.pushShadow(V))}),m.setupLights();const X=new Set;return w.traverse(function(V){if(!(V.isMesh||V.isPoints||V.isLine||V.isSprite))return;const Me=V.material;if(Me)if(Array.isArray(Me))for(let Re=0;Re<Me.length;Re++){const nt=Me[Re];wn(nt,q,V),X.add(nt)}else wn(Me,q,V),X.add(Me)}),E.pop(),m=null,X},this.compileAsync=function(w,k,q=null){const X=this.compile(w,k,q);return new Promise(V=>{function Me(){X.forEach(function(Re){Be.get(Re).currentProgram.isReady()&&X.delete(Re)}),0!==X.size?setTimeout(Me,10):V(w)}null!==me.get("KHR_parallel_shader_compile")?Me():setTimeout(Me,10)})};let Bs=null;function rB(){wl.stop()}function sB(){wl.start()}const wl=new nF;function aT(w,k,q,X){if(!1===w.visible)return;if(w.layers.test(k.layers))if(w.isGroup)q=w.renderOrder;else if(w.isLOD)!0===w.autoUpdate&&w.update(k);else if(w.isLight)m.pushLight(w),w.castShadow&&m.pushShadow(w);else if(w.isSprite){if(!w.frustumCulled||K.intersectsSprite(w)){X&&gt.setFromMatrixPosition(w.matrixWorld).applyMatrix4(qe);const Re=se.update(w),nt=w.material;nt.visible&&g.push(w,Re,nt,q,gt.z,null)}}else if((w.isMesh||w.isLine||w.isPoints)&&(!w.frustumCulled||K.intersectsObject(w))){const Re=se.update(w),nt=w.material;if(X&&(void 0!==w.boundingSphere?(null===w.boundingSphere&&w.computeBoundingSphere(),gt.copy(w.boundingSphere.center)):(null===Re.boundingSphere&&Re.computeBoundingSphere(),gt.copy(Re.boundingSphere.center)),gt.applyMatrix4(w.matrixWorld).applyMatrix4(qe)),Array.isArray(nt)){const Ye=Re.groups;for(let kt=0,Yt=Ye.length;kt<Yt;kt++){const it=Ye[kt],dn=nt[it.materialIndex];dn&&dn.visible&&g.push(w,Re,dn,q,gt.z,it)}}else nt.visible&&g.push(w,Re,nt,q,gt.z,null)}const Me=w.children;for(let Re=0,nt=Me.length;Re<nt;Re++)aT(Me[Re],k,q,X)}function oB(w,k,q,X){const V=w.opaque,Me=w.transmissive,Re=w.transparent;m.setupLightsView(q),!0===Ee&&_e.setGlobalState(v.clippingPlanes,q),X&&xe.viewport(P.copy(X)),V.length>0&&uv(V,k,q),Me.length>0&&uv(Me,k,q),Re.length>0&&uv(Re,k,q),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1)}function aB(w,k,q,X){if(null!==(!0===q.isScene?q.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[X.id]&&(m.state.transmissionRenderTarget[X.id]=new eo(1,1,{generateMipmaps:!0,type:me.has("EXT_color_buffer_half_float")||me.has("EXT_color_buffer_float")?uf:ko,minFilter:Fo,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ln.workingColorSpace}));const Me=m.state.transmissionRenderTarget[X.id],Re=X.viewport||P;Me.setSize(Re.z,Re.w);const nt=v.getRenderTarget();v.setRenderTarget(Me),v.getClearColor(J),ce=v.getClearAlpha(),ce<1&&v.setClearColor(16777215,.5),v.clear(),ue&&wt.render(q);const Ye=v.toneMapping;v.toneMapping=0;const kt=X.viewport;if(void 0!==X.viewport&&(X.viewport=void 0),m.setupLightsView(X),!0===Ee&&_e.setGlobalState(v.clippingPlanes,X),uv(w,q,X),D.updateMultisampleRenderTarget(Me),D.updateRenderTargetMipmap(Me),!1===me.has("WEBGL_multisampled_render_to_texture")){let Yt=!1;for(let it=0,dn=k.length;it<dn;it++){const Zn=k[it],Pn=Zn.object,zr=Zn.geometry,bn=Zn.material,at=Zn.group;if(2===bn.side&&Pn.layers.test(X.layers)){const ra=bn.side;bn.side=1,bn.needsUpdate=!0,cB(Pn,q,X,zr,bn,at),bn.side=ra,bn.needsUpdate=!0,Yt=!0}}!0===Yt&&(D.updateMultisampleRenderTarget(Me),D.updateRenderTargetMipmap(Me))}v.setRenderTarget(nt),v.setClearColor(J,ce),void 0!==kt&&(X.viewport=kt),v.toneMapping=Ye}function uv(w,k,q){const X=!0===k.isScene?k.overrideMaterial:null;for(let V=0,Me=w.length;V<Me;V++){const Re=w[V],nt=Re.object,Ye=Re.geometry,kt=null===X?Re.material:X,Yt=Re.group;nt.layers.test(q.layers)&&cB(nt,k,q,Ye,kt,Yt)}}function cB(w,k,q,X,V,Me){w.onBeforeRender(v,k,q,X,V,Me),w.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,w.matrixWorld),w.normalMatrix.getNormalMatrix(w.modelViewMatrix),V.onBeforeRender(v,k,q,X,w,Me),!0===V.transparent&&2===V.side&&!1===V.forceSinglePass?(V.side=1,V.needsUpdate=!0,v.renderBufferDirect(q,k,X,V,w,Me),V.side=0,V.needsUpdate=!0,v.renderBufferDirect(q,k,X,V,w,Me),V.side=2):v.renderBufferDirect(q,k,X,V,w,Me),w.onAfterRender(v,k,q,X,V,Me)}function dv(w,k,q){!0!==k.isScene&&(k=nn);const X=Be.get(w),V=m.state.lights,Re=V.state.version,nt=Je.getParameters(w,V.state,m.state.shadowsArray,k,q),Ye=Je.getProgramCacheKey(nt);let kt=X.programs;X.environment=w.isMeshStandardMaterial?k.environment:null,X.fog=k.fog,X.envMap=(w.isMeshStandardMaterial?j:S).get(w.envMap||X.environment),X.envMapRotation=null!==X.environment&&null===w.envMap?k.environmentRotation:w.envMapRotation,void 0===kt&&(w.addEventListener("dispose",Xt),kt=new Map,X.programs=kt);let Yt=kt.get(Ye);if(void 0!==Yt){if(X.currentProgram===Yt&&X.lightsStateVersion===Re)return uB(w,nt),Yt}else nt.uniforms=Je.getUniforms(w),w.onBeforeCompile(nt,v),Yt=Je.acquireProgram(nt,Ye),kt.set(Ye,Yt),X.uniforms=nt.uniforms;const it=X.uniforms;return(!w.isShaderMaterial&&!w.isRawShaderMaterial||!0===w.clipping)&&(it.clippingPlanes=_e.uniform),uB(w,nt),X.needsLights=function Dce(w){return w.isMeshLambertMaterial||w.isMeshToonMaterial||w.isMeshPhongMaterial||w.isMeshStandardMaterial||w.isShadowMaterial||w.isShaderMaterial&&!0===w.lights}(w),X.lightsStateVersion=Re,X.needsLights&&(it.ambientLightColor.value=V.state.ambient,it.lightProbe.value=V.state.probe,it.directionalLights.value=V.state.directional,it.directionalLightShadows.value=V.state.directionalShadow,it.spotLights.value=V.state.spot,it.spotLightShadows.value=V.state.spotShadow,it.rectAreaLights.value=V.state.rectArea,it.ltc_1.value=V.state.rectAreaLTC1,it.ltc_2.value=V.state.rectAreaLTC2,it.pointLights.value=V.state.point,it.pointLightShadows.value=V.state.pointShadow,it.hemisphereLights.value=V.state.hemi,it.directionalShadowMap.value=V.state.directionalShadowMap,it.directionalShadowMatrix.value=V.state.directionalShadowMatrix,it.spotShadowMap.value=V.state.spotShadowMap,it.spotLightMatrix.value=V.state.spotLightMatrix,it.spotLightMap.value=V.state.spotLightMap,it.pointShadowMap.value=V.state.pointShadowMap,it.pointShadowMatrix.value=V.state.pointShadowMatrix),X.currentProgram=Yt,X.uniformsList=null,Yt}function lB(w){if(null===w.uniformsList){const k=w.currentProgram.getUniforms();w.uniformsList=L_.seqWithValue(k.seq,w.uniforms)}return w.uniformsList}function uB(w,k){const q=Be.get(w);q.outputColorSpace=k.outputColorSpace,q.batching=k.batching,q.batchingColor=k.batchingColor,q.instancing=k.instancing,q.instancingColor=k.instancingColor,q.instancingMorph=k.instancingMorph,q.skinning=k.skinning,q.morphTargets=k.morphTargets,q.morphNormals=k.morphNormals,q.morphColors=k.morphColors,q.morphTargetsCount=k.morphTargetsCount,q.numClippingPlanes=k.numClippingPlanes,q.numIntersection=k.numClipIntersection,q.vertexAlphas=k.vertexAlphas,q.vertexTangents=k.vertexTangents,q.toneMapping=k.toneMapping}wl.setAnimationLoop(function ia(w){Bs&&Bs(w)}),typeof self<"u"&&wl.setContext(self),this.setAnimationLoop=function(w){Bs=w,Q.setAnimationLoop(w),null===w?wl.stop():wl.start()},Q.addEventListener("sessionstart",rB),Q.addEventListener("sessionend",sB),this.render=function(w,k){if(void 0!==k&&!0!==k.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===C)return;if(!0===w.matrixWorldAutoUpdate&&w.updateMatrixWorld(),null===k.parent&&!0===k.matrixWorldAutoUpdate&&k.updateMatrixWorld(),!0===Q.enabled&&!0===Q.isPresenting&&(!0===Q.cameraAutoUpdate&&Q.updateCamera(k),k=Q.getCamera()),!0===w.isScene&&w.onBeforeRender(v,w,k,I),m=sn.get(w,E.length),m.init(k),E.push(m),qe.multiplyMatrices(k.projectionMatrix,k.matrixWorldInverse),K.setFromProjectionMatrix(qe),Ge=this.localClippingEnabled,Ee=_e.init(this.clippingPlanes,Ge),g=Ve.get(w,y.length),g.init(),y.push(g),!0===Q.enabled&&!0===Q.isPresenting){const Me=v.xr.getDepthSensingMesh();null!==Me&&aT(Me,k,-1/0,v.sortObjects)}aT(w,k,0,v.sortObjects),g.finish(),!0===v.sortObjects&&g.sort(ae,ve),ue=!1===Q.enabled||!1===Q.isPresenting||!1===Q.hasDepthSensing(),ue&&wt.addToRenderList(g,w),this.info.render.frame++,!0===Ee&&_e.beginShadows(),je.render(m.state.shadowsArray,w,k),!0===Ee&&_e.endShadows(),!0===this.info.autoReset&&this.info.reset();const X=g.opaque,V=g.transmissive;if(m.setupLights(),k.isArrayCamera){const Me=k.cameras;if(V.length>0)for(let Re=0,nt=Me.length;Re<nt;Re++)aB(X,V,w,Me[Re]);ue&&wt.render(w);for(let Re=0,nt=Me.length;Re<nt;Re++){const Ye=Me[Re];oB(g,w,Ye,Ye.viewport)}}else V.length>0&&aB(X,V,w,k),ue&&wt.render(w),oB(g,w,k);null!==I&&(D.updateMultisampleRenderTarget(I),D.updateRenderTargetMipmap(I)),!0===w.isScene&&w.onAfterRender(v,w,k),Hn.resetDefaultState(),M=-1,b=null,E.pop(),E.length>0?(m=E[E.length-1],!0===Ee&&_e.setGlobalState(v.clippingPlanes,m.state.camera)):m=null,y.pop(),g=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(w,k,q){Be.get(w.texture).__webglTexture=k,Be.get(w.depthTexture).__webglTexture=q;const X=Be.get(w);X.__hasExternalTextures=!0,X.__autoAllocateDepthBuffer=void 0===q,X.__autoAllocateDepthBuffer||!0===me.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),X.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(w,k){const q=Be.get(w);q.__webglFramebuffer=k,q.__useDefaultFramebuffer=void 0===k},this.setRenderTarget=function(w,k=0,q=0){I=w,x=k,T=q;let X=!0,V=null,Me=!1,Re=!1;if(w){const Ye=Be.get(w);if(void 0!==Ye.__useDefaultFramebuffer)xe.bindFramebuffer(R.FRAMEBUFFER,null),X=!1;else if(void 0===Ye.__webglFramebuffer)D.setupRenderTarget(w);else if(Ye.__hasExternalTextures)D.rebindTextures(w,Be.get(w.texture).__webglTexture,Be.get(w.depthTexture).__webglTexture);else if(w.depthBuffer){const it=w.depthTexture;if(Ye.__boundDepthTexture!==it){if(null!==it&&Be.has(it)&&(w.width!==it.image.width||w.height!==it.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");D.setupDepthRenderbuffer(w)}}const kt=w.texture;(kt.isData3DTexture||kt.isDataArrayTexture||kt.isCompressedArrayTexture)&&(Re=!0);const Yt=Be.get(w).__webglFramebuffer;w.isWebGLCubeRenderTarget?(V=Array.isArray(Yt[k])?Yt[k][q]:Yt[k],Me=!0):V=w.samples>0&&!1===D.useMultisampledRTT(w)?Be.get(w).__webglMultisampledFramebuffer:Array.isArray(Yt)?Yt[q]:Yt,P.copy(w.viewport),W.copy(w.scissor),$=w.scissorTest}else P.copy(De).multiplyScalar(B).floor(),W.copy(ot).multiplyScalar(B).floor(),$=tn;if(xe.bindFramebuffer(R.FRAMEBUFFER,V)&&X&&xe.drawBuffers(w,V),xe.viewport(P),xe.scissor(W),xe.setScissorTest($),Me){const Ye=Be.get(w.texture);R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+k,Ye.__webglTexture,q)}else if(Re){const Ye=Be.get(w.texture);R.framebufferTextureLayer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,Ye.__webglTexture,q||0,k||0)}M=-1},this.readRenderTargetPixels=function(w,k,q,X,V,Me,Re){if(!w||!w.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let nt=Be.get(w).__webglFramebuffer;if(w.isWebGLCubeRenderTarget&&void 0!==Re&&(nt=nt[Re]),nt){xe.bindFramebuffer(R.FRAMEBUFFER,nt);try{const Ye=w.texture,kt=Ye.format,Yt=Ye.type;if(!ze.textureFormatReadable(kt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!ze.textureTypeReadable(Yt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");k>=0&&k<=w.width-X&&q>=0&&q<=w.height-V&&R.readPixels(k,q,X,V,en.convert(kt),en.convert(Yt),Me)}finally{const Ye=null!==I?Be.get(I).__webglFramebuffer:null;xe.bindFramebuffer(R.FRAMEBUFFER,Ye)}}},this.readRenderTargetPixelsAsync=function(){var w=$n(function*(k,q,X,V,Me,Re,nt){if(!k||!k.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ye=Be.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&void 0!==nt&&(Ye=Ye[nt]),Ye){const kt=k.texture,Yt=kt.format,it=kt.type;if(!ze.textureFormatReadable(Yt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!ze.textureTypeReadable(it))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(q>=0&&q<=k.width-V&&X>=0&&X<=k.height-Me){xe.bindFramebuffer(R.FRAMEBUFFER,Ye);const dn=R.createBuffer();R.bindBuffer(R.PIXEL_PACK_BUFFER,dn),R.bufferData(R.PIXEL_PACK_BUFFER,Re.byteLength,R.STREAM_READ),R.readPixels(q,X,V,Me,en.convert(Yt),en.convert(it),0);const Zn=null!==I?Be.get(I).__webglFramebuffer:null;xe.bindFramebuffer(R.FRAMEBUFFER,Zn);const Pn=R.fenceSync(R.SYNC_GPU_COMMANDS_COMPLETE,0);return R.flush(),yield function wZ(n,e,t){return new Promise(function(i,r){setTimeout(function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}},t)})}(R,Pn,4),R.bindBuffer(R.PIXEL_PACK_BUFFER,dn),R.getBufferSubData(R.PIXEL_PACK_BUFFER,0,Re),R.deleteBuffer(dn),R.deleteSync(Pn),Re}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}});return function(k,q,X,V,Me,Re,nt){return w.apply(this,arguments)}}(),this.copyFramebufferToTexture=function(w,k=null,q=0){!0!==w.isTexture&&(ff("WebGLRenderer: copyFramebufferToTexture function signature has changed."),k=arguments[0]||null,w=arguments[1]);const X=Math.pow(2,-q),V=Math.floor(w.image.width*X),Me=Math.floor(w.image.height*X),Re=null!==k?k.x:0,nt=null!==k?k.y:0;D.setTexture2D(w,0),R.copyTexSubImage2D(R.TEXTURE_2D,q,0,0,Re,nt,V,Me),xe.unbindTexture()},this.copyTextureToTexture=function(w,k,q=null,X=null,V=0){let Me,Re,nt,Ye,kt,Yt,it,dn,Zn;!0!==w.isTexture&&(ff("WebGLRenderer: copyTextureToTexture function signature has changed."),X=arguments[0]||null,w=arguments[1],k=arguments[2],V=arguments[3]||0,q=null);const Pn=w.isCompressedTexture?w.mipmaps[V]:w.image;null!==q?(Me=q.max.x-q.min.x,Re=q.max.y-q.min.y,nt=q.isBox3?q.max.z-q.min.z:1,Ye=q.min.x,kt=q.min.y,Yt=q.isBox3?q.min.z:0):(Me=Pn.width,Re=Pn.height,nt=Pn.depth||1,Ye=0,kt=0,Yt=0),null!==X?(it=X.x,dn=X.y,Zn=X.z):(it=0,dn=0,Zn=0);const zr=en.convert(k.format),bn=en.convert(k.type);let at;k.isData3DTexture?(D.setTexture3D(k,0),at=R.TEXTURE_3D):k.isDataArrayTexture||k.isCompressedArrayTexture?(D.setTexture2DArray(k,0),at=R.TEXTURE_2D_ARRAY):(D.setTexture2D(k,0),at=R.TEXTURE_2D),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,k.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,k.unpackAlignment);const ra=R.getParameter(R.UNPACK_ROW_LENGTH),Sn=R.getParameter(R.UNPACK_IMAGE_HEIGHT),Vs=R.getParameter(R.UNPACK_SKIP_PIXELS),Nd=R.getParameter(R.UNPACK_SKIP_ROWS),os=R.getParameter(R.UNPACK_SKIP_IMAGES);R.pixelStorei(R.UNPACK_ROW_LENGTH,Pn.width),R.pixelStorei(R.UNPACK_IMAGE_HEIGHT,Pn.height),R.pixelStorei(R.UNPACK_SKIP_PIXELS,Ye),R.pixelStorei(R.UNPACK_SKIP_ROWS,kt),R.pixelStorei(R.UNPACK_SKIP_IMAGES,Yt);const op=w.isDataArrayTexture||w.isData3DTexture,Kn=k.isDataArrayTexture||k.isData3DTexture;if(w.isRenderTargetTexture||w.isDepthTexture){const lo=Be.get(w),ap=Be.get(k),bs=Be.get(lo.__renderTarget),Ja=Be.get(ap.__renderTarget);xe.bindFramebuffer(R.READ_FRAMEBUFFER,bs.__webglFramebuffer),xe.bindFramebuffer(R.DRAW_FRAMEBUFFER,Ja.__webglFramebuffer);for(let Qa=0;Qa<nt;Qa++)op&&R.framebufferTextureLayer(R.READ_FRAMEBUFFER,R.COLOR_ATTACHMENT0,Be.get(w).__webglTexture,V,Yt+Qa),w.isDepthTexture?(Kn&&R.framebufferTextureLayer(R.DRAW_FRAMEBUFFER,R.COLOR_ATTACHMENT0,Be.get(k).__webglTexture,V,Zn+Qa),R.blitFramebuffer(Ye,kt,Me,Re,it,dn,Me,Re,R.DEPTH_BUFFER_BIT,R.NEAREST)):Kn?R.copyTexSubImage3D(at,V,it,dn,Zn+Qa,Ye,kt,Me,Re):R.copyTexSubImage2D(at,V,it,dn,Zn+Qa,Ye,kt,Me,Re);xe.bindFramebuffer(R.READ_FRAMEBUFFER,null),xe.bindFramebuffer(R.DRAW_FRAMEBUFFER,null)}else Kn?w.isDataTexture||w.isData3DTexture?R.texSubImage3D(at,V,it,dn,Zn,Me,Re,nt,zr,bn,Pn.data):k.isCompressedArrayTexture?R.compressedTexSubImage3D(at,V,it,dn,Zn,Me,Re,nt,zr,Pn.data):R.texSubImage3D(at,V,it,dn,Zn,Me,Re,nt,zr,bn,Pn):w.isDataTexture?R.texSubImage2D(R.TEXTURE_2D,V,it,dn,Me,Re,zr,bn,Pn.data):w.isCompressedTexture?R.compressedTexSubImage2D(R.TEXTURE_2D,V,it,dn,Pn.width,Pn.height,zr,Pn.data):R.texSubImage2D(R.TEXTURE_2D,V,it,dn,Me,Re,zr,bn,Pn);R.pixelStorei(R.UNPACK_ROW_LENGTH,ra),R.pixelStorei(R.UNPACK_IMAGE_HEIGHT,Sn),R.pixelStorei(R.UNPACK_SKIP_PIXELS,Vs),R.pixelStorei(R.UNPACK_SKIP_ROWS,Nd),R.pixelStorei(R.UNPACK_SKIP_IMAGES,os),0===V&&k.generateMipmaps&&R.generateMipmap(at),xe.unbindTexture()},this.copyTextureToTexture3D=function(w,k,q=null,X=null,V=0){return!0!==w.isTexture&&(ff("WebGLRenderer: copyTextureToTexture3D function signature has changed."),q=arguments[0]||null,X=arguments[1]||null,w=arguments[2],k=arguments[3],V=arguments[4]||0),ff('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(w,k,q,X,V)},this.initRenderTarget=function(w){void 0===Be.get(w).__webglFramebuffer&&D.setupRenderTarget(w)},this.initTexture=function(w){w.isCubeTexture?D.setTextureCube(w,0):w.isData3DTexture?D.setTexture3D(w,0):w.isDataArrayTexture||w.isCompressedArrayTexture?D.setTexture2DArray(w,0):D.setTexture2D(w,0),xe.unbindTexture()},this.resetState=function(){x=0,T=0,I=null,xe.reset(),Hn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Uo}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=ln._getDrawingBufferColorSpace(e),t.unpackColorSpace=ln._getUnpackColorSpace()}}class k_{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Le(e),this.near=t,this.far=i}clone(){return new k_(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class OF extends Xn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Go,this.environmentIntensity=1,this.environmentRotation=new Go,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Ur extends _r{static get type(){return"LineBasicMaterial"}constructor(e){super(),this.isLineBasicMaterial=!0,this.color=new Le(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const W_=new A,q_=new A,ZF=new Ct,Af=new Ku,X_=new gr,gw=new A,KF=new A;class il extends Xn{constructor(e=new Jt,t=new Ur){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)W_.fromBufferAttribute(t,r-1),q_.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=W_.distanceTo(q_);e.setAttribute("lineDistance",new Xe(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),X_.copy(i.boundingSphere),X_.applyMatrix4(r),X_.radius+=s,!1===e.ray.intersectsSphere(X_))return;ZF.copy(r).invert(),Af.copy(e.ray).applyMatrix4(ZF);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=this.isLineSegments?2:1,u=i.index,h=i.attributes.position;if(null!==u){const f=Math.max(0,o.start),p=Math.min(u.count,o.start+o.count);for(let _=f,g=p-1;_<g;_+=l){const m=u.getX(_),y=u.getX(_+1),E=Y_(this,e,Af,c,m,y);E&&t.push(E)}if(this.isLineLoop){const _=u.getX(p-1),g=u.getX(f),m=Y_(this,e,Af,c,_,g);m&&t.push(m)}}else{const f=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let _=f,g=p-1;_<g;_+=l){const m=Y_(this,e,Af,c,_,_+1);m&&t.push(m)}if(this.isLineLoop){const _=Y_(this,e,Af,c,p-1,f);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Y_(n,e,t,i,r,s){const o=n.geometry.attributes.position;if(W_.fromBufferAttribute(o,r),q_.fromBufferAttribute(o,s),t.distanceSqToSegment(W_,q_,gw,KF)>i)return;gw.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(gw);return c<e.near||c>e.far?void 0:{distance:c,point:KF.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:n}}const JF=new A,QF=new A;class Zo extends il{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)JF.fromBufferAttribute(t,r),QF.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+JF.distanceTo(QF);e.setAttribute("lineDistance",new Xe(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Pf extends Jt{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,c=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};const l=this;r=Math.floor(r),s=Math.floor(s);const u=[],d=[],h=[],f=[];let p=0;const _=[],g=i/2;let m=0;function E(v){const C=p,x=new ie,T=new A;let I=0;const M=!0===v?e:t,b=!0===v?1:-1;for(let W=1;W<=r;W++)d.push(0,g*b,0),h.push(0,b,0),f.push(.5,.5),p++;const P=p;for(let W=0;W<=r;W++){const J=W/r*c+a,ce=Math.cos(J),L=Math.sin(J);T.x=M*L,T.y=g*b,T.z=M*ce,d.push(T.x,T.y,T.z),h.push(0,b,0),x.x=.5*ce+.5,x.y=.5*L*b+.5,f.push(x.x,x.y),p++}for(let W=0;W<r;W++){const $=C+W,J=P+W;!0===v?u.push(J,J+1,$):u.push(J+1,J,$),I+=3}l.addGroup(m,I,!0===v?1:2),m+=I}(function y(){const v=new A,C=new A;let x=0;const T=(t-e)/i;for(let I=0;I<=s;I++){const M=[],b=I/s,P=b*(t-e)+e;for(let W=0;W<=r;W++){const $=W/r,J=$*c+a,ce=Math.sin(J),L=Math.cos(J);C.x=P*ce,C.y=-b*i+g,C.z=P*L,d.push(C.x,C.y,C.z),v.set(ce,T,L).normalize(),h.push(v.x,v.y,v.z),f.push($,1-b),M.push(p++)}_.push(M)}for(let I=0;I<r;I++)for(let M=0;M<s;M++){const P=_[M+1][I],W=_[M+1][I+1],$=_[M][I+1];(e>0||0!==M)&&(u.push(_[M][I],P,$),x+=3),(t>0||M!==s-1)&&(u.push(P,W,$),x+=3)}l.addGroup(m,x,0),m+=x})(),!1===o&&(e>0&&E(!0),t>0&&E(!1)),this.setIndex(u),this.setAttribute("position",new Xe(d,3)),this.setAttribute("normal",new Xe(h,3)),this.setAttribute("uv",new Xe(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pf(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ny extends Pf{constructor(e=1,t=1,i=32,r=1,s=!1,o=0,a=2*Math.PI){super(0,e,t,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new ny(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class uy extends Jt{constructor(e=.5,t=1,i=32,r=1,s=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:o},i=Math.max(3,i);const a=[],c=[],l=[],u=[];let d=e;const h=(t-e)/(r=Math.max(1,r)),f=new A,p=new ie;for(let _=0;_<=r;_++){for(let g=0;g<=i;g++){const m=s+g/i*o;f.x=d*Math.cos(m),f.y=d*Math.sin(m),c.push(f.x,f.y,f.z),l.push(0,0,1),p.x=(f.x/t+1)/2,p.y=(f.y/t+1)/2,u.push(p.x,p.y)}d+=h}for(let _=0;_<r;_++){const g=_*(i+1);for(let m=0;m<i;m++){const y=m+g,v=y+i+1,C=y+i+2,x=y+1;a.push(y,v,x),a.push(v,C,x)}}this.setIndex(a),this.setAttribute("position",new Xe(c,3)),this.setAttribute("normal",new Xe(l,3)),this.setAttribute("uv",new Xe(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uy(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class vd extends Jt{constructor(e=1,t=32,i=16,r=0,s=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const c=Math.min(o+a,Math.PI);let l=0;const u=[],d=new A,h=new A,f=[],p=[],_=[],g=[];for(let m=0;m<=i;m++){const y=[],E=m/i;let v=0;0===m&&0===o?v=.5/t:m===i&&c===Math.PI&&(v=-.5/t);for(let C=0;C<=t;C++){const x=C/t;d.x=-e*Math.cos(r+x*s)*Math.sin(o+E*a),d.y=e*Math.cos(o+E*a),d.z=e*Math.sin(r+x*s)*Math.sin(o+E*a),p.push(d.x,d.y,d.z),h.copy(d).normalize(),_.push(h.x,h.y,h.z),g.push(x+v,1-E),y.push(l++)}u.push(y)}for(let m=0;m<i;m++)for(let y=0;y<t;y++){const v=u[m][y],C=u[m+1][y],x=u[m+1][y+1];(0!==m||o>0)&&f.push(u[m][y+1],v,x),(m!==i-1||c<Math.PI)&&f.push(v,C,x)}this.setIndex(f),this.setAttribute("position",new Xe(p,3)),this.setAttribute("normal",new Xe(_,3)),this.setAttribute("uv",new Xe(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vd(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class dy extends _r{static get type(){return"MeshStandardMaterial"}constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new Le(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Le(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Go,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function ol(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}class hy{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(i=2,s=a);for(let c=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===c)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class une extends hy{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],c=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-i;break;case 2402:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===c)switch(this.getSettings_().endingEnd){case 2401:o=e,c=2*i-t;break;case 2402:o=1,c=i+r[1]-r[0];break;default:o=e-1,c=t}const l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(c-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(i-t)/(r-t),_=p*p,g=_*p,m=-h*g+2*h*_-h*p,y=(1+h)*g+(-1.5-2*h)*_+(-.5+h)*p+1,E=(-1-f)*g+(1.5+f)*_+.5*p,v=f*g-f*_;for(let C=0;C!==a;++C)s[C]=m*o[u+C]+y*o[l+C]+E*o[c+C]+v*o[d+C];return s}}class vk extends hy{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=(i-t)/(r-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[l+h]*d+o[c+h]*u;return s}}class dne extends hy{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class ro{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ol(t,this.TimeBufferType),this.values=ol(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:ol(e.times,Array),values:ol(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new dne(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new vk(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new une(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const c=i[a];if("number"==typeof c&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(null!==o&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(void 0!==r&&function _k(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}(r))for(let a=0,c=r.length;a!==c;++a){const l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const l=e[a];if(l!==e[a+1]&&(1!==a||l!==e[0]))if(r)c=!0;else{const d=a*i,h=d-i,f=d+i;for(let p=0;p!==i;++p){const _=t[d+p];if(_!==t[h+p]||_!==t[f+p]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const d=a*i,h=o*i;for(let f=0;f!==i;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,c=o*i,l=0;l!==i;++l)t[c+l]=t[a+l];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}ro.prototype.TimeBufferType=Float32Array,ro.prototype.ValueBufferType=Float32Array,ro.prototype.DefaultInterpolation=2301;class Ed extends ro{constructor(e,t,i){super(e,t,i)}}Ed.prototype.ValueTypeName="bool",Ed.prototype.ValueBufferType=Array,Ed.prototype.DefaultInterpolation=2300,Ed.prototype.InterpolantFactoryMethodLinear=void 0,Ed.prototype.InterpolantFactoryMethodSmooth=void 0;(class Ek extends ro{}).prototype.ValueTypeName="color";(class fy extends ro{}).prototype.ValueTypeName="number";class hne extends hy{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(i-t)/(r-t);let l=e*a;for(let u=l+a;l!==u;l+=4)mr.slerpFlat(s,0,o,l-a,o,l,c);return s}}class py extends ro{InterpolantFactoryMethodLinear(e){return new hne(this.times,this.values,this.getValueSize(),e)}}py.prototype.ValueTypeName="quaternion",py.prototype.InterpolantFactoryMethodSmooth=void 0;class bd extends ro{constructor(e,t,i){super(e,t,i)}}bd.prototype.ValueTypeName="string",bd.prototype.ValueBufferType=Array,bd.prototype.DefaultInterpolation=2300,bd.prototype.InterpolantFactoryMethodLinear=void 0,bd.prototype.InterpolantFactoryMethodSmooth=void 0;(class my extends ro{}).prototype.ValueTypeName="vector",Error;class al extends Xn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Le(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}const Bw=new Ct,Sk=new A,Mk=new A;class Vw{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ie(512,512),this.map=null,this.mapPass=null,this.matrix=new Ct,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new R_,this._frameExtents=new ie(1,1),this._viewportCount=1,this._viewports=[new gn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Sk.setFromMatrixPosition(e.matrixWorld),t.position.copy(Sk),Mk.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Mk),t.updateMatrixWorld(),Bw.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bw),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Bw)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Sne extends Vw{constructor(){super(new ZM(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class yy extends al{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Xn.DEFAULT_UP),this.updateMatrix(),this.target=new Xn,this.shadow=new Sne}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class xk extends al{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Pk{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Nk(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Nk();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Nk(){return performance.now()}const Gw="\\[\\]\\.:\\/",Nne=new RegExp("["+Gw+"]","g"),jw="[^"+Gw+"]",One="[^"+Gw.replace("\\.","")+"]",Bne=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",jw)+/(WCOD+)?/.source.replace("WCOD",One)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",jw)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",jw)+"$"),Vne=["material","materials","bones","map"];class zne{constructor(e,t,i){const r=i||Yn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let Yn=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Nne,"")}static parseTrackName(t){const i=Bne.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=r.nodeName.substring(s+1);-1!==Vne.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(o){for(let a=0;a<o.length;a++){const c=o[a];if(c.name===i||c.uuid===i)return c;const l=r(c.children);if(l)return l}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=zne,n})();Yn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Yn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Yn.prototype.GetterByBindingType=[Yn.prototype._getValue_direct,Yn.prototype._getValue_array,Yn.prototype._getValue_arrayElement,Yn.prototype._getValue_toArray],Yn.prototype.SetterByBindingTypeAndVersioning=[[Yn.prototype._setValue_direct,Yn.prototype._setValue_direct_setNeedsUpdate,Yn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Yn.prototype._setValue_array,Yn.prototype._setValue_array_setNeedsUpdate,Yn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Yn.prototype._setValue_arrayElement,Yn.prototype._setValue_arrayElement_setNeedsUpdate,Yn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Yn.prototype._setValue_fromArray,Yn.prototype._setValue_fromArray_setNeedsUpdate,Yn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class Bk{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ui(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Wne extends Zo{constructor(e=10,t=10,i=4473924,r=8947848){i=new Le(i),r=new Le(r);const s=t/2,o=e/t,a=e/2,c=[],l=[];for(let h=0,f=0,p=-a;h<=t;h++,p+=o){c.push(-a,0,p,a,0,p),c.push(p,0,-a,p,0,a);const _=h===s?i:r;_.toArray(l,f),f+=3,_.toArray(l,f),f+=3,_.toArray(l,f),f+=3,_.toArray(l,f),f+=3}const u=new Jt;u.setAttribute("position",new Xe(c,3)),u.setAttribute("color",new Xe(l,3)),super(u,new Ur({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class qne extends Zo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Jt;r.setAttribute("position",new Xe(t,3)),r.setAttribute("color",new Xe([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new Ur({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){const r=new Le,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Xne extends Bo{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"170"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="170");const Zk={type:"change"},Xw={type:"start"},Kk={type:"end"},Ty=new Ku,Jk=new Ga,Yne=Math.cos(70*bZ_DEG2RAD),Ii=new A,Br=2*Math.PI,Yw=1e-6;class Zne extends Xne{constructor(e,t=null){super(e,t),this.state=-1,this.enabled=!0,this.target=new A,this.cursor=new A,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new A,this._lastQuaternion=new mr,this._lastTargetPosition=new A,this._quat=(new mr).setFromUnitVectors(e.up,new A(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Bk,this._sphericalDelta=new Bk,this._scale=1,this._panOffset=new A,this._rotateStart=new ie,this._rotateEnd=new ie,this._rotateDelta=new ie,this._panStart=new ie,this._panEnd=new ie,this._panDelta=new ie,this._dollyStart=new ie,this._dollyEnd=new ie,this._dollyDelta=new ie,this._dollyDirection=new A,this._mouse=new ie,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Jne.bind(this),this._onPointerDown=Kne.bind(this),this._onPointerUp=Qne.bind(this),this._onContextMenu=oie.bind(this),this._onMouseWheel=nie.bind(this),this._onKeyDown=iie.bind(this),this._onTouchStart=rie.bind(this),this._onTouchMove=sie.bind(this),this._onMouseDown=eie.bind(this),this._onMouseMove=tie.bind(this),this._interceptControlDown=aie.bind(this),this._interceptControlUp=cie.bind(this),null!==this.domElement&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Zk),this.update(),this.state=-1}update(e=null){const t=this.object.position;Ii.copy(t).sub(this.target),Ii.applyQuaternion(this._quat),this._spherical.setFromVector3(Ii),this.autoRotate&&-1===this.state&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Br:i>Math.PI&&(i-=Br),r<-Math.PI?r+=Br:r>Math.PI&&(r-=Br),this._spherical.theta=i<=r?Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(Ii.setFromSpherical(this._spherical),Ii.applyQuaternion(this._quatInverse),t.copy(this.target).add(Ii),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=Ii.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new A(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const l=new A(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(a),this.object.updateMatrixWorld(),o=Ii.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==o&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Ty.origin.copy(this.object.position),Ty.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Ty.direction))<Yne?this.object.lookAt(this.target):(Jk.setFromNormalAndCoplanarPoint(this.object.up,this.target),Ty.intersectPlane(Jk,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,!!(s||this._lastPosition.distanceToSquared(this.object.position)>Yw||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Yw||this._lastTargetPosition.distanceToSquared(this.target)>Yw)&&(this.dispatchEvent(Zk),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?Br/60*this.autoRotateSpeed*e:Br/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Ii.setFromMatrixColumn(t,0),Ii.multiplyScalar(-e),this._panOffset.add(Ii)}_panUp(e,t){!0===this.screenSpacePanning?Ii.setFromMatrixColumn(t,1):(Ii.setFromMatrixColumn(t,0),Ii.crossVectors(this.object.up,Ii)),Ii.multiplyScalar(e),this._panOffset.add(Ii)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){Ii.copy(this.object.position).sub(this.target);let s=Ii.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*t*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),s=t-i.top,a=i.height;this._mouse.x=(e-i.left)/i.width*2-1,this._mouse.y=-s/a*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Br*this._rotateDelta.x/t.clientHeight),this._rotateUp(Br*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Br*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Br*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Br*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Br*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e);this._rotateStart.set(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e);this._panStart.set(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e);this._rotateEnd.set(.5*(e.pageX+i.x),.5*(e.pageY+i.y))}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Br*this._rotateDelta.x/t.clientHeight),this._rotateUp(Br*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e);this._panEnd.set(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd),this._updateZoomParameters(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return void this._pointers.splice(t,1)}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new ie,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){return this._pointerPositions[e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0]]}_customWheelEvent(e){const i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(e.deltaMode){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function Kne(n){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),"touch"===n.pointerType?this._onTouchStart(n):this._onMouseDown(n)))}function Jne(n){!1!==this.enabled&&("touch"===n.pointerType?this._onTouchMove(n):this._onMouseMove(n))}function Qne(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Kk),this.state=-1;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y})}}function eie(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case 1:if(!1===this.enableZoom)return;this._handleMouseDownDolly(n),this.state=1;break;case 0:if(n.ctrlKey||n.metaKey||n.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(n),this.state=2}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(n),this.state=0}break;case 2:if(n.ctrlKey||n.metaKey||n.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(n),this.state=0}else{if(!1===this.enablePan)return;this._handleMouseDownPan(n),this.state=2}break;default:this.state=-1}-1!==this.state&&this.dispatchEvent(Xw)}function tie(n){switch(this.state){case 0:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(n);break;case 1:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(n);break;case 2:if(!1===this.enablePan)return;this._handleMouseMovePan(n)}}function nie(n){!1===this.enabled||!1===this.enableZoom||-1!==this.state||(n.preventDefault(),this.dispatchEvent(Xw),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(Kk))}function iie(n){!1===this.enabled||!1===this.enablePan||this._handleKeyDown(n)}function rie(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case 0:if(!1===this.enableRotate)return;this._handleTouchStartRotate(n),this.state=3;break;case 1:if(!1===this.enablePan)return;this._handleTouchStartPan(n),this.state=4;break;default:this.state=-1}break;case 2:switch(this.touches.TWO){case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(n),this.state=5;break;case 3:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(n),this.state=6;break;default:this.state=-1}break;default:this.state=-1}-1!==this.state&&this.dispatchEvent(Xw)}function sie(n){switch(this._trackPointer(n),this.state){case 3:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(n),this.update();break;case 4:if(!1===this.enablePan)return;this._handleTouchMovePan(n),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(n),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=-1}}function oie(n){!1!==this.enabled&&n.preventDefault()}function aie(n){"Control"===n.key&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function cie(n){"Control"===n.key&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}let lie=(()=>{var n;class e{constructor(){this.destroy$=new lt,this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.centralHub=null,this.botPositions=[],this.gridHelper=null,this.animationId=null,this.clock=new Pk,this.fps$=new Ht(0),this.isInitialized=!1,this.lastFrameTime=0,this.frameCount=0,this.fps=this.fps$.asObservable(),this.animate=()=>{this.animationId=requestAnimationFrame(this.animate);const i=this.clock.getDelta();if(this.frameCount++,this.controls&&this.controls.update(),this.centralHub){this.centralHub.rotation.y+=.5*i;const r=.1*Math.sin(2*this.clock.elapsedTime);this.centralHub.scale.setScalar(1+.05*r)}this.botPositions.forEach((r,s)=>{if(r){const o=.1*Math.sin(1.5*this.clock.elapsedTime+.3*s);r.position.y=r.userData.position.y+o,r.rotation.y=.2*this.clock.elapsedTime+.5*s}}),this.scene&&this.camera&&this.renderer&&this.renderer.render(this.scene,this.camera)},console.log("ThreeSceneService initialized")}initialize(i){var r=this;return $n(function*(){try{console.log("Initializing Three.js scene..."),r.scene=new OF,r.scene.background=new Le(657930),r.scene.fog=new k_(657930,10,100),r.camera=new Gi(75,i.clientWidth/i.clientHeight,.1,1e3),r.camera.position.set(0,8,12),r.renderer=new nte({antialias:!0,alpha:!0,powerPreference:"high-performance"}),r.renderer.setSize(i.clientWidth,i.clientHeight),r.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.renderer.shadowMap.enabled=!0,r.renderer.shadowMap.type=2,r.renderer.toneMapping=4,r.renderer.toneMappingExposure=1,i.appendChild(r.renderer.domElement),r.controls=new Zne(r.camera,r.renderer.domElement),r.controls.enableDamping=!0,r.controls.dampingFactor=.05,r.controls.screenSpacePanning=!1,r.controls.minDistance=3,r.controls.maxDistance=50,r.controls.maxPolarAngle=Math.PI/2,r.setupLighting(),r.createCentralHub(),r.createBotPositions(),r.createEnvironment(),r.setupResizeHandler(i),r.isInitialized=!0,console.log("Three.js scene initialized successfully")}catch(s){throw console.error("Failed to initialize Three.js scene:",s),s}})()}setupLighting(){if(!this.scene)return;const i=new xk(4210752,.3);this.scene.add(i);const r=new yy(16777215,.8);r.position.set(10,10,5),r.castShadow=!0,r.shadow.mapSize.width=2048,r.shadow.mapSize.height=2048,r.shadow.camera.near=.5,r.shadow.camera.far=50,this.scene.add(r);const s=new yy(4491519,.2);s.position.set(-10,5,-5),this.scene.add(s);const o=new yy(16746564,.1);o.position.set(0,-10,10),this.scene.add(o)}createCentralHub(){if(!this.scene)return;const i=new vd(1.5,32,32),r=new dy({color:3447003,emissive:1725584,emissiveIntensity:.3,metalness:.1,roughness:.2});this.centralHub=new ei(i,r),this.centralHub.position.set(0,0,0),this.centralHub.castShadow=!0,this.centralHub.userData={type:"central_hub"},this.scene.add(this.centralHub);const s=new vd(2,16,16),o=new qo({color:3447003,transparent:!0,opacity:.1}),a=new ei(s,o);this.centralHub.add(a),console.log("Central hub created")}createBotPositions(){this.scene&&([{name:"North",angle:0},{name:"East",angle:Math.PI/2},{name:"South",angle:Math.PI},{name:"West",angle:3*Math.PI/2}].forEach((r,s)=>{for(let o=0;o<2;o++){const c=5+2*o,l=r.angle+.3*o,u=.5*o,d=new A(Math.cos(l)*c,u,Math.sin(l)*c),h=new ny(.3,1.2,8),f=new dy({color:9807270,metalness:.3,roughness:.7}),p=new ei(h,f);p.position.copy(d),p.castShadow=!0,p.receiveShadow=!0,p.userData={type:"bot_position",botId:`bot_${r.name.toLowerCase()}_${o+1}`,cardinal:r.name,index:o,position:d.clone()},this.botPositions.push(p),this.scene&&this.scene.add(p);const _=new uy(.8,1.2,16),g=new qo({color:3426654,transparent:!0,opacity:.3}),m=new ei(_,g);m.rotation.x=-Math.PI/2,m.position.copy(d),m.position.y=.1,this.scene&&this.scene.add(m)}}),console.log(`Created ${this.botPositions.length} bot positions`))}createEnvironment(){if(!this.scene)return;this.gridHelper=new Wne(20,20,4473924,2236962),this.gridHelper.material.transparent=!0,this.gridHelper.material.opacity=.3,this.scene.add(this.gridHelper);const i=new qne(3);i.material.transparent=!0,i.material.opacity=.5,this.scene.add(i),console.log("Environment created")}setupResizeHandler(i){const r=new ResizeObserver(s=>{for(const o of s){const{width:a,height:c}=o.contentRect;this.camera&&this.renderer&&(this.camera.aspect=a/c,this.camera.updateProjectionMatrix(),this.renderer.setSize(a,c))}});r.observe(i),this.destroy$.subscribe(()=>{r.disconnect()})}startRenderLoop(){this.isInitialized?(console.log("Starting render loop..."),this.animate(),function gY(n=0,e=Yg){return n<0&&(n=0),nL(n,n,e)}(1e3).pipe(_s(this.destroy$)).subscribe(()=>{this.fps$.next(this.frameCount),this.frameCount=0})):console.warn("Cannot start render loop: Scene not initialized")}updateBotStatus(i,r){const s=this.botPositions.find(a=>a.userData.botId===i);if(!s)return void console.warn("Bot not found:",i);const o=s.material;switch(r){case"online":o.color.setHex(3066993),o.emissive.setHex(671765);break;case"offline":o.color.setHex(9807270),o.emissive.setHex(0);break;case"processing":o.color.setHex(15965202),o.emissive.setHex(4862464)}console.log(`Updated bot ${i} status to ${r}`)}reset(){console.log("Resetting scene..."),this.camera&&this.controls&&(this.camera.position.set(0,8,12),this.controls.reset()),this.botPositions.forEach(i=>{if(i){const r=i.material;r.color.setHex(9807270),r.emissive.setHex(0)}}),this.clock.start()}dispose(){console.log("Disposing Three.js scene..."),this.destroy$.next(),this.destroy$.complete(),this.animationId&&cancelAnimationFrame(this.animationId),this.renderer&&(this.renderer.dispose(),this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement)),this.controls&&this.controls.dispose(),this.scene?.traverse(i=>{i instanceof ei&&(i.geometry.dispose(),Array.isArray(i.material)?i.material.forEach(r=>r.dispose()):i.material.dispose())}),this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.centralHub=null,this.botPositions=[],this.gridHelper=null,this.fps$.complete(),this.isInitialized=!1}static#e=n=()=>(this.\u0275fac=function(r){return new(r||e)},this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})(),uie=(()=>{var n;class e{constructor(i){this.platformId=i,this.alephClient=null,this.connectionStatus$=new Ht("initializing"),this.scriptsLoaded=!1,this.initPromise=null,console.log("\u{1f517} AlephScriptService initialized"),XN(this.platformId)&&this.initialize()}initialize(){var i=this;return $n(function*(){return i.initPromise||(i.initPromise=i.loadScriptsAndConnect()),i.initPromise})()}loadScriptsAndConnect(){var i=this;return $n(function*(){if(!XN(i.platformId))return console.warn("AlephScriptService: Not in browser context"),void i.connectionStatus$.next("unavailable");try{yield i.loadScript("socket.io","https://cdn.socket.io/4.7.5/socket.io.min.js",()=>typeof window.io<"u"),yield i.loadScript("alephscript","/assets/alephscript-client.js",()=>typeof window.createAlephScriptClient<"u"),i.scriptsLoaded=!0,console.log("\u2705 All scripts loaded successfully"),yield i.createClient()}catch(r){throw console.error("Failed to initialize AlephScript:",r),i.connectionStatus$.next("error"),r}})()}loadScript(i,r,s){return new Promise((o,a)=>{if(s())return console.log(`\u2705 ${i} already loaded`),void o();const c=document.createElement("script");c.src=r,c.async=!0,c.onload=()=>{setTimeout(()=>{s()?(console.log(`\u2705 ${i} loaded successfully`),o()):a(new Error(`${i} loaded but verification failed`))},100)},c.onerror=()=>{a(new Error(`Failed to load ${i} from ${r}`))},document.head.appendChild(c)})}createClient(i){var r=this;return $n(function*(){const s=window.createAlephScriptClient;if(!s)throw new Error("createAlephScriptClient function not available");const a={clientId:"angular-threejs-ui",instanceId:`angular-${Date.now()}`,serverUrl:"http://localhost:3000",debug:!0,...i};try{r.alephClient=s(a.clientId,a.instanceId,a.serverUrl,a.debug),r.setupEventListeners(),yield r.waitForConnection(),r.connectionStatus$.next("connected"),console.log("\u2705 AlephScript client connected successfully")}catch(c){throw console.error("Failed to create AlephScript client:",c),r.connectionStatus$.next("error"),c}})()}setupEventListeners(){this.alephClient&&(this.alephClient.on("connected",()=>{console.log("\u{1f50c} AlephScript connected"),this.connectionStatus$.next("connected")}),this.alephClient.on("disconnected",()=>{console.log("\u{1f50c} AlephScript disconnected"),this.connectionStatus$.next("disconnected")}),this.alephClient.on("error",i=>{console.error("AlephScript error:",i),this.connectionStatus$.next("error")}))}waitForConnection(i=5e3){return new Promise((r,s)=>{const o=Date.now(),a=()=>{this.alephClient?.connected||this.alephClient?.socket?.connected?r():Date.now()-o>i?s(new Error("Connection timeout")):setTimeout(a,100)};a()})}connect(i){var r=this;return $n(function*(){"connected"!==r.connectionStatus$.value?r.scriptsLoaded?r.alephClient?(r.alephClient.connect(),yield r.waitForConnection()):yield r.createClient(i):yield r.initialize():console.log("Already connected")})()}disconnect(){this.alephClient&&(this.alephClient.disconnect(),this.connectionStatus$.next("disconnected"))}emit(i,r){this.alephClient&&this.isConnected()?this.alephClient.emit(i,r):console.warn(`Cannot emit ${i}: Not connected`)}on(i,r){this.alephClient&&this.alephClient.on(i,r)}getConnectionStatus(){return this.connectionStatus$.asObservable()}isConnected(){return"connected"===this.connectionStatus$.value}getClient(){return this.alephClient}get connectionStatus(){return this.getConnectionStatus()}sendUserInput(i){this.alephClient&&(console.log("\u{1f4e4} Sending user input:",i),this.alephClient.sendUserInput(i))}selectAgent(i){this.alephClient&&(console.log("\u{1f3af} Selecting agent:",i),this.alephClient.selectAgent(i))}requestBotConfiguration(){this.alephClient&&(console.log("\u{1f527} Requesting bot configuration"),this.alephClient.sendMessage({action:"request_bot_configuration"}))}sendHeartbeat(){this.alephClient&&this.alephClient.sendMessage({action:"heartbeat"})}static#e=n=()=>(this.\u0275fac=function(r){return new(r||e)(ct(nm))},this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})();const die=["canvasContainer"];function hie(n,e){1&n&&(ht(0,"div",13),Io(1,"div",14),ht(2,"p"),Wt(3,"Initializing 3D Scene & Socket Connection..."),mt()())}let fie=(()=>{var n;class e{constructor(i,r,s){this.threeSceneService=i,this.alephScriptService=r,this.rxjsSocketBridge=s,this.destroy$=new lt,this.isLoading=!0,this.connectionStatus="disconnected",this.isDemoRunning=!1,this.currentFPS=0}ngOnInit(){console.log("%c\ufffd\ufffd\ufffd ThreeGamificationUI - AlephScript Integration v1.0 initializing...","color: #ff0099; font-weight: bold; font-size: 14px"),this.alephScriptService.connectionStatus.pipe(_s(this.destroy$)).subscribe(i=>{this.connectionStatus=i,console.log("Connection status:",i)}),this.alephScriptService.connect()}ngAfterViewInit(){setTimeout(()=>{this.initializeThreeScene()},100)}initializeThreeScene(){var i=this;return $n(function*(){try{console.log("Initializing Three.js scene..."),yield i.threeSceneService.initialize(i.canvasContainer.nativeElement),i.threeSceneService.startRenderLoop(),i.threeSceneService.fps.pipe(_s(i.destroy$)).subscribe(s=>{i.currentFPS=Math.round(s)}),i.isLoading=!1;const r=document.getElementById("loading");r&&(r.style.display="none"),console.log("Three.js scene initialized successfully")}catch(r){console.error("Failed to initialize Three.js scene:",r),i.isLoading=!1}})()}toggleDemo(){this.isDemoRunning?(console.log("Stopping demo..."),this.isDemoRunning=!1):(console.log("Starting demo..."),this.isDemoRunning=!0)}resetScene(){console.log("Resetting scene..."),this.threeSceneService.reset()}ngOnDestroy(){console.log("App component destroying..."),this.destroy$.next(),this.destroy$.complete(),this.threeSceneService.dispose(),this.alephScriptService.disconnect()}static#e=n=()=>(this.\u0275fac=function(r){return new(r||e)(pt(lie),pt(uie),pt(rL))},this.\u0275cmp=Lh({type:e,selectors:[["app-root"]],viewQuery:function(r,s){if(1&r&&Tb(die,7),2&r){let o;fg(o=pg())&&(s.canvasContainer=o.first)}},decls:22,vars:6,consts:[["canvasContainer",""],[1,"app-container"],["class","loading-overlay",4,"ngIf"],[1,"canvas-container"],[1,"ui-overlay"],[1,"header-panel","ui-panel"],[1,"connection-status"],[1,"status-indicator"],[1,"left-panel"],[1,"right-panel"],[1,"bottom-panel","ui-panel"],[1,"btn",3,"click"],[1,"performance-info"],[1,"loading-overlay"],[1,"spinner"]],template:function(r,s){if(1&r){const o=wu();ht(0,"div",1),Qs(1,hie,4,0,"div",2),Io(2,"div",3,0),ht(4,"div",4)(5,"div",5)(6,"h1"),Wt(7,"ThreeGamificationUI"),mt(),ht(8,"div",6),Io(9,"span",7),Wt(10),mt()(),ht(11,"div",8),Io(12,"app-bot-list"),mt(),ht(13,"div",9),Io(14,"app-message-panel"),mt(),ht(15,"div",10)(16,"button",11),gi("click",function(){return Bi(o),Vi(s.toggleDemo())}),Wt(17),mt(),ht(18,"button",11),gi("click",function(){return Bi(o),Vi(s.resetScene())}),Wt(19,"Reset Scene"),mt(),ht(20,"span",12),Wt(21),mt()()()()}2&r&&(Kt(),Yi("ngIf",s.isLoading),Kt(8),gg(s.connectionStatus),Kt(),Xr(" AlephScript: ",s.connectionStatus.toUpperCase()," "),Kt(7),Xr(" ",s.isDemoRunning?"Stop Demo":"Start Demo"," "),Kt(4),Xr("FPS: ",s.currentFPS))},dependencies:[Wg,$g,oY,mY],styles:[".app-container[_ngcontent-%COMP%]{width:100vw;height:100vh;position:relative;overflow:hidden}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000e6;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}.loading-overlay[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{border:4px solid #333;border-top:4px solid #3498db;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.canvas-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1}.ui-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;pointer-events:none}.ui-overlay[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:auto}.header-panel[_ngcontent-%COMP%]{position:absolute;top:16px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:20px;min-width:400px}.header-panel[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5em;font-weight:600;margin:0}.connection-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em}.status-indicator[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;background:#e74c3c;transition:background-color .3s ease}.status-indicator.connected[_ngcontent-%COMP%]{background:#2ecc71;box-shadow:0 0 10px #2ecc7180}.status-indicator.connecting[_ngcontent-%COMP%]{background:#f39c12;animation:pulse 1s infinite}.left-panel[_ngcontent-%COMP%]{position:absolute;top:100px;left:16px;width:280px;max-height:calc(100vh - 200px);overflow-y:auto}.right-panel[_ngcontent-%COMP%]{position:absolute;top:100px;right:16px;width:320px;max-height:calc(100vh - 200px);overflow-y:auto}.bottom-panel[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:16px}.performance-info[_ngcontent-%COMP%]{font-size:.8em;color:#bbb;font-family:Courier New,monospace}@media (max-width: 768px){.header-panel[_ngcontent-%COMP%]{flex-direction:column;gap:8px;min-width:300px}.left-panel[_ngcontent-%COMP%], .right-panel[_ngcontent-%COMP%]{position:relative;width:100%;max-height:300px;margin:8px}.left-panel[_ngcontent-%COMP%]{top:120px}.right-panel[_ngcontent-%COMP%]{top:440px}.bottom-panel[_ngcontent-%COMP%]{bottom:8px;flex-wrap:wrap;justify-content:center}}"]}))}return n(),e})();function Qo(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Qk(n,e=0){return Si((t,i)=>{t.subscribe(pi(i,r=>Qo(i,n,()=>i.next(r),e),()=>Qo(i,n,()=>i.complete(),e),r=>Qo(i,n,()=>i.error(r),e)))})}function e2(n,e=0){return Si((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function t2(n,e){if(!n)throw new Error("Iterable cannot be null");return new Te(t=>{Qo(t,e,()=>{const i=n[Symbol.asyncIterator]();Qo(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function Er(n,e){return e?function Eie(n,e){if(null!=n){if(qO(n))return function mie(n,e){return gs(n).pipe(e2(e),Qk(e))}(n,e);if($O(n))return function _ie(n,e){return new Te(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(WO(n))return function gie(n,e){return gs(n).pipe(e2(e),Qk(e))}(n,e);if(XO(n))return t2(n,e);if(KO(n))return function yie(n,e){return new Te(t=>{let i;return Qo(t,e,()=>{i=n[ZO](),Qo(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void t.error(o)}s?t.complete():t.next(r)},0,!0)}),()=>Nn(i?.return)&&i.return()})}(n,e);if(QO(n))return function vie(n,e){return t2(JO(n),e)}(n,e)}throw YO(n)}(n,e):gs(n)}function Zw(n){return n[n.length-1]}function Cy(n){return tL(Zw(n))?n.pop():void 0}function It(...n){return Er(n,Cy(n))}const Dy=Bd(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:Sie}=Array,{getPrototypeOf:Mie,prototype:wie,keys:xie}=Object;const{isArray:Die}=Array;function n2(...n){const e=Cy(n),t=function bie(n){return Nn(Zw(n))?n.pop():void 0}(n),{args:i,keys:r}=function Tie(n){if(1===n.length){const e=n[0];if(Sie(e))return{args:e,keys:null};if(function Cie(n){return n&&"object"==typeof n&&Mie(n)===wie}(e)){const t=xie(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}(n);if(0===i.length)return Er([],e);const s=new Te(function Pie(n,e,t=Jn){return i=>{i2(e,()=>{const{length:r}=n,s=new Array(r);let o=r,a=r;for(let c=0;c<r;c++)i2(e,()=>{const l=Er(n[c],e);let u=!1;l.subscribe(pi(i,d=>{s[c]=d,u||(u=!0,a--),a||i.next(t(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}(i,e,r?o=>function Rie(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}(r,o):Jn));return t?s.pipe(function Iie(n){return hn(e=>function Aie(n,e){return Die(e)?n(...e):n(e)}(n,e))}(t)):s}function i2(n,e,t){n?Qo(t,n,e):e()}function br(n,e,t=1/0){return Nn(e)?br((i,r)=>hn((s,o)=>e(i,s,r,o))(gs(n(i,r))),t):("number"==typeof e&&(t=e),Si((i,r)=>function Nie(n,e,t,i,r,s,o,a){const c=[];let l=0,u=0,d=!1;const h=()=>{d&&!c.length&&!l&&e.complete()},f=_=>l<i?p(_):c.push(_),p=_=>{s&&e.next(_),l++;let g=!1;gs(t(_,u++)).subscribe(pi(e,m=>{r?.(m),s?f(m):e.next(m)},()=>{g=!0},void 0,()=>{if(g)try{for(l--;c.length&&l<i;){const m=c.shift();o?Qo(e,o,()=>p(m)):p(m)}h()}catch(m){e.error(m)}}))};return n.subscribe(pi(e,f,()=>{d=!0,h()})),()=>{a?.()}}(i,r,n,t)))}function Jw(...n){return function Oie(){return function Kw(n=1/0){return br(Jn,n)}(1)}()(Er(n,Cy(n)))}function Qw(n){return new Te(e=>{gs(n()).subscribe(e)})}function Ay(n,e){const t=Nn(n)?n:()=>n,i=r=>r.error(t());return new Te(e?r=>e.schedule(i,0,r):i)}const Os=new Te(n=>n.complete());function ex(){return Si((n,e)=>{let t=null;n._refCount++;const i=pi(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}class r2 extends Te{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,xC(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Ti;const t=this.getSubject();e.add(this.source.subscribe(pi(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Ti.EMPTY)}return e}refCount(){return ex()(this)}}function is(n,e){return Si((t,i)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&i.complete();t.subscribe(pi(i,c=>{r?.unsubscribe();let l=0;const u=s++;gs(n(c,u)).subscribe(r=pi(i,d=>i.next(e?e(c,d,u,l++):d),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function Sd(n){return n<=0?()=>Os:Si((e,t)=>{let i=0;e.subscribe(pi(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function Iy(n){return Si((e,t)=>{let i=!1;e.subscribe(pi(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function s2(n=kie){return Si((e,t)=>{let i=!1;e.subscribe(pi(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function kie(){return new Dy}function fl(n,e){const t=arguments.length>=2;return i=>i.pipe(n?Zr((r,s)=>n(r,s,i)):Jn,Sd(1),t?Iy(e):s2(()=>new Dy))}function kf(n,e){return Nn(e)?br(n,e,1):br(n,1)}function er(n,e,t){const i=Nn(n)||e||t?{next:n,error:e,complete:t}:n;return i?Si((r,s)=>{var o;null===(o=i.subscribe)||void 0===o||o.call(i);let a=!0;r.subscribe(pi(s,c=>{var l;null===(l=i.next)||void 0===l||l.call(i,c),s.next(c)},()=>{var c;a=!1,null===(c=i.complete)||void 0===c||c.call(i),s.complete()},c=>{var l;a=!1,null===(l=i.error)||void 0===l||l.call(i,c),s.error(c)},()=>{var c,l;a&&(null===(c=i.unsubscribe)||void 0===c||c.call(i)),null===(l=i.finalize)||void 0===l||l.call(i)}))}):Jn}function Md(n){return Si((e,t)=>{let s,i=null,r=!1;i=e.subscribe(pi(t,void 0,void 0,o=>{s=gs(n(o,Md(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function tx(n){return n<=0?()=>Os:Si((e,t)=>{let i=[];e.subscribe(pi(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function Uf(n){return Si((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}let Bie=(()=>{class n{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(i){return new(i||n)(ct(Wr))};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const qt="primary",Vf=Symbol("RouteTitle");class Gie{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function wd(n){return new Gie(n)}function jie(n,e,t){const i=t.path.split("/");if(i.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const o=i[s],a=n[s];if(":"===o[0])r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function so(n,e){const t=n?nx(n):void 0,i=e?nx(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let s=0;s<t.length;s++)if(r=t[s],!c2(n[r],e[r]))return!1;return!0}function nx(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function c2(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),i=[...e].sort();return t.every((r,s)=>i[s]===r)}return n===e}function l2(n){return n.length>0?n[n.length-1]:null}function ea(n){return function pie(n){return!!n&&(n instanceof Te||Nn(n.lift)&&Nn(n.subscribe))}(n)?n:eg(n)?Er(Promise.resolve(n)):It(n)}const Wie={exact:function h2(n,e,t){if(!ml(n.segments,e.segments)||!Ry(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!n.children[i]||!h2(n.children[i],e.children[i],t))return!1;return!0},subset:f2},u2={exact:function qie(n,e){return so(n,e)},subset:function Xie(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>c2(n[t],e[t]))},ignored:()=>!0};function d2(n,e,t){return Wie[t.paths](n.root,e.root,t.matrixParams)&&u2[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function f2(n,e,t){return p2(n,e,e.segments,t)}function p2(n,e,t,i){if(n.segments.length>t.length){const r=n.segments.slice(0,t.length);return!(!ml(r,t)||e.hasChildren()||!Ry(r,t,i))}if(n.segments.length===t.length){if(!ml(n.segments,t)||!Ry(n.segments,t,i))return!1;for(const r in e.children)if(!n.children[r]||!f2(n.children[r],e.children[r],i))return!1;return!0}{const r=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(ml(n.segments,r)&&Ry(n.segments,r,i)&&n.children[qt])&&p2(n.children[qt],e,s,i)}}function Ry(n,e,t){return e.every((i,r)=>u2[t](n[r].parameters,i.parameters))}class pl{root;queryParams;fragment;_queryParamMap;constructor(e=new Rn([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap??=wd(this.queryParams),this._queryParamMap}toString(){return Kie.serialize(this)}}class Rn{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Oy(this)}}class zf{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=wd(this.parameters),this._parameterMap}toString(){return _2(this)}}function ml(n,e){return n.length===e.length&&n.every((t,i)=>t.path===e[i].path)}let Py=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>new Ny,providedIn:"root"})}return n})();class Ny{parse(e){const t=new cre(e);return new pl(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${Hf(e.root,!0)}`,i=function ere(n){const e=Object.entries(n).map(([t,i])=>Array.isArray(i)?i.map(r=>`${Ly(t)}=${Ly(r)}`).join("&"):`${Ly(t)}=${Ly(i)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${i}${"string"==typeof e.fragment?`#${function Jie(n){return encodeURI(n)}(e.fragment)}`:""}`}}const Kie=new Ny;function Oy(n){return n.segments.map(e=>_2(e)).join("/")}function Hf(n,e){if(!n.hasChildren())return Oy(n);if(e){const t=n.children[qt]?Hf(n.children[qt],!1):"",i=[];return Object.entries(n.children).forEach(([r,s])=>{r!==qt&&i.push(`${r}:${Hf(s,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function Zie(n,e){let t=[];return Object.entries(n.children).forEach(([i,r])=>{i===qt&&(t=t.concat(e(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==qt&&(t=t.concat(e(r,i)))}),t}(n,(i,r)=>r===qt?[Hf(n.children[qt],!1)]:[`${r}:${Hf(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[qt]?`${Oy(n)}/${t[0]}`:`${Oy(n)}/(${t.join("//")})`}}function m2(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ly(n){return m2(n).replace(/%3B/gi,";")}function ix(n){return m2(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Fy(n){return decodeURIComponent(n)}function g2(n){return Fy(n.replace(/\+/g,"%20"))}function _2(n){return`${ix(n.path)}${function Qie(n){return Object.entries(n).map(([e,t])=>`;${ix(e)}=${ix(t)}`).join("")}(n.parameters)}`}const tre=/^[^\/()?;#]+/;function rx(n){const e=n.match(tre);return e?e[0]:""}const nre=/^[^\/()?;=#]+/,rre=/^[^=?&#]+/,ore=/^[^&#]+/;class cre{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Rn([],{}):new Rn([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[qt]=new Rn(e,t)),i}parseSegment(){const e=rx(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new O(4009,!1);return this.capture(e),new zf(Fy(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=function ire(n){const e=n.match(nre);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const r=rx(this.remaining);r&&(i=r,this.capture(i))}e[Fy(t)]=Fy(i)}parseQueryParam(e){const t=function sre(n){const e=n.match(rre);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const o=function are(n){const e=n.match(ore);return e?e[0]:""}(this.remaining);o&&(i=o,this.capture(i))}const r=g2(t),s=g2(i);if(e.hasOwnProperty(r)){let o=e[r];Array.isArray(o)||(o=[o],e[r]=o),o.push(s)}else e[r]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=rx(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new O(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=qt);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[qt]:new Rn([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new O(4011,!1)}}function y2(n){return n.segments.length>0?new Rn([],{[qt]:n}):n}function v2(n){const e={};for(const[i,r]of Object.entries(n.children)){const s=v2(r);if(i===qt&&0===s.segments.length&&s.hasChildren())for(const[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[i]=s)}return function lre(n){if(1===n.numberOfChildren&&n.children[qt]){const e=n.children[qt];return new Rn(n.segments.concat(e.segments),e.children)}return n}(new Rn(n.segments,e))}function gl(n){return n instanceof pl}function E2(n){let e;const r=y2(function t(s){const o={};for(const c of s.children){const l=t(c);o[c.outlet]=l}const a=new Rn(s.url,o);return s===n&&(e=a),a}(n.root));return e??r}function b2(n,e,t,i){let r=n;for(;r.parent;)r=r.parent;if(0===e.length)return sx(r,r,r,t,i);const s=function dre(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new M2(!0,0,n);let e=0,t=!1;const i=n.reduce((r,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]="string"==typeof l?l.split("/"):l}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===o?(s.split("/").forEach((a,c)=>{0==c&&"."===a||(0==c&&""===a?t=!0:".."===a?e++:""!=a&&r.push(a))}),r):[...r,s]},[]);return new M2(t,e,i)}(e);if(s.toRoot())return sx(r,r,new Rn([],{}),t,i);const o=function hre(n,e,t){if(n.isAbsolute)return new Uy(e,!0,0);if(!t)return new Uy(e,!1,NaN);if(null===t.parent)return new Uy(t,!0,0);const i=ky(n.commands[0])?0:1;return function fre(n,e,t){let i=n,r=e,s=t;for(;s>r;){if(s-=r,i=i.parent,!i)throw new O(4005,!1);r=i.segments.length}return new Uy(i,!1,r-s)}(t,t.segments.length-1+i,n.numberOfDoubleDots)}(s,r,n),a=o.processChildren?jf(o.segmentGroup,o.index,s.commands):w2(o.segmentGroup,o.index,s.commands);return sx(r,o.segmentGroup,a,t,i)}function ky(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Gf(n){return"object"==typeof n&&null!=n&&n.outlets}function sx(n,e,t,i,r){let o,s={};i&&Object.entries(i).forEach(([c,l])=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`}),o=n===e?t:S2(n,e,t);const a=y2(v2(o));return new pl(a,s,r)}function S2(n,e,t){const i={};return Object.entries(n.children).forEach(([r,s])=>{i[r]=s===e?t:S2(s,e,t)}),new Rn(n.segments,i)}class M2{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&ky(i[0]))throw new O(4003,!1);const r=i.find(Gf);if(r&&r!==l2(i))throw new O(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Uy{segmentGroup;processChildren;index;constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}}function w2(n,e,t){if(n??=new Rn([],{}),0===n.segments.length&&n.hasChildren())return jf(n,e,t);const i=function mre(n,e,t){let i=0,r=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return s;const o=n.segments[r],a=t[i];if(Gf(a))break;const c=`${a}`,l=i<t.length-1?t[i+1]:null;if(r>0&&void 0===c)break;if(c&&l&&"object"==typeof l&&void 0===l.outlets){if(!T2(c,l,o))return s;i+=2}else{if(!T2(c,{},o))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new Rn(n.segments.slice(0,i.pathIndex),{});return s.children[qt]=new Rn(n.segments.slice(i.pathIndex),n.children),jf(s,0,r)}return i.match&&0===r.length?new Rn(n.segments,{}):i.match&&!n.hasChildren()?ox(n,e,t):i.match?jf(n,0,r):ox(n,e,t)}function jf(n,e,t){if(0===t.length)return new Rn(n.segments,{});{const i=function pre(n){return Gf(n[0])?n[0].outlets:{[qt]:n}}(t),r={};if(Object.keys(i).some(s=>s!==qt)&&n.children[qt]&&1===n.numberOfChildren&&0===n.children[qt].segments.length){const s=jf(n.children[qt],e,t);return new Rn(n.segments,s.children)}return Object.entries(i).forEach(([s,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(r[s]=w2(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{void 0===i[s]&&(r[s]=o)}),new Rn(n.segments,r)}}function ox(n,e,t){const i=n.segments.slice(0,e);let r=0;for(;r<t.length;){const s=t[r];if(Gf(s)){const c=gre(s.outlets);return new Rn(i,c)}if(0===r&&ky(t[0])){i.push(new zf(n.segments[e].path,x2(t[0]))),r++;continue}const o=Gf(s)?s.outlets[qt]:`${s}`,a=r<t.length-1?t[r+1]:null;o&&a&&ky(a)?(i.push(new zf(o,x2(a))),r+=2):(i.push(new zf(o,{})),r++)}return new Rn(i,{})}function gre(n){const e={};return Object.entries(n).forEach(([t,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(e[t]=ox(new Rn([],{}),0,i))}),e}function x2(n){const e={};return Object.entries(n).forEach(([t,i])=>e[t]=`${i}`),e}function T2(n,e,t){return n==t.path&&so(e,t.parameters)}const By="imperative";var an=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(an||{});class oo{id;url;constructor(e,t){this.id=e,this.url=t}}class ax extends oo{type=an.NavigationStart;navigationTrigger;restoredState;constructor(e,t,i="imperative",r=null){super(e,t),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class _l extends oo{urlAfterRedirects;type=an.NavigationEnd;constructor(e,t,i){super(e,t),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Vr=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n[n.Aborted=4]="Aborted",n}(Vr||{}),cx=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(cx||{});class yl extends oo{reason;code;type=an.NavigationCancel;constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class $f extends oo{reason;code;type=an.NavigationSkipped;constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r}}class lx extends oo{error;target;type=an.NavigationError;constructor(e,t,i,r){super(e,t),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class C2 extends oo{urlAfterRedirects;state;type=an.RoutesRecognized;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _re extends oo{urlAfterRedirects;state;type=an.GuardsCheckStart;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yre extends oo{urlAfterRedirects;state;shouldActivate;type=an.GuardsCheckEnd;constructor(e,t,i,r,s){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class vre extends oo{urlAfterRedirects;state;type=an.ResolveStart;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ere extends oo{urlAfterRedirects;state;type=an.ResolveEnd;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bre{route;type=an.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Sre{route;type=an.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Mre{snapshot;type=an.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wre{snapshot;type=an.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xre{snapshot;type=an.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Tre{snapshot;type=an.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ux{}class Vy{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}}function Ls(n){return n.outlet||qt}function xd(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class Nre{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return xd(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new Wf(this.rootInjector)}}let Wf=(()=>{class n{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,i){const r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){const i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new Nre(this.rootInjector),this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(i){return new(i||n)(ct($i))};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class D2{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=dx(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){const t=dx(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=hx(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return hx(e,this._root).map(t=>t.value)}}function dx(n,e){if(n===e.value)return e;for(const t of e.children){const i=dx(n,t);if(i)return i}return null}function hx(n,e){if(n===e.value)return[e];for(const t of e.children){const i=hx(n,t);if(i.length)return i.unshift(e),i}return[]}class Fs{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Td(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class A2 extends D2{snapshot;constructor(e,t){super(e),this.snapshot=t,fx(this,e)}toString(){return this.snapshot.toString()}}function I2(n){const e=function Ore(n){const s=new Hy([],{},{},"",{},qt,n,null,{});return new R2("",new Fs(s,[]))}(n),t=new Ht([new zf("",{})]),i=new Ht({}),r=new Ht({}),s=new Ht({}),o=new Ht(""),a=new Cd(t,i,s,o,r,qt,n,e.root);return a.snapshot=e.root,new A2(new Fs(a,[]),e)}class Cd{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,i,r,s,o,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(hn(l=>l[Vf]))??It(void 0),this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(hn(e=>wd(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(hn(e=>wd(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function zy(n,e,t="emptyOnly"){let i;const{routeConfig:r}=n;return i=null===e||"always"!==t&&""!==r?.path&&(e.component||e.routeConfig?.loadComponent)?{params:{...n.params},data:{...n.data},resolve:{...n.data,...n._resolvedData??{}}}:{params:{...e.params,...n.params},data:{...e.data,...n.data},resolve:{...n.data,...e.data,...r?.data,...n._resolvedData}},r&&N2(r)&&(i.resolve[Vf]=r.title),i}class Hy{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Vf]}constructor(e,t,i,r,s,o,a,c,l){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=wd(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=wd(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class R2 extends D2{url;constructor(e,t){super(t),this.url=e,fx(this,t)}toString(){return P2(this._root)}}function fx(n,e){e.value._routerState=n,e.children.forEach(t=>fx(n,t))}function P2(n){const e=n.children.length>0?` { ${n.children.map(P2).join(", ")} } `:"";return`${n.value}${e}`}function px(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,so(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),so(e.params,t.params)||n.paramsSubject.next(t.params),function $ie(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!so(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.urlSubject.next(t.url),so(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function mx(n,e){const t=so(n.params,e.params)&&function Yie(n,e){return ml(n,e)&&n.every((t,i)=>so(t.parameters,e[i].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||mx(n.parent,e.parent))}function N2(n){return"string"==typeof n.title||null===n.title}const Lre=new ge("");let O2=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=qt;activateEvents=new qr;deactivateEvents=new qr;attachEvents=new qr;detachEvents=new qr;routerOutletData=G6(void 0);parentContexts=oe(Wf);location=oe(Cs);changeDetector=oe(Xb);inputBinder=oe(gx,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){const{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new O(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new O(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new O(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new O(4013,!1);this._activatedRoute=t;const r=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new Fre(t,a,r.injector,this.routerOutletData);this.activated=r.createComponent(o,{index:r.length,injector:c,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=ur({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Yl]})}return n})();class Fre{route;childContexts;parent;outletData;constructor(e,t,i,r){this.route=e,this.childContexts=t,this.parent=i,this.outletData=r}get(e,t){return e===Cd?this.route:e===Wf?this.childContexts:e===Lre?this.outletData:this.parent.get(e,t)}}const gx=new ge("");let L2=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Lh({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){1&i&&Io(0,"router-outlet")},dependencies:[O2],encapsulation:2})}return n})();function _x(n){const e=n.children&&n.children.map(_x),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==qt&&(t.component=L2),t}function qf(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=e.value;const r=function Ure(n,e,t){return e.children.map(i=>{for(const r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return qf(n,i,r);return qf(n,i)})}(n,e,t);return new Fs(i,r)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>qf(n,a)),o}}const i=function Bre(n){return new Cd(new Ht(n.url),new Ht(n.params),new Ht(n.queryParams),new Ht(n.fragment),new Ht(n.data),n.outlet,n.component,n)}(e.value),r=e.children.map(s=>qf(n,s));return new Fs(i,r)}}class yx{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}}const F2="ngNavigationCancelingError";function Gy(n,e){const{redirectTo:t,navigationBehaviorOptions:i}=gl(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=k2(!1,Vr.Redirect);return r.url=t,r.navigationBehaviorOptions=i,r}function k2(n,e){const t=new Error(`NavigationCancelingError: ${n||""}`);return t[F2]=!0,t.cancellationCode=e,t}function U2(n){return!!n&&n[F2]}class Hre{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,i,r,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=s}activate(e){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),px(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){const r=Td(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,r[o],i),delete r[o]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(r===s)if(r.component){const o=i.getContext(r.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,i);else s&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Td(e);for(const o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);if(i&&i.outlet){const o=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Td(e);for(const o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,t,i){const r=Td(t);e.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new Tre(s.value.snapshot))}),e.children.length&&this.forwardEvent(new wre(e.value.snapshot))}activateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(px(r),r===s)if(r.component){const o=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,i);else if(r.component){const o=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),px(a.route.value),this.activateChildRoutes(e,null,o.children)}else o.attachRef=null,o.route=r,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(e,null,o.children)}else this.activateChildRoutes(e,null,i)}}class B2{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class jy{component;route;constructor(e,t){this.component=e,this.route=t}}function Gre(n,e,t){const i=n._root;return Xf(i,e?e._root:null,t,[i.value])}function Dd(n,e){const t=Symbol(),i=e.get(n,t);return i===t?"function"!=typeof n||function wp(n){return null!==go(n)}(n)?e.get(n):n:i}function Xf(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Td(e);return n.children.forEach(o=>{(function $re(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const c=function Wre(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!ml(n.url,e.url);case"pathParamsOrQueryParamsChange":return!ml(n.url,e.url)||!so(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!mx(n,e)||!so(n.queryParams,e.queryParams);default:return!mx(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);c?r.canActivateChecks.push(new B2(i)):(s.data=o.data,s._resolvedData=o._resolvedData),Xf(n,e,s.component?a?a.children:null:t,i,r),c&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new jy(a.outlet.component,o))}else o&&Yf(e,a,r),r.canActivateChecks.push(new B2(i)),Xf(n,null,s.component?a?a.children:null:t,i,r)})(o,s[o.value.outlet],t,i.concat([o.value]),r),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Yf(a,t.getContext(o),r)),r}function Yf(n,e,t){const i=Td(n),r=n.value;Object.entries(i).forEach(([s,o])=>{Yf(o,r.component?e?e.children.getContext(s):null:e,t)}),t.canDeactivateChecks.push(new jy(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}function Zf(n){return"function"==typeof n}function V2(n){return n instanceof Dy||"EmptyError"===n?.name}const $y=Symbol("INITIAL_VALUE");function Ad(){return is(n=>n2(n.map(e=>e.pipe(Sd(1),function Fie(...n){const e=Cy(n);return Si((t,i)=>{(e?Jw(n,t,e):Jw(n,t)).subscribe(i)})}($y)))).pipe(hn(e=>{for(const t of e)if(!0!==t){if(t===$y)return $y;if(!1===t||Qre(t))return t}return!0}),Zr(e=>e!==$y),Sd(1)))}function Qre(n){return gl(n)||n instanceof yx}function z2(n){return function Pi(...n){return Qn(n)}(er(e=>{if("boolean"!=typeof e)throw Gy(0,e)}),hn(e=>!0===e))}class vx{segmentGroup;constructor(e){this.segmentGroup=e||null}}class Ex extends Error{urlTree;constructor(e){super(),this.urlTree=e}}function Id(n){return Ay(new vx(n))}function use(n){return Ay(new O(4e3,!1))}class hse{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return It(i);if(r.numberOfChildren>1||!r.children[qt])return use();r=r.children[qt]}}applyRedirectCommands(e,t,i,r,s){return function fse(n,e,t){if("string"==typeof n)return It(n);const i=n,{queryParams:r,fragment:s,routeConfig:o,url:a,outlet:c,params:l,data:u,title:d}=e;return ea(Gr(t,()=>i({params:l,data:u,queryParams:r,fragment:s,routeConfig:o,url:a,outlet:c,title:d})))}(t,r,s).pipe(hn(o=>{if(o instanceof pl)throw new Ex(o);const a=this.applyRedirectCreateUrlTree(o,this.urlSerializer.parse(o),e,i);if("/"===o[0])throw new Ex(a);return a}))}applyRedirectCreateUrlTree(e,t,i,r){const s=this.createSegmentGroup(e,t.root,i,r);return new pl(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const i={};return Object.entries(e).forEach(([r,s])=>{if("string"==typeof s&&":"===s[0]){const a=s.substring(1);i[r]=t[a]}else i[r]=s}),i}createSegmentGroup(e,t,i,r){const s=this.createSegments(e,t.segments,i,r);let o={};return Object.entries(t.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(e,c,i,r)}),new Rn(s,o)}createSegments(e,t,i,r){return t.map(s=>":"===s.path[0]?this.findPosParam(e,s,r):this.findOrReturn(s,i))}findPosParam(e,t,i){const r=i[t.path.substring(1)];if(!r)throw new O(4001,!1);return r}findOrReturn(e,t){let i=0;for(const r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}}const bx={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function pse(n,e,t,i,r){const s=H2(n,e,t);return s.matched?(i=function Dre(n,e){return n.providers&&!n._injector&&(n._injector=BE(n.providers,e,`Route: ${n.path}`)),n._injector??e}(e,i),function lse(n,e,t,i){const r=e.canMatch;return r&&0!==r.length?It(r.map(o=>{const a=Dd(o,n);return ea(function Jre(n){return n&&Zf(n.canMatch)}(a)?a.canMatch(e,t):Gr(n,()=>a(e,t)))})).pipe(Ad(),z2()):It(!0)}(i,e,t).pipe(hn(o=>!0===o?s:{...bx}))):It(s)}function H2(n,e,t){if("**"===e.path)return function mse(n){return{matched:!0,parameters:n.length>0?l2(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...bx}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const r=(e.matcher||jie)(t,n,e);if(!r)return{...bx};const s={};Object.entries(r.posParams??{}).forEach(([a,c])=>{s[a]=c.path});const o=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function G2(n,e,t,i){return t.length>0&&function yse(n,e,t){return t.some(i=>Wy(n,e,i)&&Ls(i)!==qt)}(n,t,i)?{segmentGroup:new Rn(e,_se(i,new Rn(t,n.children))),slicedSegments:[]}:0===t.length&&function vse(n,e,t){return t.some(i=>Wy(n,e,i))}(n,t,i)?{segmentGroup:new Rn(n.segments,gse(n,t,i,n.children)),slicedSegments:t}:{segmentGroup:new Rn(n.segments,n.children),slicedSegments:t}}function gse(n,e,t,i){const r={};for(const s of t)if(Wy(n,e,s)&&!i[Ls(s)]){const o=new Rn([],{});r[Ls(s)]=o}return{...i,...r}}function _se(n,e){const t={};t[qt]=e;for(const i of n)if(""===i.path&&Ls(i)!==qt){const r=new Rn([],{});t[Ls(i)]=r}return t}function Wy(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}class bse{}class wse{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,i,r,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=i,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new hse(this.urlSerializer,this.urlTree)}noMatchError(e){return new O(4002,`'${e.segmentGroup}'`)}recognize(){const e=G2(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(hn(({children:t,rootSnapshot:i})=>{const r=new Fs(i,t),s=new R2("",r),o=function ure(n,e,t=null,i=null){return b2(E2(n),e,t,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}))}match(e){const t=new Hy([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),qt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,qt,t).pipe(hn(i=>({children:i,rootSnapshot:t})),Md(i=>{if(i instanceof Ex)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof vx?this.noMatchError(i):i}))}processSegmentGroup(e,t,i,r,s){return 0===i.segments.length&&i.hasChildren()?this.processChildren(e,t,i,s):this.processSegment(e,t,i,i.segments,r,!0,s).pipe(hn(o=>o instanceof Fs?[o]:[]))}processChildren(e,t,i,r){const s=[];for(const o of Object.keys(i.children))"primary"===o?s.unshift(o):s.push(o);return Er(s).pipe(kf(o=>{const a=i.children[o],c=function Pre(n,e){const t=n.filter(i=>Ls(i)===e);return t.push(...n.filter(i=>Ls(i)!==e)),t}(t,o);return this.processSegmentGroup(e,c,a,o,r)}),oL((o,a)=>(o.push(...a),o)),Iy(null),function Uie(n,e){const t=arguments.length>=2;return i=>i.pipe(n?Zr((r,s)=>n(r,s,i)):Jn,tx(1),t?Iy(e):s2(()=>new Dy))}(),br(o=>{if(null===o)return Id(i);const a=j2(o);return function xse(n){n.sort((e,t)=>e.value.outlet===qt?-1:t.value.outlet===qt?1:e.value.outlet.localeCompare(t.value.outlet))}(a),It(a)}))}processSegment(e,t,i,r,s,o,a){return Er(t).pipe(kf(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,i,r,s,o,a).pipe(Md(l=>{if(l instanceof vx)return It(null);throw l}))),fl(c=>!!c),Md(c=>{if(V2(c))return function Ese(n,e,t){return 0===e.length&&!n.children[t]}(i,r,s)?It(new bse):Id(i);throw c}))}processSegmentAgainstRoute(e,t,i,r,s,o,a,c){return Ls(i)===o||o!==qt&&Wy(r,s,i)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,r,i,s,o,c):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,i,s,o,c):Id(r):Id(r)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o,a){const{matched:c,parameters:l,consumedSegments:u,positionalParamSegments:d,remainingSegments:h}=H2(t,r,s);if(!c)return Id(t);"string"==typeof r.redirectTo&&"/"===r.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const f=new Hy(s,l,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,$2(r),Ls(r),r.component??r._loadedComponent??null,r,W2(r)),p=zy(f,a,this.paramsInheritanceStrategy);return f.params=Object.freeze(p.params),f.data=Object.freeze(p.data),this.applyRedirects.applyRedirectCommands(u,r.redirectTo,d,f,e).pipe(is(g=>this.applyRedirects.lineralizeSegments(r,g)),br(g=>this.processSegment(e,i,t,g.concat(h),o,!1,a)))}matchSegmentAgainstRoute(e,t,i,r,s,o){const a=pse(t,i,r,e);return"**"===i.path&&(t.children={}),a.pipe(is(c=>c.matched?this.getChildConfig(e=i._injector??e,i,r).pipe(is(({routes:l})=>{const u=i._loadedInjector??e,{parameters:d,consumedSegments:h,remainingSegments:f}=c,p=new Hy(h,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,$2(i),Ls(i),i.component??i._loadedComponent??null,i,W2(i)),_=zy(p,o,this.paramsInheritanceStrategy);p.params=Object.freeze(_.params),p.data=Object.freeze(_.data);const{segmentGroup:g,slicedSegments:m}=G2(t,h,f,l);if(0===m.length&&g.hasChildren())return this.processChildren(u,l,g,p).pipe(hn(E=>new Fs(p,E)));if(0===l.length&&0===m.length)return It(new Fs(p,[]));const y=Ls(i)===s;return this.processSegment(u,l,g,m,y?qt:s,!0,p).pipe(hn(E=>new Fs(p,E instanceof Fs?[E]:[])))})):Id(t)))}getChildConfig(e,t,i){return t.children?It({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?It({routes:t._loadedRoutes,injector:t._loadedInjector}):function cse(n,e,t,i){const r=e.canLoad;return void 0===r||0===r.length?It(!0):It(r.map(o=>{const a=Dd(o,n);return ea(function Xre(n){return n&&Zf(n.canLoad)}(a)?a.canLoad(e,t):Gr(n,()=>a(e,t)))})).pipe(Ad(),z2())}(e,t,i).pipe(br(r=>r?this.configLoader.loadChildren(e,t).pipe(er(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function dse(){return Ay(k2(!1,Vr.GuardRejected))}())):It({routes:[],injector:e})}}function Tse(n){const e=n.value.routeConfig;return e&&""===e.path}function j2(n){const e=[],t=new Set;for(const i of n){if(!Tse(i)){e.push(i);continue}const r=e.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),t.add(r)):e.push(i)}for(const i of t){const r=j2(i.children);e.push(new Fs(i.value,r))}return e.filter(i=>!t.has(i))}function $2(n){return n.data||{}}function W2(n){return n.resolve||{}}function q2(n){const e=n.children.map(t=>q2(t)).flat();return[n,...e]}function Sx(n){return is(e=>{const t=n(e);return t?Er(t).pipe(hn(()=>e)):It(e)})}let X2=(()=>{class n{buildTitle(t){let i,r=t.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===qt);return i}getResolvedTitleForRoute(t){return t.data[Vf]}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>oe(Pse),providedIn:"root"})}return n})(),Pse=(()=>{class n extends X2{title;constructor(t){super(),this.title=t}updateTitle(t){const i=this.buildTitle(t);void 0!==i&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||n)(ct(Bie))};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const qy=new ge("",{providedIn:"root",factory:()=>({})}),Mx=new ge("");let Y2=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=oe(C6);loadComponent(t,i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return It(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const r=ea(Gr(t,()=>i.loadComponent())).pipe(hn(Z2),is(K2),er(o=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=o}),Uf(()=>{this.componentLoaders.delete(i)})),s=new r2(r,()=>new lt).pipe(ex());return this.componentLoaders.set(i,s),s}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return It({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=function Nse(n,e,t,i){return ea(Gr(t,()=>n.loadChildren())).pipe(hn(Z2),is(K2),br(r=>r instanceof eR||Array.isArray(r)?It(r):Er(e.compileModuleAsync(r))),hn(r=>{i&&i(n);let s,o,a=!1;return Array.isArray(r)?(o=r,!0):(s=r.create(t).injector,o=s.get(Mx,[],{optional:!0,self:!0}).flat()),{routes:o.map(_x),injector:s}}))}(i,this.compiler,t,this.onLoadEndListener).pipe(Uf(()=>{this.childrenLoaders.delete(i)})),o=new r2(s,()=>new lt).pipe(ex());return this.childrenLoaders.set(i,o),o}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Z2(n){return function Ose(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}function K2(n){return It(n)}let wx=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>oe(Lse),providedIn:"root"})}return n})(),Lse=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Fse=new ge(""),Bse=new ge("");let Vse=(()=>{class n{currentNavigation=Hp(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new lt;transitionAbortWithErrorSubject=new lt;configLoader=oe(Y2);environmentInjector=oe($i);destroyRef=oe(Ys);urlSerializer=oe(Py);rootContexts=oe(Wf);location=oe(th);inputBindingEnabled=null!==oe(gx,{optional:!0});titleStrategy=oe(X2);options=oe(qy,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=oe(wx);createViewTransition=oe(Fse,{optional:!0});navigationErrorHandler=oe(Bse,{optional:!0});navigationId=0;get hasRequestedNavigation(){return 0!==this.navigationId}transitions;afterPreactivation=()=>It(void 0);rootComponentType=null;destroyed=!1;constructor(){this.configLoader.onLoadEndListener=r=>this.events.next(new Sre(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new bre(r)),this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){const i=++this.navigationId;Li(()=>{this.transitions?.next({...t,extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:i})})}setupNavigations(t){return this.transitions=new Ht(null),this.transitions.pipe(Zr(i=>null!==i),is(i=>{let r=!1;return It(i).pipe(is(s=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",Vr.SupersededByNewNavigation),Os;this.currentTransition=i,this.currentNavigation.set({id:s.id,initialUrl:s.rawUrl,extractedUrl:s.extractedUrl,targetBrowserUrl:"string"==typeof s.extras.browserUrl?this.urlSerializer.parse(s.extras.browserUrl):s.extras.browserUrl,trigger:s.source,extras:s.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null,abort:()=>s.abortController.abort()});const o=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!o&&"reload"!==(s.extras.onSameUrlNavigation??t.onSameUrlNavigation))return this.events.next(new $f(s.id,this.urlSerializer.serialize(s.rawUrl),"",cx.IgnoredSameUrlNavigation)),s.resolve(!1),Os;if(this.urlHandlingStrategy.shouldProcessUrl(s.rawUrl))return It(s).pipe(is(c=>(this.events.next(new ax(c.id,this.urlSerializer.serialize(c.extractedUrl),c.source,c.restoredState)),c.id!==this.navigationId?Os:Promise.resolve(c))),function Cse(n,e,t,i,r,s){return br(o=>function Sse(n,e,t,i,r,s,o="emptyOnly"){return new wse(n,e,t,i,r,o,s).recognize()}(n,e,t,i,o.extractedUrl,r,s).pipe(hn(({state:a,tree:c})=>({...o,targetSnapshot:a,urlAfterRedirects:c}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),er(c=>{i.targetSnapshot=c.targetSnapshot,i.urlAfterRedirects=c.urlAfterRedirects,this.currentNavigation.update(u=>(u.finalUrl=c.urlAfterRedirects,u));const l=new C2(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}));if(o&&this.urlHandlingStrategy.shouldProcessUrl(s.currentRawUrl)){const{id:c,extractedUrl:l,source:u,restoredState:d,extras:h}=s,f=new ax(c,this.urlSerializer.serialize(l),u,d);this.events.next(f);const p=I2(this.rootComponentType).snapshot;return this.currentTransition=i={...s,targetSnapshot:p,urlAfterRedirects:l,extras:{...h,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.update(_=>(_.finalUrl=l,_)),It(i)}return this.events.next(new $f(s.id,this.urlSerializer.serialize(s.extractedUrl),"",cx.IgnoredByUrlHandlingStrategy)),s.resolve(!1),Os}),er(s=>{const o=new _re(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(o)}),hn(s=>(this.currentTransition=i={...s,guards:Gre(s.targetSnapshot,s.currentSnapshot,this.rootContexts)},i)),function ese(n,e){return br(t=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?It({...t,guardsResult:!0}):function tse(n,e,t,i){return Er(n).pipe(br(r=>function ase(n,e,t,i,r){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?It(s.map(a=>{const c=xd(e)??r,l=Dd(a,c);return ea(function Kre(n){return n&&Zf(n.canDeactivate)}(l)?l.canDeactivate(n,e,t,i):Gr(c,()=>l(n,e,t,i))).pipe(fl())})).pipe(Ad()):It(!0)}(r.component,r.route,t,e,i)),fl(r=>!0!==r,!0))}(o,i,r,n).pipe(br(a=>a&&function qre(n){return"boolean"==typeof n}(a)?function nse(n,e,t,i){return Er(e).pipe(kf(r=>Jw(function rse(n,e){return null!==n&&e&&e(new Mre(n)),It(!0)}(r.route.parent,i),function ise(n,e){return null!==n&&e&&e(new xre(n)),It(!0)}(r.route,i),function ose(n,e,t){const i=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function jre(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>Qw(()=>It(o.guards.map(c=>{const l=xd(o.node)??t,u=Dd(c,l);return ea(function Zre(n){return n&&Zf(n.canActivateChild)}(u)?u.canActivateChild(i,n):Gr(l,()=>u(i,n))).pipe(fl())})).pipe(Ad())));return It(s).pipe(Ad())}(n,r.path,t),function sse(n,e,t){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return It(!0);const r=i.map(s=>Qw(()=>{const o=xd(e)??t,a=Dd(s,o);return ea(function Yre(n){return n&&Zf(n.canActivate)}(a)?a.canActivate(e,n):Gr(o,()=>a(e,n))).pipe(fl())}));return It(r).pipe(Ad())}(n,r.route,t))),fl(r=>!0!==r,!0))}(i,s,n,e):It(a)),hn(a=>({...t,guardsResult:a})))})}(this.environmentInjector,s=>this.events.next(s)),er(s=>{if(i.guardsResult=s.guardsResult,s.guardsResult&&"boolean"!=typeof s.guardsResult)throw Gy(0,s.guardsResult);const o=new yre(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot,!!s.guardsResult);this.events.next(o)}),Zr(s=>!!s.guardsResult||(this.cancelNavigationTransition(s,"",Vr.GuardRejected),!1)),Sx(s=>{if(0!==s.guards.canActivateChecks.length)return It(s).pipe(er(o=>{const a=new vre(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),is(o=>{let a=!1;return It(o).pipe(function Dse(n,e){return br(t=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return It(t);const s=new Set(r.map(c=>c.route)),o=new Set;for(const c of s)if(!o.has(c))for(const l of q2(c))o.add(l);let a=0;return Er(o).pipe(kf(c=>s.has(c)?function Ase(n,e,t,i){const r=n.routeConfig,s=n._resolve;return void 0!==r?.title&&!N2(r)&&(s[Vf]=r.title),Qw(()=>(n.data=zy(n,n.parent,t).resolve,function Ise(n,e,t,i){const r=nx(n);if(0===r.length)return It({});const s={};return Er(r).pipe(br(o=>function Rse(n,e,t,i){const r=xd(e)??i,s=Dd(n,r);return ea(s.resolve?s.resolve(e,t):Gr(r,()=>s(e,t)))}(n[o],e,t,i).pipe(fl(),er(a=>{if(a instanceof yx)throw Gy(new Ny,a);s[o]=a}))),tx(1),hn(()=>s),Md(o=>V2(o)?Os:Ay(o)))}(s,n,e,i).pipe(hn(o=>(n._resolvedData=o,n.data={...n.data,...o},null)))))}(c,i,n,e):(c.data=zy(c,c.parent,n).resolve,It(void 0))),er(()=>a++),tx(1),br(c=>a===o.size?It(t):Os))})}(this.paramsInheritanceStrategy,this.environmentInjector),er({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(o,"",Vr.NoDataFromResolver)}}))}),er(o=>{const a=new Ere(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}))}),Sx(s=>{const o=a=>{const c=[];if(a.routeConfig?.loadComponent){const l=xd(a)??this.environmentInjector;c.push(this.configLoader.loadComponent(l,a.routeConfig).pipe(er(u=>{a.component=u}),hn(()=>{})))}for(const l of a.children)c.push(...o(l));return c};return n2(o(s.targetSnapshot.root)).pipe(Iy(null),Sd(1))}),Sx(()=>this.afterPreactivation()),is(()=>{const{currentSnapshot:s,targetSnapshot:o}=i,a=this.createViewTransition?.(this.environmentInjector,s.root,o.root);return a?Er(a).pipe(hn(()=>i)):It(i)}),hn(s=>{const o=function kre(n,e,t){const i=qf(n,e._root,t?t._root:void 0);return new A2(i,e)}(t.routeReuseStrategy,s.targetSnapshot,s.currentRouterState);return this.currentTransition=i={...s,targetRouterState:o},this.currentNavigation.update(a=>(a.targetRouterState=o,a)),i}),er(()=>{this.events.next(new ux)}),((n,e,t,i)=>hn(r=>(new Hre(e,r.targetRouterState,r.currentRouterState,t,i).activate(n),r)))(this.rootContexts,t.routeReuseStrategy,s=>this.events.next(s),this.inputBindingEnabled),Sd(1),_s(new Te(s=>{const o=i.abortController.signal,a=()=>s.next();return o.addEventListener("abort",a),()=>o.removeEventListener("abort",a)}).pipe(Zr(()=>!r&&!i.targetRouterState),er(()=>{this.cancelNavigationTransition(i,i.abortController.signal.reason+"",Vr.Aborted)}))),er({next:s=>{r=!0,this.lastSuccessfulNavigation=Li(this.currentNavigation),this.events.next(new _l(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects))),this.titleStrategy?.updateTitle(s.targetRouterState.snapshot),s.resolve(!0)},complete:()=>{r=!0}}),_s(this.transitionAbortWithErrorSubject.pipe(er(s=>{throw s}))),Uf(()=>{r||this.cancelNavigationTransition(i,"",Vr.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),Md(s=>{if(this.destroyed)return i.resolve(!1),Os;if(r=!0,U2(s))this.events.next(new yl(i.id,this.urlSerializer.serialize(i.extractedUrl),s.message,s.cancellationCode)),function Vre(n){return U2(n)&&gl(n.url)}(s)?this.events.next(new Vy(s.url,s.navigationBehaviorOptions)):i.resolve(!1);else{const o=new lx(i.id,this.urlSerializer.serialize(i.extractedUrl),s,i.targetSnapshot??void 0);try{const a=Gr(this.environmentInjector,()=>this.navigationErrorHandler?.(o));if(!(a instanceof yx))throw this.events.next(o),s;{const{message:c,cancellationCode:l}=Gy(0,a);this.events.next(new yl(i.id,this.urlSerializer.serialize(i.extractedUrl),c,l)),this.events.next(new Vy(a.redirectTo,a.navigationBehaviorOptions))}}catch(a){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(a)}}return Os}))}))}cancelNavigationTransition(t,i,r){const s=new yl(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(s),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=Li(this.currentNavigation),r=i?.targetBrowserUrl??i?.extractedUrl;return t.toString()!==r?.toString()&&!i?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function zse(n){return n!==By}let Hse=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>oe(jse),providedIn:"root"})}return n})();class Gse{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let jse=(()=>{class n extends Gse{static \u0275fac=(()=>{let t;return function(r){return(t||(t=h0(n)))(r||n)}})();static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),J2=(()=>{class n{urlSerializer=oe(Py);options=oe(qy,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=oe(th);urlHandlingStrategy=oe(wx);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new pl;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:i,targetBrowserUrl:r}){const s=void 0!==t?this.urlHandlingStrategy.merge(t,i):i,o=r??s;return o instanceof pl?this.urlSerializer.serialize(o):o}commitTransition({targetRouterState:t,finalUrl:i,initialUrl:r}){i&&t?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=t):this.rawUrlTree=r}routerState=I2(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:()=>oe($se),providedIn:"root"})}return n})(),$se=(()=>{class n extends J2{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(i=>{"popstate"===i.type&&setTimeout(()=>{t(i.url,i.state,"popstate")})})}handleRouterEvent(t,i){t instanceof ax?this.updateStateMemento():t instanceof $f?this.commitTransition(i):t instanceof C2?"eager"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):t instanceof ux?(this.commitTransition(i),"deferred"===this.urlUpdateStrategy&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):t instanceof yl&&t.code!==Vr.SupersededByNewNavigation&&t.code!==Vr.Redirect?this.restoreHistory(i):t instanceof lx?this.restoreHistory(i,!0):t instanceof _l&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:i,id:r}){const{replaceUrl:s,state:o}=i;if(this.location.isCurrentPathEqualTo(t)||s){const a=this.browserPageId,c={...o,...this.generateNgRouterState(r,a)};this.location.replaceState(t,"",c)}else{const a={...o,...this.generateNgRouterState(r,this.browserPageId+1)};this.location.go(t,"",a)}}restoreHistory(t,i=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-this.browserPageId;0!==s?this.location.historyGo(s):this.getCurrentUrlTree()===t.finalUrl&&0===s&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(r){return(t||(t=h0(n)))(r||n)}})();static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const qse={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Xse={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Rd=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=oe(UR);stateManager=oe(J2);options=oe(qy,{optional:!0})||{};pendingTasks=oe(pa);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=oe(Vse);urlSerializer=oe(Py);location=oe(th);urlHandlingStrategy=oe(wx);injector=oe($i);_events=new lt;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=oe(Hse);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=oe(Mx,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!oe(gx,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Ti;subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(i=>{try{const r=this.navigationTransitions.currentTransition,s=Li(this.navigationTransitions.currentNavigation);if(null!==r&&null!==s)if(this.stateManager.handleRouterEvent(i,s),i instanceof yl&&i.code!==Vr.Redirect&&i.code!==Vr.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof _l)this.navigated=!0;else if(i instanceof Vy){const o=i.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),c={browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||"eager"===this.urlUpdateStrategy||zse(r.source),...o};this.scheduleNavigation(a,By,null,c,{resolve:r.resolve,reject:r.reject,promise:r.promise})}(function Cre(n){return!(n instanceof ux||n instanceof Vy)})(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),By,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,i,r)=>{this.navigateToSyncWithBrowser(t,r,i)})}navigateToSyncWithBrowser(t,i,r){const s={replaceUrl:!0},o=r?.navigationId?r:null;if(r){const c={...r};delete c.navigationId,delete c.\u0275routerPageId,0!==Object.keys(c).length&&(s.state=c)}const a=this.parseUrl(t);this.scheduleNavigation(a,i,o,s).catch(c=>{this.disposed||this.injector.get(xs)(c)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Li(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(_x),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,i={}){const{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:o;let d,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u={...this.currentUrlTree.queryParams,...s};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}null!==u&&(u=this.removeEmptyProps(u));try{d=E2(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||"/"!==t[0][0])&&(t=[]),d=this.currentUrlTree.root}return b2(d,t,u,l??null)}navigateByUrl(t,i={skipLocationChange:!1}){const r=gl(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,By,null,i)}navigate(t,i={skipLocationChange:!1}){return function Yse(n){for(let e=0;e<n.length;e++)if(null==n[e])throw new O(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,i){let r;if(r=!0===i?{...qse}:!1===i?{...Xse}:i,gl(t))return d2(this.currentUrlTree,t,r);const s=this.parseUrl(t);return d2(this.currentUrlTree,s,r)}removeEmptyProps(t){return Object.entries(t).reduce((i,[r,s])=>(null!=s&&(i[r]=s),i),{})}scheduleNavigation(t,i,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,c,l;o?(a=o.resolve,c=o.reject,l=o.promise):l=new Promise((d,h)=>{a=d,c=h});const u=this.pendingTasks.add();return function Wse(n,e){n.events.pipe(Zr(t=>t instanceof _l||t instanceof yl||t instanceof lx||t instanceof $f),hn(t=>t instanceof _l||t instanceof $f?0:t instanceof yl&&(t.code===Vr.Redirect||t.code===Vr.SupersededByNewNavigation)?2:1),Zr(t=>2!==t),Sd(1)).subscribe(()=>{e()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Tx=new ge("");function eU(n){return n.routerState.root}function tU(){const n=oe(ds);return e=>{const t=n.get(wa);if(e!==t.components[0])return;const i=n.get(Rd),r=n.get(nU);1===n.get(Cx)&&i.initialNavigation(),n.get(iU,null,{optional:!0})?.setUpPreloading(),n.get(Tx,null,{optional:!0})?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const nU=new ge("",{factory:()=>new lt}),Cx=new ge("",{providedIn:"root",factory:()=>1}),iU=new ge("");class Xy{}class Yy{}class ks{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?"string"==typeof e?this.lazyInit=()=>{this.headers=new Map,e.split("\n").forEach(t=>{const i=t.indexOf(":");if(i>0){const r=t.slice(0,i),s=t.slice(i+1).trim();this.addHeaderEntry(r,s)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,i)=>{this.addHeaderEntry(i,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,i])=>{this.setHeaderEntries(t,i)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof ks?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new ks;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof ks?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":const s=e.value;if(s){let o=this.headers.get(t);if(!o)return;o=o.filter(a=>-1===s.indexOf(a)),0===o.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}else this.headers.delete(t),this.normalizedNames.delete(t)}}addHeaderEntry(e,t){const i=e.toLowerCase();this.maybeSetNormalizedName(e,i),this.headers.has(i)?this.headers.get(i).push(t):this.headers.set(i,[t])}setHeaderEntries(e,t){const i=(Array.isArray(t)?t:[t]).map(s=>s.toString()),r=e.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(e,r)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class roe{encodeKey(e){return sU(e)}encodeValue(e){return sU(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const ooe=/%(\d[a-f0-9])/gi,aoe={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function sU(n){return encodeURIComponent(n).replace(ooe,(e,t)=>aoe[t]??e)}function Zy(n){return`${n}`}class Xa{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new roe,e.fromString){if(e.fromObject)throw new O(2805,!1);this.map=function soe(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[o,a]=-1==s?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,s)),e.decodeValue(r.slice(s+1))],c=t.get(o)||[];c.push(a),t.set(o,c)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const i=e.fromObject[t],r=Array.isArray(i)?i.map(Zy):[Zy(i)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(i=>{const r=e[i];Array.isArray(r)?r.forEach(s=>{t.push({param:i,value:s,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Xa({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Zy(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const r=i.indexOf(Zy(e.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class coe{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function oU(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function aU(n){return typeof Blob<"u"&&n instanceof Blob}function cU(n){return typeof FormData<"u"&&n instanceof FormData}const Kf="Content-Type",Dx="X-Request-URL",lU="text/plain",uU="application/json",dU=`${uU}, ${lU}, */*`;class Jf{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(e,t,i,r){let s;if(this.url=t,this.method=e.toUpperCase(),function loe(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s){if(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,this.keepalive=!!s.keepalive,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),s.priority&&(this.priority=s.priority),s.cache&&(this.cache=s.cache),s.credentials&&(this.credentials=s.credentials),"number"==typeof s.timeout){if(s.timeout<1||!Number.isInteger(s.timeout))throw new O(2822,"");this.timeout=s.timeout}s.mode&&(this.mode=s.mode),s.redirect&&(this.redirect=s.redirect),s.integrity&&(this.integrity=s.integrity),s.referrer&&(this.referrer=s.referrer),this.transferCache=s.transferCache}if(this.headers??=new ks,this.context??=new coe,this.params){const o=this.params.toString();if(0===o.length)this.urlWithParams=t;else{const a=t.indexOf("?");this.urlWithParams=t+(-1===a?"?":a<t.length-1?"&":"")+o}}else this.params=new Xa,this.urlWithParams=t}serializeBody(){return null===this.body?null:"string"==typeof this.body||oU(this.body)||aU(this.body)||cU(this.body)||function uoe(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)?this.body:this.body instanceof Xa?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||cU(this.body)?null:aU(this.body)?this.body.type||null:oU(this.body)?null:"string"==typeof this.body?lU:this.body instanceof Xa?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?uU:null}clone(e={}){const t=e.method||this.method,i=e.url||this.url,r=e.responseType||this.responseType,s=e.keepalive??this.keepalive,o=e.priority||this.priority,a=e.cache||this.cache,c=e.mode||this.mode,l=e.redirect||this.redirect,u=e.credentials||this.credentials,d=e.referrer||this.referrer,h=e.integrity||this.integrity,f=e.transferCache??this.transferCache,p=e.timeout??this.timeout,_=void 0!==e.body?e.body:this.body,g=e.withCredentials??this.withCredentials,m=e.reportProgress??this.reportProgress;let y=e.headers||this.headers,E=e.params||this.params;const v=e.context??this.context;return void 0!==e.setHeaders&&(y=Object.keys(e.setHeaders).reduce((C,x)=>C.set(x,e.setHeaders[x]),y)),e.setParams&&(E=Object.keys(e.setParams).reduce((C,x)=>C.set(x,e.setParams[x]),E)),new Jf(t,i,_,{params:E,headers:y,context:v,reportProgress:m,responseType:r,withCredentials:g,transferCache:f,keepalive:s,cache:a,priority:o,timeout:p,mode:c,redirect:l,credentials:u,referrer:d,integrity:h})}}var Ya=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Ya||{});class Ax{headers;status;statusText;url;ok;type;redirected;constructor(e,t=200,i="OK"){this.headers=e.headers||new ks,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.redirected=e.redirected,this.ok=this.status>=200&&this.status<300}}class Jy extends Ax{constructor(e={}){super(e)}type=Ya.ResponseHeader;clone(e={}){return new Jy({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Qf extends Ax{body;constructor(e={}){super(e),this.body=void 0!==e.body?e.body:null}type=Ya.Response;clone(e={}){return new Qf({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0,redirected:e.redirected??this.redirected})}}class vl extends Ax{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Ix(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,credentials:n.credentials,transferCache:n.transferCache,timeout:n.timeout,keepalive:n.keepalive,priority:n.priority,cache:n.cache,mode:n.mode,redirect:n.redirect,integrity:n.integrity,referrer:n.referrer}}let foe=(()=>{class n{handler;constructor(t){this.handler=t}request(t,i,r={}){let s;if(t instanceof Jf)s=t;else{let c,l;c=r.headers instanceof ks?r.headers:new ks(r.headers),r.params&&(l=r.params instanceof Xa?r.params:new Xa({fromObject:r.params})),s=new Jf(t,i,void 0!==r.body?r.body:null,{headers:c,context:r.context,params:l,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive,priority:r.priority,cache:r.cache,mode:r.mode,redirect:r.redirect,credentials:r.credentials,referrer:r.referrer,integrity:r.integrity,timeout:r.timeout})}const o=It(s).pipe(kf(c=>this.handler.handle(c)));if(t instanceof Jf||"events"===r.observe)return o;const a=o.pipe(Zr(c=>c instanceof Qf));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return a.pipe(hn(c=>{if(null!==c.body&&!(c.body instanceof ArrayBuffer))throw new O(2806,!1);return c.body}));case"blob":return a.pipe(hn(c=>{if(null!==c.body&&!(c.body instanceof Blob))throw new O(2807,!1);return c.body}));case"text":return a.pipe(hn(c=>{if(null!==c.body&&"string"!=typeof c.body)throw new O(2808,!1);return c.body}));default:return a.pipe(hn(c=>c.body))}case"response":return a;default:throw new O(2809,!1)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:(new Xa).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,Ix(r,i))}post(t,i,r={}){return this.request("POST",t,Ix(r,i))}put(t,i,r={}){return this.request("PUT",t,Ix(r,i))}static \u0275fac=function(i){return new(i||n)(ct(Xy))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();const pU=new ge("");function mU(n,e){return e(n)}function _oe(n,e){return(t,i)=>e.intercept(t,{handle:r=>n(r,i)})}const voe=new ge(""),ep=new ge(""),Eoe=new ge(""),gU=new ge("",{providedIn:"root",factory:()=>!0});function boe(){let n=null;return(e,t)=>{null===n&&(n=(oe(voe,{optional:!0})??[]).reduceRight(_oe,mU));const i=oe(Gp);if(oe(gU)){const s=i.add();return n(e,t).pipe(Uf(s))}return n(e,t)}}let _U=(()=>{class n extends Xy{backend;injector;chain=null;pendingTasks=oe(Gp);contributeToStability=oe(gU);constructor(t,i){super(),this.backend=t,this.injector=i}handle(t){if(null===this.chain){const i=Array.from(new Set([...this.injector.get(ep),...this.injector.get(Eoe,[])]));this.chain=i.reduceRight((r,s)=>function yoe(n,e,t){return(i,r)=>Gr(t,()=>e(i,s=>n(s,r)))}(r,s,this.injector),mU)}if(this.contributeToStability){const i=this.pendingTasks.add();return this.chain(t,r=>this.backend.handle(r)).pipe(Uf(i))}return this.chain(t,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||n)(ct(Yy),ct($i))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();const xoe=/^\)\]\}',?\n/,Toe=RegExp(`^${Dx}:`,"m");let vU=(()=>{class n{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new O(-2800,!1);const i=this.xhrFactory;return It(null).pipe(is(()=>new Te(s=>{const o=i.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((g,m)=>o.setRequestHeader(g,m.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept",dU),!t.headers.has(Kf)){const g=t.detectContentTypeHeader();null!==g&&o.setRequestHeader(Kf,g)}if(t.timeout&&(o.timeout=t.timeout),t.responseType){const g=t.responseType.toLowerCase();o.responseType="json"!==g?g:"text"}const a=t.serializeBody();let c=null;const l=()=>{if(null!==c)return c;const g=o.statusText||"OK",m=new ks(o.getAllResponseHeaders()),y=function Coe(n){return"responseURL"in n&&n.responseURL?n.responseURL:Toe.test(n.getAllResponseHeaders())?n.getResponseHeader(Dx):null}(o)||t.url;return c=new Jy({headers:m,status:o.status,statusText:g,url:y}),c},u=()=>{let{headers:g,status:m,statusText:y,url:E}=l(),v=null;204!==m&&(v=typeof o.response>"u"?o.responseText:o.response),0===m&&(m=v?200:0);let C=m>=200&&m<300;if("json"===t.responseType&&"string"==typeof v){const x=v;v=v.replace(xoe,"");try{v=""!==v?JSON.parse(v):null}catch(T){v=x,C&&(C=!1,v={error:T,text:v})}}C?(s.next(new Qf({body:v,headers:g,status:m,statusText:y,url:E||void 0})),s.complete()):s.error(new vl({error:v,headers:g,status:m,statusText:y,url:E||void 0}))},d=g=>{const{url:m}=l(),y=new vl({error:g,status:o.status||0,statusText:o.statusText||"Unknown Error",url:m||void 0});s.error(y)};let h=d;t.timeout&&(h=g=>{const{url:m}=l(),y=new vl({error:new DOMException("Request timed out","TimeoutError"),status:o.status||0,statusText:o.statusText||"Request timeout",url:m||void 0});s.error(y)});let f=!1;const p=g=>{f||(s.next(l()),f=!0);let m={type:Ya.DownloadProgress,loaded:g.loaded};g.lengthComputable&&(m.total=g.total),"text"===t.responseType&&o.responseText&&(m.partialText=o.responseText),s.next(m)},_=g=>{let m={type:Ya.UploadProgress,loaded:g.loaded};g.lengthComputable&&(m.total=g.total),s.next(m)};return o.addEventListener("load",u),o.addEventListener("error",d),o.addEventListener("timeout",h),o.addEventListener("abort",d),t.reportProgress&&(o.addEventListener("progress",p),null!==a&&o.upload&&o.upload.addEventListener("progress",_)),o.send(a),s.next({type:Ya.Sent}),()=>{o.removeEventListener("error",d),o.removeEventListener("abort",d),o.removeEventListener("load",u),o.removeEventListener("timeout",h),t.reportProgress&&(o.removeEventListener("progress",p),null!==a&&o.upload&&o.upload.removeEventListener("progress",_)),o.readyState!==o.DONE&&o.abort()}})))}static \u0275fac=function(i){return new(i||n)(ct(MC))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();const Nx=new ge(""),EU=new ge("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),bU=new ge("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class SU{}let Ioe=(()=>{class n{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,i){this.doc=t,this.cookieName=i}getToken(){const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=SC(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(i){return new(i||n)(ct(Wr),ct(EU))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();function Roe(n,e){const t=n.url.toLowerCase();if(!oe(Nx)||"GET"===n.method||"HEAD"===n.method||t.startsWith("http://")||t.startsWith("https://"))return e(n);const i=oe(SU).getToken(),r=oe(bU);return null!=i&&!n.headers.has(r)&&(n=n.clone({headers:n.headers.set(r,i)})),e(n)}var Za=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(Za||{});function Poe(...n){const e=[foe,vU,_U,{provide:Xy,useExisting:_U},{provide:Yy,useFactory:()=>oe(pU,{optional:!0})??oe(vU)},{provide:ep,useValue:Roe,multi:!0},{provide:Nx,useValue:!0},{provide:SU,useClass:Ioe}];for(const t of n)e.push(...t.\u0275providers);return Rp(e)}const MU=new ge("");function Noe(){return function El(n,e){return{\u0275kind:n,\u0275providers:e}}(Za.LegacyInterceptors,[{provide:MU,useFactory:boe},{provide:ep,useExisting:MU,multi:!0}])}let Ooe=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=pu({type:n});static \u0275inj=Ws({providers:[Poe(Noe())]})}return n})();var St=function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n}(St||{});const ta="*";function wU(n){return{type:St.Style,styles:n,offset:null}}class tp{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(e=0,t=0){this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class xU{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(e){this.players=e;let t=0,i=0,r=0;const s=this.players.length;0==s?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++i==s&&this._onDestroy()}),o.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){const e=this.players.reduce((t,i)=>null===t||i.totalTime>t.totalTime?i:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}function TU(n){return new O(3e3,!1)}function $oe(n){return new O(3002,!1)}function Ka(n){switch(n.length){case 0:return new tp;case 1:return n[0];default:return new xU(n)}}function CU(n,e,t=new Map,i=new Map){const r=[],s=[];let o=-1,a=null;if(e.forEach(c=>{const l=c.get("offset"),u=l==o,d=u&&a||new Map;c.forEach((h,f)=>{let p=f,_=h;if("offset"!==f)switch(p=n.normalizePropertyName(p,r),_){case"!":_=t.get(f);break;case ta:_=i.get(f);break;default:_=n.normalizeStyleValue(f,p,_,r)}d.set(p,_)}),u||s.push(d),a=d,o=l}),r.length)throw function nae(){return new O(3502,!1)}();return s}function Lx(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&Fx(t,"start",n)));break;case"done":n.onDone(()=>i(t&&Fx(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&Fx(t,"destroy",n)))}}function Fx(n,e,t){const s=kx(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),o=n._data;return null!=o&&(s._data=o),s}function kx(n,e,t,i,r="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!o}}function rs(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function DU(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}const pae=typeof document>"u"?null:document.documentElement;function Ux(n){const e=n.parentNode||n.host||null;return e===pae?null:e}let bl=null,AU=!1;function IU(n,e){for(;e;){if(e===n)return!0;e=Ux(e)}return!1}function RU(n,e,t){if(t)return Array.from(n.querySelectorAll(e));const i=n.querySelector(e);return i?[i]:[]}const NU="ng-enter",Bx="ng-leave",Qy="ng-trigger",ev=".ng-trigger",OU="ng-animating",Vx=".ng-animating";function na(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:zx(parseFloat(e[1]),e[2])}function zx(n,e){return"s"===e?1e3*n:n}function tv(n,e,t){return n.hasOwnProperty("duration")?n:function bae(n,e,t){let i,r=0,s="";if("string"==typeof n){const o=n.match(Eae);if(null===o)return e.push(TU()),{duration:0,delay:0,easing:""};i=zx(parseFloat(o[1]),o[2]);const a=o[3];null!=a&&(r=zx(parseFloat(a),o[4]));const c=o[5];c&&(s=c)}else i=n;if(!t){let o=!1,a=e.length;i<0&&(e.push(function Foe(){return new O(3100,!1)}()),o=!0),r<0&&(e.push(function koe(){return new O(3101,!1)}()),o=!0),o&&e.splice(a,0,TU())}return{duration:i,delay:r,easing:s}}(n,e,t)}const Eae=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function co(n,e,t){e.forEach((i,r)=>{const s=Gx(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i})}function Sl(n,e){e.forEach((t,i)=>{const r=Gx(i);n.style[r]=""})}function np(n){return Array.isArray(n)?1==n.length?n[0]:function Loe(n,e=null){return{type:St.Sequence,steps:n,options:e}}(n):n}const Hx=new RegExp("{{\\s*(.+?)\\s*}}","g");function LU(n){let e=[];if("string"==typeof n){let t;for(;t=Hx.exec(n);)e.push(t[1]);Hx.lastIndex=0}return e}function ip(n,e,t){const i=`${n}`,r=i.replace(Hx,(s,o)=>{let a=e[o];return null==a&&(t.push(function Boe(){return new O(3003,!1)}()),a=""),a.toString()});return r==i?n:r}const wae=/-+([a-z0-9])/g;function Gx(n){return n.replace(wae,(...e)=>e[1].toUpperCase())}function ss(n,e,t){switch(e.type){case St.Trigger:return n.visitTrigger(e,t);case St.State:return n.visitState(e,t);case St.Transition:return n.visitTransition(e,t);case St.Sequence:return n.visitSequence(e,t);case St.Group:return n.visitGroup(e,t);case St.Animate:return n.visitAnimate(e,t);case St.Keyframes:return n.visitKeyframes(e,t);case St.Style:return n.visitStyle(e,t);case St.Reference:return n.visitReference(e,t);case St.AnimateChild:return n.visitAnimateChild(e,t);case St.AnimateRef:return n.visitAnimateRef(e,t);case St.Query:return n.visitQuery(e,t);case St.Stagger:return n.visitStagger(e,t);default:throw function Voe(){return new O(3004,!1)}()}}function jx(n,e){return window.getComputedStyle(n)[e]}let $x=(()=>{class n{validateStyleProperty(t){return function gae(n){bl||(bl=function _ae(){return typeof document<"u"?document.body:null}()||{},AU=!!bl.style&&"WebkitAppearance"in bl.style);let e=!0;return bl.style&&!function mae(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in bl.style,!e&&AU&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in bl.style)),e}(t)}containsElement(t,i){return IU(t,i)}getParentElement(t){return Ux(t)}query(t,i,r){return RU(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,o,a=[],c){return new tp(r,s)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})();class Wx{static NOOP=new $x}class qx{}const Dae=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class FU extends qx{normalizePropertyName(e,t){return Gx(e)}normalizeStyleValue(e,t,i,r){let s="";const o=i.toString().trim();if(Dae.has(t)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const a=i.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&r.push(function zoe(){return new O(3005,!1)}())}return o+s}}const iv=new Set(["true","1"]),rv=new Set(["false","0"]);function kU(n,e){const t=iv.has(n)||rv.has(n),i=iv.has(e)||rv.has(e);return(r,s)=>{let o="*"==n||n==r,a="*"==e||e==s;return!o&&t&&"boolean"==typeof r&&(o=r?iv.has(n):rv.has(n)),!a&&i&&"boolean"==typeof s&&(a=s?iv.has(e):rv.has(e)),o&&a}}const Pae=new RegExp("s*:selfs*,?","g");function Yx(n,e,t,i){return new Nae(n).build(e,t,i)}class Nae{_driver;constructor(e){this._driver=e}build(e,t,i){const r=new Fae(t);return this._resetContextStyleTimingState(r),ss(this,np(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0;const s=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push(function Hoe(){return new O(3006,!1)}()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==St.State){const c=a,l=c.name;l.toString().split(/\s*,\s*/).forEach(u=>{c.name=u,s.push(this.visitState(c,t))}),c.name=l}else if(a.type==St.Transition){const c=this.visitTransition(a,t);i+=c.queryCount,r+=c.depCount,o.push(c)}else t.errors.push(function Goe(){return new O(3007,!1)}())}),{type:St.Trigger,name:e.name,states:s,transitions:o,queryCount:i,depCount:r,options:null}}visitState(e,t){const i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){const s=new Set,o=r||{};i.styles.forEach(a=>{a instanceof Map&&a.forEach(c=>{LU(c).forEach(l=>{o.hasOwnProperty(l)||s.add(l)})})}),s.size&&t.errors.push(function joe(){return new O(3008,!1)}(0,s.values()))}return{type:St.State,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const i=ss(this,np(e.animation),t),r=function Aae(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function Iae(n,e,t){if(":"==n[0]){const c=function Rae(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(function eae(){return new O(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof c)return void e.push(c);n=c}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return t.push(function Qoe(){return new O(3015,!1)}()),e;const r=i[1],s=i[2],o=i[3];e.push(kU(r,o)),"<"==s[0]&&("*"!=r||"*"!=o)&&e.push(kU(o,r))}(i,t,e)):t.push(n),t}(e.expr,t.errors);return{type:St.Transition,matchers:r,animation:i,queryCount:t.queryCount,depCount:t.depCount,options:Ml(e.options)}}visitSequence(e,t){return{type:St.Sequence,steps:e.steps.map(i=>ss(this,i,t)),options:Ml(e.options)}}visitGroup(e,t){const i=t.currentTime;let r=0;const s=e.steps.map(o=>{t.currentTime=i;const a=ss(this,o,t);return r=Math.max(r,t.currentTime),a});return t.currentTime=r,{type:St.Group,steps:s,options:Ml(e.options)}}visitAnimate(e,t){const i=function Uae(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return Zx(tv(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=Zx(0,0,"");return s.dynamic=!0,s.strValue=t,s}const r=tv(t,e);return Zx(r.duration,r.delay,r.easing)}(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:wU({});if(s.type==St.Keyframes)r=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;const l={};i.easing&&(l.easing=i.easing),o=wU(l)}t.currentTime+=i.duration+i.delay;const c=this.visitStyle(o,t);c.isEmptyStep=a,r=c}return t.currentAnimateTimings=null,{type:St.Animate,timings:i,style:r,options:null}}visitStyle(e,t){const i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){const i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of r)"string"==typeof a?a===ta?i.push(a):t.errors.push($oe()):i.push(new Map(Object.entries(a)));let s=!1,o=null;return i.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s))for(let c of a.values())if(c.toString().indexOf("{{")>=0){s=!0;break}}),{type:St.Style,styles:i,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const i=t.currentAnimateTimings;let r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(o=>{"string"!=typeof o&&o.forEach((a,c)=>{const l=t.collectedStyles.get(t.currentQuerySelector),u=l.get(c);let d=!0;u&&(s!=r&&s>=u.startTime&&r<=u.endTime&&(t.errors.push(function Woe(){return new O(3010,!1)}()),d=!1),s=u.startTime),d&&l.set(c,{startTime:s,endTime:r}),t.options&&function Mae(n,e,t){const i=e.params||{},r=LU(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(function Uoe(){return new O(3001,!1)}())})}(a,t.options,t.errors)})})}visitKeyframes(e,t){const i={type:St.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function qoe(){return new O(3011,!1)}()),i;let s=0;const o=[];let a=!1,c=!1,l=0;const u=e.steps.map(m=>{const y=this._makeStyleAst(m,t);let E=null!=y.offset?y.offset:function kae(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(y.styles),v=0;return null!=E&&(s++,v=y.offset=E),c=c||v<0||v>1,a=a||v<l,l=v,o.push(v),y});c&&t.errors.push(function Xoe(){return new O(3012,!1)}()),a&&t.errors.push(function Yoe(){return new O(3200,!1)}());const d=e.steps.length;let h=0;s>0&&s<d?t.errors.push(function Zoe(){return new O(3202,!1)}()):0==s&&(h=1/(d-1));const f=d-1,p=t.currentTime,_=t.currentAnimateTimings,g=_.duration;return u.forEach((m,y)=>{const E=h>0?y==f?1:h*y:o[y],v=E*g;t.currentTime=p+_.delay+v,_.duration=v,this._validateStyleAst(m,t),m.offset=E,i.styles.push(m)}),i}visitReference(e,t){return{type:St.Reference,animation:ss(this,np(e.animation),t),options:Ml(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:St.AnimateChild,options:Ml(e.options)}}visitAnimateRef(e,t){return{type:St.AnimateRef,animation:this.visitReference(e.animation,t),options:Ml(e.options)}}visitQuery(e,t){const i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[s,o]=function Oae(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(Pae,"")),n=n.replace(/@\*/g,ev).replace(/@\w+/g,t=>ev+"-"+t.slice(1)).replace(/:animating/g,Vx),[n,e]}(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,rs(t.collectedStyles,t.currentQuerySelector,new Map);const a=ss(this,np(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:St.Query,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:Ml(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function Koe(){return new O(3013,!1)}());const i="full"===e.timings?{duration:0,delay:0,easing:"full"}:tv(e.timings,t.errors,!0);return{type:St.Stagger,animation:ss(this,np(e.animation),t),timings:i,options:null}}}class Fae{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(e){this.errors=e}}function Ml(n){return n?(n={...n}).params&&(n.params=function Lae(n){return n?{...n}:null}(n.params)):n={},n}function Zx(n,e,t){return{duration:n,delay:e,easing:t}}function Kx(n,e,t,i,r,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:o,subTimeline:a}}class sv{_map=new Map;get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const zae=new RegExp(":enter","g"),Gae=new RegExp(":leave","g");function Jx(n,e,t,i,r,s=new Map,o=new Map,a,c,l=[]){return(new jae).buildKeyframes(n,e,t,i,r,s,o,a,c,l)}class jae{buildKeyframes(e,t,i,r,s,o,a,c,l,u=[]){l=l||new sv;const d=new Qx(e,t,l,r,s,u,[]);d.options=c;const h=c.delay?na(c.delay):0;d.currentTimeline.delayNextStep(h),d.currentTimeline.setStyles([o],null,d.errors,c),ss(this,i,d);const f=d.timelines.filter(p=>p.containsAnimation());if(f.length&&a.size){let p;for(let _=f.length-1;_>=0;_--){const g=f[_];if(g.element===t){p=g;break}}p&&!p.allowOnlyTimelineStyles()&&p.setStyles([a],null,d.errors,c)}return f.length?f.map(p=>p.buildKeyframes()):[Kx(t,[],[],[],0,h,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const i=t.subInstructions.get(t.element);if(i){const r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(i,r,r.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){const i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(const r of e){const s=r?.delay;if(s){const o="number"==typeof s?s:na(ip(s,r?.params??{},t.errors));i.delayNextStep(o)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime;const o=null!=i.duration?na(i.duration):null,a=null!=i.delay?na(i.delay):null;return 0!==o&&e.forEach(c=>{const l=t.appendInstructionToTimeline(c,o,a);s=Math.max(s,l.duration+l.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),ss(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const i=t.subContextCount;let r=t;const s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){r.previousNode.type==St.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=ov);const o=na(s.delay);r.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>ss(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const i=[];let r=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?na(e.options.delay):0;e.steps.forEach(o=>{const a=t.createSubContext(e.options);s&&a.delayNextStep(s),ss(this,o,a),r=Math.max(r,a.currentTimeline.currentTime),i.push(a.currentTimeline)}),i.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const i=e.strValue;return tv(t.params?ip(i,t.params,t.errors):i,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());const s=e.style;s.type==St.Keyframes?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,a=t.createSubContext().currentTimeline;a.easing=i.easing,e.styles.forEach(c=>{a.forwardTime((c.offset||0)*s),a.setStyles(c.styles,c.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){const i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?na(r.delay):0;s&&(t.previousNode.type===St.Style||0==i&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=ov);let o=i;const a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=a.length;let c=null;a.forEach((l,u)=>{t.currentQueryIndex=u;const d=t.createSubContext(e.options,l);s&&d.delayNextStep(s),l===t.element&&(c=d.currentTimeline),ss(this,e.animation,d),d.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,d.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),c&&(t.currentTimeline.mergeTimelineCollectedStyles(c),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const i=t.parentContext,r=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1);let c=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":c=a-c;break;case"full":c=i.currentStaggerTime}const u=t.currentTimeline;c&&u.delayNextStep(c);const d=u.currentTime;ss(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-d+(r.startTime-i.currentTimeline.startTime)}}const ov={};class Qx{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=ov;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(e,t,i,r,s,o,a,c){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=o,this.timelines=a,this.currentTimeline=c||new av(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const i=e;let r=this.options;null!=i.duration&&(r.duration=na(i.duration)),null!=i.delay&&(r.delay=na(i.delay));const s=i.params;if(s){let o=r.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=ip(s[a],o,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){const r=t||this.element,s=new Qx(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=ov,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new $ae(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,o){let a=[];if(r&&a.push(this.element),e.length>0){e=(e=e.replace(zae,"."+this._enterClassName)).replace(Gae,"."+this._leaveClassName);let l=this._driver.query(this.element,e,1!=i);0!==i&&(l=i<0?l.slice(l.length+i,l.length):l.slice(0,i)),a.push(...l)}return!s&&0==a.length&&o.push(function Joe(){return new O(3014,!1)}()),a}}class av{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new av(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||ta),this._currentKeyframe.set(t,ta);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);const s=r&&r.params||{},o=function Wae(n,e){const t=new Map;let i;return n.forEach(r=>{if("*"===r){i??=e.keys();for(let s of i)t.set(s,ta)}else for(let[s,o]of r)t.set(s,o)}),t}(e,this._globalTimelineStyles);for(let[a,c]of o){const l=ip(c,s,i);this._pendingStyles.set(a,l),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??ta),this._updateStyle(a,l)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{const r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((a,c)=>{const l=new Map([...this._backFill,...a]);l.forEach((u,d)=>{"!"===u?e.add(d):u===ta&&t.add(d)}),i||l.set("offset",c/this.duration),r.push(l)});const s=[...e.values()],o=[...t.values()];if(i){const a=r[0],c=new Map(a);a.set("offset",0),c.set("offset",1),r=[a,c]}return Kx(this.element,r,s,o,this.duration,this.startTime,this.easing,!1)}}class $ae extends av{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(e,t,i,r,s,o,a=!1){super(e,t,o.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],o=i+t,a=t/o,c=new Map(e[0]);c.set("offset",0),s.push(c);const l=new Map(e[0]);l.set("offset",VU(a)),s.push(l);const u=e.length-1;for(let d=1;d<=u;d++){let h=new Map(e[d]);const f=h.get("offset");h.set("offset",VU((t+f*i)/o)),s.push(h)}i=o,t=0,r="",e=s}return Kx(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}}function VU(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}function zU(n,e,t,i,r,s,o,a,c,l,u,d,h){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:o,timelines:a,queriedElements:c,preStyleProps:l,postStyleProps:u,totalTime:d,errors:h}}const eT={};class HU{_triggerName;ast;_stateStyles;constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return function qae(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return void 0!==e&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,o,a,c,l,u){const d=[],h=this.ast.options&&this.ast.options.params||eT,p=this.buildStyles(i,a&&a.params||eT,d),_=c&&c.params||eT,g=this.buildStyles(r,_,d),m=new Set,y=new Map,E=new Map,v="void"===r,C={params:GU(_,h),delay:this.ast.options?.delay},x=u?[]:Jx(e,t,this.ast.animation,s,o,p,g,C,l,d);let T=0;return x.forEach(I=>{T=Math.max(I.duration+I.delay,T)}),d.length?zU(t,this._triggerName,i,r,v,p,g,[],[],y,E,T,d):(x.forEach(I=>{const M=I.element,b=rs(y,M,new Set);I.preStyleProps.forEach(W=>b.add(W));const P=rs(E,M,new Set);I.postStyleProps.forEach(W=>P.add(W)),M!==t&&m.add(M)}),zU(t,this._triggerName,i,r,v,p,g,x,[...m.values()],y,E,T))}}function GU(n,e){const t={...e};return Object.entries(n).forEach(([i,r])=>{null!=r&&(t[i]=r)}),t}class Xae{styles;defaultParams;normalizer;constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){const i=new Map,r=GU(e,this.defaultParams);return this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((o,a)=>{o&&(o=ip(o,r,t));const c=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,c,o,t),i.set(a,o)})}),i}}class Zae{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,t.states.forEach(r=>{this.states.set(r.name,new Xae(r.style,r.options&&r.options.params||{},i))}),jU(this.states,"true","1"),jU(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new HU(e,r,this.states))}),this.fallbackTransition=function Kae(n,e){return new HU(n,{type:St.Transition,animation:{type:St.Sequence,steps:[],options:null},matchers:[(o,a)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(o=>o.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}}function jU(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const Jae=new sv;class Qae{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i}register(e,t){const i=[],s=Yx(this._driver,t,i,[]);if(i.length)throw function iae(){return new O(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,i){const r=e.element,s=CU(this._normalizer,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){const r=[],s=this._animations.get(e);let o;const a=new Map;if(s?(o=Jx(this._driver,t,s,NU,Bx,new Map,new Map,i,Jae,r),o.forEach(u=>{const d=rs(a,u.element,new Map);u.postStyleProps.forEach(h=>d.set(h,null))})):(r.push(function rae(){return new O(3300,!1)}()),o=[]),r.length)throw function sae(){return new O(3504,!1)}();a.forEach((u,d)=>{u.forEach((h,f)=>{u.set(f,this._driver.computeStyle(d,f,ta))})});const l=Ka(o.map(u=>{const d=a.get(u.element);return this._buildPlayer(u,new Map,d)}));return this._playersById.set(e,l),l.onDestroy(()=>this.destroy(e)),this.players.push(l),l}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function oae(){return new O(3301,!1)}();return t}listen(e,t,i,r){const s=kx(t,"","","");return Lx(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if("register"==i)return void this.register(e,r[0]);if("create"==i)return void this.create(e,t,r[0]||{});const s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const $U="ng-animate-queued",tT="ng-animate-disabled",rce=[],WU={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},sce={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Us="__ng_removed";class nT{namespaceId;value;options;get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;const i=e&&e.hasOwnProperty("value");if(this.value=function lce(n){return n??null}(i?e.value:e),i){const{value:s,...o}=e;this.options=o}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){const t=e.params;if(t){const i=this.options.params;Object.keys(t).forEach(r=>{null==i[r]&&(i[r]=t[r])})}}}const rp="void",iT=new nT(rp);class oce{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this._hostClassName="ng-tns-"+e,Es(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw function aae(){return new O(3302,!1)}();if(null==i||0==i.length)throw function cae(){return new O(3303,!1)}();if(!function uce(n){return"start"==n||"done"==n}(i))throw function lae(){return new O(3400,!1)}();const s=rs(this._elementListeners,e,[]),o={name:t,phase:i,callback:r};s.push(o);const a=rs(this._engine.statesByElement,e,new Map);return a.has(t)||(Es(e,Qy),Es(e,Qy+"-"+t),a.set(t,iT)),()=>{this._engine.afterFlush(()=>{const c=s.indexOf(o);c>=0&&s.splice(c,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function uae(){return new O(3401,!1)}();return t}trigger(e,t,i,r=!0){const s=this._getTrigger(t),o=new rT(this.id,t,e);let a=this._engine.statesByElement.get(e);a||(Es(e,Qy),Es(e,Qy+"-"+t),this._engine.statesByElement.set(e,a=new Map));let c=a.get(t);const l=new nT(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&c&&l.absorbOptions(c.options),a.set(t,l),c||(c=iT),l.value!==rp&&c.value===l.value){if(!function fce(n,e){const t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(c.params,l.params)){const _=[],g=s.matchStyles(c.value,c.params,_),m=s.matchStyles(l.value,l.params,_);_.length?this._engine.reportError(_):this._engine.afterFlush(()=>{Sl(e,g),co(e,m)})}return}const h=rs(this._engine.playersByElement,e,[]);h.forEach(_=>{_.namespaceId==this.id&&_.triggerName==t&&_.queued&&_.destroy()});let f=s.matchTransition(c.value,l.value,e,l.params),p=!1;if(!f){if(!r)return;f=s.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:f,fromState:c,toState:l,player:o,isFallbackTransition:p}),p||(Es(e,$U),o.onStart(()=>{Pd(e,$U)})),o.onDone(()=>{let _=this.players.indexOf(o);_>=0&&this.players.splice(_,1);const g=this._engine.playersByElement.get(e);if(g){let m=g.indexOf(o);m>=0&&g.splice(m,1)}}),this.players.push(o),h.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const i=this._engine.driver.query(e,ev,!0);i.forEach(r=>{if(r[Us])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(o=>o.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){const s=this._engine.statesByElement.get(e),o=new Map;if(s){const a=[];if(s.forEach((c,l)=>{if(o.set(l,c.value),this._triggers.has(l)){const u=this.trigger(e,l,rp,r);u&&a.push(u)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),i&&Ka(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){const r=new Set;t.forEach(s=>{const o=s.name;if(r.has(o))return;r.add(o);const c=this._triggers.get(o).fallbackTransition,l=i.get(o)||iT,u=new nT(rp),d=new rT(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:c,fromState:l,toState:u,player:d,isFallbackTransition:!0})})}}removeNode(e,t){const i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let o=e;for(;o=o.parentNode;)if(i.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{const s=e[Us];(!s||s===WU)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){Es(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==i.triggerName){const c=kx(s,i.triggerName,i.fromState.value,i.toState.value);c._data=e,Lx(i.player,a.phase,c,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{const s=i.transition.ast.depCount,o=r.transition.ast.depCount;return 0==s||0==o?s-o:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}}class ace{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(e,t)=>{};_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){const i=new oce(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){const c=r.get(a);if(c){const l=i.indexOf(c);i.splice(l+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const i=this._fetchNamespace(e);this.namespacesByHostElement.delete(i.hostElement);const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1),i.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,i=this.statesByElement.get(e);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}return t}trigger(e,t,i,r){if(cv(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!cv(t))return;const s=t[Us];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){const o=this._fetchNamespace(e);o&&o.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Es(e,tT)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Pd(e,tT))}removeNode(e,t,i){if(cv(t)){const r=e?this._fetchNamespace(e):null;r?r.removeNode(t,i):this.markElementAsRemoved(e,t,!1,i);const s=this.namespacesByHostElement.get(t);s&&s.id!==e&&s.removeNode(t,i)}else this._onRemovalComplete(t,i)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[Us]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return cv(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,ev,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,Vx,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Ka(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[Us];if(t&&t.setForRemoval){if(e[Us]=WU,t.namespaceId){this.destroyInnerAnimations(e);const i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(tT)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Es(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],t.length?Ka(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw function dae(){return new O(3402,!1)}()}_flushAnimations(e,t){const i=new sv,r=[],s=new Map,o=[],a=new Map,c=new Map,l=new Map,u=new Set;this.disabledNodes.forEach(L=>{u.add(L);const Y=this.driver.query(L,".ng-animate-queued",!0);for(let B=0;B<Y.length;B++)u.add(Y[B])});const d=this.bodyNode,h=Array.from(this.statesByElement.keys()),f=YU(h,this.collectedEnterElements),p=new Map;let _=0;f.forEach((L,Y)=>{const B=NU+_++;p.set(Y,B),L.forEach(ae=>Es(ae,B))});const g=[],m=new Set,y=new Set;for(let L=0;L<this.collectedLeaveElements.length;L++){const Y=this.collectedLeaveElements[L],B=Y[Us];B&&B.setForRemoval&&(g.push(Y),m.add(Y),B.hasAnimation?this.driver.query(Y,".ng-star-inserted",!0).forEach(ae=>m.add(ae)):y.add(Y))}const E=new Map,v=YU(h,Array.from(m));v.forEach((L,Y)=>{const B=Bx+_++;E.set(Y,B),L.forEach(ae=>Es(ae,B))}),e.push(()=>{f.forEach((L,Y)=>{const B=p.get(Y);L.forEach(ae=>Pd(ae,B))}),v.forEach((L,Y)=>{const B=E.get(Y);L.forEach(ae=>Pd(ae,B))}),g.forEach(L=>{this.processLeaveNode(L)})});const C=[],x=[];for(let L=this._namespaceList.length-1;L>=0;L--)this._namespaceList[L].drainQueuedTransitions(t).forEach(B=>{const ae=B.player,ve=B.element;if(C.push(ae),this.collectedEnterElements.length){const fe=ve[Us];if(fe&&fe.setForMove){if(fe.previousTriggersValues&&fe.previousTriggersValues.has(B.triggerName)){const qe=fe.previousTriggersValues.get(B.triggerName),Ke=this.statesByElement.get(B.element);if(Ke&&Ke.has(B.triggerName)){const gt=Ke.get(B.triggerName);gt.value=qe,Ke.set(B.triggerName,gt)}}return void ae.destroy()}}const De=!d||!this.driver.containsElement(d,ve),ot=E.get(ve),tn=p.get(ve),K=this._buildInstruction(B,i,tn,ot,De);if(K.errors&&K.errors.length)return void x.push(K);if(De)return ae.onStart(()=>Sl(ve,K.fromStyles)),ae.onDestroy(()=>co(ve,K.toStyles)),void r.push(ae);if(B.isFallbackTransition)return ae.onStart(()=>Sl(ve,K.fromStyles)),ae.onDestroy(()=>co(ve,K.toStyles)),void r.push(ae);const Ee=[];K.timelines.forEach(fe=>{fe.stretchStartingKeyframe=!0,this.disabledNodes.has(fe.element)||Ee.push(fe)}),K.timelines=Ee,i.append(ve,K.timelines),o.push({instruction:K,player:ae,element:ve}),K.queriedElements.forEach(fe=>rs(a,fe,[]).push(ae)),K.preStyleProps.forEach((fe,qe)=>{if(fe.size){let Ke=c.get(qe);Ke||c.set(qe,Ke=new Set),fe.forEach((gt,nn)=>Ke.add(nn))}}),K.postStyleProps.forEach((fe,qe)=>{let Ke=l.get(qe);Ke||l.set(qe,Ke=new Set),fe.forEach((gt,nn)=>Ke.add(nn))})});if(x.length){const L=[];x.forEach(Y=>{L.push(function hae(){return new O(3505,!1)}())}),C.forEach(Y=>Y.destroy()),this.reportError(L)}const T=new Map,I=new Map;o.forEach(L=>{const Y=L.element;i.has(Y)&&(I.set(Y,Y),this._beforeAnimationBuild(L.player.namespaceId,L.instruction,T))}),r.forEach(L=>{const Y=L.element;this._getPreviousPlayers(Y,!1,L.namespaceId,L.triggerName,null).forEach(ae=>{rs(T,Y,[]).push(ae),ae.destroy()})});const M=g.filter(L=>KU(L,c,l)),b=new Map;XU(b,this.driver,y,l,ta).forEach(L=>{KU(L,c,l)&&M.push(L)});const W=new Map;f.forEach((L,Y)=>{XU(W,this.driver,new Set(L),c,"!")}),M.forEach(L=>{const Y=b.get(L),B=W.get(L);b.set(L,new Map([...Y?.entries()??[],...B?.entries()??[]]))});const $=[],J=[],ce={};o.forEach(L=>{const{element:Y,player:B,instruction:ae}=L;if(i.has(Y)){if(u.has(Y))return B.onDestroy(()=>co(Y,ae.toStyles)),B.disabled=!0,B.overrideTotalTime(ae.totalTime),void r.push(B);let ve=ce;if(I.size>1){let ot=Y;const tn=[];for(;ot=ot.parentNode;){const K=I.get(ot);if(K){ve=K;break}tn.push(ot)}tn.forEach(K=>I.set(K,ve))}const De=this._buildAnimation(B.namespaceId,ae,T,s,W,b);if(B.setRealPlayer(De),ve===ce)$.push(B);else{const ot=this.playersByElement.get(ve);ot&&ot.length&&(B.parentPlayer=Ka(ot)),r.push(B)}}else Sl(Y,ae.fromStyles),B.onDestroy(()=>co(Y,ae.toStyles)),J.push(B),u.has(Y)&&r.push(B)}),J.forEach(L=>{const Y=s.get(L.element);if(Y&&Y.length){const B=Ka(Y);L.setRealPlayer(B)}}),r.forEach(L=>{L.parentPlayer?L.syncPlayerEvents(L.parentPlayer):L.destroy()});for(let L=0;L<g.length;L++){const Y=g[L],B=Y[Us];if(Pd(Y,Bx),B&&B.hasAnimation)continue;let ae=[];if(a.size){let De=a.get(Y);De&&De.length&&ae.push(...De);let ot=this.driver.query(Y,Vx,!0);for(let tn=0;tn<ot.length;tn++){let K=a.get(ot[tn]);K&&K.length&&ae.push(...K)}}const ve=ae.filter(De=>!De.destroyed);ve.length?dce(this,Y,ve):this.processLeaveNode(Y)}return g.length=0,$.forEach(L=>{this.players.push(L),L.onDone(()=>{L.destroy();const Y=this.players.indexOf(L);this.players.splice(Y,1)}),L.play()}),$}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let o=[];if(t){const a=this.playersByQueriedElement.get(e);a&&(o=a)}else{const a=this.playersByElement.get(e);if(a){const c=!s||s==rp;a.forEach(l=>{l.queued||!c&&l.triggerName!=r||o.push(l)})}}return(i||r)&&(o=o.filter(a=>!(i&&i!=a.namespaceId||r&&r!=a.triggerName))),o}_beforeAnimationBuild(e,t,i){const s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:t.triggerName;for(const c of t.timelines){const l=c.element,u=l!==s,d=rs(i,l,[]);this._getPreviousPlayers(l,u,o,a,t.toState).forEach(f=>{const p=f.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),f.destroy(),d.push(f)})}Sl(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,o){const a=t.triggerName,c=t.element,l=[],u=new Set,d=new Set,h=t.timelines.map(p=>{const _=p.element;u.add(_);const g=_[Us];if(g&&g.removedBeforeQueried)return new tp(p.duration,p.delay);const m=_!==c,y=function hce(n){const e=[];return ZU(n,e),e}((i.get(_)||rce).map(T=>T.getRealPlayer())).filter(T=>!!T.element&&T.element===_),E=s.get(_),v=o.get(_),C=CU(this._normalizer,p.keyframes,E,v),x=this._buildPlayer(p,C,y);if(p.subTimeline&&r&&d.add(_),m){const T=new rT(e,a,_);T.setRealPlayer(x),l.push(T)}return x});l.forEach(p=>{rs(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>function cce(n,e,t){let i=n.get(e);if(i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&n.delete(e)}return i}(this.playersByQueriedElement,p.element,p))}),u.forEach(p=>Es(p,OU));const f=Ka(h);return f.onDestroy(()=>{u.forEach(p=>Pd(p,OU)),co(c,t.toStyles)}),d.forEach(p=>{rs(r,p,[]).push(f)}),f}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new tp(e.duration,e.delay)}}class rT{namespaceId;triggerName;element;_player=new tp;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>Lx(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){rs(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function cv(n){return n&&1===n.nodeType}function qU(n,e){const t=n.style.display;return n.style.display=e??"none",t}function XU(n,e,t,i,r){const s=[];t.forEach(c=>s.push(qU(c)));const o=[];i.forEach((c,l)=>{const u=new Map;c.forEach(d=>{const h=e.computeStyle(l,d,r);u.set(d,h),(!h||0==h.length)&&(l[Us]=sce,o.push(l))}),n.set(l,u)});let a=0;return t.forEach(c=>qU(c,s[a++])),o}function YU(n,e){const t=new Map;if(n.forEach(a=>t.set(a,[])),0==e.length)return t;const r=new Set(e),s=new Map;function o(a){if(!a)return 1;let c=s.get(a);if(c)return c;const l=a.parentNode;return c=t.has(l)?l:r.has(l)?1:o(l),s.set(a,c),c}return e.forEach(a=>{const c=o(a);1!==c&&t.get(c).push(a)}),t}function Es(n,e){n.classList?.add(e)}function Pd(n,e){n.classList?.remove(e)}function dce(n,e,t){Ka(t).onDone(()=>n.processLeaveNode(e))}function ZU(n,e){for(let t=0;t<n.length;t++){const i=n[t];i instanceof xU?ZU(i.players,e):e.push(i)}}function KU(n,e,t){const i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}class sp{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(e,t)=>{};constructor(e,t,i){this._driver=t,this._normalizer=i,this._transitionEngine=new ace(e.body,t,i),this._timelineEngine=new Qae(e.body,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){const o=e+"-"+r;let a=this._triggerCache[o];if(!a){const c=[],u=Yx(this._driver,s,c,[]);if(c.length)throw function tae(){return new O(3404,!1)}();a=function Yae(n,e,t){return new Zae(n,e,t)}(r,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,r,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i){this._transitionEngine.removeNode(e,t,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if("@"==i.charAt(0)){const[s,o]=DU(i);this._timelineEngine.command(s,t,o,r)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if("@"==i.charAt(0)){const[o,a]=DU(i);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}}let mce=(()=>{class n{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&co(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(co(this._element,this._initialStyles),this._endStyles&&(co(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Sl(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Sl(this._element,this._endStyles),this._endStyles=null),co(this._element,this._initialStyles),this._state=3)}}return n})();function sT(n){let e=null;return n.forEach((t,i)=>{(function gce(n){return"display"===n||"position"===n})(i)&&(e=e||new Map,e.set(i,t))}),e}class JU{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;const t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&e.set(r,this._finished?i:jx(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class QU{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return IU(e,t)}getParentElement(e){return Ux(e)}query(e,t,i){return RU(e,t,i)}computeStyle(e,t,i){return jx(e,t)}animate(e,t,i,r,s,o=[]){const c={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(c.easing=s);const l=new Map,u=o.filter(f=>f instanceof JU);(function xae(n,e){return 0===n||0===e})(i,r)&&u.forEach(f=>{f.currentSnapshot.forEach((p,_)=>l.set(_,p))});let d=function Sae(n){return n.length?n[0]instanceof Map?n:n.map(e=>new Map(Object.entries(e))):[]}(t).map(f=>new Map(f));d=function Tae(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,o)=>{i.has(o)||r.push(o),i.set(o,s)}),r.length)for(let s=1;s<e.length;s++){let o=e[s];r.forEach(a=>o.set(a,jx(n,a)))}}return e}(e,d,l);const h=function pce(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=sT(e[0]),e.length>1&&(i=sT(e[e.length-1]))):e instanceof Map&&(t=sT(e)),t||i?new mce(n,t,i):null}(e,d);return new JU(e,d,c,h)}}const eB="@.disabled";class tB{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(e,t,i,r){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=r}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){"@"==t.charAt(0)&&t==eB?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i,r){return this.delegate.listen(e,t,i,r)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class _ce extends tB{factory;constructor(e,t,i,r,s){super(t,i,r,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){"@"==t.charAt(0)?"."==t.charAt(1)&&t==eB?this.disableAnimations(e,i=void 0===i||!!i):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i,r){if("@"==t.charAt(0)){const s=function yce(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let o=t.slice(1),a="";return"@"!=o.charAt(0)&&([o,a]=function vce(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(o)),this.engine.listen(this.namespaceId,s,o,a,c=>{this.factory.scheduleListenerCallback(c._data||-1,i,c)})}return this.delegate.listen(e,t,i,r)}}class Ece{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(e,t,i){this.delegate=e,this.engine=t,this._zone=i,t.onRemovalComplete=(r,s)=>{s?.removeChild(null,r)}}createRenderer(e,t){const r=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){const l=this._rendererCache;let u=l.get(r);return u||(u=new tB("",r,this.engine,()=>l.delete(r)),l.set(r,u)),u}const s=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);const a=l=>{Array.isArray(l)?l.forEach(a):this.engine.registerTrigger(s,o,e,l.name,l)};return t.data.animation.forEach(a),new _ce(this,o,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,i){if(e>=0&&e<this._microtaskId)return void this._zone.run(()=>t(i));const r=this._animationCallbacksBuffer;0==r.length&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(s=>{const[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),r.push([t,i])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(e){this.engine.flush(),this.delegate.componentReplaced?.(e)}}const nB=[{provide:qx,useFactory:function Sce(){return new FU}},{provide:sp,useClass:(()=>{class n extends sp{constructor(t,i,r){super(t,i,r)}ngOnDestroy(){this.flush()}static \u0275fac=function(i){return new(i||n)(ct(Wr),ct(Wx),ct(qx))};static \u0275prov=Oe({token:n,factory:n.\u0275fac})}return n})()},{provide:km,useFactory:function Mce(n,e,t){return new Ece(n,e,t)},deps:[MS,sp,fn]}],iB=[{provide:Wx,useClass:$x},{provide:ED,useValue:"NoopAnimations"},...nB],oT=[{provide:Wx,useFactory:()=>new QU},{provide:ED,useFactory:()=>"BrowserAnimations"},...nB];let wce=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?iB:oT}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=pu({type:n});static \u0275inj=Ws({providers:oT,imports:[VO]})}return n})();(function l7(n,e){return dq({rootComponent:n,...kO(e)})})(fie,{providers:[function eoe(n,...e){return Rp([{provide:Mx,multi:!0,useValue:n},[],{provide:Cd,useFactory:eU,deps:[Rd]},{provide:i1,multi:!0,useFactory:tU},e.map(t=>t.\u0275providers)])}([]),MT(VO,Ooe,wce)]}).catch(n=>console.error("Error starting app:",n))},935:()=>{const Sr=globalThis;function nr(z){return(Sr.__Zone_symbol_prefix||"__zone_symbol__")+z}const uo=Object.getOwnPropertyDescriptor,ec=Object.defineProperty,as=Object.getPrototypeOf,cT=Object.create,hv=Array.prototype.slice,up="addEventListener",tc="removeEventListener",nc=nr(up),vi=nr(tc),ir="true",Hr="false",ho=nr("");function oi(z,H){return Zone.current.wrap(z,H)}function _t(z,H,ne,U,ee){return Zone.current.scheduleMacroTask(z,H,ne,U,ee)}const cn=nr,Od=typeof window<"u",xl=Od?window:void 0,Un=Od&&xl||globalThis;function Ld(z,H){for(let ne=z.length-1;ne>=0;ne--)"function"==typeof z[ne]&&(z[ne]=oi(z[ne],H+"_"+ne));return z}function Fd(z){return!z||!1!==z.writable&&!("function"==typeof z.get&&typeof z.set>"u")}const kd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Tl=!("nw"in Un)&&typeof Un.process<"u"&&"[object process]"===Un.process.toString(),sa=!Tl&&!kd&&!(!Od||!xl.HTMLElement),fo=typeof Un.process<"u"&&"[object process]"===Un.process.toString()&&!kd&&!(!Od||!xl.HTMLElement),zs={},Cl=cn("enable_beforeunload"),oa=function(z){if(!(z=z||Un.event))return;let H=zs[z.type];H||(H=zs[z.type]=cn("ON_PROPERTY"+z.type));const ne=this||z.target||Un,U=ne[H];let ee;return sa&&ne===xl&&"error"===z.type?(ee=U&&U.call(this,z.message,z.filename,z.lineno,z.colno,z.error),!0===ee&&z.preventDefault()):(ee=U&&U.apply(this,arguments),"beforeunload"===z.type&&Un[Cl]&&"string"==typeof ee?z.returnValue=ee:null!=ee&&!ee&&z.preventDefault()),ee};function Ud(z,H,ne){let U=uo(z,H);if(!U&&ne&&uo(ne,H)&&(U={enumerable:!0,configurable:!0}),!U||!U.configurable)return;const ee=cn("on"+H+"patched");if(z.hasOwnProperty(ee)&&z[ee])return;delete U.writable,delete U.value;const Se=U.get,Qe=U.set,We=H.slice(2);let rt=zs[We];rt||(rt=zs[We]=cn("ON_PROPERTY"+We)),U.set=function(yt){let He=this;!He&&z===Un&&(He=Un),He&&("function"==typeof He[rt]&&He.removeEventListener(We,oa),Qe?.call(He,null),He[rt]=yt,"function"==typeof yt&&He.addEventListener(We,oa,!1))},U.get=function(){let yt=this;if(!yt&&z===Un&&(yt=Un),!yt)return null;const He=yt[rt];if(He)return He;if(Se){let xt=Se.call(this);if(xt)return U.set.call(this,xt),"function"==typeof yt.removeAttribute&&yt.removeAttribute(H),xt}return null},ec(z,H,U),z[ee]=!0}function Dl(z,H,ne){if(H)for(let U=0;U<H.length;U++)Ud(z,"on"+H[U],ne);else{const U=[];for(const ee in z)"on"==ee.slice(0,2)&&U.push(ee);for(let ee=0;ee<U.length;ee++)Ud(z,U[ee],ne)}}const Ri=cn("originalInstance");function po(z){const H=Un[z];if(!H)return;Un[cn(z)]=H,Un[z]=function(){const ee=Ld(arguments,z);switch(ee.length){case 0:this[Ri]=new H;break;case 1:this[Ri]=new H(ee[0]);break;case 2:this[Ri]=new H(ee[0],ee[1]);break;case 3:this[Ri]=new H(ee[0],ee[1],ee[2]);break;case 4:this[Ri]=new H(ee[0],ee[1],ee[2],ee[3]);break;default:throw new Error("Arg list too long.")}},Ss(Un[z],H);const ne=new H(function(){});let U;for(U in ne)"XMLHttpRequest"===z&&"responseBlob"===U||function(ee){"function"==typeof ne[ee]?Un[z].prototype[ee]=function(){return this[Ri][ee].apply(this[Ri],arguments)}:ec(Un[z].prototype,ee,{set:function(Se){"function"==typeof Se?(this[Ri][ee]=oi(Se,z+"."+ee),Ss(this[Ri][ee],Se)):this[Ri][ee]=Se},get:function(){return this[Ri][ee]}})}(U);for(U in H)"prototype"!==U&&H.hasOwnProperty(U)&&(Un[z][U]=H[U])}function Hs(z,H,ne){let U=z;for(;U&&!U.hasOwnProperty(H);)U=as(U);!U&&z[H]&&(U=z);const ee=cn(H);let Se=null;if(U&&(!(Se=U[ee])||!U.hasOwnProperty(ee))&&(Se=U[ee]=U[H],Fd(U&&uo(U,H)))){const We=ne(Se,ee,H);U[H]=function(){return We(this,arguments)},Ss(U[H],Se)}return Se}function fv(z,H,ne){let U=null;function ee(Se){const Qe=Se.data;return Qe.args[Qe.cbIdx]=function(){Se.invoke.apply(this,arguments)},U.apply(Qe.target,Qe.args),Se}U=Hs(z,H,Se=>function(Qe,We){const rt=ne(Qe,We);return rt.cbIdx>=0&&"function"==typeof We[rt.cbIdx]?_t(rt.name,We[rt.cbIdx],rt,ee):Se.apply(Qe,We)})}function Ss(z,H){z[cn("OriginalDelegate")]=H}let Gs=!1,js=!1;function $s(){if(Gs)return js;Gs=!0;try{const z=xl.navigator.userAgent;(-1!==z.indexOf("MSIE ")||-1!==z.indexOf("Trident/")||-1!==z.indexOf("Edge/"))&&(js=!0)}catch{}return js}function dp(z){return"function"==typeof z}function hp(z){return"number"==typeof z}const fp={useG:!0},rr={},pp={},sc=new RegExp("^"+ho+"(\\w+)(true|false)$"),mp=cn("propagationStopped");function pv(z,H){const ne=(H?H(z):z)+Hr,U=(H?H(z):z)+ir,ee=ho+ne,Se=ho+U;rr[z]={},rr[z][Hr]=ee,rr[z][ir]=Se}function mv(z,H,ne,U){const ee=U&&U.add||up,Se=U&&U.rm||tc,Qe=U&&U.listeners||"eventListeners",We=U&&U.rmAll||"removeAllListeners",rt=cn(ee),yt="."+ee+":",He="prependListener",xt="."+He+":",Ut=function(Te,Ne,pn){if(Te.isRemoved)return;const yn=Te.callback;let ti;"object"==typeof yn&&yn.handleEvent&&(Te.callback=et=>yn.handleEvent(et),Te.originalDelegate=yn);try{Te.invoke(Te,Ne,[pn])}catch(et){ti=et}const lt=Te.options;return lt&&"object"==typeof lt&&lt.once&&Ne[Se].call(Ne,pn.type,Te.originalDelegate?Te.originalDelegate:Te.callback,lt),ti};function _n(Te,Ne,pn){if(!(Ne=Ne||z.event))return;const yn=Te||Ne.target||z,ti=yn[rr[Ne.type][pn?ir:Hr]];if(ti){const lt=[];if(1===ti.length){const et=Ut(ti[0],yn,Ne);et&&lt.push(et)}else{const et=ti.slice();for(let Ht=0;Ht<et.length&&(!Ne||!0!==Ne[mp]);Ht++){const Gt=Ut(et[Ht],yn,Ne);Gt&&lt.push(Gt)}}if(1===lt.length)throw lt[0];for(let et=0;et<lt.length;et++){const Ht=lt[et];H.nativeScheduleMicroTask(()=>{throw Ht})}}}const xn=function(Te){return _n(this,Te,!1)},Jn=function(Te){return _n(this,Te,!0)};function Pi(Te,Ne){if(!Te)return!1;let pn=!0;Ne&&void 0!==Ne.useG&&(pn=Ne.useG);const yn=Ne&&Ne.vh;let ti=!0;Ne&&void 0!==Ne.chkDup&&(ti=Ne.chkDup);let lt=!1;Ne&&void 0!==Ne.rt&&(lt=Ne.rt);let et=Te;for(;et&&!et.hasOwnProperty(ee);)et=as(et);if(!et&&Te[ee]&&(et=Te),!et||et[rt])return!1;const Ht=Ne&&Ne.eventNameToString,Gt={},bt=et[rt]=et[ee],O=et[cn(Se)]=et[Se],Lt=et[cn(Qe)]=et[Qe],On=et[cn(We)]=et[We];let Rt;Ne&&Ne.prepend&&(Rt=et[cn(Ne.prepend)]=et[Ne.prepend]);const ni=pn?function(Z){if(!Gt.isExisting)return bt.call(Gt.target,Gt.eventName,Gt.capture?Jn:xn,Gt.options)}:function(Z){return bt.call(Gt.target,Gt.eventName,Z.invoke,Gt.options)},rn=pn?function(Z){if(!Z.isRemoved){const pe=rr[Z.eventName];let dt;pe&&(dt=pe[Z.capture?ir:Hr]);const Dt=dt&&Z.target[dt];if(Dt)for(let st=0;st<Dt.length;st++)if(Dt[st]===Z){Dt.splice(st,1),Z.isRemoved=!0,Z.removeAbortListener&&(Z.removeAbortListener(),Z.removeAbortListener=null),0===Dt.length&&(Z.allRemoved=!0,Z.target[dt]=null);break}}if(Z.allRemoved)return O.call(Z.target,Z.eventName,Z.capture?Jn:xn,Z.options)}:function(Z){return O.call(Z.target,Z.eventName,Z.invoke,Z.options)},ut=Ne?.diff||function(Z,pe){const dt=typeof pe;return"function"===dt&&Z.callback===pe||"object"===dt&&Z.originalDelegate===pe},Mr=Zone[cn("UNPATCHED_EVENTS")],Gn=z[cn("PASSIVE_EVENTS")],ye=function(Z,pe,dt,Dt,st=!1,Bt=!1){return function(){const $t=this||z;let Zt=arguments[0];Ne&&Ne.transferEventName&&(Zt=Ne.transferEventName(Zt));let Tn=arguments[1];if(!Tn)return Z.apply(this,arguments);if(Tl&&"uncaughtException"===Zt)return Z.apply(this,arguments);let Ln=!1;if("function"!=typeof Tn){if(!Tn.handleEvent)return Z.apply(this,arguments);Ln=!0}if(yn&&!yn(Z,Tn,$t,arguments))return;const jn=!!Gn&&-1!==Gn.indexOf(Zt),Ue=function we(Z){if("object"==typeof Z&&null!==Z){const pe={...Z};return Z.signal&&(pe.signal=Z.signal),pe}return Z}(function jt(Z,pe){return pe?"boolean"==typeof Z?{capture:Z,passive:!0}:Z?"object"==typeof Z&&!1!==Z.passive?{...Z,passive:!0}:Z:{passive:!0}:Z}(arguments[2],jn)),cc=Ue?.signal;if(cc?.aborted)return;if(Mr)for(let sr=0;sr<Mr.length;sr++)if(Zt===Mr[sr])return jn?Z.call($t,Zt,Tn,Ue):Z.apply(this,arguments);const bp=!!Ue&&("boolean"==typeof Ue||Ue.capture),Sp=!(!Ue||"object"!=typeof Ue)&&Ue.once,uT=Zone.current;let Mp=rr[Zt];Mp||(pv(Zt,Ht),Mp=rr[Zt]);const Oe=Mp[bp?ir:Hr];let go,lc=$t[Oe],Ws=!1;if(lc){if(Ws=!0,ti)for(let sr=0;sr<lc.length;sr++)if(ut(lc[sr],Tn))return}else lc=$t[Oe]=[];const wp=$t.constructor.name,xp=pp[wp];xp&&(go=xp[Zt]),go||(go=wp+pe+(Ht?Ht(Zt):Zt)),Gt.options=Ue,Sp&&(Gt.options.once=!1),Gt.target=$t,Gt.capture=bp,Gt.eventName=Zt,Gt.isExisting=Ws;const uc=pn?fp:void 0;uc&&(uc.taskData=Gt),cc&&(Gt.options.signal=void 0);const ji=uT.scheduleEventTask(go,Tn,uc,dt,Dt);if(cc){Gt.options.signal=cc;const sr=()=>ji.zone.cancelTask(ji);Z.call(cc,"abort",sr,{once:!0}),ji.removeAbortListener=()=>cc.removeEventListener("abort",sr)}return Gt.target=null,uc&&(uc.taskData=null),Sp&&(Gt.options.once=!0),"boolean"!=typeof ji.options&&(ji.options=Ue),ji.target=$t,ji.capture=bp,ji.eventName=Zt,Ln&&(ji.originalDelegate=Tn),Bt?lc.unshift(ji):lc.push(ji),st?$t:void 0}};return et[ee]=ye(bt,yt,ni,rn,lt),Rt&&(et[He]=ye(Rt,xt,function(Z){return Rt.call(Gt.target,Gt.eventName,Z.invoke,Gt.options)},rn,lt,!0)),et[Se]=function(){const Z=this||z;let pe=arguments[0];Ne&&Ne.transferEventName&&(pe=Ne.transferEventName(pe));const dt=arguments[2],Dt=!!dt&&("boolean"==typeof dt||dt.capture),st=arguments[1];if(!st)return O.apply(this,arguments);if(yn&&!yn(O,st,Z,arguments))return;const Bt=rr[pe];let $t;Bt&&($t=Bt[Dt?ir:Hr]);const Zt=$t&&Z[$t];if(Zt)for(let Tn=0;Tn<Zt.length;Tn++){const Ln=Zt[Tn];if(ut(Ln,st))return Zt.splice(Tn,1),Ln.isRemoved=!0,0!==Zt.length||(Ln.allRemoved=!0,Z[$t]=null,Dt||"string"!=typeof pe)||(Z[ho+"ON_PROPERTY"+pe]=null),Ln.zone.cancelTask(Ln),lt?Z:void 0}return O.apply(this,arguments)},et[Qe]=function(){const Z=this||z;let pe=arguments[0];Ne&&Ne.transferEventName&&(pe=Ne.transferEventName(pe));const dt=[],Dt=oc(Z,Ht?Ht(pe):pe);for(let st=0;st<Dt.length;st++){const Bt=Dt[st];dt.push(Bt.originalDelegate?Bt.originalDelegate:Bt.callback)}return dt},et[We]=function(){const Z=this||z;let pe=arguments[0];if(pe){Ne&&Ne.transferEventName&&(pe=Ne.transferEventName(pe));const dt=rr[pe];if(dt){const Bt=Z[dt[Hr]],$t=Z[dt[ir]];if(Bt){const Zt=Bt.slice();for(let Tn=0;Tn<Zt.length;Tn++){const Ln=Zt[Tn];this[Se].call(this,pe,Ln.originalDelegate?Ln.originalDelegate:Ln.callback,Ln.options)}}if($t){const Zt=$t.slice();for(let Tn=0;Tn<Zt.length;Tn++){const Ln=Zt[Tn];this[Se].call(this,pe,Ln.originalDelegate?Ln.originalDelegate:Ln.callback,Ln.options)}}}}else{const dt=Object.keys(Z);for(let Dt=0;Dt<dt.length;Dt++){const Bt=sc.exec(dt[Dt]);let $t=Bt&&Bt[1];$t&&"removeListener"!==$t&&this[We].call(this,$t)}this[We].call(this,"removeListener")}if(lt)return this},Ss(et[ee],bt),Ss(et[Se],O),On&&Ss(et[We],On),Lt&&Ss(et[Qe],Lt),!0}let Qn=[];for(let Te=0;Te<ne.length;Te++)Qn[Te]=Pi(ne[Te],U);return Qn}function oc(z,H){if(!H){const Se=[];for(let Qe in z){const We=sc.exec(Qe);let rt=We&&We[1];if(rt&&(!H||rt===H)){const yt=z[Qe];if(yt)for(let He=0;He<yt.length;He++)Se.push(yt[He])}}return Se}let ne=rr[H];ne||(pv(H),ne=rr[H]);const U=z[ne[Hr]],ee=z[ne[ir]];return U?ee?U.concat(ee):U.slice():ee?ee.slice():[]}function gp(z,H){const ne=z.Event;ne&&ne.prototype&&H.patchMethod(ne.prototype,"stopImmediatePropagation",U=>function(ee,Se){ee[mp]=!0,U&&U.apply(ee,Se)})}const aa=cn("zoneTask");function ca(z,H,ne,U){let ee=null,Se=null;ne+=U;const Qe={};function We(yt){const He=yt.data;He.args[0]=function(){return yt.invoke.apply(this,arguments)};const xt=ee.apply(z,He.args);return hp(xt)?He.handleId=xt:(He.handle=xt,He.isRefreshable=dp(xt.refresh)),yt}function rt(yt){const{handle:He,handleId:xt}=yt.data;return Se.call(z,He??xt)}ee=Hs(z,H+=U,yt=>function(He,xt){if(dp(xt[0])){const Ut={isRefreshable:!1,isPeriodic:"Interval"===U,delay:"Timeout"===U||"Interval"===U?xt[1]||0:void 0,args:xt},_n=xt[0];xt[0]=function(){try{return _n.apply(this,arguments)}finally{const{handle:pn,handleId:yn,isPeriodic:ti,isRefreshable:lt}=Ut;!ti&&!lt&&(yn?delete Qe[yn]:pn&&(pn[aa]=null))}};const xn=_t(H,xt[0],Ut,We,rt);if(!xn)return xn;const{handleId:Jn,handle:Pi,isRefreshable:Qn,isPeriodic:Te}=xn.data;if(Jn)Qe[Jn]=xn;else if(Pi&&(Pi[aa]=xn,Qn&&!Te)){const Ne=Pi.refresh;Pi.refresh=function(){const{zone:pn,state:yn}=xn;return"notScheduled"===yn?(xn._state="scheduled",pn._updateTaskCount(xn,1)):"running"===yn&&(xn._state="scheduling"),Ne.call(this)}}return Pi??Jn??xn}return yt.apply(z,xt)}),Se=Hs(z,ne,yt=>function(He,xt){const Ut=xt[0];let _n;hp(Ut)?(_n=Qe[Ut],delete Qe[Ut]):(_n=Ut?.[aa],_n?Ut[aa]=null:_n=Ut),_n?.type?_n.cancelFn&&_n.zone.cancelTask(_n):yt.apply(z,xt)})}function ac(z,H,ne){if(!ne||0===ne.length)return H;const U=ne.filter(Se=>Se.target===z);if(0===U.length)return H;const ee=U[0].ignoreProperties;return H.filter(Se=>-1===ee.indexOf(Se))}function Ti(z,H,ne,U){z&&Dl(z,ac(z,H,ne),U)}function Al(z){return Object.getOwnPropertyNames(z).filter(H=>H.startsWith("on")&&H.length>2).map(H=>H.substring(2))}function vp(z,H,ne,U,ee){const Se=Zone.__symbol__(U);if(H[Se])return;const Qe=H[Se]=H[U];H[U]=function(We,rt,yt){return rt&&rt.prototype&&ee.forEach(function(He){const xt=`${ne}.${U}::`+He,Ut=rt.prototype;try{if(Ut.hasOwnProperty(He)){const _n=z.ObjectGetOwnPropertyDescriptor(Ut,He);_n&&_n.value?(_n.value=z.wrapWithCurrentZone(_n.value,xt),z._redefineProperty(rt.prototype,He,_n)):Ut[He]&&(Ut[He]=z.wrapWithCurrentZone(Ut[He],xt))}else Ut[He]&&(Ut[He]=z.wrapWithCurrentZone(Ut[He],xt))}catch{}}),Qe.call(H,We,rt,yt)},z.attachOriginToPatched(H[U],Qe)}const Ep=function lp(){const z=globalThis,H=!0===z[nr("forceDuplicateZoneCheck")];if(z.Zone&&(H||"function"!=typeof z.Zone.__symbol__))throw new Error("Zone already loaded.");return z.Zone??=function cp(){const z=Sr.performance;function H(jt){z&&z.mark&&z.mark(jt)}function ne(jt,Ze){z&&z.measure&&z.measure(jt,Ze)}H("Zone");let U=(()=>{class jt{static __symbol__=nr;static assertZonePatched(){if(Sr.Promise!==Gt.ZoneAwarePromise)throw new Error("Zone.js has detected that ZoneAwarePromise `(window|global).Promise` has been overwritten.\nMost likely cause is that a Promise polyfill has been loaded after Zone.js (Polyfilling Promise api is not necessary when zone.js is loaded. If you must load one, do so before loading zone.js.)")}static get root(){let N=jt.current;for(;N.parent;)N=N.parent;return N}static get current(){return O.zone}static get currentTask(){return Lt}static __load_patch(N,G,ke=!1){if(Gt.hasOwnProperty(N)){const vt=!0===Sr[nr("forceDuplicateZoneCheck")];if(!ke&&vt)throw Error("Already loaded patch: "+N)}else if(!Sr["__Zone_disable_"+N]){const vt="Zone:"+N;H(vt),Gt[N]=G(Sr,jt,bt),ne(vt,vt)}}get parent(){return this._parent}get name(){return this._name}_parent;_name;_properties;_zoneDelegate;constructor(N,G){this._parent=N,this._name=G?G.name||"unnamed":"<root>",this._properties=G&&G.properties||{},this._zoneDelegate=new Se(this,this._parent&&this._parent._zoneDelegate,G)}get(N){const G=this.getZoneWith(N);if(G)return G._properties[N]}getZoneWith(N){let G=this;for(;G;){if(G._properties.hasOwnProperty(N))return G;G=G._parent}return null}fork(N){if(!N)throw new Error("ZoneSpec required!");return this._zoneDelegate.fork(this,N)}wrap(N,G){if("function"!=typeof N)throw new Error("Expecting function got: "+N);const ke=this._zoneDelegate.intercept(this,N,G),vt=this;return function(){return vt.runGuarded(ke,this,arguments,G)}}run(N,G,ke,vt){O={parent:O,zone:this};try{return this._zoneDelegate.invoke(this,N,G,ke,vt)}finally{O=O.parent}}runGuarded(N,G=null,ke,vt){O={parent:O,zone:this};try{try{return this._zoneDelegate.invoke(this,N,G,ke,vt)}catch(ni){if(this._zoneDelegate.handleError(this,ni))throw ni}}finally{O=O.parent}}runTask(N,G,ke){if(N.zone!=this)throw new Error("A task can only be run in the zone of creation! (Creation: "+(N.zone||Pi).name+"; Execution: "+this.name+")");const vt=N,{type:ni,data:{isPeriodic:rn=!1,isRefreshable:cs=!1}={}}=N;if(N.state===Qn&&(ni===Ht||ni===et))return;const ut=N.state!=pn;ut&&vt._transitionTo(pn,Ne);const Mr=Lt;Lt=vt,O={parent:O,zone:this};try{ni==et&&N.data&&!rn&&!cs&&(N.cancelFn=void 0);try{return this._zoneDelegate.invokeTask(this,vt,G,ke)}catch(Gn){if(this._zoneDelegate.handleError(this,Gn))throw Gn}}finally{const Gn=N.state;if(Gn!==Qn&&Gn!==ti)if(ni==Ht||rn||cs&&Gn===Te)ut&&vt._transitionTo(Ne,pn,Te);else{const we=vt._zoneDelegates;this._updateTaskCount(vt,-1),ut&&vt._transitionTo(Qn,pn,Qn),cs&&(vt._zoneDelegates=we)}O=O.parent,Lt=Mr}}scheduleTask(N){if(N.zone&&N.zone!==this){let ke=this;for(;ke;){if(ke===N.zone)throw Error(`can not reschedule task to ${this.name} which is descendants of the original zone ${N.zone.name}`);ke=ke.parent}}N._transitionTo(Te,Qn);const G=[];N._zoneDelegates=G,N._zone=this;try{N=this._zoneDelegate.scheduleTask(this,N)}catch(ke){throw N._transitionTo(ti,Te,Qn),this._zoneDelegate.handleError(this,ke),ke}return N._zoneDelegates===G&&this._updateTaskCount(N,1),N.state==Te&&N._transitionTo(Ne,Te),N}scheduleMicroTask(N,G,ke,vt){return this.scheduleTask(new Qe(lt,N,G,ke,vt,void 0))}scheduleMacroTask(N,G,ke,vt,ni){return this.scheduleTask(new Qe(et,N,G,ke,vt,ni))}scheduleEventTask(N,G,ke,vt,ni){return this.scheduleTask(new Qe(Ht,N,G,ke,vt,ni))}cancelTask(N){if(N.zone!=this)throw new Error("A task can only be cancelled in the zone of creation! (Creation: "+(N.zone||Pi).name+"; Execution: "+this.name+")");if(N.state===Ne||N.state===pn){N._transitionTo(yn,Ne,pn);try{this._zoneDelegate.cancelTask(this,N)}catch(G){throw N._transitionTo(ti,yn),this._zoneDelegate.handleError(this,G),G}return this._updateTaskCount(N,-1),N._transitionTo(Qn,yn),N.runCount=-1,N}}_updateTaskCount(N,G){const ke=N._zoneDelegates;-1==G&&(N._zoneDelegates=null);for(let vt=0;vt<ke.length;vt++)ke[vt]._updateTaskCount(N.type,G)}}return jt})();const ee={name:"",onHasTask:(jt,Ze,N,G)=>jt.hasTask(N,G),onScheduleTask:(jt,Ze,N,G)=>jt.scheduleTask(N,G),onInvokeTask:(jt,Ze,N,G,ke,vt)=>jt.invokeTask(N,G,ke,vt),onCancelTask:(jt,Ze,N,G)=>jt.cancelTask(N,G)};class Se{get zone(){return this._zone}_zone;_taskCounts={microTask:0,macroTask:0,eventTask:0};_parentDelegate;_forkDlgt;_forkZS;_forkCurrZone;_interceptDlgt;_interceptZS;_interceptCurrZone;_invokeDlgt;_invokeZS;_invokeCurrZone;_handleErrorDlgt;_handleErrorZS;_handleErrorCurrZone;_scheduleTaskDlgt;_scheduleTaskZS;_scheduleTaskCurrZone;_invokeTaskDlgt;_invokeTaskZS;_invokeTaskCurrZone;_cancelTaskDlgt;_cancelTaskZS;_cancelTaskCurrZone;_hasTaskDlgt;_hasTaskDlgtOwner;_hasTaskZS;_hasTaskCurrZone;constructor(Ze,N,G){this._zone=Ze,this._parentDelegate=N,this._forkZS=G&&(G&&G.onFork?G:N._forkZS),this._forkDlgt=G&&(G.onFork?N:N._forkDlgt),this._forkCurrZone=G&&(G.onFork?this._zone:N._forkCurrZone),this._interceptZS=G&&(G.onIntercept?G:N._interceptZS),this._interceptDlgt=G&&(G.onIntercept?N:N._interceptDlgt),this._interceptCurrZone=G&&(G.onIntercept?this._zone:N._interceptCurrZone),this._invokeZS=G&&(G.onInvoke?G:N._invokeZS),this._invokeDlgt=G&&(G.onInvoke?N:N._invokeDlgt),this._invokeCurrZone=G&&(G.onInvoke?this._zone:N._invokeCurrZone),this._handleErrorZS=G&&(G.onHandleError?G:N._handleErrorZS),this._handleErrorDlgt=G&&(G.onHandleError?N:N._handleErrorDlgt),this._handleErrorCurrZone=G&&(G.onHandleError?this._zone:N._handleErrorCurrZone),this._scheduleTaskZS=G&&(G.onScheduleTask?G:N._scheduleTaskZS),this._scheduleTaskDlgt=G&&(G.onScheduleTask?N:N._scheduleTaskDlgt),this._scheduleTaskCurrZone=G&&(G.onScheduleTask?this._zone:N._scheduleTaskCurrZone),this._invokeTaskZS=G&&(G.onInvokeTask?G:N._invokeTaskZS),this._invokeTaskDlgt=G&&(G.onInvokeTask?N:N._invokeTaskDlgt),this._invokeTaskCurrZone=G&&(G.onInvokeTask?this._zone:N._invokeTaskCurrZone),this._cancelTaskZS=G&&(G.onCancelTask?G:N._cancelTaskZS),this._cancelTaskDlgt=G&&(G.onCancelTask?N:N._cancelTaskDlgt),this._cancelTaskCurrZone=G&&(G.onCancelTask?this._zone:N._cancelTaskCurrZone),this._hasTaskZS=null,this._hasTaskDlgt=null,this._hasTaskDlgtOwner=null,this._hasTaskCurrZone=null;const ke=G&&G.onHasTask;(ke||N&&N._hasTaskZS)&&(this._hasTaskZS=ke?G:ee,this._hasTaskDlgt=N,this._hasTaskDlgtOwner=this,this._hasTaskCurrZone=this._zone,G.onScheduleTask||(this._scheduleTaskZS=ee,this._scheduleTaskDlgt=N,this._scheduleTaskCurrZone=this._zone),G.onInvokeTask||(this._invokeTaskZS=ee,this._invokeTaskDlgt=N,this._invokeTaskCurrZone=this._zone),G.onCancelTask||(this._cancelTaskZS=ee,this._cancelTaskDlgt=N,this._cancelTaskCurrZone=this._zone))}fork(Ze,N){return this._forkZS?this._forkZS.onFork(this._forkDlgt,this.zone,Ze,N):new U(Ze,N)}intercept(Ze,N,G){return this._interceptZS?this._interceptZS.onIntercept(this._interceptDlgt,this._interceptCurrZone,Ze,N,G):N}invoke(Ze,N,G,ke,vt){return this._invokeZS?this._invokeZS.onInvoke(this._invokeDlgt,this._invokeCurrZone,Ze,N,G,ke,vt):N.apply(G,ke)}handleError(Ze,N){return!this._handleErrorZS||this._handleErrorZS.onHandleError(this._handleErrorDlgt,this._handleErrorCurrZone,Ze,N)}scheduleTask(Ze,N){let G=N;if(this._scheduleTaskZS)this._hasTaskZS&&G._zoneDelegates.push(this._hasTaskDlgtOwner),G=this._scheduleTaskZS.onScheduleTask(this._scheduleTaskDlgt,this._scheduleTaskCurrZone,Ze,N),G||(G=N);else if(N.scheduleFn)N.scheduleFn(N);else{if(N.type!=lt)throw new Error("Task is missing scheduleFn.");xn(N)}return G}invokeTask(Ze,N,G,ke){return this._invokeTaskZS?this._invokeTaskZS.onInvokeTask(this._invokeTaskDlgt,this._invokeTaskCurrZone,Ze,N,G,ke):N.callback.apply(G,ke)}cancelTask(Ze,N){let G;if(this._cancelTaskZS)G=this._cancelTaskZS.onCancelTask(this._cancelTaskDlgt,this._cancelTaskCurrZone,Ze,N);else{if(!N.cancelFn)throw Error("Task is not cancelable");G=N.cancelFn(N)}return G}hasTask(Ze,N){try{this._hasTaskZS&&this._hasTaskZS.onHasTask(this._hasTaskDlgt,this._hasTaskCurrZone,Ze,N)}catch(G){this.handleError(Ze,G)}}_updateTaskCount(Ze,N){const G=this._taskCounts,ke=G[Ze],vt=G[Ze]=ke+N;if(vt<0)throw new Error("More tasks executed then were scheduled.");0!=ke&&0!=vt||this.hasTask(this._zone,{microTask:G.microTask>0,macroTask:G.macroTask>0,eventTask:G.eventTask>0,change:Ze})}}class Qe{type;source;invoke;callback;data;scheduleFn;cancelFn;_zone=null;runCount=0;_zoneDelegates=null;_state="notScheduled";constructor(Ze,N,G,ke,vt,ni){if(this.type=Ze,this.source=N,this.data=ke,this.scheduleFn=vt,this.cancelFn=ni,!G)throw new Error("callback is not defined");this.callback=G;const rn=this;this.invoke=Ze===Ht&&ke&&ke.useG?Qe.invokeTask:function(){return Qe.invokeTask.call(Sr,rn,this,arguments)}}static invokeTask(Ze,N,G){Ze||(Ze=this),On++;try{return Ze.runCount++,Ze.zone.runTask(Ze,N,G)}finally{1==On&&Jn(),On--}}get zone(){return this._zone}get state(){return this._state}cancelScheduleRequest(){this._transitionTo(Qn,Te)}_transitionTo(Ze,N,G){if(this._state!==N&&this._state!==G)throw new Error(`${this.type} '${this.source}': can not transition to '${Ze}', expecting state '${N}'${G?" or '"+G+"'":""}, was '${this._state}'.`);this._state=Ze,Ze==Qn&&(this._zoneDelegates=null)}toString(){return this.data&&typeof this.data.handleId<"u"?this.data.handleId.toString():Object.prototype.toString.call(this)}toJSON(){return{type:this.type,state:this.state,source:this.source,zone:this.zone.name,runCount:this.runCount}}}const We=nr("setTimeout"),rt=nr("Promise"),yt=nr("then");let Ut,He=[],xt=!1;function _n(jt){if(Ut||Sr[rt]&&(Ut=Sr[rt].resolve(0)),Ut){let Ze=Ut[yt];Ze||(Ze=Ut.then),Ze.call(Ut,jt)}else Sr[We](jt,0)}function xn(jt){0===On&&0===He.length&&_n(Jn),jt&&He.push(jt)}function Jn(){if(!xt){for(xt=!0;He.length;){const jt=He;He=[];for(let Ze=0;Ze<jt.length;Ze++){const N=jt[Ze];try{N.zone.runTask(N,null,null)}catch(G){bt.onUnhandledError(G)}}}bt.microtaskDrainDone(),xt=!1}}const Pi={name:"NO ZONE"},Qn="notScheduled",Te="scheduling",Ne="scheduled",pn="running",yn="canceling",ti="unknown",lt="microTask",et="macroTask",Ht="eventTask",Gt={},bt={symbol:nr,currentZoneFrame:()=>O,onUnhandledError:Rt,microtaskDrainDone:Rt,scheduleMicroTask:xn,showUncaughtError:()=>!U[nr("ignoreConsoleErrorUncaughtError")],patchEventTarget:()=>[],patchOnProperties:Rt,patchMethod:()=>Rt,bindArguments:()=>[],patchThen:()=>Rt,patchMacroTask:()=>Rt,patchEventPrototype:()=>Rt,isIEOrEdge:()=>!1,getGlobalObjects:()=>{},ObjectDefineProperty:()=>Rt,ObjectGetOwnPropertyDescriptor:()=>{},ObjectCreate:()=>{},ArraySlice:()=>[],patchClass:()=>Rt,wrapWithCurrentZone:()=>Rt,filterProperties:()=>[],attachOriginToPatched:()=>Rt,_redefineProperty:()=>Rt,patchCallbacks:()=>Rt,nativeScheduleMicroTask:_n};let O={parent:null,zone:new U(null,null)},Lt=null,On=0;function Rt(){}return ne("Zone","Zone"),U}(),z.Zone}();(function gv(z){(function mo(z){z.__load_patch("ZoneAwarePromise",(H,ne,U)=>{const ee=Object.getOwnPropertyDescriptor,Se=Object.defineProperty,We=U.symbol,rt=[],yt=!1!==H[We("DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION")],He=We("Promise"),xt=We("then");U.onUnhandledError=we=>{if(U.showUncaughtError()){const ye=we&&we.rejection;ye?console.error("Unhandled Promise rejection:",ye instanceof Error?ye.message:ye,"; Zone:",we.zone.name,"; Task:",we.task&&we.task.source,"; Value:",ye,ye instanceof Error?ye.stack:void 0):console.error(we)}},U.microtaskDrainDone=()=>{for(;rt.length;){const we=rt.shift();try{we.zone.runGuarded(()=>{throw we.throwOriginal?we.rejection:we})}catch(ye){xn(ye)}}};const _n=We("unhandledPromiseRejectionHandler");function xn(we){U.onUnhandledError(we);try{const ye=ne[_n];"function"==typeof ye&&ye.call(this,we)}catch{}}function Jn(we){return we&&"function"==typeof we.then}function Pi(we){return we}function Qn(we){return rn.reject(we)}const Te=We("state"),Ne=We("value"),pn=We("finally"),yn=We("parentPromiseValue"),ti=We("parentPromiseState"),et=null,Gt=!1;function O(we,ye){return Z=>{try{jt(we,ye,Z)}catch(pe){jt(we,!1,pe)}}}const Lt=function(){let we=!1;return function(Z){return function(){we||(we=!0,Z.apply(null,arguments))}}},On="Promise resolved with itself",Rt=We("currentTaskTrace");function jt(we,ye,Z){const pe=Lt();if(we===Z)throw new TypeError(On);if(we[Te]===et){let dt=null;try{("object"==typeof Z||"function"==typeof Z)&&(dt=Z&&Z.then)}catch(Dt){return pe(()=>{jt(we,!1,Dt)})(),we}if(ye!==Gt&&Z instanceof rn&&Z.hasOwnProperty(Te)&&Z.hasOwnProperty(Ne)&&Z[Te]!==et)N(Z),jt(we,Z[Te],Z[Ne]);else if(ye!==Gt&&"function"==typeof dt)try{dt.call(Z,pe(O(we,ye)),pe(O(we,!1)))}catch(Dt){pe(()=>{jt(we,!1,Dt)})()}else{we[Te]=ye;const Dt=we[Ne];if(we[Ne]=Z,we[pn]===pn&&!0===ye&&(we[Te]=we[ti],we[Ne]=we[yn]),ye===Gt&&Z instanceof Error){const st=ne.currentTask&&ne.currentTask.data&&ne.currentTask.data.__creationTrace__;st&&Se(Z,Rt,{configurable:!0,enumerable:!1,writable:!0,value:st})}for(let st=0;st<Dt.length;)G(we,Dt[st++],Dt[st++],Dt[st++],Dt[st++]);if(0==Dt.length&&ye==Gt){we[Te]=0;let st=Z;try{throw new Error("Uncaught (in promise): "+function Qe(we){return we&&we.toString===Object.prototype.toString?(we.constructor&&we.constructor.name||"")+": "+JSON.stringify(we):we?we.toString():Object.prototype.toString.call(we)}(Z)+(Z&&Z.stack?"\n"+Z.stack:""))}catch(Bt){st=Bt}yt&&(st.throwOriginal=!0),st.rejection=Z,st.promise=we,st.zone=ne.current,st.task=ne.currentTask,rt.push(st),U.scheduleMicroTask()}}}return we}const Ze=We("rejectionHandledHandler");function N(we){if(0===we[Te]){try{const ye=ne[Ze];ye&&"function"==typeof ye&&ye.call(this,{rejection:we[Ne],promise:we})}catch{}we[Te]=Gt;for(let ye=0;ye<rt.length;ye++)we===rt[ye].promise&&rt.splice(ye,1)}}function G(we,ye,Z,pe,dt){N(we);const Dt=we[Te],st=Dt?"function"==typeof pe?pe:Pi:"function"==typeof dt?dt:Qn;ye.scheduleMicroTask("Promise.then",()=>{try{const Bt=we[Ne],$t=!!Z&&pn===Z[pn];$t&&(Z[yn]=Bt,Z[ti]=Dt);const Zt=ye.run(st,void 0,$t&&st!==Qn&&st!==Pi?[]:[Bt]);jt(Z,!0,Zt)}catch(Bt){jt(Z,!1,Bt)}},Z)}const vt=function(){},ni=H.AggregateError;class rn{static toString(){return"function ZoneAwarePromise() { [native code] }"}static resolve(ye){return ye instanceof rn?ye:jt(new this(null),!0,ye)}static reject(ye){return jt(new this(null),Gt,ye)}static withResolvers(){const ye={};return ye.promise=new rn((Z,pe)=>{ye.resolve=Z,ye.reject=pe}),ye}static any(ye){if(!ye||"function"!=typeof ye[Symbol.iterator])return Promise.reject(new ni([],"All promises were rejected"));const Z=[];let pe=0;try{for(let st of ye)pe++,Z.push(rn.resolve(st))}catch{return Promise.reject(new ni([],"All promises were rejected"))}if(0===pe)return Promise.reject(new ni([],"All promises were rejected"));let dt=!1;const Dt=[];return new rn((st,Bt)=>{for(let $t=0;$t<Z.length;$t++)Z[$t].then(Zt=>{dt||(dt=!0,st(Zt))},Zt=>{Dt.push(Zt),pe--,0===pe&&(dt=!0,Bt(new ni(Dt,"All promises were rejected")))})})}static race(ye){let Z,pe,dt=new this((Bt,$t)=>{Z=Bt,pe=$t});function Dt(Bt){Z(Bt)}function st(Bt){pe(Bt)}for(let Bt of ye)Jn(Bt)||(Bt=this.resolve(Bt)),Bt.then(Dt,st);return dt}static all(ye){return rn.allWithCallback(ye)}static allSettled(ye){return(this&&this.prototype instanceof rn?this:rn).allWithCallback(ye,{thenCallback:pe=>({status:"fulfilled",value:pe}),errorCallback:pe=>({status:"rejected",reason:pe})})}static allWithCallback(ye,Z){let pe,dt,Dt=new this((Zt,Tn)=>{pe=Zt,dt=Tn}),st=2,Bt=0;const $t=[];for(let Zt of ye){Jn(Zt)||(Zt=this.resolve(Zt));const Tn=Bt;try{Zt.then(Ln=>{$t[Tn]=Z?Z.thenCallback(Ln):Ln,st--,0===st&&pe($t)},Ln=>{Z?($t[Tn]=Z.errorCallback(Ln),st--,0===st&&pe($t)):dt(Ln)})}catch(Ln){dt(Ln)}st++,Bt++}return st-=2,0===st&&pe($t),Dt}constructor(ye){const Z=this;if(!(Z instanceof rn))throw new Error("Must be an instanceof Promise.");Z[Te]=et,Z[Ne]=[];try{const pe=Lt();ye&&ye(pe(O(Z,!0)),pe(O(Z,Gt)))}catch(pe){jt(Z,!1,pe)}}get[Symbol.toStringTag](){return"Promise"}get[Symbol.species](){return rn}then(ye,Z){let pe=this.constructor?.[Symbol.species];(!pe||"function"!=typeof pe)&&(pe=this.constructor||rn);const dt=new pe(vt),Dt=ne.current;return this[Te]==et?this[Ne].push(Dt,dt,ye,Z):G(this,Dt,dt,ye,Z),dt}catch(ye){return this.then(null,ye)}finally(ye){let Z=this.constructor?.[Symbol.species];(!Z||"function"!=typeof Z)&&(Z=rn);const pe=new Z(vt);pe[pn]=pn;const dt=ne.current;return this[Te]==et?this[Ne].push(dt,pe,ye,ye):G(this,dt,pe,ye,ye),pe}}rn.resolve=rn.resolve,rn.reject=rn.reject,rn.race=rn.race,rn.all=rn.all;const cs=H[He]=H.Promise;H.Promise=rn;const ut=We("thenPatched");function Mr(we){const ye=we.prototype,Z=ee(ye,"then");if(Z&&(!1===Z.writable||!Z.configurable))return;const pe=ye.then;ye[xt]=pe,we.prototype.then=function(dt,Dt){return new rn((Bt,$t)=>{pe.call(this,Bt,$t)}).then(dt,Dt)},we[ut]=!0}return U.patchThen=Mr,cs&&(Mr(cs),Hs(H,"fetch",we=>function Gn(we){return function(ye,Z){let pe=we.apply(ye,Z);if(pe instanceof rn)return pe;let dt=pe.constructor;return dt[ut]||Mr(dt),pe}}(we))),Promise[ne.__symbol__("uncaughtPromiseErrors")]=rt,rn})})(z),function Il(z){z.__load_patch("toString",H=>{const ne=Function.prototype.toString,U=cn("OriginalDelegate"),ee=cn("Promise"),Se=cn("Error"),Qe=function(){if("function"==typeof this){const He=this[U];if(He)return"function"==typeof He?ne.call(He):Object.prototype.toString.call(He);if(this===Promise){const xt=H[ee];if(xt)return ne.call(xt)}if(this===Error){const xt=H[Se];if(xt)return ne.call(xt)}}return ne.call(this)};Qe[U]=ne,Function.prototype.toString=Qe;const We=Object.prototype.toString;Object.prototype.toString=function(){return"function"==typeof Promise&&this instanceof Promise?"[object Promise]":We.call(this)}})}(z),function zd(z){z.__load_patch("util",(H,ne,U)=>{const ee=Al(H);U.patchOnProperties=Dl,U.patchMethod=Hs,U.bindArguments=Ld,U.patchMacroTask=fv;const Se=ne.__symbol__("BLACK_LISTED_EVENTS"),Qe=ne.__symbol__("UNPATCHED_EVENTS");H[Qe]&&(H[Se]=H[Qe]),H[Se]&&(ne[Se]=ne[Qe]=H[Se]),U.patchEventPrototype=gp,U.patchEventTarget=mv,U.isIEOrEdge=$s,U.ObjectDefineProperty=ec,U.ObjectGetOwnPropertyDescriptor=uo,U.ObjectCreate=cT,U.ArraySlice=hv,U.patchClass=po,U.wrapWithCurrentZone=oi,U.filterProperties=ac,U.attachOriginToPatched=Ss,U._redefineProperty=Object.defineProperty,U.patchCallbacks=vp,U.getGlobalObjects=()=>({globalSources:pp,zoneSymbolEventNames:rr,eventNames:ee,isBrowser:sa,isMix:fo,isNode:Tl,TRUE_STR:ir,FALSE_STR:Hr,ZONE_SYMBOL_PREFIX:ho,ADD_EVENT_LISTENER_STR:up,REMOVE_EVENT_LISTENER_STR:tc})})}(z)})(Ep),function yp(z){z.__load_patch("legacy",H=>{const ne=H[z.__symbol__("legacyPatch")];ne&&ne()}),z.__load_patch("timers",H=>{const U="clear";ca(H,"set",U,"Timeout"),ca(H,"set",U,"Interval"),ca(H,"set",U,"Immediate")}),z.__load_patch("requestAnimationFrame",H=>{ca(H,"request","cancel","AnimationFrame"),ca(H,"mozRequest","mozCancel","AnimationFrame"),ca(H,"webkitRequest","webkitCancel","AnimationFrame")}),z.__load_patch("blocking",(H,ne)=>{const U=["alert","prompt","confirm"];for(let ee=0;ee<U.length;ee++)Hs(H,U[ee],(Qe,We,rt)=>function(yt,He){return ne.current.run(Qe,H,He,rt)})}),z.__load_patch("EventTarget",(H,ne,U)=>{(function Vd(z,H){H.patchEventPrototype(z,H)})(H,U),function Bd(z,H){if(Zone[H.symbol("patchEventTarget")])return;const{eventNames:ne,zoneSymbolEventNames:U,TRUE_STR:ee,FALSE_STR:Se,ZONE_SYMBOL_PREFIX:Qe}=H.getGlobalObjects();for(let rt=0;rt<ne.length;rt++){const yt=ne[rt],Ut=Qe+(yt+Se),_n=Qe+(yt+ee);U[yt]={},U[yt][Se]=Ut,U[yt][ee]=_n}const We=z.EventTarget;We&&We.prototype&&H.patchEventTarget(z,H,[We&&We.prototype])}(H,U);const ee=H.XMLHttpRequestEventTarget;ee&&ee.prototype&&U.patchEventTarget(H,U,[ee.prototype])}),z.__load_patch("MutationObserver",(H,ne,U)=>{po("MutationObserver"),po("WebKitMutationObserver")}),z.__load_patch("IntersectionObserver",(H,ne,U)=>{po("IntersectionObserver")}),z.__load_patch("FileReader",(H,ne,U)=>{po("FileReader")}),z.__load_patch("on_property",(H,ne,U)=>{!function _p(z,H){if(Tl&&!fo||Zone[z.symbol("patchEvents")])return;const ne=H.__Zone_ignore_on_properties;let U=[];if(sa){const ee=window;U=U.concat(["Document","SVGElement","Element","HTMLElement","HTMLBodyElement","HTMLMediaElement","HTMLFrameSetElement","HTMLFrameElement","HTMLIFrameElement","HTMLMarqueeElement","Worker"]);const Se=[];Ti(ee,Al(ee),ne&&ne.concat(Se),as(ee))}U=U.concat(["XMLHttpRequest","XMLHttpRequestEventTarget","IDBIndex","IDBRequest","IDBOpenDBRequest","IDBDatabase","IDBTransaction","IDBCursor","WebSocket"]);for(let ee=0;ee<U.length;ee++){const Se=H[U[ee]];Se?.prototype&&Ti(Se.prototype,Al(Se.prototype),ne)}}(U,H)}),z.__load_patch("customElements",(H,ne,U)=>{!function Nn(z,H){const{isBrowser:ne,isMix:U}=H.getGlobalObjects();(ne||U)&&z.customElements&&"customElements"in z&&H.patchCallbacks(H,z.customElements,"customElements","define",["connectedCallback","disconnectedCallback","adoptedCallback","attributeChangedCallback","formAssociatedCallback","formDisabledCallback","formResetCallback","formStateRestoreCallback"])}(H,U)}),z.__load_patch("XHR",(H,ne)=>{!function yt(He){const xt=He.XMLHttpRequest;if(!xt)return;const Ut=xt.prototype;let xn=Ut[nc],Jn=Ut[vi];if(!xn){const bt=He.XMLHttpRequestEventTarget;if(bt){const O=bt.prototype;xn=O[nc],Jn=O[vi]}}const Pi="readystatechange",Qn="scheduled";function Te(bt){const O=bt.data,Lt=O.target;Lt[Qe]=!1,Lt[rt]=!1;const On=Lt[Se];xn||(xn=Lt[nc],Jn=Lt[vi]),On&&Jn.call(Lt,Pi,On);const Rt=Lt[Se]=()=>{if(Lt.readyState===Lt.DONE)if(!O.aborted&&Lt[Qe]&&bt.state===Qn){const Ze=Lt[ne.__symbol__("loadfalse")];if(0!==Lt.status&&Ze&&Ze.length>0){const N=bt.invoke;bt.invoke=function(){const G=Lt[ne.__symbol__("loadfalse")];for(let ke=0;ke<G.length;ke++)G[ke]===bt&&G.splice(ke,1);!O.aborted&&bt.state===Qn&&N.call(bt)},Ze.push(bt)}else bt.invoke()}else!O.aborted&&!1===Lt[Qe]&&(Lt[rt]=!0)};return xn.call(Lt,Pi,Rt),Lt[U]||(Lt[U]=bt),Ht.apply(Lt,O.args),Lt[Qe]=!0,bt}function Ne(){}function pn(bt){const O=bt.data;return O.aborted=!0,Gt.apply(O.target,O.args)}const yn=Hs(Ut,"open",()=>function(bt,O){return bt[ee]=0==O[2],bt[We]=O[1],yn.apply(bt,O)}),lt=cn("fetchTaskAborting"),et=cn("fetchTaskScheduling"),Ht=Hs(Ut,"send",()=>function(bt,O){if(!0===ne.current[et]||bt[ee])return Ht.apply(bt,O);{const Lt={target:bt,url:bt[We],isPeriodic:!1,args:O,aborted:!1},On=_t("XMLHttpRequest.send",Ne,Lt,Te,pn);bt&&!0===bt[rt]&&!Lt.aborted&&On.state===Qn&&On.invoke()}}),Gt=Hs(Ut,"abort",()=>function(bt,O){const Lt=function _n(bt){return bt[U]}(bt);if(Lt&&"string"==typeof Lt.type){if(null==Lt.cancelFn||Lt.data&&Lt.data.aborted)return;Lt.zone.cancelTask(Lt)}else if(!0===ne.current[lt])return Gt.apply(bt,O)})}(H);const U=cn("xhrTask"),ee=cn("xhrSync"),Se=cn("xhrListener"),Qe=cn("xhrScheduled"),We=cn("xhrURL"),rt=cn("xhrErrorBeforeScheduled")}),z.__load_patch("geolocation",H=>{H.navigator&&H.navigator.geolocation&&function rc(z,H){const ne=z.constructor.name;for(let U=0;U<H.length;U++){const ee=H[U],Se=z[ee];if(Se){if(!Fd(uo(z,ee)))continue;z[ee]=(We=>{const rt=function(){return We.apply(this,Ld(arguments,ne+"."+ee))};return Ss(rt,We),rt})(Se)}}}(H.navigator.geolocation,["getCurrentPosition","watchPosition"])}),z.__load_patch("PromiseRejectionEvent",(H,ne)=>{function U(ee){return function(Se){oc(H,ee).forEach(We=>{const rt=H.PromiseRejectionEvent;if(rt){const yt=new rt(ee,{promise:Se.promise,reason:Se.rejection});We.invoke(yt)}})}}H.PromiseRejectionEvent&&(ne[cn("unhandledPromiseRejectionHandler")]=U("unhandledrejection"),ne[cn("rejectionHandledHandler")]=U("rejectionhandled"))}),z.__load_patch("queueMicrotask",(H,ne,U)=>{!function lT(z,H){H.patchMethod(z,"queueMicrotask",ne=>function(U,ee){Zone.current.scheduleMicroTask("queueMicrotask",ee[0])})}(H,U)})}(Ep)}},Sr=>{Sr(Sr.s=398)}]);